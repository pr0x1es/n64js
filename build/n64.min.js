var yH=Object.defineProperty;var EH=(J,Z)=>{for(var q in Z)yH(J,q,{get:Z[q],enumerable:!0,configurable:!0,set:(Q)=>Z[q]=()=>Q})};var x6=31,A8=0,O4=1,y4=2,E4=3,T4=4,S4=5,h2=6,R2=7,_4=8,s9=9,M9=10,w8=11,_0=12,c0=13,t6=14,o5=15,v4=16,d5=17;var b2=20,D2=21,A2=22,w2=23,B2=24,I2=25,_q=26,vq=27,fq=28,uq=29,f4=30,C2=31,O2=2,xq=0,gq=1,y2=2,E2=3,mq=4,pq=5;var aq=8,cq=9,oq=10,dq=11,nq=12,lq=13;var rq=15;function tq(J){switch(J){case 67:case 68:case 70:case 72:case 73:case 76:case 80:case 83:case 85:case 87:case 88:case 89:case 96:return 0;case 66:return 2;case 55:case 65:case 69:case 71:case 74:case 75:case 78:return 1}return 1}function eq(J){const Z=String.fromCharCode(J),q=TH.get(Z);if(q)return q;return`unknown code ${Z}`}var B8=0,x4=1,sq=2;var iq=69;var TH=new Map([["N","Game Pak"],["D","64DD Disk"],["C","Expandable Game: Game Pak Part"],["E","Expandable Game: 64DD Disk Part"],["Z","Aleck64 Game Pak"]]);function JQ(J,Z,q){const Q=Z.sp_mem.subRegion(4096,4096);J.setControlU64(_0,0x00000000_34000000n),J.setControlU64(v4,0x00000000_7006e463n),J.setControlU64(s9,0x00000000_00005000n),J.setControlU64(c0,0x00000000_0000005cn),J.setControlU64(o5,0x00000000_00000b22n),J.setControlU64(T4,0x00000000_007ffff0n),J.setControlU64(t6,0xffffffff_ffffffffn),J.setControlU64(_4,0xffffffff_ffffffffn),J.setControlU64(f4,0xffffffff_ffffffffn),J.cop1ControlChanged();const W=0x00000000_00000000n;if(J.setRegU64(0,W),J.setRegU64(1,W),J.setRegU64(2,0xffffffff_d1731be9n),J.setRegU64(3,0xffffffff_d1731be9n),J.setRegU64(4,0x00000000_00001be9n),J.setRegU64(5,0xffffffff_f45231e5n),J.setRegU64(6,0xffffffff_a4001f0cn),J.setRegU64(7,0xffffffff_a4001f08n),J.setRegU64(8,0x00000000_000000c0n),J.setRegU64(9,W),J.setRegU64(10,0x00000000_00000040n),J.setRegU64(11,0xffffffff_a4000040n),J.setRegU64(16,W),J.setRegU64(17,W),J.setRegU64(18,W),J.setRegU64(19,W),J.setRegU64(20,BigInt(q.tvType)),J.setRegU64(21,W),J.setRegU64(23,0x00000000_00000006n),J.setRegU64(24,W),J.setRegU64(25,0xffffffff_d73f2993n),J.setRegU64(26,W),J.setRegU64(27,W),J.setRegU64(28,W),J.setRegU64(29,0xffffffff_a4001ff0n),J.setRegU64(30,W),J.setRegU64(31,0xffffffff_a4001554n),q.tvType==B8){switch(q.cic){case"6102":J.setRegU64(5,0xffffffff_c0f1d859n),J.setRegU64(14,0x00000000_2de108ean),J.setRegU64(24,W);break;case"6103":J.setRegU64(5,0xffffffff_d4646273n),J.setRegU64(14,0x00000000_1af99984n),J.setRegU64(24,W);break;case"6105":J.setRegU64(5,0xffffffff_decaaad1n),J.setRegU64(14,0x00000000_0cf85c13n),J.setRegU64(24,0x00000000_00000002n);break;case"6106":J.setRegU64(5,0xffffffff_b04dc903n),J.setRegU64(14,0x00000000_1af99984n),J.setRegU64(24,0x00000000_00000002n);break;default:break}J.setRegU64(20,W),J.setRegU64(23,0x00000000_00000006n),J.setRegU64(31,0xffffffff_a4001554n)}else{switch(q.cic){case"6102":J.setRegU64(5,0xffffffff_c95973d5n),J.setRegU64(14,0x00000000_2449a366n);break;case"6103":J.setRegU64(5,0xffffffff_95315a28n),J.setRegU64(14,0x00000000_5baca1dfn);break;case"6105":J.setRegU64(5,0x00000000_5493fb9an),J.setRegU64(14,0xffffffff_c2c20384n);break;case"6106":J.setRegU64(5,0xffffffff_e067221fn),J.setRegU64(14,0x00000000_5cd2b70fn);break;default:break}J.setRegU64(20,0x00000000_00000001n),J.setRegU64(23,W),J.setRegU64(24,0x00000000_00000003n),J.setRegU64(31,0xffffffff_a4001550n)}switch(q.cic){case"6101":J.setRegU64(22,0x00000000_0000003fn);break;case"6102":J.setRegU64(1,0x00000000_00000001n),J.setRegU64(2,0x00000000_0ebda536n),J.setRegU64(3,0x00000000_0ebda536n),J.setRegU64(4,0x00000000_0000a536n),J.setRegU64(12,0xffffffff_ed10d0b3n),J.setRegU64(13,0x00000000_1402a4ccn),J.setRegU64(15,0x00000000_3103e121n),J.setRegU64(22,0x00000000_0000003fn),J.setRegU64(25,0xffffffff_9debb54fn);break;case"6103":J.setRegU64(1,0x00000000_00000001n),J.setRegU64(2,0x00000000_49a5ee96n),J.setRegU64(3,0x00000000_49a5ee96n),J.setRegU64(4,0x00000000_0000ee96n),J.setRegU64(12,0xffffffff_ce9dfbf7n),J.setRegU64(13,0xffffffff_ce9dfbf7n),J.setRegU64(15,0x00000000_18b63d28n),J.setRegU64(22,0x00000000_00000078n),J.setRegU64(25,0xffffffff_825b21c9n);break;case"6105":Q.set32(0,1007534016),Q.set32(4,q.tvType==B8?3181905916:2376599548),Q.set32(8,632096704),Q.set32(12,822608000),Q.set32(16,1426128892),Q.set32(20,1007534016),Q.set32(24,2376597540),Q.set32(28,1007398912),J.setRegU64(1,W),J.setRegU64(2,0xffffffff_f58b0fbfn),J.setRegU64(3,0xffffffff_f58b0fbfn),J.setRegU64(4,0x00000000_00000fbfn),J.setRegU64(12,0xffffffff_9651f81en),J.setRegU64(13,0x00000000_2d42aac5n),J.setRegU64(15,0x00000000_56584d60n),J.setRegU64(22,0x00000000_00000091n),J.setRegU64(25,0xffffffff_cdce565fn);break;case"6106":J.setRegU64(1,W),J.setRegU64(2,0xffffffff_a95930a4n),J.setRegU64(3,0xffffffff_a95930a4n),J.setRegU64(4,0x00000000_000030a4n),J.setRegU64(12,0xffffffff_bcb59510n),J.setRegU64(13,0xffffffff_bcb59510n),J.setRegU64(15,0x00000000_7a3c07f4n),J.setRegU64(22,0x00000000_00000085n),J.setRegU64(25,0x00000000_465e3f72n);break;default:break}J.pc=2751463488}var T2=function(J){return(J>>26&63)===28};class S2{constructor(J){this.hardware=J,this.breakpoints=new Map}reset(){this.breakpoints.clear()}toggle(J){const Z=this.hardware.memMap.readMemoryInternal32(J);let q;if(T2(Z))q=this.breakpoints[J]||0,delete this.breakpoints[J];else q=28<<26,this.breakpoints[J]=Z;this.hardware.memMap.writeMemoryInternal32(J,q)}isBreakpoint(J){const Z=this.hardware.memMap.readMemoryInternal32(J);return T2(Z)}getInstruction(J){const Z=this.hardware.memMap.readMemoryInternal32(J);if(T2(Z))return this.breakpoints[J]||0;return Z}}function ZQ(J,Z){let q=J.toString();while(q.length<Z)q="0"+q;return q}function v(J,Z){let q;if(typeof J=="bigint"){const W=Z?(1n<<BigInt(Z))-1n:0xffff_ffff_ffff_ffffn;q=J&W}else{const W=Z&&Z<32?(1<<Z)-1:4294967295;q=(Number(J)&W)>>>0}let Q=q.toString(16);if(Z){const W=Z>>2;while(Q.length<W)Q="0"+Q}return Q}function v0(J){return"0x"+v(J,8)}function Z0(J){return"0x"+v(J,16)}function k(J){return"0x"+v(J,32)}function P9(J){return"0x"+v(J,64)}function t(J){return J.nameOf=(Z)=>{for(let q in J)if(Object.prototype.hasOwnProperty.call(J,q)&&J[q]===Z)return q;return k(Z)},Object.freeze(J)}var KQ=32768,XQ=16384,_2=8192,YQ=4096,zQ=2048,FQ=1024,HQ=512,GQ=256,$Q=32,jQ=16,kQ=8,NQ=4,LQ=2,MQ=1,A0=t({RightBottom:0,RightRight:1,RightLeft:2,RightTop:3,TopLeft:4,TopRight:5,BottomLeft:6,BottomRight:7,CenterLeft:8,CenterRight:9,LeftStick:10,RightStick:11,LeftTop:12,LeftBottom:13,LeftLeft:14,LeftRight:15,CenterCenter:16}),qQ=17,QQ=t({AxisLeftX:0,AxisLeftY:1,AxisRightX:2,AxisRightY:3}),WQ=4;class g4{constructor(){this.buttons=0,this.stick_x=0,this.stick_y=0}}class v2{constructor(){this.inputs=[new g4,new g4,new g4,new g4];const J=document.querySelector("body");J.addEventListener("keyup",(Z)=>{this.handleKey(0,Z.key,!1)}),J.addEventListener("keydown",(Z)=>{this.handleKey(0,Z.key,!0)}),this.gamepads={},this.activeGamepadidx=-1,window.addEventListener("gamepadconnected",(Z)=>{this.connectGamepad(Z)},!1),window.addEventListener("gamepaddisconnected",(Z)=>{this.disconnectGamepad(Z)},!1),this.controllerMapping=new PQ}handleKey(J,Z,q){switch(Z){case"a":this.setButton(J,YQ,q);break;case"s":this.setButton(J,KQ,q);break;case"x":this.setButton(J,XQ,q);break;case"z":this.setButton(J,_2,q);break;case"y":this.setButton(J,_2,q);break;case"c":this.setButton(J,$Q,q);break;case"v":this.setButton(J,jQ,q);break;case"t":this.setButton(J,zQ,q);break;case"g":this.setButton(J,FQ,q);break;case"f":this.setButton(J,HQ,q);break;case"h":this.setButton(J,GQ,q);break;case"i":this.setButton(J,kQ,q);break;case"k":this.setButton(J,NQ,q);break;case"j":this.setButton(J,LQ,q);break;case"l":this.setButton(J,MQ,q);break;case"ArrowLeft":this.setStickX(J,q?-80:0);break;case"ArrowRight":this.setStickX(J,q?80:0);break;case"ArrowDown":this.setStickY(J,q?-80:0);break;case"ArrowUp":this.setStickY(J,q?80:0);break}}setStickX(J,Z){this.inputs[J].stick_x=Z}setStickY(J,Z){this.inputs[J].stick_y=Z}setButton(J,Z,q){let Q=this.inputs[J].buttons;if(q)Q|=Z;else Q&=~Z;this.inputs[J].buttons=Q}connectGamepad(J){const Z=J.gamepad;if(console.log(`Gamepad connected at index ${Z.index}: ${Z.id}. ${Z.buttons.length} buttons, ${Z.axes.length} axes.`),this.gamepads[Z.index]=Z,this.activeGamepadidx<0)if(this.isStandardGamepad(Z))this.activeGamepadidx=Z.index;else console.log("Gamepad mapping is non-standard, ignoring")}disconnectGamepad(J){const Z=J.gamepad;if(delete this.gamepads[Z.index],Z.index==this.activeGamepadidx)this.activeGamepadidx=-1}isStandardGamepad(J){if(J.mapping!=="standard")return console.log(`gamepad mapping is unhandled: (${J.mapping})`),!1;if(J.axes.length<WQ)return console.log(`gamepad has too few axes: ${J.axes.length} < ${WQ}`),!1;if(J.buttons.length<qQ)return console.log(`gamepad has too few buttons: ${J.buttons.length} < ${qQ}`),!1;if(typeof J.buttons[0]!=="object")return console.log("gamepad buttons element is not object"),!1;return!0}updateInput(){if(this.activeGamepadidx<0)return;const J=navigator.getGamepads()[this.activeGamepadidx];if(!J.connected){console.log("gamepad not connected");return}const Z=J.buttons;this.controllerMapping.mappings.forEach((q,Q)=>{if(q.gpModifier===void 0?!0:Z[q.gpModifier].pressed==q.gpModifierDown)this.setButton(0,Q,Z[q.gpButton].pressed)}),this.setStickX(0,J.axes[QQ.AxisLeftX]*80),this.setStickY(0,J.axes[QQ.AxisLeftY]*-80)}}class PQ{constructor(){const J=new Map;this.mappings=J,J.set(kQ,new l0(A0.RightTop,A0.BottomLeft,!0)),J.set(NQ,new l0(A0.RightBottom,A0.BottomLeft,!0)),J.set(LQ,new l0(A0.RightLeft,A0.BottomLeft,!0)),J.set(MQ,new l0(A0.RightRight,A0.BottomLeft,!0)),J.set(KQ,new l0(A0.RightBottom,A0.BottomLeft,!1)),J.set(XQ,new l0(A0.RightRight,A0.BottomLeft,!1)),J.set($Q,new l0(A0.TopLeft)),J.set(jQ,new l0(A0.TopRight)),J.set(YQ,new l0(A0.CenterRight)),J.set(_2,new l0(A0.BottomRight)),J.set(zQ,new l0(A0.LeftTop)),J.set(FQ,new l0(A0.LeftBottom)),J.set(HQ,new l0(A0.LeftLeft)),J.set(GQ,new l0(A0.LeftRight))}}class l0{constructor(J,Z,q){this.gpButton=J,this.gpModifier=Z,this.gpModifierDown=q}}function VQ(J,Z){F6=J,m4=Z}function UQ(){if(F6)F6.html("")}function U(J){if(m4)J=`${m4()}: ${J}`;if(console.log(J),F6)F6.append(`${J}<br>`),F6.scrollTop(F6[0].scrollHeight)}function hQ(J){if(m4)J=`${m4()}: ${J}`;if(console.warn(J),F6)F6.append(`<font color="yellow">${J}</font><br>`),F6.scrollTop(F6[0].scrollHeight)}function RQ(J){if(F6)F6.append(J)}var F6,m4;function bQ(){i9=void 0,e6=void 0}function DQ(){return i9||e6?!0:!1}function AQ(J){let q=J;for(let Q of[i9,e6]){if(!Q)continue;if(!Q.tick())q=0;let W=Math.floor(Q.getAvailableBytes()/8);W=Math.max(0,W-100),q=Math.min(q,W)}return q}var i9=null,e6=null;function IQ(J,Z,q){let Q=11,W=wQ;for(let K=0;K<q;K++){Z[K]=Q+5*J[K]&15,Q=W[Z[K]];const X=Z[K]>>3&1;let z=((X==1?~Z[K]:Z[K])&7)%3==1?X:1-X;if(W==BQ){if(Z[K]==1||Z[K]==9)z=1;if(Z[K]==11||Z[K]==14)z=0}W=z==1?BQ:wQ}}var wQ=[4,7,10,7,14,5,14,1,12,15,8,15,6,3,6,9],BQ=[4,1,10,7,14,5,14,1,12,9,8,5,6,3,12,9];var _Q=function(J,Z,q){let Q=0;for(let W=0;W<q;W++){const K=J[Z+W];for(let X=0;X<8;X++)Q=(Q<<1|K>>>7-X&1)^(Q&128?133:0)}for(let W=8;W!==0;W--)Q=Q<<1^(Q&128?133:0);return Q&255},vQ=function(J){let Z=0;for(let q=0;q<16;q++)Z=(Z<<1|J>>>15-q&1)^(Z&16?21:0);return Z&31},_H=5,p4=64,CQ=63,fQ=0,vH=1,fH=2,uH=3,xH=4,gH=5,mH=6,pH=7,aH=8,uQ=255,cH=0,oH=253,OQ=254,dH=255,yQ=0,f2=1,EQ=2,TQ=16,nH=128,lH=192,SQ=1280;var rH=64,sH=128;class u2{constructor(J,Z){this.hardware=J,this.pifRam=this.hardware.pif_mem.subRegion(1984,64);const q=new a4(Z[0]);q.present=!0,q.attachControllerPack(J.mempacks[0]),this.channels=[q,new a4(Z[1]),new a4(Z[2]),new a4(Z[3]),new xQ(J)]}get controlByte(){return this.pifRam.getU8(CQ)}set controlByte(J){this.pifRam.set8(CQ,J)}cpuRead(J){}cpuWrite(J){}dmaWrite(J,Z){if(this.pifRam.copy(0,J,Z,p4),this.controlByte&1)this.controlByte&=~1,this.configure()}dmaRead(J,Z){if(this.controlByte&2)this.processCICChallenge();else this.execute();J.copy(Z,this.pifRam,0,p4)}processCICChallenge(){const J=new Uint8Array(30),Z=new Uint8Array(30);for(let q=0;q<15;++q)J[q*2+0]=this.pifRam.u8[48+q]>>>4&15,J[q*2+1]=this.pifRam.u8[48+q]>>>0&15;IQ(J,Z,30);for(let q=0;q<15;++q)this.pifRam.u8[48+q]=(Z[q*2]<<4)+Z[q*2+1];this.pifRam.u8[46]=0,this.pifRam.u8[47]=0}configure(){for(let q of this.channels)q.init();let J=0,Z=0;while(J<p4&&Z<_H){const q=this.pifRam.u8.subarray(J),Q=q[0];if(J++,Q==OQ)break;if(Q==dH)continue;if(Q==cH){Z++;continue}if(Q==oH){this.channels[Z].reset=!0,Z++;continue}if(J>=p4)break;const W=q[1];if(J++,W==OQ)break;const K=Q&63,X=J;J+=K;const Y=W&63,z=J;if(J+=Y,J>=p4)break;const G=this.pifRam.u8.subarray(X,X+K),H=this.pifRam.u8.subarray(z,z+Y);this.channels[Z].joybusConfigure(q,K,Y,G,H),Z++}}execute(){for(let J of this.channels){if(J.reset)continue;if(J.skip)continue;const Z=J.frame[0],q=J.frame[1];if(Z&128)continue;if(Z&64)continue;const Q=Z&63,W=q&63,K=J.joybusCommand(Q,W,J.txBuf,J.rxBuf);if(K<W)J.frame[1]|=sH;if(K>W)J.frame[1]|=rH}}}class x2{constructor(){this.init()}expectTx(J,Z,q){if(Z!=q)U(`${J}: got tx ${Z} but expect ${q}`)}init(){this.frame=0,this.tx=0,this.rx=0,this.txBuf=null,this.rxBuf=null,this.skip=!0,this.reset=!1}joybusConfigure(J,Z,q,Q,W){this.frame=J,this.tx=Z,this.rx=q,this.txBuf=Q,this.rxBuf=W,this.skip=!1}}class a4 extends x2{constructor(J){super();this.inputs=J,this.present=!1,this.attachment=yQ,this.memory=null,this.rumbleActive=!1}attachControllerPack(J){this.attachment=f2,this.memory=J}joybusCommand(J,Z,q,Q){if(!this.present)return 0;const W=q[0];switch(W){case uQ:return this.getStatus(J,Z,q,Q);case fQ:return this.getStatus(J,Z,q,Q);case vH:return this.readController(J,Z,q,Q);case fH:return this.readAccessory(J,Z,q,Q);case uH:return this.writeAccessory(J,Z,q,Q)}return n64js.halt("Unknown controller command "+W),0}getStatus(J,Z,q,Q){return this.expectTx("kCmdGetStatus",J,1),Q[0]=SQ>>>8,Q[1]=SQ&255,Q[2]=this.attachment==yQ?2:1,3}readController(J,Z,q,Q){this.expectTx("kCmdControllerRead",J,1);let W=this.inputs.buttons,K=this.inputs.stick_x,X=this.inputs.stick_y;if(e6)e6.sync32(3203395597,"input"),W=e6.reflect32(W),K=e6.reflect32(K),X=e6.reflect32(X);return Q[0]=W>>>8,Q[1]=W&255,Q[2]=K,Q[3]=X,4}readAccessory(J,Z,q,Q){this.expectTx("kCmdControllerAccessoryRead",J,3);const W=q[1]<<8|q[2]&224;if((q[2]&31)!=vQ(W))return 0;switch(this.attachment){case f2:const X=this.memory.data;for(let Y=0,z=W;Y<Z-1;Y++,z++)Q[Y]=z<X.length?X[z]:0;break;case EQ:for(let Y=0,z=W;Y<Z-1;Y++,z++){let G;if(z<32768)G=0;else if(z<36864)G=128;else G=this.rumbleActive?255:0;Q[Y]=G}break;default:return 0}return Q[Z-1]=_Q(Q,0,Z-1),Z}writeAccessory(J,Z,q,Q){this.expectTx("kCmdControllerAccessoryWrite",J,35);const W=q[1]<<8|q[2]&224;if((q[2]&31)!=vQ(W))return 0;switch(this.attachment){case f2:const X=this.memory.data;this.memory.dirty=!0;for(let Y=0,z=W;Y<J-3;Y++,z++)if(z<X.length)X[z]=q[3+Y];break;case EQ:if(W>=49152)this.rumbleActive=q[3]&1;break;default:return 0}return Q[Z-1]=_Q(q,3,J-3),Z}}class xQ extends x2{constructor(J){super();this.hardware=J}joybusCommand(J,Z,q,Q){const W=q[0];switch(W){case uQ:return this.getStatus(J,Z,q,Q);case fQ:return this.getStatus(J,Z,q,Q);case xH:return this.readEeprom(J,Z,q,Q);case gH:return this.writeEeprom(J,Z,q,Q);case mH:return this.rtcStatus(J,Z,q,Q);case pH:return this.rtcRead(J,Z,q,Q);case aH:return this.rtcWrite(J,Z,q,Q)}return n64js.halt(`Unknown cartridge command: ${W}`),0}getEepromID(){switch(this.hardware.saveType){case"Eeprom4k":return nH;case"Eeprom16k":return lH}return 0}getEeprom(){switch(this.hardware.saveType){case"Eeprom4k":case"Eeprom16k":return this.hardware.saveMem}return null}getStatus(J,Z,q,Q){this.expectTx("kCmdGetStatus",J,1);const W=this.getEepromID();if(!W)return 0;return Q[0]=W>>>8,Q[1]=W&255,Q[2]=0,3}readEeprom(J,Z,q,Q){this.expectTx("kCmdEepromRead",J,2);const W=this.getEeprom();if(!W)return 0;const K=q[1]*8;for(let X=0;X<Z;++X)Q[X]=W.u8[K+X];return Z}writeEeprom(J,Z,q,Q){this.expectTx("kCmdEepromWrite",J,10);const W=this.getEeprom();if(!W)return 0;const K=q[1]*8;for(let X=0;X<J-2;++X)W.u8[K+X]=q[2+X];return this.hardware.saveDirty=!0,Q[0]=0,1}rtcStatus(J,Z,q,Q){return Q[0]=TQ>>>8,Q[1]=TQ&255,Q[2]=0,3}rtcRead(J,Z,q,Q){return n64js.warn("rtc read unhandled"),0}rtcWrite(J,Z,q,Q){return n64js.warn("rtc write unhandled"),0}}function J0(J,Z){if(!J)throw new gQ(Z)}class gQ{constructor(J){this.message=J}toString(){return"AssertException: "+this.message}}function I8(J){return J>>>26&63}function C8(J){return J>>>16&31}function O8(J){return J&63}function H6(J){return J>>>21&31}function mQ(J){return J>>>16&3}function G6(J){return J&63}function J9(J){return J>>>6&31}function Y0(J){return J>>>11&31}function g6(J){return J>>>16&31}function G0(J){return(J&65535)<<16>>16}function e0(J){return J>>>6&31}function u(J){return J>>>11&31}function D(J){return J>>>16&31}function O(J){return J>>>21&31}function y8(J){return J&63}function iH(J){return J&67108863}function Z9(J){return J&65535}function x(J){return(J&65535)<<16>>16}function c(J){return J>>>21&31}function o0(J,Z){return J+4+G0(Z)*4>>>0}function V9(J,Z){return(J&4026531840|iH(Z)*4)>>>0}var tH=function(J){return G0(J)&65535},pQ=function(J){return G0(J)<<16>>16},R=function(){return"?"},JG=function(J){return cQ[O8(J.opcode)](J)},ZG=function(J){return oQ[H6(J.opcode)](J)},qG=function(J){switch(J0((J.opcode>>>18&7)===0,"cc bit is not 0"),mQ(J.opcode)){case 0:return`BC1F      !c ? --> ${J.branchAddress}`;case 1:return`BC1T      c ? --> ${J.branchAddress}`;case 2:return`BC1FL     !c ? --> ${J.branchAddress}`;case 3:return`BC1TL     c ? --> ${J.branchAddress}`}return"???"},n5=function(J,Z){const q=Z.toUpperCase();switch(G6(J.opcode)){case 0:return`ADD.${q}     ${J.fd(Z)} = ${J.fs(Z)} + ${J.ft(Z)}`;case 1:return`SUB.${q}     ${J.fd(Z)} = ${J.fs(Z)} - ${J.ft(Z)}`;case 2:return`MUL.${q}     ${J.fd(Z)} = ${J.fs(Z)} * ${J.ft(Z)}`;case 3:return`DIV.${q}     ${J.fd(Z)} = ${J.fs(Z)} / ${J.ft(Z)}`;case 4:return`SQRT.${q}    ${J.fd(Z)} = sqrt(${J.fs(Z)})`;case 5:return`ABS.${q}     ${J.fd(Z)} = abs(${J.fs(Z)})`;case 6:return`MOV.${q}     ${J.fd(Z)} = ${J.fs(Z)}`;case 7:return`NEG.${q}     ${J.fd(Z)} = -${J.fs(Z)}`;case 8:return`ROUND.L.${q} ${J.fd("l")} = round.l(${J.fs(Z)})`;case 9:return`TRUNC.L.${q} ${J.fd("l")} = trunc.l(${J.fs(Z)})`;case 10:return`CEIL.L.${q}  ${J.fd("l")} = ceil.l(${J.fs(Z)})`;case 11:return`FLOOR.L.${q} ${J.fd("l")} = floor.l(${J.fs(Z)})`;case 12:return`ROUND.W.${q} ${J.fd("w")} = round.w(${J.fs(Z)})`;case 13:return`TRUNC.W.${q} ${J.fd("w")} = trunc.w(${J.fs(Z)})`;case 14:return`CEIL.W.${q}  ${J.fd("w")} = ceil.w(${J.fs(Z)})`;case 15:return`FLOOR.W.${q} ${J.fd("w")} = floor.w(${J.fs(Z)})`;case 32:return`CVT.S.${q}   ${J.fd("s")} = (s)${J.fs(Z)}`;case 33:return`CVT.D.${q}   ${J.fd("d")} = (d)${J.fs(Z)}`;case 36:return`CVT.W.${q}   ${J.fd("w")} = (w)${J.fs(Z)}`;case 37:return`CVT.L.${q}   ${J.fd("l")} = (l)${J.fs(Z)}`;case 48:return`C.F.${q}     c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 49:return`C.UN.${q}    c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 50:return`C.EQ.${q}    c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 51:return`C.UEQ.${q}   c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 52:return`C.OLT.${q}   c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 53:return`C.ULT.${q}   c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 54:return`C.OLE.${q}   c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 55:return`C.ULE.${q}   c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 56:return`C.SF.${q}    c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 57:return`C.NGLE.${q}  c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 58:return`C.SEQ.${q}   c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 59:return`C.NGL.${q}   c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 60:return`C.LT.${q}    c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 61:return`C.NGE.${q}   c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 62:return`C.LE.${q}    c = ${J.fs(Z)} cmp ${J.ft(Z)}`;case 63:return`C.NGT.${q}   c = ${J.fs(Z)} cmp ${J.ft(Z)}`}return`Cop1.${Z}${v(G6(J.opcode),8)}?`},QG=function(J){return n5(J,"s")},WG=function(J){return n5(J,"d")},KG=function(J){return n5(J,"w")},XG=function(J){return n5(J,"l")},YG=function(J){return dQ[H6(J.opcode)](J)},zG=function(J){return nQ[H6(J.opcode)](J)},FG=function(J){return lQ[H6(J.opcode)](J)},HG=function(J){switch(y8(J.opcode)){case 1:return"TLBR";case 2:return"TLBWI";case 6:return"TLBWR";case 8:return"TLBP";case 24:return"ERET"}return"Unk"},GG=function(J){return rQ[C8(J.opcode)](J)};function p2(J,Z,q){const Q=new aQ(J,Z,q),W=sQ[I8(Z)](Q);return{instruction:Q,disassembly:W,isJumpTarget:!1}}function iQ(J,Z,q){const Q=n64js.breakpoints(),W=[],K=new Set;for(let X=J;X<Z;X+=4){const Y=Q.getInstruction(X),z=p2(X,Y,q);if(z.instruction.target)K.add(z.instruction.target);W.push(z)}for(let X of W)if(K.has(X.instruction.address))X.isJumpTarget=!0;return W}window.n64js=window.n64js||{};var g2=["r0","at","v0","v1","a0","a1","a2","a3","t0","t1","t2","t3","t4","t5","t6","t7","s0","s1","s2","s3","s4","s5","s6","s7","t8","t9","k0","k1","gp","sp","s8","ra"],E8=["Index","Rand","EntryLo0","EntryLo1","Context","PageMask","Wired","?7","BadVAddr","Count","EntryHi","Compare","SR","Cause","EPC","PrID","Config","LLAddr","WatchLo","WatchHi","XContext","?21","?22","?23","?24","?25","ECC","CacheErr","TagLo","TagHi","ErrorEPC","?31"],m2=["f00","f01","f02","f03","f04","f05","f06","f07","f08","f09","f10","f11","f12","f13","f14","f15","f16","f17","f18","f19","f20","f21","f22","f23","f24","f25","f26","f27","f28","f29","f30","f31"],eH=["GR00","GR01","GR02","GR03","GR04","GR05","GR06","GR07","GR08","GR09","GR10","GR11","GR12","GR13","GR14","GR15","GR16","GR17","GR18","GR19","GR20","GR21","GR22","GR23","GR24","GR25","GR26","GR27","GR28","GR29","GR30","GR31"];class aQ{constructor(J,Z,q){this.address=J,this.opcode=Z,this.srcRegs={},this.dstRegs={},this.target="",this.memory=null,this.outputHTML=q}get rt_d(){const J=this.cop0RegName(D);return this.dstRegs[J]=1,this.makeRegSpan(J)}get rd(){const J=this.cop0RegName(u);return this.dstRegs[J]=1,this.makeRegSpan(J)}get rt(){const J=this.cop0RegName(D);return this.srcRegs[J]=1,this.makeRegSpan(J)}get rs(){const J=this.cop0RegName(O);return this.srcRegs[J]=1,this.makeRegSpan(J)}get sa(){return e0(this.opcode)}cop0RegName(J){return g2[J(this.opcode)]}writesRA(){return this.dstRegs[x6]=1,""}ft_d(J){const Z=this.cop1RegName(g6,J);return this.dstRegs[Z]=1,this.makeFPRegSpan(Z)}fs_d(J){const Z=this.cop1RegName(Y0,J);return this.dstRegs[Z]=1,this.makeFPRegSpan(Z)}fd(J){const Z=this.cop1RegName(J9,J);return this.dstRegs[Z]=1,this.makeFPRegSpan(Z)}ft(J){const Z=this.cop1RegName(g6,J);return this.srcRegs[Z]=1,this.makeFPRegSpan(Z)}fs(J){const Z=this.cop1RegName(Y0,J);return this.srcRegs[Z]=1,this.makeFPRegSpan(Z)}cop1RegName(J,Z){const q=J(this.opcode),Q=Z?`-${Z}`:"";return m2[q]+Q}get gt_d(){const J=this.cop2RegName(D);return this.dstRegs[J]=1,this.makeRegSpan(J)}get gd(){const J=this.cop2RegName(u);return this.dstRegs[J]=1,this.makeRegSpan(J)}get gt(){const J=this.cop2RegName(D);return this.srcRegs[J]=1,this.makeRegSpan(J)}get gs(){const J=this.cop2RegName(O);return this.srcRegs[J]=1,this.makeRegSpan(J)}cop2RegName(J){return eH[J(this.opcode)]}get imm(){return`0x${v(Z9(this.opcode),16)}`}get branchAddress(){return this.target=o0(this.address,this.opcode),this.makeLabelText(this.target)}get jumpAddress(){return this.target=V9(this.address,this.opcode),this.makeLabelText(this.target)}get base(){const J=this.cop0RegName(c);return this.srcRegs[J]=1,this.makeRegSpan(J)}get offsetU16(){return`0x${v(tH(this.opcode),16)}`}get offsetS16(){return`0x${v(pQ(this.opcode),16)}`}memaccess(J){return this.memory={reg:c(this.opcode),offset:pQ(this.opcode),mode:J},`[${this.base}+${this.offsetU16}]`}memload(){return this.memaccess("load")}memstore(){return this.memaccess("store")}makeLabelText(J){if(this.outputHTML)return`<span class="dis-address-jump">${v(J,32)}</span>`;return v(J,32)}makeRegSpan(J){if(this.outputHTML)return`<span class="dis-reg-${J}">${J}</span>`;return J}makeFPRegSpan(J){const Z=J.replace("-",".");if(this.outputHTML)return`<span class="dis-reg-${J}">${Z}</span>`;return Z}}var cQ=[(J)=>{if(J.opcode===0)return"NOP";return`SLL       ${J.rd} = ${J.rt} << ${J.sa}`},R,(J)=>`SRL       ${J.rd} = ${J.rt} >>> ${J.sa}`,(J)=>`SRA       ${J.rd} = ${J.rt} >> ${J.sa}`,(J)=>`SLLV      ${J.rd} = ${J.rt} << ${J.rs}`,R,(J)=>`SRLV      ${J.rd} = ${J.rt} >>> ${J.rs}`,(J)=>`SRAV      ${J.rd} = ${J.rt} >> ${J.rs}`,(J)=>`JR        ${J.rs}`,(J)=>`JALR      ${J.rd}, ${J.rs}`,R,R,(J)=>`SYSCALL   ${v(J.opcode>>6&1048575,20)}`,(J)=>`BREAK     ${v(J.opcode>>6&1048575,20)}`,R,(J)=>"SYNC",(J)=>`MFHI      ${J.rd} = MultHi`,(J)=>`MTHI      MultHi = ${J.rs}`,(J)=>`MFLO      ${J.rd} = MultLo`,(J)=>`MTLO      MultLo = ${J.rs}`,(J)=>`DSLLV     ${J.rd} = ${J.rt} << ${J.rs}`,R,(J)=>`DSRLV     ${J.rd} = ${J.rt} >>> ${J.rs}`,(J)=>`DSRAV     ${J.rd} = ${J.rt} >> ${J.rs}`,(J)=>`MULT      ${J.rs} * ${J.rt}`,(J)=>`MULTU     ${J.rs} * ${J.rt}`,(J)=>`DIV       ${J.rs} / ${J.rt}`,(J)=>`DIVU      ${J.rs} / ${J.rt}`,(J)=>`DMULT     ${J.rs} * ${J.rt}`,(J)=>`DMULTU    ${J.rs} * ${J.rt}`,(J)=>`DDIV      ${J.rs} / ${J.rt}`,(J)=>`DDIVU     ${J.rs} / ${J.rt}`,(J)=>`ADD       ${J.rd} = ${J.rs} + ${J.rt}`,(J)=>`ADDU      ${J.rd} = ${J.rs} + ${J.rt}`,(J)=>`SUB       ${J.rd} = ${J.rs} - ${J.rt}`,(J)=>`SUBU      ${J.rd} = ${J.rs} - ${J.rt}`,(J)=>`AND       ${J.rd} = ${J.rs} & ${J.rt}`,(J)=>{if(D(J.opcode)===0)if(O(J.opcode)===0)return`CLEAR     ${J.rd} = 0`;else return`MOV       ${J.rd} = ${J.rs}`;return`OR        ${J.rd} = ${J.rs} | ${J.rt}`},(J)=>`XOR       ${J.rd} = ${J.rs} ^ ${J.rt}`,(J)=>`NOR       ${J.rd} = ~( ${J.rs} | ${J.rt} )`,R,R,(J)=>`SLT       ${J.rd} = ${J.rs} < ${J.rt}`,(J)=>`SLTU      ${J.rd} = ${J.rs} < ${J.rt}`,(J)=>`DADD      ${J.rd} = ${J.rs} + ${J.rt}`,(J)=>`DADDU     ${J.rd} = ${J.rs} + ${J.rt}`,(J)=>`DSUB      ${J.rd} = ${J.rs} - ${J.rt}`,(J)=>`DSUBU     ${J.rd} = ${J.rs} - ${J.rt}`,(J)=>`TGE       trap( ${J.rs} >= ${J.rt} )`,(J)=>`TGEU      trap( ${J.rs} >= ${J.rt} )`,(J)=>`TLT       trap( ${J.rs} < ${J.rt} )`,(J)=>`TLTU      trap( ${J.rs} < ${J.rt} )`,(J)=>`TEQ       trap( ${J.rs} == ${J.rt} )`,R,(J)=>`TNE       trap( ${J.rs} != ${J.rt} )`,R,(J)=>`DSLL      ${J.rd} = ${J.rt} << ${J.sa}`,R,(J)=>`DSRL      ${J.rd} = ${J.rt} >>> ${J.sa}`,(J)=>`DSRA      ${J.rd} = ${J.rt} >> ${J.sa}`,(J)=>`DSLL32    ${J.rd} = ${J.rt} << (32+${J.sa})`,R,(J)=>`DSRL32    ${J.rd} = ${J.rt} >>> (32+${J.sa})`,(J)=>`DSRA32    ${J.rd} = ${J.rt} >> (32+${J.sa})`];if(cQ.length!=64)throw"Oops, didn't build the special table correctly";var oQ=[(J)=>`MFC0      ${J.rt} <- ${E8[Y0(J.opcode)]}`,(J)=>`DMFC0     ${J.rt} <- ${E8[Y0(J.opcode)]}`,R,R,(J)=>`MTC0      ${J.rt} -> ${E8[Y0(J.opcode)]}`,(J)=>`DMTC0     ${J.rt} -> ${E8[Y0(J.opcode)]}`,R,R,R,R,R,R,R,R,R,R,HG,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R];if(oQ.length!=32)throw"Oops, didn't build the cop0 table correctly";var dQ=[(J)=>`MFC1      ${J.rt_d} = ${J.fs()}`,(J)=>`DMFC1     ${J.rt_d} = ${J.fs()}`,(J)=>`CFC1      ${J.rt_d} = CCR${u(J.opcode)}`,(J)=>`DCFC1     ${J.rt_d} = CCR${u(J.opcode)}`,(J)=>`MTC1      ${J.fs_d()} = ${J.rt}`,(J)=>`DMTC1     ${J.fs_d()} = ${J.rt}`,(J)=>`CTC1      CCR${u(J.opcode)} = ${J.rt}`,(J)=>`DCTC1     CCR${u(J.opcode)} = ${J.rt}`,qG,R,R,R,R,R,R,R,QG,WG,R,R,KG,XG,R,R,R,R,R,R,R,R,R,R];if(dQ.length!=32)throw"Oops, didn't build the cop1 table correctly";var nQ=[(J)=>`MFC2      ${J.rt_d} = ${J.fs()}`,(J)=>`DMFC2     ${J.rt_d} = ${J.fs()}`,(J)=>`CFC2      ${J.rt_d} = CCR${u(J.opcode)}`,(J)=>`DCFC2     ${J.rt_d} = CCR${u(J.opcode)}`,(J)=>`MTC2      ${J.fs_d()} = ${J.rt}`,(J)=>`DMTC2     ${J.fs_d()} = ${J.rt}`,(J)=>`CTC2      CCR${u(J.opcode)} = ${J.rt}`,(J)=>`DCTC2     CCR${u(J.opcode)} = ${J.rt}`,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R];if(nQ.length!=32)throw"Oops, didn't build the cop2 table correctly";var lQ=[(J)=>`MFC3      ${J.rt_d} = ${J.fs()}`,(J)=>`DMFC3     ${J.rt_d} = ${J.fs()}`,(J)=>`CFC3      ${J.rt_d} = CCR${u(J.opcode)}`,(J)=>`DCFC3     ${J.rt_d} = CCR${u(J.opcode)}`,(J)=>`MTC3      ${J.fs_d()} = ${J.rt}`,(J)=>`DMTC3     ${J.fs_d()} = ${J.rt}`,(J)=>`CTC3      CCR${u(J.opcode)} = ${J.rt}`,(J)=>`DCTC3     CCR${u(J.opcode)} = ${J.rt}`,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R];if(lQ.length!=32)throw"Oops, didn't build the cop3 table correctly";var rQ=[(J)=>`BLTZ      ${J.rs} < 0 --> ${J.branchAddress}`,(J)=>`BGEZ      ${J.rs} >= 0 --> ${J.branchAddress}`,(J)=>`BLTZL     ${J.rs} < 0 --> ${J.branchAddress}`,(J)=>`BGEZL     ${J.rs} >= 0 --> ${J.branchAddress}`,R,R,R,R,(J)=>`TGEI      ${J.rs} >= ${J.rt} --> trap `,(J)=>`TGEIU     ${J.rs} >= ${J.rt} --> trap `,(J)=>`TLTI      ${J.rs} < ${J.rt} --> trap `,(J)=>`TLTIU     ${J.rs} < ${J.rt} --> trap `,(J)=>`TEQI      ${J.rs} == ${J.rt} --> trap `,R,(J)=>`TNEI      ${J.rs} != ${J.rt} --> trap `,R,(J)=>`BLTZAL    ${J.rs} < 0 --> ${J.branchAddress}${J.writesRA()}`,(J)=>`BGEZAL    ${J.rs} >= 0 --> ${J.branchAddress}${J.writesRA()}`,(J)=>`BLTZALL   ${J.rs} < 0 --> ${J.branchAddress}${J.writesRA()}`,(J)=>`BGEZALL   ${J.rs} >= 0 --> ${J.branchAddress}${J.writesRA()}`,R,R,R,R,R,R,R,R,R,R,R,R];if(rQ.length!=32)throw"Oops, didn't build the special table correctly";var sQ=[JG,GG,(J)=>`J         --> ${J.jumpAddress}`,(J)=>`JAL       --> ${J.jumpAddress}${J.writesRA()}`,(J)=>{if(O(J.opcode)==D(J.opcode))return`B         --> ${J.branchAddress}`;return`BEQ       ${J.rs} == ${J.rt} --> ${J.branchAddress}`},(J)=>`BNE       ${J.rs} != ${J.rt} --> ${J.branchAddress}`,(J)=>`BLEZ      ${J.rs} <= 0 --> ${J.branchAddress}`,(J)=>`BGTZ      ${J.rs} > 0 --> ${J.branchAddress}`,(J)=>`ADDI      ${J.rt_d} = ${J.rs} + ${J.imm}`,(J)=>`ADDIU     ${J.rt_d} = ${J.rs} + ${J.imm}`,(J)=>`SLTI      ${J.rt_d} = (${J.rs} < ${J.imm})`,(J)=>`SLTIU     ${J.rt_d} = (${J.rs} < ${J.imm})`,(J)=>`ANDI      ${J.rt_d} = ${J.rs} & ${J.imm}`,(J)=>`ORI       ${J.rt_d} = ${J.rs} | ${J.imm}`,(J)=>`XORI      ${J.rt_d} = ${J.rs} ^ ${J.imm}`,(J)=>`LUI       ${J.rt_d} = ${J.imm} << 16`,ZG,YG,zG,FG,(J)=>`BEQL      ${J.rs} == ${J.rt} --> ${J.branchAddress}`,(J)=>`BNEL      ${J.rs} != ${J.rt} --> ${J.branchAddress}`,(J)=>`BLEZL     ${J.rs} <= 0 --> ${J.branchAddress}`,(J)=>`BGTZL     ${J.rs} > 0 --> ${J.branchAddress}`,(J)=>`DADDI     ${J.rt_d} = ${J.rs} + ${J.imm}`,(J)=>`DADDIU    ${J.rt_d} = ${J.rs} + ${J.imm}`,(J)=>`LDL       ${J.rt_d} <- ${J.memload()}`,(J)=>`LDR       ${J.rt_d} <- ${J.memload()}`,R,R,R,R,(J)=>`LB        ${J.rt_d} <- ${J.memload()}`,(J)=>`LH        ${J.rt_d} <- ${J.memload()}`,(J)=>`LWL       ${J.rt_d} <- ${J.memload()}`,(J)=>`LW        ${J.rt_d} <- ${J.memload()}`,(J)=>`LBU       ${J.rt_d} <- ${J.memload()}`,(J)=>`LHU       ${J.rt_d} <- ${J.memload()}`,(J)=>`LWR       ${J.rt_d} <- ${J.memload()}`,(J)=>`LWU       ${J.rt_d} <- ${J.memload()}`,(J)=>`SB        ${J.rt} -> ${J.memstore()}`,(J)=>`SH        ${J.rt} -> ${J.memstore()}`,(J)=>`SWL       ${J.rt} -> ${J.memstore()}`,(J)=>`SW        ${J.rt} -> ${J.memstore()}`,(J)=>`SDL       ${J.rt} -> ${J.memstore()}`,(J)=>`SDR       ${J.rt} -> ${J.memstore()}`,(J)=>`SWR       ${J.rt} -> ${J.memstore()}`,(J)=>`CACHE     ${v(D(J.opcode),8)}, ${J.memaccess()}`,(J)=>`LL        ${J.rt_d} <- ${J.memload()}`,(J)=>`LWC1      ${J.ft_d()} <- ${J.memload()}`,R,R,(J)=>`LLD       ${J.rt_d} <- ${J.memload()}`,(J)=>`LDC1      ${J.ft_d()} <- ${J.memload()}`,(J)=>`LDC2      ${J.gt_d} <- ${J.memload()}`,(J)=>`LD        ${J.rt_d} <- ${J.memload()}`,(J)=>`SC        ${J.rt} -> ${J.memstore()}`,(J)=>`SWC1      ${J.ft()} -> ${J.memstore()}`,(J)=>"BREAKPOINT",R,(J)=>`SCD       ${J.rt} -> ${J.memstore()}`,(J)=>`SDC1      ${J.ft()} -> ${J.memstore()}`,(J)=>`SDC2      ${J.gt} -> ${J.memstore()}`,(J)=>`SD        ${J.rt} -> ${J.memstore()}`];if(sQ.length!=64)throw"Oops, didn't build the simple table correctly";var KW=function(J){return J&63},$G=function(J){return J>>>6&31},t9=function(J){return J>>>11&31},r5=function(J){return J>>>16&31},l5=function(J){return J>>>21&31},jG=function(J){return J>>>26&63},tQ=function(J){return J>>>21&31},kG=function(J){return J>>>16&31},c4=function(J){return J>>>7&15},eQ=function(J){return(J&127)<<25>>25},JW=function(J){return J>>>21&15},NG=function(J){return J>>>11&31},LG=function(J){return J>>>16&31},MG=function(J){return J>>>11&31},PG=function(J){return J>>>6&31},VG=function(J){return J&67108863},a2=function(J){return J&65535},UG=function(J){return a2(J)<<16>>16},ZW=function(J){return J>>>21&31},qW=function(J){return a2(J)<<16>>16},hG=function(J){return J&65535},RG=function(J,Z){return J+4+UG(Z)*4},bG=function(J,Z){return J&4026531840|VG(Z)*4},QW=function(J){return v(J,16)},T8=function(J){return J},EG=function(J){return yG[KW(J.opcode)](J)},U9=function(J){return`unknown: ${k(J.opcode)}`};function o4(J,Z){const q=new XW(J,Z),Q=_G[jG(Z)](q);return{address:J,instruction:q,disassembly:Q,isJumpTarget:!1}}function s5(J,Z,q){return o2(J,Z,Z,q-Z)}function o2(J,Z,q,Q){const W=[],K=new Set,X=J.length-1;for(let Y=0;Y<Q;Y+=4){const z=J.getU32(q+Y&X),G=o4(Z+Y,z);if(G.instruction.target)K.add(G.instruction.target);W.push(G)}for(let Y of W)if(K.has(Y.instruction.address))Y.isJumpTarget=!0;return W}function YW(J,Z,q,Q){let W="";for(let K=0;K<Q;K+=4)W+=`${v(Z+K,16)}: ${v(J.getU32(q+K),32)}\n`;return W}var c2=["r0","at","v0","v1","a0","a1","a2","a3","t0","t1","t2","t3","t4","t5","t6","t7","s0","s1","s2","s3","s4","s5","s6","s7","t8","t9","k0","k1","gp","sp","s8","ra"],DG=31,WW=["SP_MEM_ADDR_REG","SP_DRAM_ADDR_REG","SP_RD_LEN_REG","SP_WR_LEN_REG","SP_STATUS_REG","SP_DMA_FULL_REG","SP_DMA_BUSY_REG","SP_SEMAPHORE_REG","DPC_START_REG","DPC_END_REG","DPC_CURRENT_REG","DPC_STATUS_REG","DPC_CLOCK_REG","DPC_BUFBUSY_REG","DPC_PIPEBUSY_REG","DPC_TMEM_REG"],AG=["VCO","VCC","VCE","VCE"],wG=["All","All1","0q","1q","0h","1h","2h","3h","0","1","2","3","4","5","6","7"];class XW{constructor(J,Z){this.address=J,this.opcode=Z,this.srcRegs={},this.dstRegs={},this.target="",this.memory=null}get rd(){const J=this.gprName(t9);return this.dstRegs[J]=1,T8(J)}get rt(){const J=this.gprName(r5);return this.srcRegs[J]=1,T8(J)}get rs(){const J=this.gprName(l5);return this.srcRegs[J]=1,T8(J)}get rt_d(){const J=this.gprName(r5);return this.dstRegs[J]=1,T8(J)}get c0reg(){const J=t9(this.opcode);if(J<WW.length)return WW[J];return`c0reg${J}`}get cop2E(){return`${JW(this.opcode)}`}get cop2DE(){return`${NG(this.opcode)}`}get cop2VD(){return`V${PG(this.opcode)}`}get cop2VT(){return`V${LG(this.opcode)}`}get cop2VS(){return`V${MG(this.opcode)}`}get cop2VecSelect(){return wG[JW(this.opcode)]}get c2flag(){return AG[t9(this.opcode)&3]}get sa(){return $G(this.opcode)}gprName(J){return c2[J(this.opcode)]}writesRA(){return this.dstRegs[DG]=1,""}get imm(){return`0x${v(a2(this.opcode),16)}`}get branchAddress(){return this.target=RG(this.address,this.opcode),QW(this.target)}get jumpAddress(){return this.target=bG(this.address,this.opcode),QW(this.target)}get base(){const J=this.gprName(ZW);return this.srcRegs[J]=1,T8(J)}get offsetU16(){return`0x${v(hG(this.opcode),16)}`}get offsetS16(){return`0x${v(qW(this.opcode),16)}`}memload(){return this.memaccess("load")}memstore(){return this.memaccess("store")}memaccess(J){return this.memory={reg:ZW(this.opcode),offset:qW(this.opcode),mode:J},`[${this.base}+${this.offsetU16}]`}get vmemEl(){return`E${c4(this.opcode)}`}vmemEls(J){return`[${c4(this.opcode)}..${c4(this.opcode)+J-1&15}]`}get vmemVT(){return`V${kG(this.opcode)}`}get vmemBase(){const J=this.gprName(tQ);return this.srcRegs[J]=1,T8(J)}vmemload(J){return this.vmemaccess("load",J)}vmemstore(J){return this.vmemaccess("store",J)}vmemaccess(J,Z){return Z=Z||1,this.memory={reg:tQ(this.opcode),offset:eQ(this.opcode)*Z,mode:J},`[${this.vmemBase}${this.sprintVOffset(Z)}]`}sprintVOffset(J){const Z=eQ(this.opcode)*J;return(Z>=0?"+":"")+Z.toString()}}var BG=(()=>{let J=[];for(let Z=0;Z<64;Z++)J[Z]=U9;return J[0]=(Z)=>{if(Z.opcode===0)return"NOP";return`SLL       ${Z.rd} = ${Z.rt} << ${Z.sa}`},J[2]=(Z)=>`SRL       ${Z.rd} = ${Z.rt} >>> ${Z.sa}`,J[3]=(Z)=>`SRA       ${Z.rd} = ${Z.rt} >> ${Z.sa}`,J[4]=(Z)=>`SLLV      ${Z.rd} = ${Z.rt} << ${Z.rs}`,J[6]=(Z)=>`SRLV      ${Z.rd} = ${Z.rt} >>> ${Z.rs}`,J[7]=(Z)=>`SRAV      ${Z.rd} = ${Z.rt} >> ${Z.rs}`,J[8]=(Z)=>`JR        ${Z.rs}`,J[9]=(Z)=>`JALR      ${Z.rd}, ${Z.rs}`,J[13]=(Z)=>`BREAK     ${v(Z.opcode>>6&1048575,20)}`,J[32]=(Z)=>`ADD       ${Z.rd} = ${Z.rs} + ${Z.rt}`,J[33]=(Z)=>`ADDU      ${Z.rd} = ${Z.rs} + ${Z.rt}`,J[34]=(Z)=>`SUB       ${Z.rd} = ${Z.rs} - ${Z.rt}`,J[35]=(Z)=>`SUBU      ${Z.rd} = ${Z.rs} - ${Z.rt}`,J[36]=(Z)=>`AND       ${Z.rd} = ${Z.rs} & ${Z.rt}`,J[37]=(Z)=>`OR        ${Z.rd} = ${Z.rs} | ${Z.rt}`,J[38]=(Z)=>`XOR       ${Z.rd} = ${Z.rs} ^ ${Z.rt}`,J[39]=(Z)=>`NOR       ${Z.rd} = ~( ${Z.rs} | ${Z.rt} )`,J[42]=(Z)=>`SLT       ${Z.rd} = ${Z.rs} < ${Z.rt}`,J[43]=(Z)=>`SLTU      ${Z.rd} = ${Z.rs} < ${Z.rt}`,J})(),IG=(()=>{let J=[];for(let Z=0;Z<32;Z++)J.push(U9);return J[0]=(Z)=>`BLTZ      ${Z.rs} < 0 --> ${Z.branchAddress}`,J[1]=(Z)=>`BGEZ      ${Z.rs} >= 0 --> ${Z.branchAddress}`,J[16]=(Z)=>`BLTZAL    ${Z.rs} < 0 --> ${Z.branchAddress}${Z.writesRA()}`,J[17]=(Z)=>`BGEZAL    ${Z.rs} >= 0 --> ${Z.branchAddress}${Z.writesRA()}`,J})(),CG=(()=>{let J=[];for(let Z=0;Z<32;Z++)J.push(U9);return J[0]=(Z)=>`MFC0      ${Z.rt_d} <- ${Z.c0reg}`,J[4]=(Z)=>`MTC0      ${Z.rt} -> ${Z.c0reg}`,J})(),OG=(()=>{let J=[];for(let Z=0;Z<32;Z++)J.push(U9);J[0]=(Z)=>`MFC2      ${Z.rt_d} = ${t9(Z.opcode)}[${c4(Z.opcode)}]`,J[2]=(Z)=>`CFC2      ${Z.rt_d} = ${Z.c2flag}`,J[4]=(Z)=>`MTC2      V${t9(Z.opcode)}[${c4(Z.opcode)}] = ${Z.rt}`,J[6]=(Z)=>`CTC2      ${Z.c2flag} = ${Z.rt}`;for(let Z=16;Z<32;Z++)J[Z]=EG;return J})(),yG=(()=>{let J=[];for(let Z=0;Z<64;Z++)J.push(U9);return J[0]=(Z)=>`VMULF     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[1]=(Z)=>`VMULU     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[2]=(Z)=>`VRNDP     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[3]=(Z)=>`VMULQ     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[4]=(Z)=>`VMUDL     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[5]=(Z)=>`VMUDM     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[6]=(Z)=>`VMUDN     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[7]=(Z)=>`VMUDH     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[8]=(Z)=>`VMACF     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[9]=(Z)=>`VMACU     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[10]=(Z)=>`VRNDN     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[11]=(Z)=>`VMACQ     ${Z.cop2VD}, ACC = oddify(ACC)`,J[12]=(Z)=>`VMADL     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[13]=(Z)=>`VMADM     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[14]=(Z)=>`VMADN     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[15]=(Z)=>`VMADH     ${Z.cop2VD} = ${Z.cop2VS} * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[16]=(Z)=>`VADD      ${Z.cop2VD} = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[17]=(Z)=>`VSUB      ${Z.cop2VD} = ${Z.cop2VS} - ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[18]=(Z)=>`VSUT      ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[19]=(Z)=>`VABS      ${Z.cop2VD} = sign(${Z.cop2VS}) * ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[20]=(Z)=>`VADDC     ${Z.cop2VD} = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[21]=(Z)=>`VSUBC     ${Z.cop2VD} = ${Z.cop2VS} - ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[22]=(Z)=>`VADDB     ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[23]=(Z)=>`VSUBB     ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[24]=(Z)=>`VACCB     ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[25]=(Z)=>`VSUCB     ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[26]=(Z)=>`VSAD      ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[27]=(Z)=>`VSAC      ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[28]=(Z)=>`VSUM      ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[29]=(Z)=>`VSAR      ${Z.cop2VD}, ${Z.cop2VS}, ${Z.cop2VT}[${Z.cop2E}]`,J[30]=(Z)=>`V30       ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[31]=(Z)=>`V31       ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[32]=(Z)=>`VLT       ${Z.cop2VD}, CC = cmpLT(${Z.cop2VS}, ${Z.cop2VT}[${Z.cop2VecSelect}])`,J[33]=(Z)=>`VEQ       ${Z.cop2VD}, CC = cmpEQ(${Z.cop2VS}, ${Z.cop2VT}[${Z.cop2VecSelect}])`,J[34]=(Z)=>`VNE       ${Z.cop2VD}, CC = cmpNE(${Z.cop2VS}, ${Z.cop2VT}[${Z.cop2VecSelect}])`,J[35]=(Z)=>`VGE       ${Z.cop2VD}, CC = cmpGE(${Z.cop2VS}, ${Z.cop2VT}[${Z.cop2VecSelect}])`,J[36]=(Z)=>`VCL       ${Z.cop2VD}, ACC = ${Z.cop2VS} clip ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[37]=(Z)=>`VCH       ${Z.cop2VD}, ACC = ${Z.cop2VS} clip ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[38]=(Z)=>`VCR       ${Z.cop2VD}, ACC = ${Z.cop2VS} crimp ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[39]=(Z)=>`VMRG      ${Z.cop2VD} = VCC ? ${Z.cop2VS} : ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[40]=(Z)=>`VAND      ${Z.cop2VD} = ${Z.cop2VS} & ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[41]=(Z)=>`VNAND     ${Z.cop2VD} = ~(${Z.cop2VS} & ${Z.cop2VT}[${Z.cop2VecSelect}])`,J[42]=(Z)=>`VOR       ${Z.cop2VD} = ${Z.cop2VS} | ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[43]=(Z)=>`VNOR      ${Z.cop2VD} = ~(${Z.cop2VS} | ${Z.cop2VT}[${Z.cop2VecSelect}])`,J[44]=(Z)=>`VXOR      ${Z.cop2VD} = ${Z.cop2VS} ^ ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[45]=(Z)=>`VNXOR     ${Z.cop2VD} = ~(${Z.cop2VS} ^ ${Z.cop2VT}[${Z.cop2VecSelect}])`,J[46]=(Z)=>`V46       ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[47]=(Z)=>`V47       ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[48]=(Z)=>`VRCP      ${Z.cop2VD}[${Z.cop2DE}] = 1/${Z.cop2VT}[${Z.cop2VecSelect}]`,J[49]=(Z)=>`VRCPL     ${Z.cop2VD}[${Z.cop2DE}] = 1/${Z.cop2VT}[${Z.cop2VecSelect}]`,J[50]=(Z)=>`VRCPH     ${Z.cop2VD}[${Z.cop2DE}], DIVIN = DIVOUT, ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[51]=(Z)=>`VMOV      ${Z.cop2VD}[${Z.cop2DE}] = ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[52]=(Z)=>`VRSQ      ${Z.cop2VD}[${Z.cop2DE}] = 1/sqrt(${Z.cop2VT}[${Z.cop2VecSelect}])`,J[53]=(Z)=>`VRSQL     ${Z.cop2VD}[${Z.cop2DE}] = 1/sqrt(${Z.cop2VT}[${Z.cop2VecSelect}])`,J[54]=(Z)=>`VRSQH     ${Z.cop2VD}[${Z.cop2DE}], DIVIN = DIVOUT, ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[55]=(Z)=>"VNOP",J[56]=(Z)=>`VEXTT     ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[57]=(Z)=>`VEXTQ     ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[58]=(Z)=>`VEXTN     ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[59]=(Z)=>`V59       ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[60]=(Z)=>`VINST     ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[61]=(Z)=>`VINSQ     ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[62]=(Z)=>`VINSN     ${Z.cop2VD} = 0, ACC = ${Z.cop2VS} + ${Z.cop2VT}[${Z.cop2VecSelect}]`,J[63]=(Z)=>"VNULL",J})(),TG=(()=>{let J=[];for(let Z=0;Z<32;Z++)J.push(U9);return J[0]=(Z)=>`LBV       ${Z.vmemVT}${Z.vmemEls(1)} <- ${Z.vmemload(1)}`,J[1]=(Z)=>`LSV       ${Z.vmemVT}${Z.vmemEls(2)} <- ${Z.vmemload(2)}`,J[2]=(Z)=>`LLV       ${Z.vmemVT}${Z.vmemEls(4)} <- ${Z.vmemload(4)}`,J[3]=(Z)=>`LDV       ${Z.vmemVT}${Z.vmemEls(8)} <- ${Z.vmemload(8)}`,J[4]=(Z)=>`LQV       ${Z.vmemVT} <- ${Z.vmemload(16)}`,J[5]=(Z)=>`LRV       ${Z.vmemVT} <- ${Z.vmemload(16)}`,J[6]=(Z)=>`LPV       ${Z.vmemVT} <- ${Z.vmemload(8)}`,J[7]=(Z)=>`LUV       ${Z.vmemVT} <- ${Z.vmemload(8)}`,J[8]=(Z)=>`LHV       ${Z.vmemVT} <- ${Z.vmemload(16)}`,J[9]=(Z)=>`LFV       ${Z.vmemVT} <- ${Z.vmemload(16)}`,J[10]=(Z)=>`LWV       ${Z.vmemVT} <- ${Z.vmemload(16)}`,J[11]=(Z)=>`LTV       ${Z.vmemVT} <- ${Z.vmemload(16)}`,J})(),SG=(()=>{let J=[];for(let Z=0;Z<32;Z++)J.push(U9);return J[0]=(Z)=>`SBV       ${Z.vmemVT}${Z.vmemEls(1)} -> ${Z.vmemstore(1)}`,J[1]=(Z)=>`SSV       ${Z.vmemVT}${Z.vmemEls(2)} -> ${Z.vmemstore(2)}`,J[2]=(Z)=>`SLV       ${Z.vmemVT}${Z.vmemEls(4)} -> ${Z.vmemstore(4)}`,J[3]=(Z)=>`SDV       ${Z.vmemVT}${Z.vmemEls(8)} -> ${Z.vmemstore(8)}`,J[4]=(Z)=>`SQV       ${Z.vmemVT} -> ${Z.vmemstore(16)}`,J[5]=(Z)=>`SRV       ${Z.vmemVT} -> ${Z.vmemstore(16)}`,J[6]=(Z)=>`SPV       ${Z.vmemVT} -> ${Z.vmemstore(8)}`,J[7]=(Z)=>`SUV       ${Z.vmemVT} -> ${Z.vmemstore(8)}`,J[8]=(Z)=>`SHV       ${Z.vmemVT} -> ${Z.vmemstore(16)}`,J[9]=(Z)=>`SFV       ${Z.vmemVT} -> ${Z.vmemstore(16)}`,J[10]=(Z)=>`SWV       ${Z.vmemVT} -> ${Z.vmemstore(16)}`,J[11]=(Z)=>`STV       ${Z.vmemVT} -> ${Z.vmemstore(16)}`,J})(),_G=(()=>{let J=[];for(let Z=0;Z<64;Z++)J.push(U9);return J[0]=(Z)=>BG[KW(Z.opcode)](Z),J[1]=(Z)=>IG[r5(Z.opcode)](Z),J[2]=(Z)=>`J         --> ${Z.jumpAddress}`,J[3]=(Z)=>`JAL       --> ${Z.jumpAddress}${Z.writesRA()}`,J[4]=(Z)=>{if(l5(Z.opcode)==r5(Z.opcode))return`B         --> ${Z.branchAddress}`;return`BEQ       ${Z.rs} == ${Z.rt} --> ${Z.branchAddress}`},J[5]=(Z)=>`BNE       ${Z.rs} != ${Z.rt} --> ${Z.branchAddress}`,J[6]=(Z)=>`BLEZ      ${Z.rs} <= 0 --> ${Z.branchAddress}`,J[7]=(Z)=>`BGTZ      ${Z.rs} > 0 --> ${Z.branchAddress}`,J[8]=(Z)=>`ADDI      ${Z.rt_d} = ${Z.rs} + ${Z.imm}`,J[9]=(Z)=>`ADDIU     ${Z.rt_d} = ${Z.rs} + ${Z.imm}`,J[10]=(Z)=>`SLTI      ${Z.rt_d} = (${Z.rs} < ${Z.imm})`,J[11]=(Z)=>`SLTIU     ${Z.rt_d} = (${Z.rs} < ${Z.imm})`,J[12]=(Z)=>`ANDI      ${Z.rt_d} = ${Z.rs} & ${Z.imm}`,J[13]=(Z)=>`ORI       ${Z.rt_d} = ${Z.rs} | ${Z.imm}`,J[14]=(Z)=>`XORI      ${Z.rt_d} = ${Z.rs} ^ ${Z.imm}`,J[15]=(Z)=>`LUI       ${Z.rt_d} = ${Z.imm} << 16`,J[16]=(Z)=>CG[l5(Z.opcode)](Z),J[18]=(Z)=>OG[l5(Z.opcode)](Z),J[32]=(Z)=>`LB        ${Z.rt_d} <- ${Z.memload()}`,J[33]=(Z)=>`LH        ${Z.rt_d} <- ${Z.memload()}`,J[35]=(Z)=>`LW        ${Z.rt_d} <- ${Z.memload()}`,J[36]=(Z)=>`LBU       ${Z.rt_d} <- ${Z.memload()}`,J[37]=(Z)=>`LHU       ${Z.rt_d} <- ${Z.memload()}`,J[39]=(Z)=>`LWU       ${Z.rt_d} <- ${Z.memload()}`,J[40]=(Z)=>`SB        ${Z.rt} -> ${Z.memstore()}`,J[41]=(Z)=>`SH        ${Z.rt} -> ${Z.memstore()}`,J[43]=(Z)=>`SW        ${Z.rt} -> ${Z.memstore()}`,J[50]=(Z)=>TG[t9(Z.opcode)](Z),J[58]=(Z)=>SG[t9(Z.opcode)](Z),J})();var d2=function(J){let Z,q;if(Z=J.match(/(#|0x)?([a-f0-9]{6})/i))q=Z[2];else if(Z=J.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))q=parseInt(Z[1]).toString(16).padStart(2,0)+parseInt(Z[2]).toString(16).padStart(2,0)+parseInt(Z[3]).toString(16).padStart(2,0);else if(Z=J.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))q=Z[1]+Z[1]+Z[2]+Z[2]+Z[3]+Z[3];if(q)return"#"+q;return!1},gG=function(J){return xG.find((Z)=>Z.match(J))},pG=function(J){const Z=document.createElement("style");Z.innerHTML=J;const q=document.querySelector("head link[rel=stylesheet], head style");if(q)document.head.insertBefore(Z,q);else document.head.appendChild(Z)};class m6{constructor(J,Z,q,Q,W="div"){this.parent=J,this.object=Z,this.property=q,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(Q),this.$name=document.createElement("div"),this.$name.classList.add("name"),m6.nextNameID=m6.nextNameID||0,this.$name.id=`lil-gui-name-${++m6.nextNameID}`,this.$widget=document.createElement(W),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.domElement.addEventListener("keydown",(K)=>K.stopPropagation()),this.domElement.addEventListener("keyup",(K)=>K.stopPropagation()),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(q)}name(J){return this._name=J,this.$name.innerHTML=J,this}onChange(J){return this._onChange=J,this}_callOnChange(){if(this.parent._callOnChange(this),this._onChange!==void 0)this._onChange.call(this,this.getValue());this._changed=!0}onFinishChange(J){return this._onFinishChange=J,this}_callOnFinishChange(){if(this._changed){if(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0)this._onFinishChange.call(this,this.getValue())}this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(J=!0){return this.disable(!J)}disable(J=!0){if(J===this._disabled)return this;return this._disabled=J,this.domElement.classList.toggle("disabled",J),this.$disable.toggleAttribute("disabled",J),this}show(J=!0){return this._hidden=!J,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(J){const Z=this.parent.add(this.object,this.property,J);return Z.name(this._name),this.destroy(),Z}min(J){return this}max(J){return this}step(J){return this}decimals(J){return this}listen(J=!0){if(this._listening=J,this._listenCallbackID!==void 0)cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0;if(this._listening)this._listenCallback();return this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const J=this.save();if(J!==this._listenPrevValue)this.updateDisplay();this._listenPrevValue=J}getValue(){return this.object[this.property]}setValue(J){return this.object[this.property]=J,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(J){return this.setValue(J),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class HW extends m6{constructor(J,Z,q){super(J,Z,q,"boolean","label");this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}var vG={isPrimitive:!0,match:(J)=>typeof J==="string",fromHexString:d2,toHexString:d2},d4={isPrimitive:!0,match:(J)=>typeof J==="number",fromHexString:(J)=>parseInt(J.substring(1),16),toHexString:(J)=>"#"+J.toString(16).padStart(6,0)},fG={isPrimitive:!1,match:(J)=>Array.isArray(J),fromHexString(J,Z,q=1){const Q=d4.fromHexString(J);Z[0]=(Q>>16&255)/255*q,Z[1]=(Q>>8&255)/255*q,Z[2]=(Q&255)/255*q},toHexString([J,Z,q],Q=1){Q=255/Q;const W=J*Q<<16^Z*Q<<8^q*Q<<0;return d4.toHexString(W)}},uG={isPrimitive:!1,match:(J)=>Object(J)===J,fromHexString(J,Z,q=1){const Q=d4.fromHexString(J);Z.r=(Q>>16&255)/255*q,Z.g=(Q>>8&255)/255*q,Z.b=(Q&255)/255*q},toHexString({r:J,g:Z,b:q},Q=1){Q=255/Q;const W=J*Q<<16^Z*Q<<8^q*Q<<0;return d4.toHexString(W)}},xG=[vG,d4,fG,uG];class GW extends m6{constructor(J,Z,q,Q){super(J,Z,q,"color");this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=gG(this.initialValue),this._rgbScale=Q,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const W=d2(this.$text.value);if(W)this._setValueFromHexString(W)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(J){if(this._format.isPrimitive){const Z=this._format.fromHexString(J);this.setValue(Z)}else this._format.fromHexString(J,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(J){return this._setValueFromHexString(J),this._callOnFinishChange(),this}updateDisplay(){if(this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),!this._textFocused)this.$text.value=this.$input.value.substring(1);return this.$display.style.backgroundColor=this.$input.value,this}}class i5 extends m6{constructor(J,Z,q){super(J,Z,q,"function");this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",(Q)=>{Q.preventDefault(),this.getValue().call(this.object),this._callOnChange()}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class $W extends m6{constructor(J,Z,q,Q,W,K){super(J,Z,q,"number");this._initInput(),this.min(Q),this.max(W);const X=K!==void 0;this.step(X?K:this._getImplicitStep(),X),this.updateDisplay()}decimals(J){return this._decimals=J,this.updateDisplay(),this}min(J){return this._min=J,this._onUpdateMinMax(),this}max(J){return this._max=J,this._onUpdateMinMax(),this}step(J,Z=!0){return this._step=J,this._stepExplicit=Z,this}updateDisplay(){const J=this.getValue();if(this._hasSlider){let Z=(J-this._min)/(this._max-this._min);Z=Math.max(0,Math.min(Z,1)),this.$fill.style.width=Z*100+"%"}if(!this._inputFocused)this.$input.value=this._decimals===void 0?J:J.toFixed(this._decimals);return this}_initInput(){if(this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),window.matchMedia("(pointer: coarse)").matches)this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any");this.$widget.appendChild(this.$input),this.$disable=this.$input;const Z=()=>{let b=parseFloat(this.$input.value);if(isNaN(b))return;if(this._stepExplicit)b=this._snap(b);this.setValue(this._clamp(b))},q=(b)=>{const C=parseFloat(this.$input.value);if(isNaN(C))return;this._snapClampSetValue(C+b),this.$input.value=this.getValue()},Q=(b)=>{if(b.key==="Enter")this.$input.blur();if(b.code==="ArrowUp")b.preventDefault(),q(this._step*this._arrowKeyMultiplier(b));if(b.code==="ArrowDown")b.preventDefault(),q(this._step*this._arrowKeyMultiplier(b)*-1)},W=(b)=>{if(this._inputFocused)b.preventDefault(),q(this._step*this._normalizeMouseWheel(b))};let K=!1,X,Y,z,G,H;const j=5,N=(b)=>{X=b.clientX,Y=z=b.clientY,K=!0,G=this.getValue(),H=0,window.addEventListener("mousemove",L),window.addEventListener("mouseup",M)},L=(b)=>{if(K){const C=b.clientX-X,_=b.clientY-Y;if(Math.abs(_)>j)b.preventDefault(),this.$input.blur(),K=!1,this._setDraggingStyle(!0,"vertical");else if(Math.abs(C)>j)M()}if(!K){const C=b.clientY-z;if(H-=C*this._step*this._arrowKeyMultiplier(b),G+H>this._max)H=this._max-G;else if(G+H<this._min)H=this._min-G;this._snapClampSetValue(G+H)}z=b.clientY},M=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",L),window.removeEventListener("mouseup",M)},V=()=>{this._inputFocused=!0},h=()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()};this.$input.addEventListener("input",Z),this.$input.addEventListener("keydown",Q),this.$input.addEventListener("wheel",W,{passive:!1}),this.$input.addEventListener("mousedown",N),this.$input.addEventListener("focus",V),this.$input.addEventListener("blur",h)}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const J=(h,b,C,_,E)=>{return(h-b)/(C-b)*(E-_)+_},Z=(h)=>{const b=this.$slider.getBoundingClientRect();let C=J(h,b.left,b.right,this._min,this._max);this._snapClampSetValue(C)},q=(h)=>{this._setDraggingStyle(!0),Z(h.clientX),window.addEventListener("mousemove",Q),window.addEventListener("mouseup",W)},Q=(h)=>{Z(h.clientX)},W=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",Q),window.removeEventListener("mouseup",W)};let K=!1,X,Y;const z=(h)=>{h.preventDefault(),this._setDraggingStyle(!0),Z(h.touches[0].clientX),K=!1},G=(h)=>{if(h.touches.length>1)return;if(this._hasScrollBar)X=h.touches[0].clientX,Y=h.touches[0].clientY,K=!0;else z(h);window.addEventListener("touchmove",H,{passive:!1}),window.addEventListener("touchend",j)},H=(h)=>{if(K){const b=h.touches[0].clientX-X,C=h.touches[0].clientY-Y;if(Math.abs(b)>Math.abs(C))z(h);else window.removeEventListener("touchmove",H),window.removeEventListener("touchend",j)}else h.preventDefault(),Z(h.touches[0].clientX)},j=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",H),window.removeEventListener("touchend",j)},N=this._callOnFinishChange.bind(this),L=400;let M;const V=(h)=>{if(Math.abs(h.deltaX)<Math.abs(h.deltaY)&&this._hasScrollBar)return;h.preventDefault();const C=this._normalizeMouseWheel(h)*this._step;this._snapClampSetValue(this.getValue()+C),this.$input.value=this.getValue(),clearTimeout(M),M=setTimeout(N,L)};this.$slider.addEventListener("mousedown",q),this.$slider.addEventListener("touchstart",G,{passive:!1}),this.$slider.addEventListener("wheel",V,{passive:!1})}_setDraggingStyle(J,Z="horizontal"){if(this.$slider)this.$slider.classList.toggle("active",J);document.body.classList.toggle("lil-gui-dragging",J),document.body.classList.toggle(`lil-gui-${Z}`,J)}_getImplicitStep(){if(this._hasMin&&this._hasMax)return(this._max-this._min)/1000;return 0.1}_onUpdateMinMax(){if(!this._hasSlider&&this._hasMin&&this._hasMax){if(!this._stepExplicit)this.step(this._getImplicitStep(),!1);this._initSlider(),this.updateDisplay()}}_normalizeMouseWheel(J){let{deltaX:Z,deltaY:q}=J;if(Math.floor(J.deltaY)!==J.deltaY&&J.wheelDelta)Z=0,q=-J.wheelDelta/120,q*=this._stepExplicit?1:10;return Z+-q}_arrowKeyMultiplier(J){let Z=this._stepExplicit?1:10;if(J.shiftKey)Z*=10;else if(J.altKey)Z/=10;return Z}_snap(J){const Z=Math.round(J/this._step)*this._step;return parseFloat(Z.toPrecision(15))}_clamp(J){if(J<this._min)J=this._min;if(J>this._max)J=this._max;return J}_snapClampSetValue(J){this.setValue(this._clamp(this._snap(J)))}get _hasScrollBar(){const J=this.parent.root.$children;return J.scrollHeight>J.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class jW extends m6{constructor(J,Z,q,Q){super(J,Z,q,"option");this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(Q)?Q:Object.values(Q),this._names=Array.isArray(Q)?Q:Object.keys(Q),this._names.forEach((W)=>{const K=document.createElement("option");K.innerHTML=W,this.$select.appendChild(K)}),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const J=this.getValue(),Z=this._values.indexOf(J);return this.$select.selectedIndex=Z,this.$display.innerHTML=Z===-1?J:this._names[Z],this}}class kW extends m6{constructor(J,Z,q){super(J,Z,q,"string");this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",(Q)=>{if(Q.code==="Enter")this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}var mG=`.lil-gui {
  font-family: var(--font-family);
  font-size: var(--font-size);
  line-height: 1;
  font-weight: normal;
  font-style: normal;
  text-align: left;
  background-color: var(--background-color);
  color: var(--text-color);
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  --background-color: #1f1f1f;
  --text-color: #ebebeb;
  --title-background-color: #111111;
  --title-text-color: #ebebeb;
  --widget-color: #424242;
  --hover-color: #4f4f4f;
  --focus-color: #595959;
  --number-color: #2cc9ff;
  --string-color: #a2db3c;
  --font-size: 11px;
  --input-font-size: 11px;
  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;
  --padding: 4px;
  --spacing: 4px;
  --widget-height: 20px;
  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);
  --name-width: 45%;
  --slider-knob-width: 2px;
  --slider-input-width: 27%;
  --color-input-width: 27%;
  --slider-input-min-width: 45px;
  --color-input-min-width: 45px;
  --folder-indent: 7px;
  --widget-padding: 0 0 0 3px;
  --widget-border-radius: 2px;
  --checkbox-size: calc(0.75 * var(--widget-height));
  --scrollbar-width: 5px;
}
.lil-gui, .lil-gui * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
.lil-gui.root {
  width: var(--width, 245px);
  display: flex;
  flex-direction: column;
}
.lil-gui.root > .title {
  background: var(--title-background-color);
  color: var(--title-text-color);
}
.lil-gui.root > .children {
  overflow-x: hidden;
  overflow-y: auto;
}
.lil-gui.root > .children::-webkit-scrollbar {
  width: var(--scrollbar-width);
  height: var(--scrollbar-width);
  background: var(--background-color);
}
.lil-gui.root > .children::-webkit-scrollbar-thumb {
  border-radius: var(--scrollbar-width);
  background: var(--focus-color);
}
@media (pointer: coarse) {
  .lil-gui.allow-touch-styles, .lil-gui.allow-touch-styles .lil-gui {
    --widget-height: 28px;
    --padding: 6px;
    --spacing: 6px;
    --font-size: 13px;
    --input-font-size: 16px;
    --folder-indent: 10px;
    --scrollbar-width: 7px;
    --slider-input-min-width: 50px;
    --color-input-min-width: 65px;
  }
}
.lil-gui.force-touch-styles, .lil-gui.force-touch-styles .lil-gui {
  --widget-height: 28px;
  --padding: 6px;
  --spacing: 6px;
  --font-size: 13px;
  --input-font-size: 16px;
  --folder-indent: 10px;
  --scrollbar-width: 7px;
  --slider-input-min-width: 50px;
  --color-input-min-width: 65px;
}
.lil-gui.autoPlace {
  max-height: 100%;
  position: fixed;
  top: 0;
  right: 15px;
  z-index: 1001;
}

.lil-gui .controller {
  display: flex;
  align-items: center;
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
}
.lil-gui .controller.disabled {
  opacity: 0.5;
}
.lil-gui .controller.disabled, .lil-gui .controller.disabled * {
  pointer-events: none !important;
}
.lil-gui .controller > .name {
  min-width: var(--name-width);
  flex-shrink: 0;
  white-space: pre;
  padding-right: var(--spacing);
  line-height: var(--widget-height);
}
.lil-gui .controller .widget {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  min-height: var(--widget-height);
}
.lil-gui .controller.string input {
  color: var(--string-color);
}
.lil-gui .controller.boolean .widget {
  cursor: pointer;
}
.lil-gui .controller.color .display {
  width: 100%;
  height: var(--widget-height);
  border-radius: var(--widget-border-radius);
  position: relative;
}
@media (hover: hover) {
  .lil-gui .controller.color .display:hover:before {
    content: " ";
    display: block;
    position: absolute;
    border-radius: var(--widget-border-radius);
    border: 1px solid #fff9;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
.lil-gui .controller.color input[type=color] {
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.lil-gui .controller.color input[type=text] {
  margin-left: var(--spacing);
  font-family: var(--font-family-mono);
  min-width: var(--color-input-min-width);
  width: var(--color-input-width);
  flex-shrink: 0;
}
.lil-gui .controller.option select {
  opacity: 0;
  position: absolute;
  width: 100%;
  max-width: 100%;
}
.lil-gui .controller.option .display {
  position: relative;
  pointer-events: none;
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  line-height: var(--widget-height);
  max-width: 100%;
  overflow: hidden;
  word-break: break-all;
  padding-left: 0.55em;
  padding-right: 1.75em;
  background: var(--widget-color);
}
@media (hover: hover) {
  .lil-gui .controller.option .display.focus {
    background: var(--focus-color);
  }
}
.lil-gui .controller.option .display.active {
  background: var(--focus-color);
}
.lil-gui .controller.option .display:after {
  font-family: "lil-gui";
  content: "\u2195";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  padding-right: 0.375em;
}
.lil-gui .controller.option .widget,
.lil-gui .controller.option select {
  cursor: pointer;
}
@media (hover: hover) {
  .lil-gui .controller.option .widget:hover .display {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number input {
  color: var(--number-color);
}
.lil-gui .controller.number.hasSlider input {
  margin-left: var(--spacing);
  width: var(--slider-input-width);
  min-width: var(--slider-input-min-width);
  flex-shrink: 0;
}
.lil-gui .controller.number .slider {
  width: 100%;
  height: var(--widget-height);
  background-color: var(--widget-color);
  border-radius: var(--widget-border-radius);
  padding-right: var(--slider-knob-width);
  overflow: hidden;
  cursor: ew-resize;
  touch-action: pan-y;
}
@media (hover: hover) {
  .lil-gui .controller.number .slider:hover {
    background-color: var(--hover-color);
  }
}
.lil-gui .controller.number .slider.active {
  background-color: var(--focus-color);
}
.lil-gui .controller.number .slider.active .fill {
  opacity: 0.95;
}
.lil-gui .controller.number .fill {
  height: 100%;
  border-right: var(--slider-knob-width) solid var(--number-color);
  box-sizing: content-box;
}

.lil-gui-dragging .lil-gui {
  --hover-color: var(--widget-color);
}
.lil-gui-dragging * {
  cursor: ew-resize !important;
}

.lil-gui-dragging.lil-gui-vertical * {
  cursor: ns-resize !important;
}

.lil-gui .title {
  height: var(--title-height);
  line-height: calc(var(--title-height) - 4px);
  font-weight: 600;
  padding: 0 var(--padding);
  -webkit-tap-highlight-color: transparent;
  cursor: pointer;
  outline: none;
  text-decoration-skip: objects;
}
.lil-gui .title:before {
  font-family: "lil-gui";
  content: "\u25BE";
  padding-right: 2px;
  display: inline-block;
}
.lil-gui .title:active {
  background: var(--title-background-color);
  opacity: 0.75;
}
@media (hover: hover) {
  body:not(.lil-gui-dragging) .lil-gui .title:hover {
    background: var(--title-background-color);
    opacity: 0.85;
  }
  .lil-gui .title:focus {
    text-decoration: underline var(--focus-color);
  }
}
.lil-gui.root > .title:focus {
  text-decoration: none !important;
}
.lil-gui.closed > .title:before {
  content: "\u25B8";
}
.lil-gui.closed > .children {
  transform: translateY(-7px);
  opacity: 0;
}
.lil-gui.closed:not(.transition) > .children {
  display: none;
}
.lil-gui.transition > .children {
  transition-duration: 300ms;
  transition-property: height, opacity, transform;
  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);
  overflow: hidden;
  pointer-events: none;
}
.lil-gui .children:empty:before {
  content: "Empty";
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
  display: block;
  height: var(--widget-height);
  font-style: italic;
  line-height: var(--widget-height);
  opacity: 0.5;
}
.lil-gui.root > .children > .lil-gui > .title {
  border: 0 solid var(--widget-color);
  border-width: 1px 0;
  transition: border-color 300ms;
}
.lil-gui.root > .children > .lil-gui.closed > .title {
  border-bottom-color: transparent;
}
.lil-gui + .controller {
  border-top: 1px solid var(--widget-color);
  margin-top: 0;
  padding-top: var(--spacing);
}
.lil-gui .lil-gui .lil-gui > .title {
  border: none;
}
.lil-gui .lil-gui .lil-gui > .children {
  border: none;
  margin-left: var(--folder-indent);
  border-left: 2px solid var(--widget-color);
}
.lil-gui .lil-gui .controller {
  border: none;
}

.lil-gui input {
  -webkit-tap-highlight-color: transparent;
  border: 0;
  outline: none;
  font-family: var(--font-family);
  font-size: var(--input-font-size);
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  background: var(--widget-color);
  color: var(--text-color);
  width: 100%;
}
@media (hover: hover) {
  .lil-gui input:hover {
    background: var(--hover-color);
  }
  .lil-gui input:active {
    background: var(--focus-color);
  }
}
.lil-gui input:disabled {
  opacity: 1;
}
.lil-gui input[type=text],
.lil-gui input[type=number] {
  padding: var(--widget-padding);
}
.lil-gui input[type=text]:focus,
.lil-gui input[type=number]:focus {
  background: var(--focus-color);
}
.lil-gui input::-webkit-outer-spin-button,
.lil-gui input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
.lil-gui input[type=number] {
  -moz-appearance: textfield;
}
.lil-gui input[type=checkbox] {
  appearance: none;
  -webkit-appearance: none;
  height: var(--checkbox-size);
  width: var(--checkbox-size);
  border-radius: var(--widget-border-radius);
  text-align: center;
  cursor: pointer;
}
.lil-gui input[type=checkbox]:checked:before {
  font-family: "lil-gui";
  content: "\u2713";
  font-size: var(--checkbox-size);
  line-height: var(--checkbox-size);
}
@media (hover: hover) {
  .lil-gui input[type=checkbox]:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui button {
  -webkit-tap-highlight-color: transparent;
  outline: none;
  cursor: pointer;
  font-family: var(--font-family);
  font-size: var(--font-size);
  color: var(--text-color);
  width: 100%;
  height: var(--widget-height);
  text-transform: none;
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
  border: 1px solid var(--widget-color);
  text-align: center;
  line-height: calc(var(--widget-height) - 4px);
}
@media (hover: hover) {
  .lil-gui button:hover {
    background: var(--hover-color);
    border-color: var(--hover-color);
  }
  .lil-gui button:focus {
    border-color: var(--focus-color);
  }
}
.lil-gui button:active {
  background: var(--focus-color);
}

@font-face {
  font-family: "lil-gui";
  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");
}`,FW=!1;class n2{constructor({parent:J,autoPlace:Z=J===void 0,container:q,width:Q,title:W="Controls",closeFolders:K=!1,injectStyles:X=!0,touchStyles:Y=!0}={}){if(this.parent=J,this.root=J?J.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",(z)=>{if(z.code==="Enter"||z.code==="Space")z.preventDefault(),this.$title.click()}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(W),this.parent){this.parent.children.push(this),this.parent.folders.push(this),this.parent.$children.appendChild(this.domElement);return}if(this.domElement.classList.add("root"),Y)this.domElement.classList.add("allow-touch-styles");if(!FW&&X)pG(mG),FW=!0;if(q)q.appendChild(this.domElement);else if(Z)this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement);if(Q)this.domElement.style.setProperty("--width",Q+"px");this._closeFolders=K}add(J,Z,q,Q,W){if(Object(q)===q)return new jW(this,J,Z,q);const K=J[Z];switch(typeof K){case"number":return new $W(this,J,Z,q,Q,W);case"boolean":return new HW(this,J,Z);case"string":return new kW(this,J,Z);case"function":return new i5(this,J,Z)}console.error(`gui.add failed
	property:`,Z,`
	object:`,J,`
	value:`,K)}addColor(J,Z,q=1){return new GW(this,J,Z,q)}addFolder(J){const Z=new n2({parent:this,title:J});if(this.root._closeFolders)Z.close();return Z}load(J,Z=!0){if(J.controllers)this.controllers.forEach((q)=>{if(q instanceof i5)return;if(q._name in J.controllers)q.load(J.controllers[q._name])});if(Z&&J.folders)this.folders.forEach((q)=>{if(q._title in J.folders)q.load(J.folders[q._title])});return this}save(J=!0){const Z={controllers:{},folders:{}};if(this.controllers.forEach((q)=>{if(q instanceof i5)return;if(q._name in Z.controllers)throw new Error(`Cannot save GUI with duplicate property "${q._name}"`);Z.controllers[q._name]=q.save()}),J)this.folders.forEach((q)=>{if(q._title in Z.folders)throw new Error(`Cannot save GUI with duplicate folder "${q._title}"`);Z.folders[q._title]=q.save()});return Z}open(J=!0){return this._setClosed(!J),this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}_setClosed(J){if(this._closed===J)return;this._closed=J,this._callOnOpenClose(this)}show(J=!0){return this._hidden=!J,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(J=!0){return this._setClosed(!J),this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const Z=this.$children.clientHeight;this.$children.style.height=Z+"px",this.domElement.classList.add("transition");const q=(W)=>{if(W.target!==this.$children)return;this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",q)};this.$children.addEventListener("transitionend",q);const Q=!J?0:this.$children.scrollHeight;this.domElement.classList.toggle("closed",!J),requestAnimationFrame(()=>{this.$children.style.height=Q+"px"})}),this}title(J){return this._title=J,this.$title.innerHTML=J,this}reset(J=!0){return(J?this.controllersRecursive():this.controllers).forEach((q)=>q.reset()),this}onChange(J){return this._onChange=J,this}_callOnChange(J){if(this.parent)this.parent._callOnChange(J);if(this._onChange!==void 0)this._onChange.call(this,{object:J.object,property:J.property,value:J.getValue(),controller:J})}onFinishChange(J){return this._onFinishChange=J,this}_callOnFinishChange(J){if(this.parent)this.parent._callOnFinishChange(J);if(this._onFinishChange!==void 0)this._onFinishChange.call(this,{object:J.object,property:J.property,value:J.getValue(),controller:J})}onOpenClose(J){return this._onOpenClose=J,this}_callOnOpenClose(J){if(this.parent)this.parent._callOnOpenClose(J);if(this._onOpenClose!==void 0)this._onOpenClose.call(this,J)}destroy(){if(this.parent)this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1);if(this.domElement.parentElement)this.domElement.parentElement.removeChild(this.domElement);Array.from(this.children).forEach((J)=>J.destroy())}controllersRecursive(){let J=Array.from(this.controllers);return this.folders.forEach((Z)=>{J=J.concat(Z.controllersRecursive())}),J}foldersRecursive(){let J=Array.from(this.folders);return this.folders.forEach((Z)=>{J=J.concat(Z.foldersRecursive())}),J}}var NW=n2;function aG(){J6.show()}function cG(){J6.hide()}function LW(J){if(J)aG();else cG()}var J6=new NW;J6.title("Options");J6.hide();function VW(){l2=new Map,t5=new Map}function r2(){return t5}function n4(J){let Z=t5.get(J);if(Z){if(Z.opsCompiled>0&&!Z.func)Z.invalidate();return Z}if(!MW.enableDynarec)return null;let q=l2.get(J)||0;if(q++,l2.set(J,q),q<nG)return null;return Z=new PW(J),t5.set(J,Z),Z}var MW={enableDynarec:!0},dG=J6.addFolder("Performance");dG.add(MW,"enableDynarec").name("Dynamic Recompilation");var nG=500,t5=new Map,l2=new Map;class PW{constructor(J){this.entryPC=J,this.minPC=J,this.maxPC=J+4,this.func=void 0,this.opsCompiled=0,this.executionCount=0,this.bailedOut=!1,this.nextFragments=[],this.bodyCode="",this.needsDelayCheck=!0,this.cop1statusKnown=!1,this.usesCop1=!1}invalidate(){this.minPC=this.entryPC,this.maxPC=this.entryPC+4,this.func=void 0,this.opsCompiled=0,this.executionCount=0,this.bailedOut=!1,this.nextFragments=[],this.bodyCode="",this.needsDelayCheck=!0,this.cop1statusKnown=!1,this.usesCop1=!1}updateMinMax(J){this.minPC=Math.min(this.minPC,J),this.maxPC=Math.max(this.maxPC,J+4)}getNextFragment(J,Z){let q=this.nextFragments[Z];if(!q||q.entryPC!==J)q=J===this.entryPC?this:n4(J),this.nextFragments[Z]=q;if(q&&q.opsCompiled>0&&!q.func)q.invalidate();return q}}function W7(J){let Z="";if(J&M0.AA_EN)Z+="|AA_EN";if(J&M0.Z_CMP)Z+="|Z_CMP";if(J&M0.Z_UPD)Z+="|Z_UPD";if(J&M0.IM_RD)Z+="|IM_RD";if(J&M0.CLR_ON_CVG)Z+="|CLR_ON_CVG";const q=J&768;if(q===M0.CVG_DST_CLAMP)Z+="|CVG_DST_CLAMP";else if(q===M0.CVG_DST_WRAP)Z+="|CVG_DST_WRAP";else if(q===M0.CVG_DST_FULL)Z+="|CVG_DST_FULL";else if(q===M0.CVG_DST_SAVE)Z+="|CVG_DST_SAVE";const Q=J&3072;if(Q===M0.ZMODE_OPA)Z+="|ZMODE_OPA";else if(Q===M0.ZMODE_INTER)Z+="|ZMODE_INTER";else if(Q===M0.ZMODE_XLU)Z+="|ZMODE_XLU";else if(Q===M0.ZMODE_DEC)Z+="|ZMODE_DEC";if(J&M0.CVG_X_ALPHA)Z+="|CVG_X_ALPHA";if(J&M0.ALPHA_CVG_SEL)Z+="|ALPHA_CVG_SEL";if(J&M0.FORCE_BL)Z+="|FORCE_BL";const W=J>>>ZJ,K=Z.length>0?Z.substr(1):"0",X="GBL_c1("+Q7(W>>>2)+") | GBL_c2("+Q7(W)+") /*"+Z0(W)+"*/";return K+", "+X}function m0(J){let Z=J;if(J===WJ)Z="G_TX_LOADTILE";if(J===lG)Z="G_TX_RENDERTILE";return Z}function g8(J){switch(J){case rG:return"G_TX_WRAP";case i4:return"G_TX_MIRROR";case h9:return"G_TX_CLAMP";case i4|h9:return"G_TX_MIRROR|G_TX_CLAMP"}return J}function m8(J,Z){let q="";if(Z&J.G_ZBUFFER)q+="|G_ZBUFFER";if(Z&J.G_TEXTURE_ENABLE)q+="|G_TEXTURE_ENABLE";if(Z&J.G_SHADE)q+="|G_SHADE";if(Z&J.G_SHADING_SMOOTH)q+="|G_SHADING_SMOOTH";const Q=Z&J.G_CULL_BOTH;if(Q===J.G_CULL_FRONT)q+="|G_CULL_FRONT";else if(Q===J.G_CULL_BACK)q+="|G_CULL_BACK";else if(Q===J.G_CULL_BOTH)q+="|G_CULL_BOTH";if(Z&J.G_FOG)q+="|G_FOG";if(Z&J.G_LIGHTING)q+="|G_LIGHTING";if(Z&J.G_TEXTURE_GEN)q+="|G_TEXTURE_GEN";if(Z&J.G_TEXTURE_GEN_LINEAR)q+="|G_TEXTURE_GEN_LINEAR";if(Z&J.G_LOD)q+="|G_LOD";return q.length>0?q.substr(1):"0"}function Q7(J){const Z=J>>>12&3,q=J>>>8&3,Q=J>>>4&3,W=J>>>0&3;return hW[Z]+","+sG[q]+","+hW[Q]+","+iG[W]}var M0={AA_EN:8,Z_CMP:16,Z_UPD:32,IM_RD:64,CLR_ON_CVG:128,CVG_DST_CLAMP:0,CVG_DST_WRAP:256,CVG_DST_FULL:512,CVG_DST_SAVE:768,ZMODE_OPA:0,ZMODE_INTER:1024,ZMODE_XLU:2048,ZMODE_DEC:3072,CVG_X_ALPHA:4096,ALPHA_CVG_SEL:8192,FORCE_BL:16384,TEX_EDGE:0},s2=0,UW=2;var ZJ=16,S8=3,K7=4,RW=4294967288,bW=0,l4=4,r4=6,i2=8,e5=9,J7=12,Z7=14,t2=16,q7=17,e2=19,s4=20;var JJ=23,$6=t({G_GBI2_MV_VIEWPORT:8,G_GBI2_MV_LIGHT:10,G_GBI2_MV_POINT:12,G_GBI2_MV_MATRIX:14,G_GBI2_MVO_LOOKATX:0,G_GBI2_MVO_LOOKATY:24,G_GBI2_MVO_L0:48,G_GBI2_MVO_L1:72,G_GBI2_MVO_L2:96,G_GBI2_MVO_L3:120,G_GBI2_MVO_L4:144,G_GBI2_MVO_L5:168,G_GBI2_MVO_L6:192,G_GBI2_MVO_L7:216}),X7=1<<JJ,_8=3<<s4,Y7=1<<e2,z7=3<<q7,F7=1<<t2,v8=3<<Z7,f8=3<<J7,H7=7<<e5,G7=1<<i2,$7=3<<r4,j7=3<<l4;var k7=1;var qJ=2;var QJ=4,u8=0;var w0=t({G_MW_MATRIX:0,G_MW_NUMLIGHT:2,G_MW_CLIP:4,G_MW_SEGMENT:6,G_MW_FOG:8,G_MW_LIGHTCOL:10,G_MW_POINTS:12,G_MW_PERSPNORM:14}),V0=t({G_MV_VIEWPORT:128,G_MV_LOOKATY:130,G_MV_LOOKATX:132,G_MV_L0:134,G_MV_L1:136,G_MV_L2:138,G_MV_L3:140,G_MV_L4:142,G_MV_L5:144,G_MV_L6:146,G_MV_L7:148,G_MV_TXTATT:150,G_MV_MATRIX_1:158,G_MV_MATRIX_2:152,G_MV_MATRIX_3:154,G_MV_MATRIX_4:156}),DW=0,N7=t({G_MWO_CLIP_RNX:4,G_MWO_CLIP_RNY:12,G_MWO_CLIP_RPX:20,G_MWO_CLIP_RPY:28}),L7=1,M7=2,P7=4,V7=8,U7=16,h7=32,R7=t({FR_NEG_FRUSTRATIO_1:1,FR_POS_FRUSTRATIO_1:65535,FR_NEG_FRUSTRATIO_2:2,FR_POS_FRUSTRATIO_2:65534,FR_NEG_FRUSTRATIO_3:3,FR_POS_FRUSTRATIO_3:65533,FR_NEG_FRUSTRATIO_4:4,FR_POS_FRUSTRATIO_4:65532,FR_NEG_FRUSTRATIO_5:5,FR_POS_FRUSTRATIO_5:65531,FR_NEG_FRUSTRATIO_6:6,FR_POS_FRUSTRATIO_6:65530}),b7=t({G_MWO_SEGMENT_0:0,G_MWO_SEGMENT_1:1,G_MWO_SEGMENT_2:2,G_MWO_SEGMENT_3:3,G_MWO_SEGMENT_4:4,G_MWO_SEGMENT_5:5,G_MWO_SEGMENT_6:6,G_MWO_SEGMENT_7:7,G_MWO_SEGMENT_8:8,G_MWO_SEGMENT_9:9,G_MWO_SEGMENT_A:10,G_MWO_SEGMENT_B:11,G_MWO_SEGMENT_C:12,G_MWO_SEGMENT_D:13,G_MWO_SEGMENT_E:14,G_MWO_SEGMENT_F:15});var x8=t({G_MWO_POINT_RGBA:16,G_MWO_POINT_ST:20,G_MWO_POINT_XYSCREEN:24,G_MWO_POINT_ZSCREEN:28}),D7=t({NUMLIGHTS_1:1,NUMLIGHTS_2:2,NUMLIGHTS_3:3,NUMLIGHTS_4:4,NUMLIGHTS_5:5,NUMLIGHTS_6:6,NUMLIGHTS_7:7}),WJ=7,lG=0,rG=0,i4=1,h9=2,AW=t({G_SC_NON_INTERLACE:0,G_SC_ODD_INTERLACE:3,G_SC_EVEN_INTERLACE:2}),B6={G_ZBUFFER:1,G_TEXTURE_ENABLE:2,G_SHADE:4,G_SHADING_SMOOTH:512,G_CULL_FRONT:4096,G_CULL_BACK:8192,G_CULL_BOTH:12288,G_FOG:65536,G_LIGHTING:131072,G_TEXTURE_GEN:262144,G_TEXTURE_GEN_LINEAR:524288,G_LOD:1048576},q9={G_TEXTURE_ENABLE:2,G_SHADE:0,G_ZBUFFER:1,G_CULL_BACK:512,G_CULL_FRONT:1024,G_CULL_BOTH:1536,G_FOG:65536,G_LIGHTING:131072,G_TEXTURE_GEN:262144,G_TEXTURE_GEN_LINEAR:524288,G_LOD:1048576,G_SHADING_SMOOTH:2097152},j0=t({G_IM_FMT_RGBA:0,G_IM_FMT_YUV:1,G_IM_FMT_CI:2,G_IM_FMT_IA:3,G_IM_FMT_I:4}),d=t({G_IM_SIZ_4b:0,G_IM_SIZ_8b:1,G_IM_SIZ_16b:2,G_IM_SIZ_32b:3}),A7=t({G_PM_1PRIMITIVE:1<<JJ,G_PM_NPRIMITIVE:0<<JJ}),k0=t({G_CYC_1CYCLE:0<<s4,G_CYC_2CYCLE:1<<s4,G_CYC_COPY:2<<s4,G_CYC_FILL:3<<s4}),w7=t({G_TP_NONE:0<<e2,G_TP_PERSP:1<<e2}),B7=t({G_TD_CLAMP:0<<q7,G_TD_SHARPEN:1<<q7,G_TD_DETAIL:2<<q7}),I7=t({G_TL_TILE:0<<t2,G_TL_LOD:1<<t2}),p8=t({G_TT_NONE:0<<Z7,G_TT_RGBA16:2<<Z7,G_TT_IA16:3<<Z7}),a8=t({G_TF_POINT:0<<J7,G_TF_AVERAGE:3<<J7,G_TF_BILERP:2<<J7}),C7=t({G_TC_CONV:0<<e5,G_TC_FILTCONV:5<<e5,G_TC_FILT:6<<e5}),O7=t({G_CK_NONE:0<<i2,G_CK_KEY:1<<i2}),y7=t({G_CD_MAGICSQ:0<<r4,G_CD_BAYER:1<<r4,G_CD_NOISE:2<<r4,G_CD_DISABLE:3<<r4}),E7=t({G_AD_PATTERN:0<<l4,G_AD_NOTPATTERN:1<<l4,G_AD_NOISE:2<<l4,G_AD_DISABLE:3<<l4}),e9=t({G_AC_NONE:0<<s2,G_AC_THRESHOLD:1<<s2,G_AC_DITHER:3<<s2}),R9=t({G_ZS_PIXEL:0<<UW,G_ZS_PRIM:1<<UW}),hW=["G_BL_CLR_IN","G_BL_CLR_MEM","G_BL_CLR_BL","G_BL_CLR_FOG"],sG=["G_BL_A_IN","G_BL_A_FOG","G_BL_A_SHADE","G_BL_0"],iG=["G_BL_1MA","G_BL_A_MEM","G_BL_1","G_BL_0"];function tG(J){const Z=J>>>8&255,q=J&255;return Z<<24|Z<<16|Z<<8|q}function YJ(J){const Z=o8[J>>>11&31],q=o8[J>>>6&31],Q=o8[J>>>1&31],W=J&1?255:0;return Z<<24|q<<16|Q<<8|W}var eG=function(J,Z,q){const Q=J.data,W=J.width*4;let K=0;const X=q.line<<4;let Y=q.tmem<<3,z=0;for(let G=0;G<q.height;++G){let H=Y,j=K;for(let N=0;N<q.width;++N){const L=H^z;Q[j+0]=Z[L+0],Q[j+1]=Z[L+1],Q[j+2]=Z[L+2],Q[j+3]=Z[L+3],H+=4,j+=4}Y+=X,K+=W,z^=8}},J$=function(J,Z,q){let Q=J.data,W=J.width*4,K=0,X=q.line<<3,Y=q.tmem<<3,z=0;for(let G=0;G<q.height;++G){let H=Y,j=K;for(let N=0;N<q.width;++N){let L=H^z,M=Z[L]<<8|Z[L+1];Q[j+0]=o8[M>>>11&31],Q[j+1]=o8[M>>>6&31],Q[j+2]=o8[M>>>1&31],Q[j+3]=M&1?255:0,H+=2,j+=4}Y+=X,K+=W,z^=4}},Z$=function(J,Z,q){let Q=J.data,W=J.width*4,K=0,X=q.line<<3,Y=q.tmem<<3,z=0;for(let G=0;G<q.height;++G){let H=Y,j=K;for(let N=0;N<q.width;++N){let L=H^z,M=Z[L],V=Z[L+1];Q[j+0]=M,Q[j+1]=M,Q[j+2]=M,Q[j+3]=V,H+=2,j+=4}Y+=X,K+=W,z^=4}},q$=function(J,Z,q){let Q=J.data,W=J.width*4,K=0,X=q.line<<3,Y=q.tmem<<3,z=0;for(let G=0;G<q.height;++G){let H=Y,j=K;for(let N=0;N<q.width;++N){let L=H^z,M=Z[L],V=t4[M>>>4&15],h=t4[M&15];Q[j+0]=V,Q[j+1]=V,Q[j+2]=V,Q[j+3]=h,H+=1,j+=4}Y+=X,K+=W,z^=4}},Q$=function(J,Z,q){let Q=J.data,W=J.width*4,K=0,X=q.line<<3,Y=q.tmem<<3,z=0;for(let G=0;G<q.height;++G){let H=Y,j=K;for(let N=0;N+1<q.width;N+=2){let L=H^z,M=Z[L],V=XJ[(M&224)>>>5],h=KJ[(M&16)>>>4],b=XJ[(M&14)>>>1],C=KJ[(M&1)>>>0];Q[j+0]=V,Q[j+1]=V,Q[j+2]=V,Q[j+3]=h,Q[j+4]=b,Q[j+5]=b,Q[j+6]=b,Q[j+7]=C,H+=1,j+=8}if(q.width&1){let N=H^z,L=Z[N],M=XJ[(L&224)>>>5],V=KJ[(L&16)>>>4];Q[j+0]=M,Q[j+1]=M,Q[j+2]=M,Q[j+3]=V,H+=1,j+=4}Y+=X,K+=W,z^=4}},W$=function(J,Z,q){let Q=J.data,W=J.width*4,K=0,X=q.line<<3,Y=q.tmem<<3,z=0;for(let G=0;G<q.height;++G){let H=Y,j=K;for(let N=0;N<q.width;++N){let L=Z[H^z];Q[j+0]=L,Q[j+1]=L,Q[j+2]=L,Q[j+3]=L,H+=1,j+=4}Y+=X,K+=W,z^=4}},K$=function(J,Z,q){let Q=J.data,W=J.width*4,K=0,X=q.line<<3,Y=q.tmem<<3,z=0;for(let G=0;G<q.height;++G){let H=Y,j=K;for(let N=0;N+1<q.width;N+=2){let L=Z[H^z],M=t4[(L&240)>>>4],V=t4[(L&15)>>>0];Q[j+0]=M,Q[j+1]=M,Q[j+2]=M,Q[j+3]=M,Q[j+4]=V,Q[j+5]=V,Q[j+6]=V,Q[j+7]=V,H+=1,j+=8}if(q.width&1){let N=Z[H^z],L=t4[(N&240)>>>4];Q[j+0]=L,Q[j+1]=L,Q[j+2]=L,Q[j+3]=L,H+=1,j+=4}Y+=X,K+=W,z^=4}},wW=function(J,Z,q,Q){const W=J.data,K=J.width*4;let X=0;const Y=q.line<<3;let z=q.tmem<<3;const G=0;for(let j=0;j<256;++j){const M=2048+(j*4+G)*2,V=Z[M+0]<<8|Z[M+1];c8[j]=Q(V)}let H=0;for(let j=0;j<q.height;++j){let N=z,L=X;for(let M=0;M<q.width;++M){const V=c8[Z[N^H]];W[L+0]=V>>24&255,W[L+1]=V>>16&255,W[L+2]=V>>8&255,W[L+3]=V&255,N+=1,L+=4}z+=Y,X+=K,H^=4}},BW=function(J,Z,q,Q,W){const K=J.data,X=J.width*4;let Y=0;const z=q.line<<3;let G=q.tmem<<3;const H=0;for(let N=0;N<16;++N){const V=2048+((Q*16|N)*4+H)*2,h=Z[V+0]<<8|Z[V+1];c8[N]=W(h)}let j=0;for(let N=0;N<q.height;++N){let L=G,M=Y;for(let V=0;V+1<q.width;V+=2){let h=Z[L^j],b=c8[(h&240)>>>4],C=c8[(h&15)>>>0];K[M+0]=b>>24&255,K[M+1]=b>>16&255,K[M+2]=b>>8&255,K[M+3]=b&255,K[M+4]=C>>24&255,K[M+5]=C>>16&255,K[M+6]=C>>8&255,K[M+7]=C&255,L+=1,M+=8}if(q.width&1){let V=Z[L^j],h=c8[(V&240)>>>4];K[M+0]=h>>24&255,K[M+1]=h>>16&255,K[M+2]=h>>8&255,K[M+3]=h&255,L+=1,M+=4}G+=z,Y+=X,j^=4}};function IW(J,Z,q,Q){const W=Q===p8.G_TT_IA16?tG:YJ;switch(q.format){case j0.G_IM_FMT_RGBA:switch(q.size){case d.G_IM_SIZ_32b:return eG(J,Z,q),!0;case d.G_IM_SIZ_16b:return J$(J,Z,q),!0;case d.G_IM_SIZ_8b:return wW(J,Z,q,W),!0;case d.G_IM_SIZ_4b:return BW(J,Z,q,q.palette,W),!0}break;case j0.G_IM_FMT_IA:switch(q.size){case d.G_IM_SIZ_16b:return Z$(J,Z,q),!0;case d.G_IM_SIZ_8b:return q$(J,Z,q),!0;case d.G_IM_SIZ_4b:return Q$(J,Z,q),!0}break;case j0.G_IM_FMT_I:switch(q.size){case d.G_IM_SIZ_8b:return W$(J,Z,q),!0;case d.G_IM_SIZ_4b:return K$(J,Z,q),!0}break;case j0.G_IM_FMT_CI:switch(q.size){case d.G_IM_SIZ_8b:return wW(J,Z,q,W),!0;case d.G_IM_SIZ_4b:return BW(J,Z,q,q.palette,W),!0}break}return!1}var KJ=[0,255],XJ=[0,36,73,109,146,182,219,255],t4=[0,17,34,51,68,85,102,119,136,153,170,187,204,221,238,255],o8=[0,8,16,24,33,41,49,57,66,74,82,90,99,107,115,123,132,140,148,156,165,173,181,189,198,206,214,222,231,239,247,255],c8=new Uint32Array(256);function T7(J,Z,q){let Q;switch(Z){case S8:Q=`gsDPSetAlphaCompare(${e9.nameOf(q)});`;break;case K7:Q=`gsDPSetDepthSource(${R9.nameOf(q)});`;break;case RW:Q=`gsDPSetRenderMode(${W7(q)});`;break;default:Q=`gsSPSetOtherMode(G_SETOTHERMODE_L, ${k(Z)}, ${k(q)}`;break}J.text(Q)}function S7(J,Z,q,Q,W){let K;switch(Z){case bW:break;case j7:K=`gsDPSetAlphaDither(${E7.nameOf(W)});`;break;case $7:K=`gsDPSetColorDither(${y7.nameOf(W)});`;break;case G7:K=`gsDPSetCombineKey(${O7.nameOf(W)});`;break;case H7:K=`gsDPSetTextureConvert(${C7.nameOf(W)});`;break;case f8:K=`gsDPSetTextureFilter(${a8.nameOf(W)});`;break;case F7:K=`gsDPSetTextureLOD(${I7.nameOf(W)});`;break;case v8:K=`gsDPSetTextureLUT(${p8.nameOf(W)});`;break;case z7:K=`gsDPSetTextureDetail(${B7.nameOf(W)});`;break;case Y7:K=`gsDPSetTexturePersp(${w7.nameOf(W)});`;break;case _8:K=`gsDPSetCycleType(${k0.nameOf(W)});`;break;case X7:K=`gsDPPipelineMode(${A7.nameOf(W)});`;break;default:K=`gsSPSetOtherMode(G_SETOTHERMODE_H, ${k(Z)}, ${k(W)});`;break}J.text(K)}var CW=function(J,Z,q,Q){const W=`${J}, ${Z}, ${q}`,K=`${W}, ${Q}`;if(J<128&&Z<128||Z<128&&q<128||q<128&&J<128)return`<span style="color: white; background-color: rgb(${W})">${K}</span>`;return`<span style="background-color: rgb(${W})">${K}</span>`};function b9(J){const Z=J>>>24&255,q=J>>>16&255,Q=J>>>8&255,W=J&255;return CW(Z,q,Q,W)}function _7(J){const Z=J&255,q=J>>>8&255,Q=J>>>16&255,W=J>>>24&255;return CW(Z,q,Q,W)}function OW(J){return b9(YJ(J))}class J8{constructor(J){this.gl=J,this.vao=J.createVertexArray(),this.posBuffer=null,this.uvBuffer=null,this.colBuffer=null}bind(){this.gl.bindVertexArray(this.vao)}unbind(){this.gl.bindVertexArray(null)}initPosAttr(J,Z){const q=this.gl;this.bind();const Q=q.getAttribLocation(J,Z),W=q.createBuffer();q.enableVertexAttribArray(Q),q.bindBuffer(q.ARRAY_BUFFER,W),q.vertexAttribPointer(Q,4,q.FLOAT,!1,0,0),this.unbind(),this.posBuffer=W}initColorAttr(J,Z){const q=this.gl;this.bind();const Q=q.getAttribLocation(J,Z),W=q.createBuffer();q.enableVertexAttribArray(Q),q.bindBuffer(q.ARRAY_BUFFER,W),q.vertexAttribPointer(Q,4,q.UNSIGNED_BYTE,!0,0,0),this.unbind(),this.colBuffer=W}initUVsAttr(J,Z){const q=this.gl;this.bind();const Q=q.getAttribLocation(J,Z),W=q.createBuffer();q.enableVertexAttribArray(Q),q.bindBuffer(q.ARRAY_BUFFER,W),q.vertexAttribPointer(Q,2,q.FLOAT,!1,0,0),this.unbind(),this.uvBuffer=W}setPosData(J,Z){this.setData(this.posBuffer,J,Z)}setColorData(J,Z){this.setData(this.colBuffer,J,Z)}setUVData(J,Z){this.setData(this.uvBuffer,J,Z)}setData(J,Z,q){const Q=this.gl;Q.bindBuffer(Q.ARRAY_BUFFER,J),Q.bufferData(Q.ARRAY_BUFFER,Z,q)}}function GJ(J,Z,q){let Q=HJ(J,Z),W=HJ(J,q),K=J.createProgram();if(J.attachShader(K,Q),J.attachShader(K,W),J.linkProgram(K),!J.getProgramParameter(K,J.LINK_STATUS))J0(!1,"Unable to initialize the shader program.");return K}var HJ=function(J,Z){let q=document.getElementById(Z);if(!q)return null;let Q=vW(q),W;if(q.type==="x-shader/x-fragment")W=J.FRAGMENT_SHADER;else if(q.type==="x-shader/x-vertex")W=J.VERTEX_SHADER;else return null;return fW(J,Q,W)},vW=function(J){let Z="",q=J.firstChild;while(q){if(q.nodeType==Node.TEXT_NODE)Z+=q.textContent;q=q.nextSibling}return Z},fW=function(J,Z,q){let Q=J.createShader(q);if(J.shaderSource(Q,Z),J.compileShader(Q),!J.getShaderParameter(Q,J.COMPILE_STATUS))return J0(!1,"An error occurred compiling the shaders: "+J.getShaderInfoLog(Q)),null;return Q};function xW(J,Z,q,Q,W){let K=Q<k0.G_CYC_COPY?`${Z.toString(16)+q.toString(16)}_${Q}`:Q.toString();if(W)K+="_alphaThreshold";let X=EW.get(K);if(X)return X;if(!FJ)FJ=HJ(J,"n64-shader-vs");if(!zJ){let H0=document.getElementById("n64-shader-fs");if(H0)zJ=vW(H0)}let Y=Z>>>20&15,z=q>>>28&15,G=Z>>>15&31,H=q>>>15&7,j=Z>>>12&7,N=q>>>12&7,L=Z>>>9&7,M=q>>>9&7,V=Z>>>5&15,h=q>>>24&15,b=Z>>>0&31,C=q>>>6&7,_=q>>>21&7,E=q>>>3&7,S=q>>>18&7,m=q>>>0&7,o;if(Q===k0.G_CYC_FILL)o="col = shade;\n";else if(Q===k0.G_CYC_COPY)o="col = tex0;\n";else if(Q===k0.G_CYC_1CYCLE)o="",o+="col.rgb = ("+v7[Y]+" - "+v7[z]+") * "+TW[G]+" + "+_W[H]+";\n",o+="col.a = ("+D9[j]+" - "+D9[N]+") * "+D9[L]+" + "+D9[M]+";\n";else o="",o+="col.rgb = ("+v7[Y]+" - "+v7[z]+") * "+TW[G]+" + "+_W[H]+";\n",o+="col.a = ("+D9[j]+" - "+D9[N]+") * "+D9[L]+" + "+D9[M]+";\n",o+="combined = vec4(col.rgb, col.a);\n",o+="col.rgb = ("+SW[V]+" - "+SW[h]+") * "+Y$[b]+" + "+z$[C]+";\n",o+="col.a = ("+f7[_]+" - "+f7[E]+") * "+f7[S]+" + "+f7[m]+";\n";if(W)o+="if(col.a <= uAlphaThreshold) discard;\n";let L0=zJ.replace("{{body}}",o);if(X$){let H0="\n";H0+="\tRGB0 = ("+x7[Y]+" - "+g7[z]+") * "+u7[G]+" + "+m7[H]+"\n",H0+="\t  A0 = ("+A9[j]+" - "+A9[N]+") * "+p7[L]+" + "+a7[M]+"\n",H0+="\tRGB1 = ("+x7[V]+" - "+g7[h]+") * "+u7[b]+" + "+m7[C]+"\n",H0+="\t  A1 = ("+A9[_]+" - "+A9[E]+") * "+p7[S]+" + "+a7[m]+"\n";let Y6=L0.split("\n").join("<br>");U("Compiled "+H0+"\nto\n"+Y6)}let R0=fW(J,L0,J.FRAGMENT_SHADER);if(!R0)return null;let F0=J.createProgram();if(J.attachShader(F0,FJ),J.attachShader(F0,R0),J.linkProgram(F0),!J.getProgramParameter(F0,J.LINK_STATUS))J0(!1,"Unable to initialize the shader program.");return X=new uW(J,F0,L0),EW.set(K,X),X}function c7(J,Z){let q=J>>>20&15,Q=Z>>>28&15,W=J>>>15&31,K=Z>>>15&7,X=J>>>12&7,Y=Z>>>12&7,z=J>>>9&7,G=Z>>>9&7,H=J>>>5&15,j=Z>>>24&15,N=J>>>0&31,L=Z>>>6&7,M=Z>>>21&7,V=Z>>>3&7,h=Z>>>18&7,b=Z>>>0&7,C="";return C+="RGB0 = ("+x7[q]+" - "+g7[Q]+") * "+u7[W]+" + "+m7[K]+"\n",C+="  A0 = ("+A9[X]+" - "+A9[Y]+") * "+p7[z]+" + "+a7[G]+"\n",C+="RGB1 = ("+x7[H]+" - "+g7[j]+") * "+u7[N]+" + "+m7[L]+"\n",C+="  A1 = ("+A9[M]+" - "+A9[V]+") * "+p7[h]+" + "+a7[b]+"\n",C}var X$=!1,EW=new Map,zJ=null,FJ=null,TW=["combined.rgb","tex0.rgb","tex1.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","combined.a","tex0.a","tex1.a","prim.a","shade.a","env.a","lod_frac","prim_lod_frac","k5","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","zero.rgb"],Y$=["combined.rgb","tex1.rgb","tex0.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","combined.a","tex1.a","tex0.a","prim.a","shade.a","env.a","lod_frac","prim_lod_frac","k5","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","?           ","zero.rgb"],v7=["combined.rgb","tex0.rgb","tex1.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","combined.a","tex0.a","tex1.a","prim.a","shade.a","env.a","lod_frac","prim_lod_frac","zero.rgb"],SW=["combined.rgb","tex1.rgb","tex0.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","combined.a","tex1.a","tex0.a","prim.a","shade.a","env.a","lod_frac","prim_lod_frac","zero.rgb"],_W=["combined.rgb","tex0.rgb","tex1.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","zero.rgb"],z$=["combined.rgb","tex1.rgb","tex0.rgb","prim.rgb","shade.rgb","env.rgb","one.rgb","zero.rgb"],D9=["combined.a","tex0.a","tex1.a","prim.a","shade.a","env.a","one.a","zero.a"],f7=["combined.a","tex1.a","tex0.a","prim.a","shade.a","env.a","one.a","zero.a"],u7=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","KeyScale    ","CombinedAlph","Texel0_Alpha","Texel1_Alpha","Prim_Alpha  ","Shade_Alpha ","Env_Alpha   ","LOD_Frac    ","PrimLODFrac ","K5          ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           "],x7=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","1           ","Noise       ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           "],g7=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","KeyCenter   ","K4          ","0           ","0           ","0           ","0           ","0           ","0           ","0           ","0           "],m7=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","1           ","0           "],A9=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","PrimLODFrac ","0           "],p7=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","1           ","0           "],a7=["Combined    ","Texel0      ","Texel1      ","Primitive   ","Shade       ","Env         ","1           ","0           "];class uW{constructor(J,Z,q){this.program=Z,this.shaderSource=q,this.vertexArray=new J8(J),this.vertexArray.initPosAttr(Z,"aPosition"),this.vertexArray.initUVsAttr(Z,"aUV"),this.vertexArray.initColorAttr(Z,"aColor"),this.uSamplerUniform0=J.getUniformLocation(Z,"uSampler0"),this.uSamplerUniform1=J.getUniformLocation(Z,"uSampler1"),this.uTexScaleUniform0=J.getUniformLocation(Z,"uTexScale0"),this.uTexScaleUniform1=J.getUniformLocation(Z,"uTexScale1"),this.uTexOffsetUniform0=J.getUniformLocation(Z,"uTexOffset0"),this.uTexOffsetUniform1=J.getUniformLocation(Z,"uTexOffset1"),this.uPrimColorUniform=J.getUniformLocation(Z,"uPrimColor"),this.uEnvColorUniform=J.getUniformLocation(Z,"uEnvColor"),this.uAlphaThresholdUniform=J.getUniformLocation(Z,"uAlphaThresholdUniform")}}var H$=function(J){const Z=jJ("x",J,V7,L7),q=jJ("y",J,U7,M7),Q=jJ("z",J,h7,P7);return`${Z} ${q} ${Q}`},jJ=function(J,Z,q,Q){const W=Z&q,K=Z&Q;let X="",Y="";if(W&&K)X="clip-err",Y="!";else if(W)X="clip-pos",Y=">";else if(K)X="clip-neg",Y="<";else X="clip-none",Y="0";return`<span class="${X}">${J}${Y}</span>`},o7,d8,w9,gW=$("#dlist-content"),F$=0,mW="";class kJ{constructor(J,Z){this.state=J,this.processDList=Z,this.currentOp=0,this.numOps=0,this.bailAfter=-1,this.lastTask,this.stateTimeShown=-1,this.running=!1,this.requested=!1,this.dlFocusCounter=0}onNewTask(J){if(this.lastTask=J,this.requested){if(mW==""||J.detectVersionString().includes(mW)){if(this.dlFocusCounter==F$)this.requested=!1,n64js.breakEmulationForDisplayListDebug(),this.stateTimeShown=-1,this.running=!0;this.dlFocusCounter++}}else this.dlFocusCounter=0}toggle(){if(this.running)this.hideUI(),this.bailAfter=-1,this.running=!1,n64js.toggleRun();else this.showUI(),this.requested=!0}halt(){this.showUI(),this.requested=!1,this.running=!0,this.bailAfter=this.currentOp,this.stateTimeShown=-1}debugDisplayList(){if(this.stateTimeShown==-1){const J=new pW(this);this.processDList(this.lastTask,J,-1),J.finalise(),this.numOps=J.numOps>0?J.numOps-1:0,this.setScrubRange(this.numOps);const Z=this.bailAfter==-1?this.numOps:this.bailAfter;this.setScrubTime(Z)}if(this.processDList(this.lastTask,null,this.bailAfter),this.stateTimeShown!==this.bailAfter)this.updateStateUI(),this.stateTimeShown=this.bailAfter}postOp(J){if(J>-1&&this.currentOp>=J)return!0;return this.currentOp++,!1}updateStateUI(){d8.find("#dl-geometrymode-content").html(this.buildStateTab()),d8.find("#dl-vertices-content").html(this.buildVerticesTab()),d8.find("#dl-tiles-content").html(this.buildTilesTab()),d8.find("#dl-combiner-content").html(this.buildCombinerTab()),d8.find("#dl-rdp-content").html(this.buildRDPTab())}setScrubText(J,Z){o7.find(".scrub-text").html(`uCode op ${J}/${Z}.`)}setScrubRange(J){o7.find("input").attr({min:0,max:J,value:J}),this.setScrubText(J,J)}setScrubTime(J){this.bailAfter=J,this.setScrubText(this.bailAfter,this.numOps);const Z=w9.find(`#I${this.bailAfter}`);w9.scrollTop(w9.scrollTop()+Z.position().top-w9.height()/2+Z.height()/2);const q="hle-cur-instr";w9.find(".hle-instr").removeClass(q),Z.addClass(q)}initUI(){const J=gW.find("#controls");this.bailAfter=-1,this.numOps=0;const Z=this;J.find("#rwd").click(()=>{if(Z.running&&Z.bailAfter>0)Z.setScrubTime(Z.bailAfter-1)}),J.find("#fwd").click(()=>{if(Z.running&&Z.bailAfter<Z.numOps)Z.setScrubTime(Z.bailAfter+1)}),J.find("#stop").click(()=>{this.toggle()}),o7=J.find(".scrub"),o7.find("input").change(function(){Z.setScrubTime($(this).val()|0)}),this.setScrubRange(0),d8=gW.find(".hle-state"),w9=$('<div class="hle-disasm"></div>'),$("#adjacent-debug").empty().append(w9)}showUI(){n64js.debugger().show(),$("#dlist-tab").tab("show")}hideUI(){n64js.debugger().hide()}setDisplayListOutput(J){w9.html(J),J.find(".dl-tip").parent().click(function(){$(this).find(".dl-tip").toggle()})}buildStateTab(){const J=$('<table class="table table-condensed dl-debug-table" style="width: auto;"></table>'),Z=$("<tr />");for(let q in this.state.geometryMode)if(Object.prototype.hasOwnProperty.call(this.state.geometryMode,q)){const Q=$(`<td>${q}</td>`);Q.addClass(this.state.geometryMode[q]?"dl-debug-geommode-enabled":"dl-debug-geommode-disabled"),Z.append(Q)}return J.append(Z),J}buildRDPTab(){const J=this.state.rdpOtherModeL,Z=this.state.rdpOtherModeH,q=this.state.textureImage,Q=new Map([["alphaCompare",e9.nameOf(J&S8)],["depthSource",R9.nameOf(J&K7)],["renderMode",W7(J)],["alphaDither",E7.nameOf(Z&j7)],["colorDither",y7.nameOf(Z&$7)],["combineKey",O7.nameOf(Z&G7)],["textureConvert",C7.nameOf(Z&H7)],["textureFilter",a8.nameOf(Z&f8)],["textureLUT",p8.nameOf(Z&v8)],["textureLOD",I7.nameOf(Z&F7)],["texturePersp",w7.nameOf(Z&Y7)],["textureDetail",B7.nameOf(Z&z7)],["cycleType",k0.nameOf(Z&_8)],["pipelineMode",A7.nameOf(Z&X7)],["","&nbsp"],["TI.format",j0.nameOf(q.format)],["TI.size",d.nameOf(q.size)],["TI.width",q.width],["TI.address",k(q.address)]]),W=$('<table class="table table-condensed dl-debug-table" style="width: auto;"></table>');for(let[K,X]of Q){let Y=$(`<tr><td>${K}</td><td>${X}</td></tr>`);W.append(Y)}return W}buildColorsTable(){const J=["fillColor","envColor","primColor","blendColor","fogColor"],Z=$('<table class="table table-condensed dl-debug-table" style="width: auto;"></table>');for(let q of J){let Q=$(`<tr><td>${q}</td><td>${b9(this.state[q])}</td></tr>`);Z.append(Q)}return Z}buildCombinerTab(){const J=$('<pre class="combine"></pre>');J.append(k0.nameOf(this.state.getCycleType())+"\n"),J.append(this.buildColorsTable()),J.append(c7(this.state.combine.hi,this.state.combine.lo));const Z=this.renderer.getCurrentN64Shader();if(Z)J.append(Z.shaderSource);return J}buildTexture(J){const Z=this.renderer.lookupTexture(J);if(Z)return Z.createScaledCanvas(8)}buildTilesTab(){const J=$("<div />");J.append(this.buildTilesTable());const Z=[],q=$("<tr />");for(let W=0;W<8;++W){let K=this.buildTexture(W);Z.push(m0(W));let X=$("<td />");X.append(K?K:""),q.append(X)}const Q=$('<table class="table table-condensed dl-debug-table" style="width: auto"></table>');return Q.append($(`<tr><th>${Z.join("</th><th>")}</th></tr>`)),Q.append(q),J.append(Q),J}buildTilesTable(){const J=["tile #","format","size","line","tmem","palette","cmS","maskS","shiftS","cmT","maskT","shiftT","left","top","right","bottom","width","height","unmasked w","unmasked h"],Z=$('<table class="table table-condensed dl-debug-table" style="width: auto"></table>'),q=$(`<tr><th>${J.join("</th><th>")}</th></tr>`);Z.append(q);for(let Q=0;Q<this.state.tiles.length;++Q){const W=this.state.tiles[Q];if(W.format===-1)continue;const K=[];K.push(m0(Q)),K.push(j0.nameOf(W.format)),K.push(d.nameOf(W.size)),K.push(W.line),K.push(W.tmem),K.push(W.palette),K.push(g8(W.cmS)),K.push(W.maskS),K.push(W.shiftS),K.push(g8(W.cmT)),K.push(W.maskT),K.push(W.shiftT),K.push(W.left),K.push(W.top),K.push(W.right),K.push(W.bottom),K.push(W.width),K.push(W.height),K.push(W.unmaskedWidth),K.push(W.unmaskedHeight);const X=$(`<tr><td>${K.join("</td><td>")}</td></tr>`);Z.append(X)}return Z}buildVerticesTab(){const J=["vtx #","x","y","z","px","py","pz","pw","color","u","v","clip"],Z=$('<table class="table table-condensed dl-debug-table" style="width: auto"></table>'),q=$(`<tr><th>${J.join("</th><th>")}</th></tr>`);Z.append(q);for(let Q=0;Q<this.state.projectedVertices.length;++Q){const W=this.state.projectedVertices[Q];if(!W.set)continue;const K=W.pos.x/W.pos.w,X=W.pos.y/W.pos.w,Y=W.pos.z/W.pos.w,z=[];z.push(Q),z.push(K.toFixed(3)),z.push(X.toFixed(3)),z.push(Y.toFixed(3)),z.push(W.pos.x.toFixed(3)),z.push(W.pos.y.toFixed(3)),z.push(W.pos.z.toFixed(3)),z.push(W.pos.w.toFixed(3)),z.push(_7(W.color)),z.push(W.u.toFixed(3)),z.push(W.v.toFixed(3)),z.push(H$(W.clipFlags));const G=$(`<tr><td>${z.join("</td><td>")}</td></tr>`);Z.append(G)}return Z}}class pW{constructor(J){this.debugController=J,this.$currentDis=$("<pre></pre>"),this.$span=void 0,this.numOps=0}begin(J,Z,q){const Q=new Array(q+1).join("  ");this.$span=$(`<span class="hle-instr" id="I${this.numOps}" />`),this.$span.append(`${ZQ(this.numOps,5)} ${v(J,32)}${v(Z,32)} ${Q}`),this.$currentDis.append(this.$span)}text(J){this.$span.append(J)}tip(J){const Z=$(`<div class="dl-tip">${J}</div>`);Z.hide(),this.$span.append(Z)}end(){this.$span.append("<br>"),this.numOps++}finalise=function(){this.debugController.setDisplayListOutput(this.$currentDis)};rgba8888(J){return b9(J)}rgba5551(J){return OW(J)}}class U0{constructor(J,Z,q){if(q!==void 0)this.elems=new Float32Array(3),this.elems[0]=J,this.elems[1]=Z,this.elems[2]=q;else this.elems=J||new Float32Array(3)}get x(){return this.elems[0]}get y(){return this.elems[1]}get z(){return this.elems[2]}set x(J){this.elems[0]=J}set y(J){this.elems[1]=J}set z(J){this.elems[2]=J}set(J,Z,q){return this.x=J,this.y=Z,this.z=q,this}dot(J){let Z=0;for(let q=0;q<this.elems.length;++q)Z+=this.elems[q]*J.elems[q];return Z}lengthSqr(){return this.dot(this)}length(){return Math.sqrt(this.lengthSqr())}addInPlace(J){for(let Z=0;Z<this.elems.length;++Z)this.elems[Z]+=J.elems[Z];return this}subInPlace(J){for(let Z=0;Z<this.elems.length;++Z)this.elems[Z]-=J.elems[Z];return this}scaleInPlace(J){for(let Z=0;Z<this.elems.length;++Z)this.elems[Z]*=J;return this}vecScaleInPlace(J){for(let Z=0;Z<this.elems.length;++Z)this.elems[Z]*=J.elems[Z];return this}invVecScaleInPlace(J){for(let Z=0;Z<this.elems.length;++Z)this.elems[Z]/=J.elems[Z];return this}normaliseInPlace(){let J=this.length();if(J>0)return this.scaleInPlace(1/J);return this}static create(J){const Z=new U0;return Z.elems[0]=J[0],Z.elems[1]=J[1],Z.elems[2]=J[2],Z}}var aW=function(J,Z,q){return J.getU32(Z)&4294901760|J.getU32(q)>>>16&65535},cW=function(J,Z,q){return J.getU32(Z)<<16|J.getU32(q)&65535},NJ=function(J){return J<<18>>18},n8=function(J){return J<<4>>4},y=t({Nop:0,FillTriangle:8,FillZBufferTriangle:9,TextureTriangle:10,TextureZBufferTriangle:11,ShadeTriangle:12,ShadeZBufferTriangle:13,ShadeTextureTriangle:14,ShadeTextureZBufferTriangle:15,TextureRectangle:36,TextureRectangleFlip:37,SyncLoad:38,SyncPipe:39,SyncTile:40,SyncFull:41,SetKeyGB:42,SetKeyR:43,SetConvert:44,SetScissor:45,SetPrimDepth:46,SetOtherModes:47,LoadTLut:48,SetTileSize:50,LoadBlock:51,LoadTile:52,SetTile:53,FillRectangle:54,SetFillColor:55,SetFogColor:56,SetBlendColor:57,SetPrimColor:58,SetEnvColor:59,SetCombine:60,SetTextureImage:61,SetMaskImage:62,SetColorImage:63}),e4=[1,1,1,1,1,1,1,1,4,6,12,14,12,14,20,22,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],r7=16,G$=1<<r7,$$=2,d7=1<<$$,n7=16,l7=16;class Z8{constructor(J,Z,q,Q){Q=Q||4294967295,this.dv=J,this.curAddr=Z,this.endAddr=q,this.addrMask=Q}clone(){return new Z8(this.dv,this.curAddr,this.endAddr,this.addrMask)}getU32(J){return this.dv.getUint32(this.curAddr+J&this.addrMask,!1)}getU64(J){return this.dv.getBigUint64(this.curAddr+J&this.addrMask,!1)}advance(J){this.curAddr+=J}bytesRemaining(){return this.endAddr-this.curAddr}empty(){return this.curAddr>=this.endAddr}}class p6{constructor(J){this.displayPrecisionBits=J,this.elems=[0,0,0,0]}loadHiLo(J,Z){this.elems[0]=aW(J,Z+0,Z+16),this.elems[1]=cW(J,Z+0,Z+16),this.elems[2]=aW(J,Z+4,Z+20),this.elems[3]=cW(J,Z+4,Z+20)}toString(){const J=1/(1<<this.displayPrecisionBits);return`[${this.elems[0]*J}, ${this.elems[1]*J}, ${this.elems[2]*J}, ${this.elems[3]*J}]`}}class J5{constructor(){this.type=0,this.tile=0,this.rightMajor=!1,this.shade=!1,this.texture=!1,this.zbuffer=!1,this.yh=0,this.ym=0,this.yl=0,this.xh=0,this.xm=0,this.xl=0,this.dxhdy=0,this.dxmdy=0,this.dxldy=0,this.rgba=new p6(n7),this.drgba_dx=new p6(n7),this.drgba_de=new p6(n7),this.drgba_dy=new p6(n7),this.stw=new p6(l7+5),this.dstw_dx=new p6(l7+5),this.dstw_de=new p6(l7+5),this.dstw_dy=new p6(l7+5)}load(J){const Z=J.getU32(0)>>24&63;if(this.type=Z,this.shade=(Z&4)!=0,this.texture=(Z&2)!=0,this.zbuffer=(Z&1)!=0,this.loadEdge(J),J.advance(32),this.shade)this.loadShade(J),J.advance(64);if(this.texture)this.loadTexture(J),J.advance(64)}loadEdge(J){this.tile=J.getU32(0)>>16&7,this.rightMajor=(J.getU32(0)&8388608)!=0,this.yl=NJ(J.getU32(0)>>0),this.ym=NJ(J.getU32(4)>>16),this.yh=NJ(J.getU32(4)>>0),this.xl=n8(J.getU32(8)),this.xh=n8(J.getU32(16)),this.xm=n8(J.getU32(24)),this.dxldy=n8(J.getU32(12)),this.dxhdy=n8(J.getU32(20)),this.dxmdy=n8(J.getU32(28))}loadShade(J){this.rgba.loadHiLo(J,0),this.drgba_dx.loadHiLo(J,8),this.drgba_de.loadHiLo(J,32),this.drgba_dy.loadHiLo(J,40)}loadTexture(J){this.stw.loadHiLo(J,0),this.dstw_dx.loadHiLo(J,8),this.dstw_de.loadHiLo(J,32),this.dstw_dy.loadHiLo(J,40)}interpolateX(J){let Z=this.yh&~(d7-1),q=this.ym,Q=this.xh+(J-Z)*this.dxhdy,W;if(J<this.ym)W=this.xm+(J-Z)*this.dxmdy;else W=this.xl+(J-q)*this.dxldy;const K=this.rightMajor?Q:W,X=this.rightMajor?W:Q;return[K>>r7,X>>r7]}interpolate(J,Z,q,Q,W){const K=this.yh&~(d7-1),X=(Z-K)/d7,z=this.xh+X*this.dxhdy>>r7,G=J-z,H=new p6(q.precisionBits);for(let j=0;j<4;j++)H.elems[j]=q.elems[j]+Q.elems[j]*X+(W.elems[j]&~31)*G;return H}interpolateShade(J,Z){return this.interpolate(J,Z,this.rgba,this.drgba_de,this.drgba_dx)}interpolateTexture(J,Z){return this.interpolate(J,Z,this.stw,this.dstw_de,this.dstw_dx)}calculateRectUVs(){const J=this.yh,Z=this.ym,q=this.interpolateX(this.yh),Q=this.interpolateX(this.ym),W=Math.min(q[0],Q[0]),K=Math.max(q[1],Q[1]),X=this.interpolateTexture(W,J),Y=this.interpolateTexture(K,J),z=this.interpolateTexture(W,Z),G=this.interpolateTexture(K,Z),H=1/(1<<16)/32;return[X.elems[0]*H,X.elems[1]*H,Y.elems[0]*H,Y.elems[1]*H,z.elems[0]*H,z.elems[1]*H,G.elems[0]*H,G.elems[1]*H]}toString(){const J=1/G$,Z=1/d7;let q="";if(q+=`
Edge:
  tile ${this.tile}
  yl ${this.yl*Z}, ym ${this.ym*Z}, yh ${this.yh*Z}
  xl ${this.xl*J}, xm ${this.xm*J}, xh ${this.xh*J}
  dxldy ${this.dxldy*J}, dxmdy ${this.dxmdy*J}, dxhdy ${this.dxhdy*J}
`,this.shade)q+=`
Shade:
  rgba ${this.rgba.toString()}
  drgba_dx ${this.drgba_dx.toString()}
  drgba_de ${this.drgba_de.toString()}
  drgba_dy ${this.drgba_dy.toString()}
`;if(this.texture)q+=`Texture:
  stw ${this.stw.toString()}
  dstw_dx ${this.dstw_dx.toString()}
  dstw_de ${this.dstw_de.toString()}
  dstw_dy ${this.dstw_dy.toString()}
`;return q}}class LJ{constructor(J){this.hardware=J,this.commandTable=this.makeCommandTable()}makeCommandTable(){let J=[];for(let Z=0;Z<64;Z++)J.push(this.executeUnknown.bind(this));return J[y.Nop]=this.executeNop.bind(this),J[y.FillTriangle]=this.executeTriangle.bind(this),J[y.FillZBufferTriangle]=this.executeTriangle.bind(this),J[y.TextureTriangle]=this.executeTriangle.bind(this),J[y.TextureZBufferTriangle]=this.executeTriangle.bind(this),J[y.ShadeTriangle]=this.executeTriangle.bind(this),J[y.ShadeZBufferTriangle]=this.executeTriangle.bind(this),J[y.ShadeTextureTriangle]=this.executeTriangle.bind(this),J[y.ShadeTextureZBufferTriangle]=this.executeTriangle.bind(this),J[y.TextureRectangle]=this.executeUnhandled.bind(this),J[y.TextureRectangleFlip]=this.executeUnhandled.bind(this),J[y.SyncLoad]=this.executeSyncLoad.bind(this),J[y.SyncPipe]=this.executeSyncPipe.bind(this),J[y.SyncTile]=this.executeSyncTile.bind(this),J[y.SyncFull]=this.executeSyncFull.bind(this),J[y.SetKeyGB]=this.executeSetKeyGB.bind(this),J[y.SetKeyR]=this.executeSetKeyR.bind(this),J[y.SetConvert]=this.executeSetConvert.bind(this),J[y.SetScissor]=this.executeSetScissor.bind(this),J[y.SetPrimDepth]=this.executeSetPrimDepth.bind(this),J[y.SetOtherModes]=this.executeSetOtherModes.bind(this),J[y.LoadTLut]=this.executeLoadTLut.bind(this),J[y.SetTileSize]=this.executeSetTileSize.bind(this),J[y.LoadBlock]=this.executeLoadBlock.bind(this),J[y.LoadTile]=this.executeLoadTile.bind(this),J[y.SetTile]=this.executeSetTile.bind(this),J[y.FillRectangle]=this.executeFillRectangle.bind(this),J[y.SetFillColor]=this.executeSetFillColor.bind(this),J[y.SetFogColor]=this.executeSetFogColor.bind(this),J[y.SetBlendColor]=this.executeSetBlendColor.bind(this),J[y.SetPrimColor]=this.executeSetPrimColor.bind(this),J[y.SetEnvColor]=this.executeSetEnvColor.bind(this),J[y.SetCombine]=this.executeSetCombine.bind(this),J[y.SetTextureImage]=this.executeSetTextureImage.bind(this),J[y.SetMaskImage]=this.executeSetMaskImage.bind(this),J[y.SetColorImage]=this.executeSetColorImage.bind(this),J}run(J){while(!J.empty()){const q=J.getU32(0)>>24&63,Q=e4[q]*8,W=J.curAddr+Q;this.commandTable[q](q,J),J.curAddr=W}}executeNop(J,Z){}executeUnknown(J,Z){console.log(`Unknown RDP command: ${y.nameOf(J)}`)}executeUnhandled(J,Z){console.log(`Unhandled RDP command: ${y.nameOf(J)}`)}executeTriangle(J,Z){this.executeUnhandled(J,Z)}executeSyncLoad(J,Z){this.executeUnhandled(J,Z)}executeSyncPipe(J,Z){this.executeUnhandled(J,Z)}executeSyncTile(J,Z){this.executeUnhandled(J,Z)}executeSyncFull(J,Z){this.hardware.dpcDevice.syncFull()}executeSetKeyGB(J,Z){this.executeUnhandled(J,Z)}executeSetKeyR(J,Z){this.executeUnhandled(J,Z)}executeSetConvert(J,Z){this.executeUnhandled(J,Z)}executeSetScissor(J,Z){this.executeUnhandled(J,Z)}executeSetPrimDepth(J,Z){this.executeUnhandled(J,Z)}executeSetOtherModes(J,Z){this.executeUnhandled(J,Z)}executeLoadTLut(J,Z){this.executeUnhandled(J,Z)}executeSetTileSize(J,Z){this.executeUnhandled(J,Z)}executeLoadBlock(J,Z){this.executeUnhandled(J,Z)}executeLoadTile(J,Z){this.executeUnhandled(J,Z)}executeSetTile(J,Z){this.executeUnhandled(J,Z)}executeFillRectangle(J,Z){this.executeUnhandled(J,Z)}executeSetFillColor(J,Z){this.executeUnhandled(J,Z)}executeSetFogColor(J,Z){this.executeUnhandled(J,Z)}executeSetBlendColor(J,Z){this.executeUnhandled(J,Z)}executeSetPrimColor(J,Z){this.executeUnhandled(J,Z)}executeSetEnvColor(J,Z){this.executeUnhandled(J,Z)}executeSetCombine(J,Z){this.executeUnhandled(J,Z)}executeSetTextureImage(J,Z){this.executeUnhandled(J,Z)}executeSetMaskImage(J,Z){this.executeUnhandled(J,Z)}executeSetColorImage(J,Z){this.executeUnhandled(J,Z)}}var k$=function(J,Z){let q=[];const Q=e4[J]*8;for(let W=0;W<Q;W+=8)q.push(v(Z.getU64(W),64));return q.join(" ")},N$=function(J,Z){return"Unknown"},K0=function(J,Z){return""},L$=function(J,Z){return""},B9=function(J,Z){return dW.load(Z),"\n"+dW.toString()},M$=function(J,Z){while(J.length<Z)J+=" ";return J};function MJ(J){if(J=J.clone(),J.bytesRemaining()<4)return null;const Z=J.curAddr,Q=J.getU32(0)>>24&63,W=e4[Q]*8;if(J.bytesRemaining()<W)return null;let X=`${M$(y.nameOf(Q),24)}${k$(Q,J)}`;return X+=j$[Q](Q,J),{address:Z,disassembly:X}}function nW(J){J=J.clone();const Z=[];while(!J.empty()){const Q=J.getU32(0)>>24&63,W=e4[Q]*8,K=MJ(J);if(K!=null)Z.push(K);J.advance(W)}return Z}var dW=new J5,j$=(()=>{let J=[];for(let Z=0;Z<64;Z++)J.push(N$);return J[y.Nop]=L$,J[y.FillTriangle]=B9,J[y.FillZBufferTriangle]=B9,J[y.TextureTriangle]=B9,J[y.TextureZBufferTriangle]=B9,J[y.ShadeTriangle]=B9,J[y.ShadeZBufferTriangle]=B9,J[y.ShadeTextureTriangle]=B9,J[y.ShadeTextureZBufferTriangle]=B9,J[y.TextureRectangle]=K0,J[y.TextureRectangleFlip]=K0,J[y.SyncLoad]=K0,J[y.SyncPipe]=K0,J[y.SyncTile]=K0,J[y.SyncFull]=K0,J[y.SetKeyGB]=K0,J[y.SetKeyR]=K0,J[y.SetConvert]=K0,J[y.SetScissor]=K0,J[y.SetPrimDepth]=K0,J[y.SetOtherModes]=K0,J[y.LoadTLut]=K0,J[y.SetTileSize]=K0,J[y.LoadBlock]=K0,J[y.LoadTile]=K0,J[y.SetTile]=K0,J[y.FillRectangle]=K0,J[y.SetFillColor]=K0,J[y.SetFogColor]=K0,J[y.SetBlendColor]=K0,J[y.SetPrimColor]=K0,J[y.SetEnvColor]=K0,J[y.SetCombine]=K0,J[y.SetTextureImage]=K0,J[y.SetMaskImage]=K0,J[y.SetColorImage]=K0,J})();class r0{constructor(J){this.elems=J||new Float32Array(16)}multiply(J){let Z=this.elems,q=J.elems,Q=new Float32Array(16);for(let W=0;W<4;++W)for(let K=0;K<4;++K)Q[W*4+K]+=Z[W*4+0]*q[0+K],Q[W*4+K]+=Z[W*4+1]*q[4+K],Q[W*4+K]+=Z[W*4+2]*q[8+K],Q[W*4+K]+=Z[W*4+3]*q[12+K];return new r0(Q)}transformNormal(J,Z){let q=this.elems,Q=J.elems,W=Q[0],K=Q[1],X=Q[2];Z.elems[0]=q[0]*W+q[1]*K+q[2]*X,Z.elems[1]=q[4]*W+q[5]*K+q[6]*X,Z.elems[2]=q[8]*W+q[9]*K+q[10]*X}transformPoint(J,Z){let q=this.elems,Q=J.elems,W=Q[0],K=Q[1],X=Q[2];Z.elems[0]=q[0]*W+q[1]*K+q[2]*X+q[3],Z.elems[1]=q[4]*W+q[5]*K+q[6]*X+q[7],Z.elems[2]=q[8]*W+q[9]*K+q[10]*X+q[11],Z.elems[3]=q[12]*W+q[13]*K+q[14]*X+q[15]}static identity(){let J=new Float32Array(16);return J[0]=1,J[5]=1,J[10]=1,J[15]=1,new r0(J)}copy(){let J=new Float32Array(16);for(let Z=0;Z<16;Z++)J[Z]=this.elems[Z];return new r0(J)}static makeOrtho(J,Z,q,Q,W,K){let X=-(Z+J)/(Z-J),Y=-(Q+q)/(Q-q),z=-(K+W)/(K-W),G=new Float32Array(16);return G[0]=2/(Z-J),G[1]=0,G[2]=0,G[3]=0,G[4]=0,G[5]=2/(Q-q),G[6]=0,G[7]=0,G[8]=0,G[9]=0,G[10]=-2/(K-W),G[11]=0,G[12]=X,G[13]=Y,G[14]=z,G[15]=1,new r0(G)}}var B0={canvasScale:1,haltOnWarning:!1,dumpMicrocode:!1,dumpMicrocodeSubstring:"",emulationMode:"HLE",dumpRDP:!1},l8=J6.addFolder("Graphics");l8.add(B0,"canvasScale").name("Canvas Scale").min(1).max(4).step(0.25);l8.add(B0,"haltOnWarning").name("Halt on Warning");l8.add(B0,"dumpMicrocode").name("Dump Microcode");l8.add(B0,"dumpMicrocodeSubstring").name("Dump Microcode Substring");l8.add(B0,"emulationMode",{"HLE (Recommended)":"HLE","LLE (Experimental, Slow)":"LLE"}).name("Emulation Mode");l8.add(B0,"dumpRDP").name("Dump RDP");function r8(J,Z){return(J>>>2)-(Z>>>2)+1&1023}var lW=function(J,Z){return Z?Math.min(1<<Z,J):J};class PJ{constructor(){this.format=-1,this.size=0,this.line=0,this.tmem=0,this.palette=0,this.cmT=0,this.maskT=0,this.shiftT=0,this.cmS=0,this.maskS=0,this.shiftS=0,this.uls=0,this.ult=0,this.lrs=0,this.lrt=0,this.hash=0}get left(){return this.uls/4}get top(){return this.ult/4}get right(){return this.lrs/4}get bottom(){return this.lrt/4}get unmaskedWidth(){return r8(this.lrs,this.uls)}get unmaskedHeight(){return r8(this.lrt,this.ult)}get width(){return lW(this.unmaskedWidth,this.maskS)}get height(){return lW(this.unmaskedHeight,this.maskT)}set(J,Z,q,Q,W,K,X,Y,z,G,H){this.format=J,this.size=Z,this.line=q,this.tmem=Q,this.palette=W,this.cmS=K,this.maskS=X,this.shiftS=Y,this.cmT=z,this.maskT=G,this.shiftT=H,this.hash=0}setSize(J,Z,q,Q){this.uls=J,this.ult=Z,this.lrs=q,this.lrt=Q,this.hash=0}}class VJ{constructor(J){this.numTris=0,this.maxTris=J,this.positions=new Float32Array(J*3*4),this.colours=new Uint32Array(J*3*1),this.coords=new Float32Array(J*3*2)}reset(){this.numTris=0}empty(){return this.numTris==0}hasCapacity(J){return this.numTris+J<this.maxTris}pushTri(J,Z,q){return this.pushTriWithUV(J,Z,q,J.u,J.v,Z.u,Z.v,q.u,q.v)}pushTriWithUV(J,Z,q,Q,W,K,X,Y,z){if(this.numTris>=this.maxTris)return!1;const G=J.pos,H=Z.pos,j=q.pos;let N=this.numTris*3*4;this.positions[N++]=G.x,this.positions[N++]=G.y,this.positions[N++]=G.z,this.positions[N++]=G.w,this.positions[N++]=H.x,this.positions[N++]=H.y,this.positions[N++]=H.z,this.positions[N++]=H.w,this.positions[N++]=j.x,this.positions[N++]=j.y,this.positions[N++]=j.z,this.positions[N++]=j.w;let L=this.numTris*3*1;this.colours[L++]=J.color,this.colours[L++]=Z.color,this.colours[L++]=q.color;let M=this.numTris*3*2;return this.coords[M++]=Q,this.coords[M++]=W,this.coords[M++]=K,this.coords[M++]=X,this.coords[M++]=Y,this.coords[M++]=z,this.numTris++,!0}}var U$=function(J){return{r:(J>>>11&31)/31,g:(J>>>6&31)/31,b:(J>>>1&31)/31,a:(J>>>0&1)/1}},iW=function(J){return{r:(J>>>24&255)/255,g:(J>>>16&255)/255,b:(J>>>8&255)/255,a:(J>>>0&255)/255}},V$=!0,rW=new Map,sW=new Map;class Z5{constructor(J,Z){this.state=J,this.ramDV=Z,this.vertexStride=2,this.version="",this.triangleBuffer=new VJ(64),this.onLoadUcodeHandler=null,this.gbiCommonCommands=new Map([[228,this.executeTexRect.bind(this)],[229,this.executeTexRectFlip.bind(this)],[230,this.executeRDPLoadSync.bind(this)],[231,this.executeRDPPipeSync.bind(this)],[232,this.executeRDPTileSync.bind(this)],[233,this.executeRDPFullSync.bind(this)],[234,this.executeSetKeyGB.bind(this)],[235,this.executeSetKeyR.bind(this)],[236,this.executeSetConvert.bind(this)],[237,this.executeSetScissor.bind(this)],[238,this.executeSetPrimDepth.bind(this)],[239,this.executeSetRDPOtherMode.bind(this)],[240,this.executeLoadTLut.bind(this)],[242,this.executeSetTileSize.bind(this)],[243,this.executeLoadBlock.bind(this)],[244,this.executeLoadTile.bind(this)],[245,this.executeSetTile.bind(this)],[246,this.executeFillRect.bind(this)],[247,this.executeSetFillColor.bind(this)],[248,this.executeSetFogColor.bind(this)],[249,this.executeSetBlendColor.bind(this)],[250,this.executeSetPrimColor.bind(this)],[251,this.executeSetEnvColor.bind(this)],[252,this.executeSetCombine.bind(this)],[253,this.executeSetTImg.bind(this)],[254,this.executeSetZImg.bind(this)],[255,this.executeSetCImg.bind(this)]])}buildCommandTable(){const J=[];for(let Z=0;Z<256;++Z){let q=this.getHandler(Z);if(!q)q=this.executeUnknown.bind(this);J.push(q)}return J}getHandler(J){const Z=this.gbiCommonCommands.get(J);if(Z)return Z;return null}onLoadUcode(J){this.onLoadUcodeHandler=J}executeUnknown(J,Z){this.warn(`Unknown display list op ${v0(J>>>24)}`,`cmd0 ${k(J)}, cmd1 ${k(Z)}`)}warnUnimplemented(J){this.warn(J,"unimplemented")}warn(J,Z){if(sW.get(J))return;sW.set(J,!0);const q=Z!==void 0?`${J}: ${Z}`:J;if(B0.haltOnWarning)this.hleHalt(q);else n64js.warn(q)}loadMatrix(J,Z){const Q=new DataView(this.ramDV.buffer,J);if(Z!=64)this.warn("Unusual matrix length",`${Z}`);const W=new Float32Array(16);for(let K=0;K<4;++K)W[0+K]=(Q.getInt16(K*8+0)<<16|Q.getUint16(K*8+0+32))*0.0000152587890625,W[4+K]=(Q.getInt16(K*8+2)<<16|Q.getUint16(K*8+2+32))*0.0000152587890625,W[8+K]=(Q.getInt16(K*8+4)<<16|Q.getUint16(K*8+4+32))*0.0000152587890625,W[12+K]=(Q.getInt16(K*8+6)<<16|Q.getUint16(K*8+6+32))*0.0000152587890625;return new r0(W)}previewMatrix(J){const Z=J.elems,q=[Z[0],Z[1],Z[2],Z[3]],Q=[Z[4],Z[5],Z[6],Z[7]],W=[Z[8],Z[9],Z[10],Z[11]],K=[Z[12],Z[13],Z[14],Z[15]];return`<div><table class="matrix-table">
      <tr><td>${q.join("</td><td>")}</td></tr>
      <tr><td>${Q.join("</td><td>")}</td></tr>
      <tr><td>${W.join("</td><td>")}</td></tr>
      <tr><td>${K.join("</td><td>")}</td></tr>
    </table></div>`}loadViewport(J){const Z=new U0(+this.ramDV.getInt16(J+0)/4,-this.ramDV.getInt16(J+2)/4,+this.ramDV.getInt16(J+4)),q=new U0(this.ramDV.getInt16(J+8)/4,this.ramDV.getInt16(J+10)/4,this.ramDV.getInt16(J+12));this.state.viewport.set(Z,q)}previewViewport(J){const Z=new U0(this.ramDV.getInt16(J+0)/4,this.ramDV.getInt16(J+2)/4,this.ramDV.getInt16(J+4)),q=new U0(this.ramDV.getInt16(J+8)/4,this.ramDV.getInt16(J+10)/4,this.ramDV.getInt16(J+12));let Q="";return Q+=`scale = (${Z.x}, ${Z.y}, ${Z.z}) `,Q+=`trans = (${q.x}, ${q.y}, ${q.z}) `,Q}loadLight(J,Z){if(J>=this.state.lights.length){U(`light index ${J} out of range`);return}this.state.lights[J].color=iW(this.ramDV.getUint32(Z+0)),this.state.lights[J].dir=U0.create([this.ramDV.getInt8(Z+8),this.ramDV.getInt8(Z+9),this.ramDV.getInt8(Z+10)]).normaliseInPlace()}previewLight(J){let Z="";Z+=`color = ${b9(this.ramDV.getUint32(J+0))} `,Z+=`colorCopy = ${b9(this.ramDV.getUint32(J+4))} `;const q=U0.create([this.ramDV.getInt8(J+8),this.ramDV.getInt8(J+9),this.ramDV.getInt8(J+10)]).normaliseInPlace();return Z+=`norm = (${q.x}, ${q.y}, ${q.z})`,Z}loadVertices(J,Z,q,Q){const W=this.state.geometryMode.lighting,K=this.state.geometryMode.textureGen,X=this.state.geometryMode.textureGenLinear,Y=new DataView(this.ramDV.buffer,q);if(Q)this.previewVertex(J,Z,Y,Q,W);if(J+Z>=this.state.projectedVertices.length){this.warn("Too many verts");return}const z=this.state.modelview[this.state.modelview.length-1],H=this.state.projection[this.state.projection.length-1].multiply(z),j=this.state.texture.scaleS/32,N=this.state.texture.scaleT/32,L=new U0,M=new U0,V=new U0,h=this.renderer.nativeTransform.viTransform,b=this.state.viewport.transform,C=16;for(let _=0;_<Z;++_){const E=_*C,S=this.state.projectedVertices[J+_];if(S.set=!0,L.x=Y.getInt16(E+0),L.y=Y.getInt16(E+2),L.z=Y.getInt16(E+4),S.u=Y.getInt16(E+8)*j,S.v=Y.getInt16(E+10)*N,S.color=Y.getUint32(E+12,!0),this.projectInPlace(S,L,H,b,h),W){if(this.unpackNormal(M,S.color),z.transformNormal(M,V),V.normaliseInPlace(),S.color=this.calculateLighting(V,255),K)if(X)S.calculateLinearUV(V);else S.calculateSphericalUV(V)}}}projectInPlace(J,Z,q,Q,W){const K=J.pos;q.transformPoint(Z,K),J.clipFlags=this.calculateClipFlags(K);const X=K.w;K.scaleInPlace(1/X),Q.transformInPlace(K),W.invTransformInPlace(K),K.scaleInPlace(X)}calculateClipFlags(J){let Z=0;if(J.x<-J.w)Z|=V7;else if(J.x>J.w)Z|=L7;if(J.y<-J.w)Z|=U7;else if(J.y>J.w)Z|=M7;if(J.z<-J.w)Z|=h7;else if(J.z>J.w)Z|=P7;return Z}unpackNormal(J,Z){J.x=Z<<24>>24,J.y=Z<<16>>24,J.z=Z<<8>>24}calculateLighting(J,Z){const q=this.state.numLights;let Q=this.state.lights[q].color.r,W=this.state.lights[q].color.g,K=this.state.lights[q].color.b;for(let X=0;X<q;++X){const Y=this.state.lights[X],z=J.dot(Y.dir);if(z>0)Q+=Y.color.r*z,W+=Y.color.g*z,K+=Y.color.b*z}return Q=Math.min(Q,1)*255,W=Math.min(W,1)*255,K=Math.min(K,1)*255,Z<<24|K<<16|W<<8|Q}previewVertex(J,Z,q,Q,W){const K=["#","x","y","z","?","u","v",W?"norm":"rgba"];let X="";X+='<table class="vertex-table">',X+=`<tr><th>${K.join("</th><th>")}</th></tr>\n`;for(let Y=0;Y<Z;++Y){const z=Y*16,G=W?`${q.getInt8(z+12)},${q.getInt8(z+13)},${q.getInt8(z+14)}`:b9(q.getUint32(z+12)),H=[J+Y,q.getInt16(z+0),q.getInt16(z+2),q.getInt16(z+4),q.getInt16(z+6),q.getInt16(z+8),q.getInt16(z+10),G];X+=`<tr><td>${H.join("</td><td>")}</td></tr>\n`}X+="</table>",Q.tip(X)}executeNoop(J,Z,q){if(q)q.text("gsDPNoOp();")}executeSpNoop(J,Z,q){if(q)q.text("gsSPNoOp();")}executeLoadUcode(J,Z,q){const Q=Z&268435455,K=this.state.rdpHalf1Cmd1,X=(J&65535)+1;let Y="?";if(this.onLoadUcodeHandler){const z=this.onLoadUcodeHandler(Q,4096,K,X);z.onLoadUcode(this.onLoadUcodeHandler),Y=z.version}else this.warn("No loadUcodeHandler set!");if(q)q.text(`gsSPLoadUCode(${k(Q)}, 4096, ${k(K)} ${X}); // ${Y}`)}executeRDPHalf1(J,Z,q){if(q)q.text(`gsImmp1(G_RDPHALF_1, ${k(Z)});`);this.state.rdpHalf1Cmd1=Z}executeRDPHalf2(J,Z,q){if(q)q.text(`gsImmp1(G_RDPHALF_2, ${k(Z)});`);this.state.rdpHalf2Cmd1=Z}executeRDPLoadSync(J,Z,q){if(q)q.text("gsDPLoadSync();")}executeRDPPipeSync(J,Z,q){if(q)q.text("gsDPPipeSync();")}executeRDPTileSync(J,Z,q){if(q)q.text("gsDPTileSync();")}executeRDPFullSync(J,Z,q){if(q)q.text("gsDPFullSync();")}executeSetKeyGB(J,Z,q){if(q)q.text("gsDPSetKeyGB(???);")}executeSetKeyR(J,Z,q){if(q)q.text("gsDPSetKeyR(???);")}executeSetConvert(J,Z,q){if(q)q.text("gsDPSetConvert(???);")}executeSetScissor(J,Z,q){const Q=(J>>>12&4095)/4,W=(J>>>0&4095)/4,K=(Z>>>12&4095)/4,X=(Z>>>0&4095)/4,Y=Z>>>24&2;if(q)q.text(`gsDPSetScissor(${AW.nameOf(Y)}, ${Q}, ${W}, ${K}, ${X});`);this.state.scissor.x0=Q,this.state.scissor.y0=W,this.state.scissor.x1=K,this.state.scissor.y1=X,this.state.scissor.mode=Y}executeSetRDPOtherMode(J,Z,q){if(q)q.text(`gsDPSetOtherMode(${k(J)}, ${k(Z)}); // TODO: fix formatting`);this.state.rdpOtherModeH=J,this.state.rdpOtherModeL=Z}executeSetTile(J,Z,q){const Q=J>>>21&7,W=J>>>19&3,K=J>>>9&511,X=J>>>0&511,Y=Z>>>24&7,z=Z>>>20&15,G=Z>>>18&3,H=Z>>>14&15,j=Z>>>10&15,N=Z>>>8&3,L=Z>>>4&15,M=Z>>>0&15;if(this.state.tiles[Y].set(Q,W,K,X,z,N,L,M,G,H,j),q){const h=j0.nameOf(Q),b=d.nameOf(W),C=m0(Y),_=g8(N),E=g8(G);q.text(`gsDPSetTile(${h}, ${b}, ${K}, ${X}, ${C}, ${z}, ${E}, ${H}, ${j}, ${_}, ${L}, ${M});`)}}executeSetTileSize(J,Z,q){const Q=J>>>12&4095,W=J>>>0&4095,K=Z>>>24&7,X=Z>>>12&4095,Y=Z>>>0&4095,z=this.state.tiles[K];if(z.setSize(Q,W,X,Y),q){const G=m0(K);q.text(`gsDPSetTileSize(${G}, ${z.left}, ${z.top}, ${z.right}, ${z.bottom});`),q.tip(`size (${z.width} x ${z.height}), unmasked (${z.unmaskedWidth} x ${z.unmaskedHeight})`)}}executeSetFillColor(J,Z,q){if(q)q.text(`gsDPSetFillColor(${q.rgba8888(Z)}); // hi as 5551 = ${q.rgba5551(Z>>>16)}, lo as 5551 = ${q.rgba5551(Z&65535)} `);this.state.fillColor=Z}executeSetFogColor(J,Z,q){if(q)q.text(`gsDPSetFogColor(${q.rgba8888(Z)});`);this.state.fogColor=Z}executeSetBlendColor(J,Z,q){if(q)q.text(`gsDPSetBlendColor(${q.rgba8888(Z)});`);this.state.blendColor=Z}executeSetPrimColor(J,Z,q){if(q){const Q=J>>>8&255,W=J>>>0&255;q.text(`gsDPSetPrimColor(${Q}, ${W}, ${q.rgba8888(Z)});`)}this.state.primColor=Z}executeSetPrimDepth(J,Z,q){const Q=Z>>>16&65535,W=Z&65535;if(q)q.text(`gsDPSetPrimDepth(${Q},${W});`)}executeSetEnvColor(J,Z,q){if(q)q.text(`gsDPSetEnvColor(${q.rgba8888(Z)});`);this.state.envColor=Z}executeSetCombine(J,Z,q){if(q){const Q=J&16777215,W=Z,K=c7(Q,W);q.text(`gsDPSetCombine(${k(Q)}, ${k(W)});\n${K}`)}this.state.combine.hi=J&16777215,this.state.combine.lo=Z}executeSetTImg(J,Z,q){const Q=J>>>21&7,W=J>>>19&3,K=(J>>>0&4095)+1,X=this.state.rdpSegmentAddress(Z);if(q)q.text(`gsDPSetTextureImage(${j0.nameOf(Q)}, ${d.nameOf(W)}, ${K}, ${k(X)});`);this.state.textureImage.set(Q,W,K,X)}executeSetZImg(J,Z,q){const Q=this.state.rdpSegmentAddress(Z);if(q)q.text(`gsDPSetDepthImage(${k(Q)});`);this.state.depthImage.address=Q}executeSetCImg(J,Z,q){const Q=J>>>21&7,W=J>>>19&3,K=(J>>>0&4095)+1,X=this.state.rdpSegmentAddress(Z);if(q)q.text(`gsDPSetColorImage(${j0.nameOf(Q)}, ${d.nameOf(W)}, ${K}, ${k(X)});`);if(this.state.colorImage={format:Q,size:W,width:K,address:X},n64js.hardware().timeline.addEvent(`SetColorImage ${k(X)}`),V$&&!rW.get(X))U(`Setting colorImage to ${k(X)}, ${K}, size ${d.nameOf(W)}, format ${j0.nameOf(Q)}`),rW.set(X,!0)}executeLoadBlock(J,Z,q){const Q=Z>>>24&7,W=J>>>12&4095,K=J>>>0&4095,X=Z>>>12&4095,Y=Z>>>0&4095;if(W!==0)this.warn("Unexpected non-zero uls in load block");if(K!==0)this.warn("Unexpected non-zero ult in load block");if(q){const H=m0(Q);q.text(`gsDPLoadBlock(${H}, ${W}, ${K}, ${X}, ${Y});`)}const z=this.state.textureImage,G=this.state.tiles[Q];this.state.tmem.loadBlock(z,G,W,K,X,Y,q),this.state.invalidateTileHashes()}executeLoadTile(J,Z,q){const Q=Z>>>24&7,W=J>>>12&4095,K=J>>>0&4095,X=Z>>>12&4095,Y=Z>>>0&4095;if(q){const H=m0(Q);q.text(`gsDPLoadTile(${H}, ${W/4}, ${K/4}, ${X/4}, ${Y/4});`)}const z=this.state.textureImage,G=this.state.tiles[Q];this.state.tmem.loadTile(z,G,W,K,X,Y,q),this.state.invalidateTileHashes()}executeLoadTLut(J,Z,q){const Q=Z>>>24&7,W=J>>>12&4095,K=J>>>0&4095,X=Z>>>12&4095,Y=Z>>>0&4095;if(q){const H=m0(Q);q.text(`gsDPLoadTLUTCmd(${H}, ${r8(X,W)}); //${W}, ${K}, ${X}, ${Y}`)}const z=this.state.textureImage,G=this.state.tiles[Q];this.state.tmem.loadTLUT(z,G,W,K,X,Y,q),this.state.invalidateTileHashes()}executeFillRect(J,Z,q){const Q=(Z>>>12&4095)>>>2,W=(Z>>>0&4095)>>>2;let K=(J>>>12&4095)>>>2,X=(J>>>0&4095)>>>2;const Y=this.gl;if(q)q.text(`gsDPFillRectangle(${Q}, ${W}, ${K}, ${X});`);if(this.state.depthImage.address==this.state.colorImage.address){Y.clearDepth(1),Y.depthMask(!0),Y.clear(Y.DEPTH_BUFFER_BIT);return}const z=this.state.getCycleType();let G={r:0,g:0,b:0,a:0};if(z===k0.G_CYC_FILL){if(K+=1,X+=1,this.state.colorImage.size===d.G_IM_SIZ_16b)G=U$(this.state.fillColor&65535);else G=iW(this.state.fillColor);const H=K-Q,j=X-W;if(H===this.renderer.nativeTransform.viWidth&&j===this.renderer.nativeTransform.viHeight){Y.clearColor(G.r,G.g,G.b,G.a),Y.clear(Y.COLOR_BUFFER_BIT);return}}else if(z===k0.G_CYC_COPY)K+=1,X+=1;this.renderer.fillRect(Q,W,K,X,G)}executeTexRect(J,Z,q){this.state.nextCommand();const Q=this.state.cmd1;this.state.nextCommand();const W=this.state.cmd1;this.rdpTexRect(J,Z,Q,W,q)}rdpTexRect(J,Z,q,Q,W){let K=(J>>>12&4095)/4,X=(J>>>0&4095)/4;const Y=Z>>>24&7,z=(Z>>>12&4095)/4,G=(Z>>>0&4095)/4;let H=(q>>>16&65535)/32,j=(q>>>0&65535)/32,N=((Q|0)>>16)/1024;const L=(Q<<16>>16)/1024,M=this.state.getCycleType();if(M===k0.G_CYC_COPY)N*=0.25;if(M===k0.G_CYC_COPY||M===k0.G_CYC_FILL)K+=1,X+=1;if(N<0)H++;if(L<0)j++;const V=H+N*(K-z),h=j+L*(X-G);if(W){const b=m0(Y);W.text(`gsSPTextureRectangle(${z},${G},${K},${X},${b},${H},${j},${N},${L});`),W.tip(`cmd2 = ${k(q)}, cmd3 = ${k(Q)}`),W.tip(`st0 = (${H}, ${j}) st1 = (${V}, ${h})`)}this.renderer.texRect(Y,z,G,K,X,H,j,V,h,!1)}executeTexRectFlip(J,Z,q){this.state.nextCommand();const Q=this.state.cmd1;this.state.nextCommand();const W=this.state.cmd1;this.rdpTexRectFlip(J,Z,Q,W,q)}rdpTexRectFlip(J,Z,q,Q,W){let K=(J>>>12&4095)/4,X=(J>>>0&4095)/4;const Y=Z>>>24&7,z=(Z>>>12&4095)/4,G=(Z>>>0&4095)/4;let H=(q>>>16&65535)/32,j=(q>>>0&65535)/32,N=((Q|0)>>16)/1024;const L=(Q<<16>>16)/1024,M=this.state.getCycleType();if(M===k0.G_CYC_COPY)N*=0.25;if(M===k0.G_CYC_COPY||M===k0.G_CYC_FILL)K+=1,X+=1;if(N<0)H++;if(L<0)j++;const V=H+N*(X-G),h=j+L*(K-z);if(W){const b=m0(Y);W.text(`gsSPTextureRectangleFlip(${z},${G},${K},${X},${b},${H},${j},${N},${L});`),W.tip(`cmd2 = ${k(q)}, cmd3 = ${k(Q)}`),W.tip(`st0 = (${H}, ${j}) st1 = (${V}, ${h})`)}this.renderer.texRect(Y,z,G,K,X,H,j,V,h,!0)}executeCullDL(J,Z,q){const Q=(J&65535)>>>1,W=(Z&65535)>>>1,K=this.testClipFlags(Q,W);if(q)q.text(`gSPCullDisplayList(${Q}, ${W}); // ${K?"continue":"end"}`);if(!K)this.state.endDisplayList()}testClipFlags(J,Z){if(Z<=J)return this.warn("begin and end vertices for testClipFlags are inverted or empty"),!0;if(Z>=this.state.projectedVertices.length)return this.warn("end vertex for testClipFlags is out of bounds"),!0;let q=~0;for(let Q=J;Q<=Z;Q++)q&=this.state.projectedVertices[Q].clipFlags;return q==0}calcTextureScale(J){if(J===0||J===65535)return 1;return J/65536}}var s7=!1;class I9 extends Z5{constructor(J,Z){super(J,Z);this.vertexStride=2,this.gbi1Commands=new Map([[0,this.executeSpNoop.bind(this)],[1,this.executeMatrix.bind(this)],[3,this.executeMoveMem.bind(this)],[4,this.executeVertex.bind(this)],[6,this.executeDL.bind(this)],[9,this.executeSprite2DBase.bind(this)],[175,this.executeLoadUcode.bind(this)],[176,this.executeBranchZ.bind(this)],[177,this.executeTri2.bind(this)],[178,this.executeModifyVertex.bind(this)],[179,this.executeRDPHalf2.bind(this)],[180,this.executeRDPHalf1.bind(this)],[181,this.executeLine3D.bind(this)],[182,this.executeClearGeometryMode.bind(this)],[183,this.executeSetGeometryMode.bind(this)],[184,this.executeEndDL.bind(this)],[185,this.executeSetOtherModeL.bind(this)],[186,this.executeSetOtherModeH.bind(this)],[187,this.executeTexture.bind(this)],[188,this.executeMoveWord.bind(this)],[189,this.executePopMatrix.bind(this)],[190,this.executeCullDL.bind(this)],[191,this.executeTri1.bind(this)],[192,this.executeNoop.bind(this)]])}getHandler(J){const Z=this.gbi1Commands.get(J);if(Z)return Z;return super.getHandler(J)}executeDL(J,Z,q){const Q=J>>>16&255,W=this.state.rdpSegmentAddress(Z);if(q){const K=Q===u8?"gsSPDisplayList":"gsSPBranchList";q.text(`${K}(<span class="dl-branch">${k(W)}</span>);`)}if(Q===u8)this.state.pushDisplayList(W);else this.state.branchDisplayList(W)}executeEndDL(J,Z,q){if(q)q.text("gsSPEndDisplayList();");this.state.endDisplayList()}executeBranchZ(J,Z,q){const Q=this.state.rdpSegmentAddress(this.state.rdpHalf1Cmd1);if(this.warnUnimplemented("BranchLessZ"),q)q.text("gsSPBranchLessZ(/* TODO */);");this.state.branchDisplayList(Q)}executeClearGeometryMode(J,Z,q){if(q)q.text(`gsSPClearGeometryMode(${m8(B6,Z)});`);this.state.geometryModeBits&=~Z,this.state.updateGeometryModeFromBits(B6)}executeSetGeometryMode(J,Z,q){if(q)q.text(`gsSPSetGeometryMode(${m8(B6,Z)});`);this.state.geometryModeBits|=Z,this.state.updateGeometryModeFromBits(B6)}executeSetOtherModeL(J,Z,q){const Q=J>>>8&255,W=J>>>0&255,K=Z,X=(1<<W)-1<<Q>>>0;if(q)T7(q,X,K);this.state.rdpOtherModeL=this.state.rdpOtherModeL&~X|K}executeSetOtherModeH(J,Z,q){const Q=J>>>8&255,W=J>>>0&255,K=Z,X=(1<<W)-1<<Q>>>0;if(q)S7(q,X,W,Q,K);this.state.rdpOtherModeH=this.state.rdpOtherModeH&~X|K}executeTexture(J,Z,q){const Q=J>>>16&255,W=J>>>11&3,K=J>>>8&7,X=J>>>0&255,Y=this.calcTextureScale(Z>>>16&65535),z=this.calcTextureScale(Z>>>0&65535);if(q){const G=Y.toString(),H=z.toString(),j=m0(K),N=X?"G_ON":"G_OFF";if(Q!==0)q.text(`gsSPTextureL(${G}, ${H}, ${W}, ${Q}, ${j}, ${N});`);else q.text(`gsSPTexture(${G}, ${H}, ${W}, ${j}, ${N});`)}if(this.state.setTexture(Y,z,W,K),X)this.state.geometryModeBits|=B6.G_TEXTURE_ENABLE;else this.state.geometryModeBits&=~B6.G_TEXTURE_ENABLE;this.state.updateGeometryModeFromBits(B6)}executeMatrix(J,Z,q){const Q=J>>>16&255,W=J>>>0&65535,K=this.state.rdpSegmentAddress(Z);let X=this.loadMatrix(K,W);if(q){let z="";z+=Q&k7?"G_MTX_PROJECTION":"G_MTX_MODELVIEW",z+=Q&qJ?"|G_MTX_LOAD":"|G_MTX_MUL",z+=Q&QJ?"|G_MTX_PUSH":"",q.text(`gsSPMatrix(${k(K)}, ${z});`),q.tip(this.previewMatrix(X))}const Y=Q&k7?this.state.projection:this.state.modelview;if((Q&qJ)==0)X=Y[Y.length-1].multiply(X);if(Q&QJ)Y.push(X);else Y[Y.length-1]=X}executePopMatrix(J,Z,q){const Q=Z>>>0&255;if(q){let W="";W+=Q&k7?"G_MTX_PROJECTION":"G_MTX_MODELVIEW",q.text(`gsSPPopMatrix(${W});`)}if(this.state.modelview.length>0)this.state.modelview.pop()}executeVertex(J,Z,q){const Q=(J>>>16&255)/this.vertexStride,W=J>>>10&63,K=this.state.rdpSegmentAddress(Z);if(q)q.text(`gsSPVertex(${k(K)}, ${Q}, ${W});`);this.loadVertices(Q,W,K,q)}executeModifyVertex(J,Z,q){if(this.warnUnimplemented("ModifyVertex"),q)q.text("gsSPModifyVertex(???);")}executeSprite2DBase(J,Z,q){if(this.warnUnimplemented("Sprite2DBase"),q)q.text("gsSPSprite2DBase(/* TODO */);")}executeMoveMem(J,Z,q){const Q=J>>>16&255,W=J>>>0&65535,K=this.state.rdpSegmentAddress(Z);if(q){const X=k(K),Y=V0.nameOf(Q);let z=`gsDma1p(G_MOVEMEM, ${X}, ${W}, ${Y});`;switch(Q){case V0.G_MV_VIEWPORT:if(W===16)z=`gsSPViewport(${X});`;break}q.text(z),this.previewMoveMem(Q,W,K,q)}switch(Q){case V0.G_MV_VIEWPORT:this.loadViewport(K);break;case V0.G_MV_L0:case V0.G_MV_L1:case V0.G_MV_L2:case V0.G_MV_L3:case V0.G_MV_L4:case V0.G_MV_L5:case V0.G_MV_L6:case V0.G_MV_L7:{const X=(Q-V0.G_MV_L0)/2;this.loadLight(X,K)}break}}previewMoveMem(J,Z,q,Q){let W="";for(let K=0;K<Z;++K)W+=v(this.ramDV.getUint8(q+K),8)+" ";switch(W+="<br>",J){case V0.G_MV_VIEWPORT:W+=this.previewViewport(q);break;case V0.G_MV_L0:case V0.G_MV_L1:case V0.G_MV_L2:case V0.G_MV_L3:case V0.G_MV_L4:case V0.G_MV_L5:case V0.G_MV_L6:case V0.G_MV_L7:W+=this.previewLight(q);break}Q.tip(W)}executeMoveWord(J,Z,q){const Q=J&255,W=J>>>8&65535,K=Z;let X="";switch(Q){case w0.G_MW_MATRIX:this.warnUnimplemented("MoveWord Matrix");break;case w0.G_MW_NUMLIGHT:{let Y=(K-2147483648>>>5)-1;if(q){if(W===DW)X=`gsSPNumLights(${D7.nameOf(Y)});`}this.state.numLights=Y}break;case w0.G_MW_CLIP:if(q)X=`gSPClipRatio(${N7.nameOf(W)}, ${R7.nameOf(K)});`;break;case w0.G_MW_SEGMENT:{const Y=W>>>2&15;if(q)X=`gsSPSegment(${b7.nameOf(Y)}, ${k(K)});`;this.state.segments[Y]=K}break;case w0.G_MW_FOG:{const Y=Z>>16,z=Z&65535;if(q)X=`gSPFogPosition(${Y}, ${z});`;this.state.fogParameters.set(Y,z)}break;case w0.G_MW_LIGHTCOL:this.warnUnimplemented("MoveWord LightCol");break;case w0.G_MW_POINTS:this.warnUnimplemented("MoveWord Points");break;case w0.G_MW_PERSPNORM:if(q)X=`gSPPerspNormalize(${K});`;break;default:this.warnUnimplemented("MoveWord Unknown");break}if(q){if(!X)X=`gMoveWd(${w0.nameOf(Q)}, ${Z0(W)}, ${k(K)});`;q.text(X)}}executeTri1(J,Z,q){const Q=this.vertexStride,W=this.state.projectedVertices,K=this.triangleBuffer;K.reset();let X=q?1:0,Y=this.state.executeBatch(X,(z,G)=>{const H=G>>>24&255,j=(G>>>16&255)/Q,N=(G>>>8&255)/Q,L=(G>>>0&255)/Q;if(q)q.text(`gsSP1Triangle(${j}, ${N}, ${L}, ${H});`);return K.pushTri(W[j],W[N],W[L]),K.hasCapacity(1)});this.debugController.currentOp+=Y-1,this.renderer.flushTris(K)}executeTri2(J,Z,q){const Q=this.vertexStride,W=this.state.projectedVertices,K=this.triangleBuffer;K.reset();let X=q?1:0,Y=this.state.executeBatch(X,(z,G)=>{const H=(z>>>16&255)/Q,j=(z>>>8&255)/Q,N=(z>>>0&255)/Q,L=(G>>>16&255)/Q,M=(G>>>8&255)/Q,V=(G>>>0&255)/Q;if(q)q.text(`gsSP1Triangle2(${H},${j},${N}, ${L},${M},${V});`);return K.pushTri(W[H],W[j],W[N]),K.pushTri(W[L],W[M],W[V]),K.hasCapacity(2)});this.debugController.currentOp+=Y-1,this.renderer.flushTris(K)}executeLine3D(J,Z,q){const Q=this.vertexStride,W=this.state.projectedVertices,K=this.triangleBuffer;K.reset();let X=q?1:0,Y=this.state.executeBatch(X,(z,G)=>{const H=(G>>>24&255)/Q,j=(G>>>16&255)/Q,N=(G>>>8&255)/Q,L=(G>>>0&255)/Q;if(q)q.text(`gsSPLine3D(${j}, ${N}, ${L}, ${H});`);if(j<W.length&&N<W.length&&L<W.length)K.pushTri(W[j],W[N],W[L]);else if(!s7)console.log(`verts out of bounds, ignoring: ${j}, ${N}, ${L} vs ${W.length}, stride ${Q}`),s7=!0;if(L<W.length&&H<W.length&&j<W.length)K.pushTri(W[L],W[H],W[j]);else if(!s7)console.log(`verts out of bounds, ignoring: ${L}, ${H}, ${j} vs ${W.length}, stride ${Q}`),s7=!0;return K.hasCapacity(2)});this.debugController.currentOp+=Y-1,this.renderer.flushTris(K)}}class UJ extends I9{constructor(J,Z){super(J,Z);this.vertexStride=2}}class a6 extends I9{constructor(J,Z){super(J,Z);this.vertexStride=10,this.rdpCommandBuffer=new ArrayBuffer(0,{maxByteLength:16384}),this.rdpCommandDV=new DataView(this.rdpCommandBuffer),this.rdpTriangle=new J5,this.gbi0Commands=new Map([[176,this.executeUnknown.bind(this)],[177,this.executeTri4.bind(this)],[178,this.executeRDPHalf_Cont.bind(this)]])}getHandler(J){const Z=this.gbi0Commands.get(J);if(Z)return Z;return super.getHandler(J)}executeCullDL(J,Z,q){const Q=(J&16777215)/40&15,W=Z/40&15,K=this.testClipFlags(Q,W);if(q)q.text(`gSPCullDisplayList(${Q}, ${W}); // ${K?"continue":"end"}`);if(!K)this.state.endDisplayList()}executeVertex(J,Z,q){const Q=(J>>>20&15)+1,W=J>>>16&15,K=this.state.rdpSegmentAddress(Z);if(q)q.text(`gsSPVertex(${k(K)}, ${W}, ${Q});`);this.loadVertices(W,Q,K,q)}executeRDPHalf_Cont(J,Z,q){if(this.warnUnimplemented("RDPHalf_Cont"),q)q.text("gsDPHalf_Cont(/* TODO */);")}pushRDPCommandU32(J){const Z=this.rdpCommandBuffer.byteLength;this.rdpCommandBuffer.resize(Z+4),this.rdpCommandDV.setUint32(Z,J,!1)}executeRDPCommandHalf1(J,Z,q){if(q)q.text(`gsSPRDPCommandHalf1(${k(Z)});`);this.pushRDPCommandU32(Z)}executeRDPCommandHalf2(J,Z,q){if(q)q.text(`gsSPRDPCommandHalf2(${k(Z)});`);this.pushRDPCommandU32(Z)}executeRDPCommandHalf22Final(J,Z,q){if(this.warnUnimplemented("executeRDPCommandHalf22Final"),q)q.text(`gsSPRDPCommandHalf2Final(${k(Z)});`);this.pushRDPCommandU32(Z);const Q=new Z8(this.rdpCommandDV,0,this.rdpCommandDV.byteLength);this.rdpTriangle.load(Q);const W=this.rdpTriangle,K=W.tile,X=W.yh,Y=W.ym,z=W.interpolateX(W.yh),G=W.interpolateX(W.ym),H=Math.min(z[0],G[0]),j=Math.max(z[1],G[1]),N=this.renderer.calculateRectVertices(H,X/4,j,Y/4),L=W.calculateRectUVs(),M=[4294967295,4294967295,4294967295,4294967295];if(this.renderer.lleRect(K,N,L,M),q){let V=`lleRect(${K}, [${N}], [${L}], [${M}])`;const h=MJ(Q);if(h)V+=h.disassembly;q.tip(V)}this.rdpCommandBuffer.resize(0)}executeTri4(J,Z,q){const Q=this.state.projectedVertices,W=this.triangleBuffer;W.reset();let K=q?1:0,X=this.state.executeBatch(K,(Y,z)=>{const G=Y>>>12&15,H=Y>>>8&15,j=Y>>>4&15,N=Y>>>0&15,L=z>>>28&15,M=z>>>24&15,V=z>>>20&15,h=z>>>16&15,b=z>>>12&15,C=z>>>8&15,_=z>>>4&15,E=z>>>0&15;if(q)q.text(`gsSP1Triangle4(${N},${E},${_}, ${j},${C},${b}, ${H},${h},${V}, ${G},${M},${L});`);if(N!==E)W.pushTri(Q[N],Q[E],Q[_]);if(j!==C)W.pushTri(Q[j],Q[C],Q[b]);if(H!==h)W.pushTri(Q[H],Q[h],Q[V]);if(G!==M)W.pushTri(Q[G],Q[M],Q[L]);return W.hasCapacity(4)});this.debugController.currentOp+=X-1,this.renderer.flushTris(W)}}class hJ extends a6{constructor(J,Z){super(J,Z);this.vertexStride=10,this.geCommands=new Map([[178,this.executeRDPCommandHalf2.bind(this)],[179,this.executeRDPCommandHalf22Final.bind(this)],[180,this.executeRDPCommandHalf1.bind(this)]])}getHandler(J){const Z=this.geCommands.get(J);if(Z)return Z;return super.getHandler(J)}}class RJ extends a6{constructor(J,Z){super(J,Z);this.vertexStride=10,this.auxAddress=0,this.pdCommands=new Map([[7,this.executeSetVertexColorIndex.bind(this)],[178,this.executeRDPCommandHalf2.bind(this)],[179,this.executeRDPCommandHalf22Final.bind(this)],[180,this.executeRDPCommandHalf1.bind(this)]])}getHandler(J){const Z=this.pdCommands.get(J);if(Z)return Z;return super.getHandler(J)}executeSetVertexColorIndex(J,Z,q){const Q=this.state.rdpSegmentAddress(Z);if(q)q.text(`gsSPSetVertexColorIndex(${k(Q)});`);this.auxAddress=Q}loadVertices(J,Z,q,Q){const W=this.state.geometryMode.lighting,K=this.state.geometryMode.textureGen,X=this.state.geometryMode.textureGenLinear,Y=new DataView(this.ramDV.buffer,q),z=new DataView(this.ramDV.buffer,this.auxAddress);if(Q)this.previewVertex(J,Z,Y,Q,W);if(J+Z>=this.state.projectedVertices.length){this.warn("Too many verts");return}const G=12,H=this.state.modelview[this.state.modelview.length-1],N=this.state.projection[this.state.projection.length-1].multiply(H),L=this.state.texture.scaleS/32,M=this.state.texture.scaleT/32,V=new U0,h=new U0,b=new U0,C=this.renderer.nativeTransform.viTransform,_=this.state.viewport.transform;for(let E=0;E<Z;++E){const S=E*G,m=this.state.projectedVertices[J+E];m.set=!0,V.x=Y.getInt16(S+0),V.y=Y.getInt16(S+2),V.z=Y.getInt16(S+4);const o=Y.getUint8(S+7);if(m.u=Y.getInt16(S+8)*L,m.v=Y.getInt16(S+10)*M,m.color=z.getUint32(o+0,!0),this.projectInPlace(m,V,N,_,C),W){const L0=m.color&255;if(this.unpackNormal(h,m.color),H.transformNormal(h,b),b.normaliseInPlace(),m.color=this.calculateLighting(b,L0),X)m.calculateLinearUV(b);else if(K)m.calculateSphericalUV(b)}}}}class bJ extends a6{constructor(J,Z){super(J,Z);this.vertexStride=5}executeVertex(J,Z,q){const Q=J>>>9&127,W=(J>>>16&255)/5,K=this.state.rdpSegmentAddress(Z);if(q)q.text(`gsSPVertex(${k(K)}, ${W}, ${Q});`);this.loadVertices(W,Q,K,q)}}class DJ extends a6{constructor(J,Z){super(J,Z);this.vertexStride=5}executeVertex(J,Z,q){const Q=(J>>>4&4095)/33+1,K=this.state.rdpSegmentAddress(Z);if(q)q.text(`gsSPVertex(${k(K)}, 0, ${Q});`);this.loadVertices(0,Q,K,q)}}class AJ extends a6{constructor(J,Z){super(J,Z);this.vertexStride=10,this.matrixAddress=0,this.matrixIndex=0,this.matrixArray=[r0.identity(),r0.identity(),r0.identity(),r0.identity()],this.vertexAddress=0,this.vertexOffset=0,this.billboardMode=!1,this.dkrCommands=new Map([[5,this.executeTriDMA.bind(this)],[7,this.executeDisplayListLen.bind(this)],[191,this.executeSetAddresses.bind(this)]])}getHandler(J){const Z=this.dkrCommands.get(J);if(Z)return Z;return super.getHandler(J)}executeDisplayListLen(J,Z,q){const Q=J>>>16&255,W=this.state.rdpSegmentAddress(Z);if(q)q.text(`gsSPDisplayListLen(<span class="dl-branch">${k(W)}</span>, ${Q});`);this.state.pushDisplayList(W,Q)}executeSetAddresses(J,Z,q){if(this.matrixAddress=this.state.rdpSegmentAddress(J),this.vertexAddress=this.state.rdpSegmentAddress(Z),this.vertexOffset=0,q)q.text(`gsSPSetAddress(${k(this.matrixAddress)}, ${k(this.vertexAddress)};`)}executeMoveWord(J,Z,q){const Q=J&255;if(Q==2){if(this.billboardMode=(Z&1)!=0,q)q.text(`gSetBillboardMode(${this.billboardMode});`)}else if(Q==10){if(this.matrixIndex=Z>>6&3,q)q.text(`gSetMatrixIndex(${this.matrixIndex});`)}else super.executeMoveWord(J,Z,q)}executeTexture(J,Z,q){const Q=J>>>16&255,W=J>>>11&3,K=J>>>8&7,Y=this.calcTextureScale(Z>>>16&65535),z=this.calcTextureScale(Z>>>0&65535);if(q){const G=Y.toString(),H=z.toString(),j=m0(K);if(Q!==0)q.text(`gsSPTextureL(${G}, ${H}, ${W}, ${Q}, ${j}, G_ON);`);else q.text(`gsSPTexture(${G}, ${H}, ${W}, ${j}, G_ON);`)}this.state.setTexture(Y,z,W,K),this.state.geometryModeBits|=B6.G_TEXTURE_ENABLE,this.state.updateGeometryModeFromBits(B6)}executeMatrix(J,Z,q){const Q=this.matrixAddress+Z,W=J>>22&3,K=J&65535,X=this.loadMatrix(Q,K);if(q)q.text(`gsSPMatrix(${k(Q)}, ${W});`),q.tip(this.previewMatrix(X));this.matrixArray[W]=X,this.matrixIndex=W}executeVertex(J,Z,q){const Q=this.vertexAddress+Z,W=(J>>>19&31)+1,K=J&65536,X=J>>>9&31;if(this.billboardMode)this.vertexOffset=K?1:0;else if(!K)this.vertexOffset=0;const Y=this.vertexOffset+X;if(q)q.text(`gsSPVertex(${k(Q)}, ${Y}, ${W});`);this.loadVertices(Y,W,Q,q),this.vertexOffset+=W}loadVertices(J,Z,q,Q){if(J+Z>=this.state.projectedVertices.length){this.warn("Too many verts");return}const W=10,K=new DataView(this.ramDV.buffer,q);let X=this.matrixArray[this.matrixIndex];const Y=this.renderer.nativeTransform.viTransform,z=this.state.viewport.transform,G=new U0;if(this.billboardMode){X=X.copy();const j=this.state.projectedVertices[0].pos;X.elems[3]+=j.x,X.elems[7]+=j.y,X.elems[11]+=j.z,X.elems[15]+=j.w}let H="";if(Q){const j=["#","x","y","z","rgba"];H+='<table class="vertex-table">',H+=`<tr><th>${j.join("</th><th>")}</th></tr>\n`}for(let j=0,N=0;j<Z;j++,N+=W){const L=this.state.projectedVertices[J+j];if(L.set=!0,G.x=K.getInt16(N+0),G.y=K.getInt16(N+2),G.z=K.getInt16(N+4),L.color=K.getUint32(N+6,!0),this.projectInPlace(L,G,X,z,Y),Q){const M=[J+j,G.x,G.y,G.z,_7(K.getUint32(N+6,!0))];H+=`<tr><td>${M.join("</td><td>")}</td></tr>\n`}}if(Q)H+="</table>",Q.tip(H)}executeTriDMA(J,Z,q){const Q=J>>>4&31,W=this.state.rdpSegmentAddress(Z),K=new DataView(this.ramDV.buffer,W),X=this.state.projectedVertices,Y=this.triangleBuffer;if(Y.reset(),q)q.text(`gsSPTriDMA(${k(W)}, ${Q});`);let z="";if(Q>Y.maxTris)this.warn(`Too many triangles for buffer: ${Q} > ${Y.maxTris}`);const G=16;for(let H=0;H<Q&&Y.hasCapacity(1);++H){const j=H*G,N=K.getUint8(j+0),L=K.getUint8(j+1),M=K.getUint8(j+2),V=K.getUint8(j+3),h=K.getInt16(j+4)/32,b=K.getInt16(j+6)/32,C=K.getInt16(j+8)/32,_=K.getInt16(j+10)/32,E=K.getInt16(j+12)/32,S=K.getInt16(j+14)/32;if(Y.pushTriWithUV(X[L],X[M],X[V],h,b,C,_,E,S),q)z+=`${H}: ${N}, v${L} (${h}, ${b}), v${M} (${C}, ${_}), v${V} (${E}, ${S})\n`}if(this.renderer.flushTris(Y),this.vertexOffset=0,q)q.tip(z)}}class s8 extends Z5{constructor(J,Z){super(J,Z);this.vertexStride=2,this.gbi2Commands=new Map([[0,this.executeNoop.bind(this)],[1,this.executeVertex.bind(this)],[2,this.executeModifyVtx.bind(this)],[3,this.executeCullDL.bind(this)],[4,this.executeBranchZ.bind(this)],[5,this.executeTri1.bind(this)],[6,this.executeTri2.bind(this)],[7,this.executeQuad.bind(this)],[8,this.executeLine3D.bind(this)],[9,this.executeBgRect1Cyc.bind(this)],[10,this.executeBgRectCopy.bind(this)],[11,this.executeObjRenderMode.bind(this)],[214,this.executeDmaIo.bind(this)],[215,this.executeTexture.bind(this)],[216,this.executePopMatrix.bind(this)],[217,this.executeGeometryMode.bind(this)],[218,this.executeMatrix.bind(this)],[219,this.executeMoveWord.bind(this)],[220,this.executeMoveMem.bind(this)],[221,this.executeLoadUcode.bind(this)],[222,this.executeDL.bind(this)],[223,this.executeEndDL.bind(this)],[224,this.executeSpNoop.bind(this)],[225,this.executeRDPHalf1.bind(this)],[226,this.executeSetOtherModeL.bind(this)],[227,this.executeSetOtherModeH.bind(this)],[241,this.executeRDPHalf2.bind(this)]])}getHandler(J){const Z=this.gbi2Commands.get(J);if(Z)return Z;return super.getHandler(J)}executeDL(J,Z,q){const Q=J>>>16&255,W=this.state.rdpSegmentAddress(Z);if(q){const K=Q===u8?"gsSPDisplayList":"gsSPBranchList";q.text(`${K}(<span class="dl-branch">${k(W)}</span>);`)}if(Q===u8)this.state.pushDisplayList(W);else this.state.branchDisplayList(W)}executeEndDL(J,Z,q){if(q)q.text("gsSPEndDisplayList();");this.state.endDisplayList()}executeSetOtherModeL(J,Z,q){const Q=J>>>8&255,W=J>>>0&255,K=Z,X=2147483648>>W>>>Q;if(q)T7(q,X,K);this.state.rdpOtherModeL=this.state.rdpOtherModeL&~X|K}executeSetOtherModeH(J,Z,q){const Q=J>>>8&255,W=J>>>0&255,K=Z,X=2147483648>>W>>>Q;if(q)S7(q,X,W,Q,K);this.state.rdpOtherModeH=this.state.rdpOtherModeH&~X|K}executeMatrix(J,Z,q){const Q=this.state.rdpSegmentAddress(Z),W=(J&1)===0,K=J>>>1&1,X=J>>>2&1;let Y=this.loadMatrix(Q,64);if(q){let G="";G+=X?"G_MTX_PROJECTION":"G_MTX_MODELVIEW",G+=K?"|G_MTX_LOAD":"|G_MTX_MUL",G+=W?"|G_MTX_PUSH":"",q.text(`gsSPMatrix(${k(Q)}, ${G});`),q.tip(this.previewMatrix(Y))}const z=X?this.state.projection:this.state.modelview;if(!K)Y=z[z.length-1].multiply(Y);if(W)z.push(Y);else z[z.length-1]=Y}executeVertex(J,Z,q){const Q=(J&255)>>1,W=J>>>12&255,K=Q-W,X=this.state.rdpSegmentAddress(Z);if(q)q.text(`gsSPVertex(${k(X)}, ${K}, ${W});`);this.loadVertices(K,W,X,q)}executeBranchZ(J,Z,q){if(this.warnUnimplemented("BranchZ"),q)q.text("gsSPBranchZ(/* TODO */);")}executeLine3D(J,Z,q){if(this.warnUnimplemented("Line3D"),q)q.text("gsSPLine3D(/* TODO */);")}executeBgRect1Cyc(J,Z,q){if(this.warnUnimplemented("BgRect1Cyc"),q)q.text("gsSPBgRect1Cyc(/* TODO */);")}executeBgRectCopy(J,Z,q){if(this.warnUnimplemented("BgRectCopy"),q)q.text("gsSPBgRectCopy(/* TODO */);")}executeObjRenderMode(J,Z,q){if(this.warnUnimplemented("ObjRenderMode"),q)q.text("gsSPObjRenderMode(/* TODO */);")}executeDmaIo(J,Z,q){if(q)q.text("DmaIo(/* TODO */);")}executeTri1(J,Z,q){const Q=this.state.projectedVertices,W=this.triangleBuffer;W.reset();let K=q?1:0,X=this.state.executeBatch(K,(Y,z)=>{const G=Y>>>1&127,H=Y>>>9&127,j=Y>>>17&127,N=z>>>24&255;if(q)q.text(`gsSP1Triangle(${G},${H},${j}, ${N});`);return W.pushTri(Q[G],Q[H],Q[j]),W.hasCapacity(1)});this.debugController.currentOp+=X-1,this.renderer.flushTris(W)}executeTri2(J,Z,q){const Q=this.state.projectedVertices,W=this.triangleBuffer;W.reset();let K=q?1:0,X=this.state.executeBatch(K,(Y,z)=>{const G=z>>>1&127,H=z>>>9&127,j=z>>>17&127,N=Y>>>1&127,L=Y>>>9&127,M=Y>>>17&127;if(q)q.text(`gsSP2Triangles(${G},${H},${j}, ${N},${L},${M});`);return W.pushTri(Q[G],Q[H],Q[j]),W.pushTri(Q[N],Q[L],Q[M]),W.hasCapacity(2)});this.debugController.currentOp+=X-1,this.renderer.flushTris(W)}executeQuad(J,Z,q){const Q=this.state.projectedVertices,W=this.triangleBuffer;W.reset();let K=q?1:0,X=this.state.executeBatch(K,(Y,z)=>{const G=z>>>1&127,H=z>>>9&127,j=z>>>17&127,N=Y>>>1&127,L=Y>>>9&127,M=Y>>>17&127;if(q)q.text(`gSP1Quadrangle(${G},${H},${j}, ${N},${L},${M});`);return W.pushTri(Q[G],Q[H],Q[j]),W.pushTri(Q[N],Q[L],Q[M]),W.hasCapacity(2)});this.debugController.currentOp+=X-1,this.renderer.flushTris(W)}executeModifyVtx(J,Z,q){const Q=J>>>1&32767,W=J>>>16&255,K=Z;if(q)q.text(`gsSPModifyVertex(${Q},${x8.nameOf(W)},${k(K)});`);if(Q>=this.state.projectedVertices.length){this.warn("crazy vertex index",Q);return}const X=this.state.projectedVertices[Q];switch(W){case x8.G_MWO_POINT_RGBA:this.warnUnimplemented("modifyVtx RGBA");break;case x8.G_MWO_POINT_ST:{const Y=K>>16,z=(K&65535)<<16>>16;X.set=!0,X.u=Y*this.state.texture.scaleS/32,X.v=z*this.state.texture.scaleT/32}break;case x8.G_MWO_POINT_XYSCREEN:this.warnUnimplemented("modifyVtx XYSCREEN");break;case x8.G_MWO_POINT_ZSCREEN:this.warnUnimplemented("modifyVtx ZSCREEN");break;default:this.warnUnimplemented("modifyVtx");break}}executeTexture(J,Z,q){const Q=J>>>16&255,W=J>>>11&3,K=J>>>8&7,X=J>>>1&1,Y=this.calcTextureScale(Z>>>16&65535),z=this.calcTextureScale(Z>>>0&65535);if(q){const G=Y.toString(),H=z.toString(),j=m0(K);if(Q!==0)q.text(`gsSPTextureL(${G}, ${H}, ${W}, ${Q}, ${j}, ${X});`);else q.text(`gsSPTexture(${G}, ${H}, ${W}, ${j}, ${X});`)}if(this.state.setTexture(Y,z,W,K),X)this.state.geometryModeBits|=q9.G_TEXTURE_ENABLE;else this.state.geometryModeBits&=~q9.G_TEXTURE_ENABLE;this.state.updateGeometryModeFromBits(q9)}executeGeometryMode(J,Z,q){const Q=J&16777215,W=Z;if(q){const K=m8(q9,~Q),X=m8(q9,W);q.text(`gsSPGeometryMode(~(${K}),${X});`)}this.state.geometryModeBits&=Q|q9.G_TEXTURE_ENABLE,this.state.geometryModeBits|=W&~q9.G_TEXTURE_ENABLE,this.state.updateGeometryModeFromBits(q9)}executePopMatrix(J,Z,q){if(q)q.text("gsSPPopMatrix(G_MTX_MODELVIEW);");const W=this.state.modelview;if(W.length>0)W.pop()}executeMoveWord(J,Z,q){const Q=J>>>16&255,W=J&65535,K=Z;let X="";switch(Q){case w0.G_MW_MATRIX:this.warnUnimplemented("MoveWord Matrix");break;case w0.G_MW_NUMLIGHT:{let Y=Math.floor(K/24);if(q)X=`gsSPNumLights(${D7.nameOf(Y)});`;this.state.numLights=Y}break;case w0.G_MW_CLIP:if(q)X=`gSPClipRatio(${N7.nameOf(W)}, ${R7.nameOf(K)});`;break;case w0.G_MW_SEGMENT:{const Y=W>>>2&15;if(q)X=`gsSPSegment(${b7.nameOf(Y)}, ${k(K)});`;this.state.segments[Y]=K}break;case w0.G_MW_FOG:{const Y=Z>>16,z=Z&65535;if(q)X=`gSPFogPosition(${Y}, ${z});`;this.state.fogParameters.set(Y,z)}break;case w0.G_MW_LIGHTCOL:this.warnUnimplemented("MoveWord LightCol");break;case w0.G_MW_POINTS:this.warnUnimplemented("MoveWord Points");break;case w0.G_MW_PERSPNORM:if(q)X=`gSPPerspNormalize(${K});`;break;default:this.warnUnimplemented("MoveWord Unknown");break}if(q){if(!X)X=`gMoveWd(${w0.nameOf(Q)}, ${Z0(W)}, ${k(K)});`;q.text(X)}}executeMoveMem(J,Z,q){const Q=this.state.rdpSegmentAddress(Z),W=(J>>>16&255)<<1,K=(J>>>8&255)<<3,X=J&254;let Y;if(q)Y=`gsDma1p(G_MOVEMEM, ${k(Q)}, ${W}, ${K}, ${$6.nameOf(X)});`;switch(X){case $6.G_GBI2_MV_VIEWPORT:if(q)Y=`gsSPViewport(${k(Q)});`;this.loadViewport(Q);break;case $6.G_GBI2_MV_LIGHT:if(K==$6.G_GBI2_MVO_LOOKATX){if(q)Y=`gSPLookAtX(${k(Q)});`}else if(K==$6.G_GBI2_MVO_LOOKATY){if(q)Y=`gSPLookAtY(${k(Q)});`}else if(K>=$6.G_GBI2_MVO_L0&&K<=$6.G_GBI2_MVO_L7){let z=(K-$6.G_GBI2_MVO_L0)/24>>>0;if(q)Y=`gsSPLight(${k(Q)}, ${z})`;if(this.loadLight(z,Q),W!=16)console.log(`unexpected gsSPLight length ${W}. Is this setting multiple lights?`)}else if(q)Y+=` // (unknown offset ${Z0(K)})`;break;case $6.G_GBI2_MV_POINT:this.warnUnimplemented("MoveMem G_GBI2_MV_POINT");break;case $6.G_GBI2_MV_MATRIX:this.warnUnimplemented("MoveMem G_GBI2_MV_MATRIX");break;default:this.warnUnimplemented(`MoveMem ${X.toString(16)}`)}if(q)q.text(Y),this.previewMoveMem(X,W,Q,q)}previewMoveMem(J,Z,q,Q){let W="";for(let K=0;K<Z;K+=4)W+=v(this.ramDV.getUint32(q+K),32)+" ";switch(W+="<br>",J){case $6.G_GBI2_MV_VIEWPORT:W+=this.previewViewport(q);break;case $6.G_GBI2_MV_LIGHT:W+=this.previewLight(q);break}Q.tip(W)}}class wJ extends s8{constructor(J,Z){super(J,Z);this.vertexStride=2}}var BJ=0,IJ=1,CJ=2,OJ=3;class tW{constructor(){this.imageX=0,this.imageW=0,this.frameX=0,this.frameW=0,this.imageY=0,this.imageH=0,this.frameY=0,this.frameH=0,this.imagePtr=0,this.imageLoad=0,this.imageFmt=0,this.imageSiz=0,this.imagePal=0,this.imageFlip=0,this.scaleW=0,this.scaleH=0,this.imageYorig=0}load(J,Z){this.imageX=J.getUint16(Z+0,!1)/32,this.imageW=J.getUint16(Z+2,!1)/4,this.frameX=J.getInt16(Z+4,!1)/4,this.frameW=J.getUint16(Z+6,!1)/4,this.imageY=J.getUint16(Z+8,!1)/32,this.imageH=J.getUint16(Z+10,!1)/4,this.frameY=J.getInt16(Z+12,!1)/4,this.frameH=J.getUint16(Z+14,!1)/4,this.imagePtr=J.getUint32(Z+16,!1),this.imageLoad=J.getUint16(Z+20,!1),this.imageFmt=J.getUint8(Z+22,!1),this.imageSiz=J.getUint8(Z+23,!1),this.imagePal=J.getUint16(Z+24,!1),this.imageFlip=J.getUint16(Z+26,!1),this.scaleW=J.getUint16(Z+28,!1)/1024,this.scaleH=J.getUint16(Z+30,!1)/1024,this.imageYorig=J.getInt32(Z+32,!1)/32}toString(){return`imageX/Y = (${this.imageX}, ${this.imageY}), imageW/H = (${this.imageW}, ${this.imageH})
frameX/Y = (${this.frameX}, ${this.frameY}), frameW/H = (${this.frameW}, ${this.frameH})
imagePtr = ${k(this.imagePtr)}, imageLoad = ${this.imageLoad}
imageFmt = ${j0.nameOf(this.imageFmt)}, imageSiz = ${d.nameOf(this.imageSiz)}
imagePal = ${this.imagePal}, imageFlip = ${this.imageFlip}
scaleW/H = (${this.scaleW}, ${this.scaleH})`}}class eW{constructor(){this.a=1,this.b=0,this.c=0,this.d=1,this.x=0,this.y=0,this.sx=1,this.sy=1}loadFullMatrix(J,Z){this.a=J.getInt32(Z+0,!1)/65536,this.b=J.getInt32(Z+4,!1)/65536,this.c=J.getInt32(Z+8,!1)/65536,this.d=J.getInt32(Z+12,!1)/65536,this.loadSubMatrix(J,Z+16)}loadSubMatrix(J,Z){this.x=J.getInt16(Z+0,!1)/4,this.y=J.getInt16(Z+2,!1)/4,this.sx=J.getUint16(Z+4,!1)/1024,this.sy=J.getUint16(Z+6,!1)/1024}toString(){return`rot = (${this.a}, ${this.b}, ${this.c}, ${this.d}), trans = (${this.x}, ${this.y}), scale = (${this.sx}, ${this.sy})`}}class JK{constructor(){this.objX=0,this.scaleW=0,this.imageW=0,this.objY=0,this.scaleH=0,this.imageH=0,this.imageStride=0,this.imageAdrs=0,this.imageFmt=0,this.imageSiz=0,this.imagePal=0,this.imageFlags=0}load(J,Z){this.objX=J.getInt16(Z+0,!1)/4,this.scaleW=J.getUint16(Z+2,!1)/1024,this.imageW=J.getUint16(Z+4,!1)/32,this.objY=J.getInt16(Z+8,!1)/4,this.scaleH=J.getUint16(Z+10,!1)/1024,this.imageH=J.getUint16(Z+12,!1)/32,this.imageStride=J.getUint16(Z+16,!1),this.imageAdrs=J.getUint16(Z+18,!1),this.imageFmt=J.getUint8(Z+20,!1),this.imageSiz=J.getUint8(Z+21,!1),this.imagePal=J.getUint8(Z+22,!1),this.imageFlags=J.getUint8(Z+23,!1)}get objW(){return this.imageW/this.scaleW}get objH(){return this.imageH/this.scaleH}toString(){return`pos = (${this.objX}, ${this.objY}), scale = (${this.scaleW}, ${this.scaleH}), image = (${this.imageW}, ${this.imageH})
stride = ${this.imageStride}, address = ${Z0(this.imageAdrs)}, format = ${j0.nameOf(this.imageFmt)}, size = ${d.nameOf(this.imageSiz)}
paletteIdx = ${this.imagePal}, flags = ${this.imageFlags}`}}var h$=48;var R$=51,b$=52;class ZK{constructor(){this.type=0,this.image=0,this.tileTMEM=0,this.texLoadSize=0,this.texLoadRows=0,this.sid=0,this.flag=0,this.mask=0}load(J,Z){this.type=J.getUint32(Z+0,!1),this.image=J.getUint32(Z+4,!1),this.tileTMEM=J.getUint16(Z+8,!1),this.texLoadSize=J.getUint16(Z+10,!1),this.texLoadRows=J.getUint16(Z+12,!1),this.sid=J.getUint16(Z+14,!1),this.flag=J.getUint32(Z+16,!1),this.mask=J.getUint32(Z+20,!1)}toString(){let J=`type = ${k(this.type)}, image = ${k(this.image)}\n`;return J+=`tmem = ${Z0(this.tileTMEM)}, size (qwords) = ${Z0(this.texLoadSize)}, rows (texels) = ${this.texLoadRows}`,J}}class yJ{constructor(J,Z,q){this.state=J,this.ramDV=Z,this.gbi=q,this.scaleBg=new tW,this.matrix=new eW,this.sprite=new JK,this.texture=new ZK}executeBg1cyc(J,Z,q){const Q=this.state.rdpSegmentAddress(Z);if(this.scaleBg.load(this.ramDV,Q),this.gbi.warnUnimplemented("gSPBgRect1Cyc"),q)q.text(`gSPBgRect1Cyc(${k(Q)});`),q.tip(this.scaleBg.toString())}executeBgCopy(J,Z,q){if(this.gbi.warnUnimplemented("gSPBgRectCopy"),q)q.text("gSPBgRectCopy(/* TODO */);")}executeObjRectangle(J,Z,q){this.execLoadTxRenderObj("gSPObjRectangle",!1,OJ,Z,q)}executeObjRectangleR(J,Z,q){this.execLoadTxRenderObj("gSPObjRectangleR",!1,CJ,Z,q)}executeObjSprite(J,Z,q){this.execLoadTxRenderObj("gSPObjSprite",!1,IJ,Z,q)}executeObjLoadTxRect(J,Z,q){this.execLoadTxRenderObj("gSPObjLoadTxRect",!0,OJ,Z,q)}executeObjLoadTxRectR(J,Z,q){this.execLoadTxRenderObj("gSPObjLoadTxRectR",!0,CJ,Z,q)}executeObjLoadTxSprite(J,Z,q){this.execLoadTxRenderObj("gSPObjLoadTxSprite",!0,IJ,Z,q)}executeObjLoadTxtr(J,Z,q){this.execLoadTxRenderObj("gSPObjLoadTxtr",!0,BJ,Z,q)}execLoadTxRenderObj(J,Z,q,Q,W){const K=this.state.rdpSegmentAddress(Q);let X=K;if(Z)this.texture.load(this.ramDV,X),this.loadTexture(),X+=24;if(q!=BJ)this.sprite.load(this.ramDV,X),this.renderSprite(q),X+=24;let Y="";if(W){if(W.text(`${J}(${k(K)});`),Z)Y+=this.texture.toString()+"\n";if(q!=BJ)Y+=this.sprite.toString()+"\n";W.tip(Y)}}executeObjMoveMem(J,Z,q){const Q=this.state.rdpSegmentAddress(Z),W=J&65535;switch(W){case 0:if(q)q.text(`gSPObjMatrix(${k(Q)});`);this.setObjMatrix(Q,q);break;case 2:if(q)q.text(`gSPObjSubMatrix(${k(Q)});`);this.setObjSubMatrix(Q,q);break;default:if(q)q.text(`gSPObjMoveMem(${W}, ${k(Q)});`)}}setObjMatrix(J,Z){if(this.matrix.loadFullMatrix(this.ramDV,J),Z)Z.tip(this.matrix.toString())}setObjSubMatrix(J,Z){if(this.matrix.loadSubMatrix(this.ramDV,J),Z)Z.tip(this.matrix.toString())}executeSelectDL(J,Z,q){if(this.gbi.warnUnimplemented("gSPSelectDL"),q)q.text("gSPSelectDL(/* TODO */);")}executeObjRendermode(J,Z,q){if(q)q.text("gSPObjRenderMode(/* ignored */);")}executeTriRSP(J,Z,q){if(this.gbi.warnUnimplemented("executeTriRSP"),q)q.text("executeTriRSP(); // ignored")}loadTexture(){const J=this.texture,Z=this.state.tiles[WJ],q=this.state.rdpSegmentAddress(J.image),Q=this.state.textureImage;Q.set(j0.G_IM_FMT_RGBA,d.G_IM_SIZ_16b,J.texLoadSize+1,q);const W=J.type>>>8&255,K=W>>>5&7,X=W>>>3&3,Y=J.type<<8>>24,z=(J.texLoadSize+1&Y)>>>2,G=0;Z.set(K,X,z,J.tileTMEM,G,0,0,0,0,0,0);const H=2,j=J.texLoadSize<<H;switch(J.type>>>0&255){case R$:this.state.tmem.loadBlock(Q,Z,0,0,j,J.texLoadRows);break;case b$:this.state.tmem.loadTile(Q,Z,0,0,j,J.texLoadRows);break;case h$:this.state.tmem.loadTLUT(Q,Z,0,0,j,J.texLoadRows);break;default:this.gbi.warnUnimplemented(`load texture type ${J.type}`);break}this.state.invalidateTileHashes()}renderSprite(J){const Z=this.sprite,q=this.matrix,W=Z.objX,K=Z.objY,X=Z.objW+W,Y=Z.objH+K,z=this.state.tiles[0];z.set(Z.imageFmt,Z.imageSiz,Z.imageStride,Z.imageAdrs,Z.imagePal,h9,0,0,h9,0,0),z.setSize(0,0,Z.imageW-1<<2,Z.imageH-1<<2);const G=Z.imageFlags&1,H=Z.imageFlags&16;if(G||H)this.gbi.warnUnimplemented("swapX/Y");const j=0,N=0,L=Z.imageW,M=Z.imageH;if(J==IJ){const V=q.x+q.a*W+q.b*K,h=q.y+q.c*W+q.d*K,b=q.x+q.a*X+q.b*K,C=q.y+q.c*X+q.d*K,_=q.x+q.a*W+q.b*Y,E=q.y+q.c*W+q.d*Y,S=q.x+q.a*X+q.b*Y,m=q.y+q.c*X+q.d*Y;this.gbi.renderer.texRectRot(0,V,h,b,C,_,E,S,m,j,N,L,M)}else if(J==CJ){const V=q.x+W/q.sx,h=q.y+K/q.sy,b=q.x+X/q.sx,C=q.y+Y/q.sy;this.gbi.renderer.texRect(0,V,h,b,C,j,N,L,M,!1)}else if(J==OJ){const V=W,h=X,b=K,C=Y;this.gbi.renderer.texRect(0,V,b,h,C,j,N,L,M,!1)}}}class EJ extends I9{constructor(J,Z){super(J,Z);this.vertexStride=2,this.s2dex=new yJ(J,Z,this),this.sdexCommands=new Map([[1,this.s2dex.executeBg1cyc.bind(this.s2dex)],[2,this.s2dex.executeBgCopy.bind(this.s2dex)],[3,this.s2dex.executeObjRectangle.bind(this.s2dex)],[4,this.s2dex.executeObjSprite.bind(this.s2dex)],[5,this.s2dex.executeObjMoveMem.bind(this.s2dex)],[176,this.s2dex.executeSelectDL.bind(this.s2dex)],[177,this.s2dex.executeObjRendermode.bind(this.s2dex)],[178,this.s2dex.executeObjRectangleR.bind(this.s2dex)],[193,this.s2dex.executeObjLoadTxtr.bind(this.s2dex)],[194,this.s2dex.executeObjLoadTxSprite.bind(this.s2dex)],[195,this.s2dex.executeObjLoadTxRect.bind(this.s2dex)],[196,this.s2dex.executeObjLoadTxRectR.bind(this.s2dex)],[200,this.s2dex.executeTriRSP.bind(this.s2dex)],[201,this.s2dex.executeTriRSP.bind(this.s2dex)],[202,this.s2dex.executeTriRSP.bind(this.s2dex)],[203,this.s2dex.executeTriRSP.bind(this.s2dex)],[204,this.s2dex.executeTriRSP.bind(this.s2dex)],[205,this.s2dex.executeTriRSP.bind(this.s2dex)],[206,this.s2dex.executeTriRSP.bind(this.s2dex)],[207,this.s2dex.executeTriRSP.bind(this.s2dex)],[228,this.executeRDPHalf0.bind(this.s2dex)]])}getHandler(J){const Z=this.sdexCommands.get(J);if(Z)return Z;return super.getHandler(J)}executeRDPHalf0(J,Z,q){if(q)q.text(`gsImmp1(G_RDPHALF_0, ${k(J)}, ${k(Z)});`);this.state.rdpHalf0Cmd0=J,this.state.rdpHalf0Cmd1=Z}executeRDPHalf2(J,Z,q){if(q)q.text(`gsImmp1(G_RDPHALF_2, ${k(Z)});`);this.rdpTexRect(this.state.rdpHalf0Cmd0,this.state.rdpHalf0Cmd1,this.state.rdpHalf1Cmd1,Z,q)}}class TJ extends s8{constructor(J,Z){super(J,Z);this.vertexStride=2,this.s2dex=new yJ(J,Z,this),this.sdexCommands=new Map([[1,this.s2dex.executeObjRectangle.bind(this.s2dex)],[2,this.s2dex.executeObjSprite.bind(this.s2dex)],[4,this.s2dex.executeSelectDL.bind(this.s2dex)],[5,this.s2dex.executeObjLoadTxtr.bind(this.s2dex)],[6,this.s2dex.executeObjLoadTxSprite.bind(this.s2dex)],[7,this.s2dex.executeObjLoadTxRect.bind(this.s2dex)],[8,this.s2dex.executeObjLoadTxRectR.bind(this.s2dex)],[9,this.s2dex.executeBg1cyc.bind(this.s2dex)],[10,this.s2dex.executeBgCopy.bind(this.s2dex)],[11,this.s2dex.executeObjRendermode.bind(this.s2dex)],[200,this.s2dex.executeTriRSP.bind(this.s2dex)],[201,this.s2dex.executeTriRSP.bind(this.s2dex)],[202,this.s2dex.executeTriRSP.bind(this.s2dex)],[203,this.s2dex.executeTriRSP.bind(this.s2dex)],[204,this.s2dex.executeTriRSP.bind(this.s2dex)],[205,this.s2dex.executeTriRSP.bind(this.s2dex)],[206,this.s2dex.executeTriRSP.bind(this.s2dex)],[207,this.s2dex.executeTriRSP.bind(this.s2dex)],[213,this.executeDLCount.bind(this)],[218,this.s2dex.executeObjRectangleR.bind(this.s2dex)]])}getHandler(J){const Z=this.sdexCommands.get(J);if(Z)return Z;return super.getHandler(J)}executeDLCount(J,Z,q){if(this.warnUnimplemented("executeDL_Count"),q)q.text("executeDL_Count(/* TODO */);")}executeMoveMem(J,Z,q){const Q=J&254;if(Q==0){const W=this.state.rdpSegmentAddress(Z);if(q)q.text(`gSPObjMatrix(${k(W)});`);this.s2dex.setObjMatrix(W,q);return}else if(Q==2){const W=this.state.rdpSegmentAddress(Z);if(q)q.text(`gSPObjSubMatrix(${k(W)});`);this.s2dex.setObjSubMatrix(W,q);return}super.executeMoveMem(J,Z,q)}}function $K(J,Z,q){const Q=J.detectVersionString(),W=B0.dumpMicrocodeSubstring;if(B0.dumpMicrocode&&(W==""||Q.includes(W)))J.dumpCode(),B0.dumpMicrocode=!1;const K=J.computeMicrocodeHash(),X=w$(Q,K),Y=A$(X,Z,q);return Y.version=Q,Y}var A$=function(J,Z,q){switch(J){case e7:return new a6(Z,q);case i7:return new AJ(Z,q);case zK:return new DJ(Z,q);case GK:return new RJ(Z,q);case FK:return new hJ(Z,q);case YK:return new bJ(Z,q);case QK:return new I9(Z,q);case t7:return new UJ(Z,q);case KK:return new EJ(Z,q);case WK:return new s8(Z,q);case HK:return new wJ(Z,q);case XK:return new TJ(Z,q)}return U(`unhandled ucode during table init: ${J}`),new a6(Z,q)},w$=function(J,Z){let q=D$.get(Z);if(q===void 0)q=I$(J);return B$(J,q),q},B$=function(J,Z){if(qK.get(J))return;qK.set(J,!0),U(`New RSP graphics ucode seen: ${J} = ucode ${Z}`)},I$=function(J){const Z=["F3","L3","S2DEX"];let q=-1;for(let Q of Z)if(q=J.indexOf(Q),q>=0)break;if(q>=0){if(J.indexOf("fifo",q)>=0||J.indexOf("xbux",q)>=0)return J.indexOf("S2DEX")>=0?XK:WK;return J.indexOf("S2DEX")>=0?KK:QK}return e7},e7=0,QK=1,WK=2,KK=3,XK=4,YK=5,i7=6,t7=7,zK=8,FK=9,HK=10,GK=11,D$=new Map([[1613065980,HK],[1837886526,t7],[202381338,i7],[1899172316,i7],[603530562,FK],[379440285,i7],[651856460,t7],[3401874884,GK],[1824215581,zK],[3713401635,t7],[1691120285,YK],[3610907332,e7],[826213259,e7]]),qK=new Map;class j6{constructor(J,Z,q,Q){if(Q!==void 0)this.elems=new Float32Array(4),this.elems[0]=J,this.elems[1]=Z,this.elems[2]=q,this.elems[3]=Q;else this.elems=J||new Float32Array(4)}get x(){return this.elems[0]}get y(){return this.elems[1]}get z(){return this.elems[2]}get w(){return this.elems[3]}set x(J){this.elems[0]=J}set y(J){this.elems[1]=J}set z(J){this.elems[2]=J}set w(J){this.elems[3]=J}set(J,Z,q,Q){return this.x=J,this.y=Z,this.z=q,this.w=Q,this}setV3(J,Z){return this.x=J.x,this.y=J.y,this.z=J.z,this.w=Z,this}dot(J){let Z=0;for(let q=0;q<this.elems.length;++q)Z+=this.elems[q]*J.elems[q];return Z}lengthSqr(){return this.dot(this)}length(){return Math.sqrt(this.lengthSqr())}addInPlace(J){for(let Z=0;Z<this.elems.length;++Z)this.elems[Z]+=J.elems[Z];return this}subInPlace(J){for(let Z=0;Z<this.elems.length;++Z)this.elems[Z]-=J.elems[Z];return this}scaleInPlace(J){for(let Z=0;Z<this.elems.length;++Z)this.elems[Z]*=J;return this}vecScaleInPlace(J){for(let Z=0;Z<this.elems.length;++Z)this.elems[Z]*=J.elems[Z];return this}invVecScaleInPlace(J){for(let Z=0;Z<this.elems.length;++Z)this.elems[Z]/=J.elems[Z];return this}normaliseInPlace(){let J=this.length();if(J>0)return this.scaleInPlace(1/J);return this}static create(J){const Z=new j6;return Z.elems[0]=J[0],Z.elems[1]=J[1],Z.elems[2]=J[2],Z.elems[3]=J[3],Z}}class SJ{constructor(){this.pos=new j6,this.color=0,this.u=0,this.v=0,this.clipFlags=0,this.set=!1}calculateLinearUV(J){this.u=0.5*(1+J.x),this.v=0.5*(1+J.y)}calculateSphericalUV(J){this.u=Math.acos(J.x)/Math.PI,this.v=Math.acos(J.y)/Math.PI}}class q5{constructor(J,Z){this.scale=J||new j6(1,1,1,1),this.trans=Z||new j6(0,0,0,0)}transformInPlace(J){J.vecScaleInPlace(this.scale),J.addInPlace(this.trans)}invTransformInPlace(J){J.subInPlace(this.trans),J.invVecScaleInPlace(this.scale)}}var O$=function(){return n64js.hardware().cachedMemDevice.s32},jK=function(){return n64js.hardware().cachedMemDevice.u8},_J=function(J,Z,q,Q){let W=Z>>2;const K=Z+q>>2;while(W<K)Q=Q*17+J[W]>>>0,++W;return Q},kK=function(J,Z,q,Q,W){for(let K=0;K<W;++K)J[Z+0]=q[Q+0],J[Z+1]=q[Q+1],Z+=2,Q+=2},y$=function(J,Z,q,Q,W,K){J0((Z&1)==0,"tmem isn't qword aligned");for(let X=0;X<W;++X)J[Z+0^K]=q[Q+0],J[Z+1^K]=q[Q+1],Z+=2,Q+=2},E$=function(J,Z,q,Q,W,K){for(let X=0;X<W;++X)J[Z+X]=q[Q+X];for(let X=W;X<K;++X)J[Z+X]=0},T$=function(J,Z,q,Q,W,K,X){for(let Y=0;Y<W;++Y)J[Z+Y^X]=q[Q+Y];for(let Y=W;Y<K;++Y)J[Z+Y^X]=0},S$=function(J,Z,q,Q,W){for(let K=0;K<W;K++){const X=q[Q+K*2+0],Y=q[Q+K*2+1];J[Z+K*8+0]=X,J[Z+K*8+1]=Y,J[Z+K*8+2]=X,J[Z+K*8+3]=Y,J[Z+K*8+4]=X,J[Z+K*8+5]=Y,J[Z+K*8+6]=X,J[Z+K*8+7]=Y}};class vJ{constructor(){const J=new ArrayBuffer(4096);this.tmemData32=new Int32Array(J),this.tmemData=new Uint8Array(J)}loadBlock(J,Z,q,Q,W,K,X){const Y=q>>>2,z=Q>>>2,G=J.calcAddress(Y,z),H=W-q+1&4095,j=J.texelsToBytes(H),N=j+7>>>3,L=this.tmemData32;let M=G>>>2,V=Z.tmem<<3>>>2;const h=O$(),b=Z.size==d.G_IM_SIZ_32b?2:1;if(X)X.tip(`bytes ${j}, qwords ${N}`);if(K===0)kK(L,V,h,M,N);else{const C=Math.ceil(2048/K);let _=0;for(let E=0;E<N;){const S=Math.min(N-E,C);if(_)y$(L,V,h,M,S,b);else kK(L,V,h,M,S);E+=S,V+=S*2,M+=S*2,_^=1}}}loadTile(J,Z,q,Q,W,K,X){const Y=q>>>2,z=Q>>>2,G=W>>>2,H=K>>>2,j=G+1-Y,N=H+1-z,L=J.calcAddress(Y,z),M=J.texelsToBytes(j),V=J.stride(),h=this.tmemData;let b=Z.tmem<<3,C=L;const _=J.size==d.G_IM_SIZ_32b?Z.line<<4:Z.line<<3,E=Z.size==d.G_IM_SIZ_32b?8:4;if(X)X.tip(`size (${j} x ${N}), rowBytes ${M}, ramStride ${V}, tmemStride ${_}, ramOffset ${k(C)}, tmemOffset ${Z0(b)}`);const S=jK();for(let m=0;m<N;++m){if(m&1)T$(h,b,S,C,M,_,E);else E$(h,b,S,C,M,_);b+=_,C+=V}}loadTLUT(J,Z,q,Q,W,K,X){const Y=q>>>2,z=Q>>>2,G=J.calcAddress(Y,z,d.G_IM_SIZ_16b),H=r8(W,q),j=jK(),N=Z.tmem<<3;if(X)X.tip(`count ${H}, tmemOffset ${Z0(N)}`);S$(this.tmemData,N,j,G,H)}convertTexels(J,Z,q){return IW(q,this.tmemData,J,Z)}calculateCRC(J){if(J.hash)return J.hash;const Z=J.height,q=this.tmemData32,Q=J.tmem<<3;let W=J.line<<3;if(J.format==j0.G_IM_FMT_RGBA&&J.size==d.G_IM_SIZ_32b)W*=2;const K=Z*W;let X=_J(q,Q,K,0);if(J.format===j0.G_IM_FMT_CI||J.format===j0.G_IM_FMT_RGBA){if(J.size===d.G_IM_SIZ_8b)X=_J(q,2048,2048,X);else if(J.size===d.G_IM_SIZ_4b)X=_J(q,2048+J.palette*16*2,128,X)}return J.hash=X,X}}var fJ=function(J,Z){return J<<Z>>>1};class uJ{constructor(){this.ramDV=null,this.pc=0,this.pcEnd=0,this.dlistStack=[],this.cmd0=0,this.cmd1=0,this.segments=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.tiles=new Array(8),this.lights=new Array(8),this.numLights=0,this.geometryModeBits=0,this.geometryMode={zbuffer:0,texture:0,shade:0,shadeSmooth:0,cullFront:0,cullBack:0,fog:0,lighting:0,textureGen:0,textureGenLinear:0,lod:0},this.rdpOtherModeL=0,this.rdpOtherModeH=0,this.rdpHalf0Cmd0=0,this.rdpHalf0Cmd1=0,this.rdpHalf1Cmd1=0,this.rdpHalf2Cmd1=0,this.viewport=new NK,this.projection=[],this.modelview=[],this.projectedVertices=new Array(64),this.scissor={mode:0,x0:0,y0:0,x1:320,y1:240},this.texture={tile:0,level:0,scaleS:1,scaleT:1},this.combine={lo:0,hi:0},this.fillColor=0,this.envColor=0,this.primColor=0,this.blendColor=0,this.fogColor=0,this.primDepth=0,this.fogParameters=new LK,this.colorImage={format:0,size:0,width:0,address:0},this.textureImage=new MK,this.depthImage={address:0},this.tmem=new vJ,this.screenContext2d=null}reset(J,Z){this.ramDV=J,this.pc=Z,this.pcEnd=0,this.dlistStack=[],this.cmd0=0,this.cmd1=0;for(let q=0;q<this.segments.length;++q)this.segments[q]=0;this.rdpOtherModeL=5242881,this.rdpOtherModeH=0,this.projection=[r0.identity()],this.modelview=[r0.identity()],this.geometryModeBits=0,this.geometryMode.zbuffer=0,this.geometryMode.texture=0,this.geometryMode.shade=0,this.geometryMode.shadeSmooth=0,this.geometryMode.cullFront=0,this.geometryMode.cullBack=0,this.geometryMode.fog=0,this.geometryMode.lighting=0,this.geometryMode.textureGen=0,this.geometryMode.textureGenLinear=0,this.geometryMode.lod=0;for(let q=0;q<this.tiles.length;++q)this.tiles[q]=new PJ;this.numLights=0;for(let q=0;q<this.lights.length;++q)this.lights[q]={color:{r:0,g:0,b:0,a:0},dir:U0.create([1,0,0])};for(let q=0;q<this.projectedVertices.length;++q)this.projectedVertices[q]=new SJ;this.viewport.reset(),this.fogParameters.reset()}nextCommand(){if(this.pcEnd&&this.pc>=this.pcEnd)this.endDisplayList();if(this.pc==0)return!1;return this.cmd0=this.ramDV.getUint32(this.pc+0),this.cmd1=this.ramDV.getUint32(this.pc+4),this.pc+=8,!0}advanceIfCommand(J){if(this.pc==0||this.pcEnd&&this.pc>this.pcEnd)return!1;const Z=this.ramDV.getUint32(this.pc+0);if(Z>>>24!==J)return!1;return this.cmd0=Z,this.cmd1=this.ramDV.getUint32(this.pc+4),this.pc+=8,!0}executeBatch(J,Z){const q=this.cmd0>>>24,Q=J<=0;let W=0;do if(W++,!Z(this.cmd0,this.cmd1))break;while((Q||W<J)&&this.advanceIfCommand(q));return W}pushDisplayList(J,Z){const q=Z==null?0:J+Z*8;this.dlistStack.push({pc:this.pc,pcEnd:this.pcEnd}),this.pc=J,this.pcEnd=q}branchDisplayList(J){this.pc=J}endDisplayList(){if(this.dlistStack.length<=0){this.pc=0,this.pcEnd=0;return}const J=this.dlistStack.pop();this.pc=J.pc,this.pcEnd=J.pcEnd}invalidateTileHashes(){for(let J=0;J<8;++J)this.tiles[J].hash=0}rdpSegmentAddress(J){const Z=J>>>24&15;return(this.segments[Z]&8388607)+(J&8388607)}setTexture(J,Z,q,Q){this.texture.scaleS=J,this.texture.scaleT=Z,this.texture.level=q,this.texture.tile=Q}updateGeometryModeFromBits(J){const Z=this.geometryMode,q=this.geometryModeBits;Z.zbuffer=q&J.G_ZBUFFER?1:0,Z.texture=q&J.G_TEXTURE_ENABLE?1:0,Z.shade=q&J.G_SHADE?1:0,Z.shadeSmooth=q&J.G_SHADING_SMOOTH?1:0,Z.cullFront=q&J.G_CULL_FRONT?1:0,Z.cullBack=q&J.G_CULL_BACK?1:0,Z.fog=q&J.G_FOG?1:0,Z.lighting=q&J.G_LIGHTING?1:0,Z.textureGen=q&J.G_TEXTURE_GEN?1:0,Z.textureGenLinear=q&J.G_TEXTURE_GEN_LINEAR?1:0,Z.lod=q&J.G_LOD?1:0}getCycleType(){return this.rdpOtherModeH&_8}getTextureFilterType(){return this.rdpOtherModeH&f8}getTextureLUTType(){return this.rdpOtherModeH&v8}getAlphaCompareType(){return this.rdpOtherModeL&S8}getAntiAliasEnabled(){return(this.rdpOtherModeL&M0.AA_EN)!==0}getCoverageTimesAlpha(){return(this.rdpOtherModeL&M0.CVG_X_ALPHA)!==0}getAlphaCoverageSelect(){return(this.rdpOtherModeL&M0.ALPHA_CVG_SEL)!==0}}class NK{constructor(){this.reset()}reset(){const J=new U0(160,-120,1),Z=new U0(160,120,0);this.set(J,Z)}set(J,Z){this.scale=J,this.trans=Z;const q=new j6().setV3(J,1),Q=new j6().setV3(Z,0);this.transform=new q5(q,Q)}}class LK{constructor(){this.reset()}reset(){this.multiplier=0,this.offset=0}set(J,Z){this.multiplier=J,this.offset=Z}}class MK{constructor(){this.format=0,this.size=0,this.width=0,this.address=0}set(J,Z,q,Q){this.format=J,this.size=Z,this.width=q,this.address=Q}calcAddress(J,Z,q){const Q=q===void 0?this.size:q;return this.address+Z*fJ(this.width,Q)+fJ(J,Q)}texelsToBytes(J){return fJ(J,this.size)}stride(){return this.texelsToBytes(this.width)}}class C0{constructor(J,Z){this.x=J,this.y=Z}dot(J){return this.x*J.x+this.y*J.y}lengthSqr(){return this.dot(this)}length(){return Math.sqrt(this.lengthSqr())}add(J){return new C0(this.x+J.x,this.y+J.y)}sub(J){return new C0(this.x-J.x,this.y-J.y)}scale(J){return new C0(this.x*J,this.y*J)}normaliseInPlace(){const J=this.length();if(J>0)this.x/=J,this.y/=J;return this}}class xJ{constructor(J,Z){this.scale=J||new C0(1,1),this.trans=Z||new C0(0,0)}transform(J){const Z=this.scale.x*J.x+this.trans.x,q=this.scale.y*J.y+this.trans.y;return new C0(Z,q)}}class gJ{constructor(J,Z,q){this.width=Z,this.height=q,this.$canvas=$(`<canvas width="${Z}" height="${q}" />`,{width:Z,height:q}),this.texture=J.createTexture()}createScaledCanvas(J){const Z=this.width*J,q=this.height*J,Q=$('<canvas width="'+Z+'" height="'+q+'" style="background-color: black" />',{width:Z,height:q}),W=this.$canvas[0].getContext("2d"),K=Q[0].getContext("2d"),X=W.getImageData(0,0,this.width,this.height),Y=K.createImageData(Z,q),z=X.data,G=Y.data,H=X.width*4,j=Y.width*4;for(let N=0;N<q;++N){const L=H*Math.floor(N/J);let M=j*N;for(let V=0;V<Z;++V){const h=L+Math.floor(V/J)*4;G[M+0]=z[h+0],G[M+1]=z[h+1],G[M+2]=z[h+2],G[M+3]=z[h+3],M+=4}}return K.putImageData(Y,0,0),Q}}var bK=function(J){if(J<=10)return 1/(1<<J);return 1<<16-J},PK=0,mJ=1,VK=2,UK=3,hK=4,RK=new Map;class pJ{constructor(J,Z,q,Q){this.gl=J,this.state=Z,this.nativeTransform=new DK,this.textureCache=new Map,this.frameBuffer=J.createFramebuffer(),J.bindFramebuffer(J.FRAMEBUFFER,this.frameBuffer),this.frameBuffer.width=q,this.frameBuffer.height=Q,this.frameBufferTexture2D=J.createTexture(),J.bindTexture(J.TEXTURE_2D,this.frameBufferTexture2D),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.NEAREST),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.NEAREST),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),this.frameBufferTexture3D=J.createTexture(),J.bindTexture(J.TEXTURE_2D,this.frameBufferTexture3D),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.NEAREST),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.NEAREST),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texImage2D(J.TEXTURE_2D,0,J.RGBA,q,Q,0,J.RGBA,J.UNSIGNED_BYTE,null),J.framebufferTexture2D(J.FRAMEBUFFER,J.COLOR_ATTACHMENT0,J.TEXTURE_2D,this.frameBufferTexture3D,0),J.bindTexture(J.TEXTURE_2D,null);const W=J.createRenderbuffer();J.bindRenderbuffer(J.RENDERBUFFER,W),J.renderbufferStorage(J.RENDERBUFFER,J.DEPTH_COMPONENT16,q,Q),J.framebufferRenderbuffer(J.FRAMEBUFFER,J.DEPTH_ATTACHMENT,J.RENDERBUFFER,W),J.bindRenderbuffer(J.RENDERBUFFER,null),J.bindFramebuffer(J.FRAMEBUFFER,null),this.blitShaderProgram=GJ(J,"blit-shader-vs","blit-shader-fs"),this.blitSamplerUniform=J.getUniformLocation(this.blitShaderProgram,"uSampler"),this.blitVA=this.initBlitVA(this.blitShaderProgram),this.fillShaderProgram=GJ(J,"fill-shader-vs","fill-shader-fs"),this.fillFillColorUniform=J.getUniformLocation(this.fillShaderProgram,"uFillColor"),this.fillRectVA=this.initFillRectVA(this.fillShaderProgram),this.debugClearVA=this.initClearVA(this.fillShaderProgram),this.$textureOutput=$("#texture-content")}reset(){this.textureCache.clear(),this.$textureOutput.html("")}newFrame(){const J=this.gl;J.bindFramebuffer(J.FRAMEBUFFER,this.frameBuffer),J.viewport(0,0,this.frameBuffer.width,this.frameBuffer.height)}initBlitVA(J){const Z=this.gl,q=new J8(Z),Q=[-1,-1,0,1,1,-1,0,1,-1,1,0,1,1,1,0,1];q.initPosAttr(J,"aPosition"),q.setPosData(new Float32Array(Q),Z.STATIC_DRAW);const W=[0,0,1,0,0,1,1,1];return q.initUVsAttr(J,"aUV"),q.setUVData(new Float32Array(W),Z.STATIC_DRAW),q}copyTextureToFrontBuffer(J){const Z=this.gl;Z.bindFramebuffer(Z.FRAMEBUFFER,null),Z.useProgram(this.blitShaderProgram);const q=document.getElementById("display");Z.viewport(0,0,q.width,q.height),this.blitVA.bind(),Z.activeTexture(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,J),Z.uniform1i(this.blitSamplerUniform,0),Z.disable(Z.CULL_FACE),Z.disable(Z.BLEND),Z.disable(Z.DEPTH_TEST),Z.depthMask(!1),Z.drawArrays(Z.TRIANGLE_STRIP,0,4),this.blitVA.unbind()}copyBackBufferToFrontBuffer(){this.copyTextureToFrontBuffer(this.frameBufferTexture3D)}copyPixelsToFrontBuffer(J,Z,q,Q){const W=this.gl;if(W.activeTexture(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,this.frameBufferTexture2D),Q==32)W.texImage2D(W.TEXTURE_2D,0,W.RGBA,Z,q,0,W.RGBA,W.UNSIGNED_BYTE,J);else if(Q==16)W.texImage2D(W.TEXTURE_2D,0,W.RGBA,Z,q,0,W.RGBA,W.UNSIGNED_SHORT_5_5_5_1,J);this.copyTextureToFrontBuffer(this.frameBufferTexture2D)}flushTris(J){const Z=this.gl;if(J.empty())return;const q=this.state.geometryMode.texture,Q=this.state.geometryMode.lighting&&this.state.geometryMode.textureGen;if(this.setProgramState(J.positions,J.colours,J.coords,q,Q,this.state.texture.tile),this.initDepth(),this.state.geometryMode.cullFront||this.state.geometryMode.cullBack){Z.enable(Z.CULL_FACE);const W=this.state.geometryMode.cullFront?Z.FRONT:Z.BACK;Z.cullFace(W)}else Z.disable(Z.CULL_FACE);Z.drawArrays(Z.TRIANGLES,0,J.numTris*3),J.reset(),Z.bindVertexArray(null)}initClearVA(J){const Z=this.gl,q=new J8(Z),Q=[1,1,0,1,-1,1,0,1,1,-1,0,1,-1,-1,0,1];return q.initPosAttr(J,"aPosition"),q.setPosData(new Float32Array(Q),Z.STATIC_DRAW),q}debugClear(){const J=this.gl;J.useProgram(this.fillShaderProgram),this.debugClearVA.bind(),J.uniform4f(this.fillFillColorUniform,1,0,1,1),J.disable(J.BLEND),J.disable(J.CULL_FACE),J.disable(J.DEPTH_TEST),J.depthMask(!1),J.drawArrays(J.TRIANGLE_STRIP,0,4),this.debugClearVA.unbind()}initFillRectVA(J){const Z=this.gl,q=new J8(Z);return q.initPosAttr(J,"aPosition"),q.setPosData(new Float32Array(16),Z.DYNAMIC_DRAW),q}fillRect(J,Z,q,Q,W){const K=this.gl;this.setGLBlendMode();const X=this.nativeTransform.convertN64ToDisplay(new C0(J,Z)),Y=this.nativeTransform.convertN64ToDisplay(new C0(q,Q)),z=[Y.x,Y.y,0,1,X.x,Y.y,0,1,Y.x,X.y,0,1,X.x,X.y,0,1];K.useProgram(this.fillShaderProgram),this.fillRectVA.bind(),this.fillRectVA.setPosData(new Float32Array(z),K.DYNAMIC_DRAW),K.uniform4f(this.fillFillColorUniform,W.r,W.g,W.b,W.a),K.disable(K.CULL_FACE),K.disable(K.DEPTH_TEST),K.depthMask(!1),K.drawArrays(K.TRIANGLE_STRIP,0,4),this.fillRectVA.unbind()}calculateRectVertices(J,Z,q,Q){const W=this.nativeTransform.convertN64ToDisplay(new C0(J,Z)),K=this.nativeTransform.convertN64ToDisplay(new C0(q,Q)),Y=(this.state.rdpOtherModeL&R9.G_ZS_PRIM)!==0?this.state.primDepth:0;return[W.x,W.y,Y,1,K.x,W.y,Y,1,W.x,K.y,Y,1,K.x,K.y,Y,1]}lleRect(J,Z,q,Q){const W=this.gl;if(this.setProgramState(new Float32Array(Z),new Uint32Array(Q),new Float32Array(q),!0,!1,J),W.disable(W.CULL_FACE),(this.state.rdpOtherModeL&R9.G_ZS_PRIM)!==0?!0:!1)this.initDepth();else W.disable(W.DEPTH_TEST),W.depthMask(!1);W.drawArrays(W.TRIANGLE_STRIP,0,4),W.bindVertexArray(null)}texRect(J,Z,q,Q,W,K,X,Y,z,G){const H=this.calculateRectVertices(Z,q,Q,W);let j;if(G)j=[K,X,K,z,Y,X,Y,z];else j=[K,X,Y,X,K,z,Y,z];const N=[4294967295,4294967295,4294967295,4294967295];this.lleRect(J,H,j,N)}texRectRot(J,Z,q,Q,W,K,X,Y,z,G,H,j,N){const L=this.nativeTransform.convertN64ToDisplay(new C0(Z,q)),M=this.nativeTransform.convertN64ToDisplay(new C0(Q,W)),V=this.nativeTransform.convertN64ToDisplay(new C0(K,X)),h=this.nativeTransform.convertN64ToDisplay(new C0(Y,z)),C=(this.state.rdpOtherModeL&R9.G_ZS_PRIM)!==0?this.state.primDepth:0,_=[L.x,L.y,C,1,M.x,M.y,C,1,V.x,V.y,C,1,h.x,h.y,C,1],E=[G,H,j,H,G,N,j,N],S=[4294967295,4294967295,4294967295,4294967295];this.lleRect(J,_,E,S)}initDepth(){const J=this.gl,Z=this.state.geometryMode.zbuffer!==0,q=(this.state.rdpOtherModeL&M0.Z_CMP)!==0,Q=(this.state.rdpOtherModeL&M0.Z_UPD)!==0;if(Z&&q||Q)J.enable(J.DEPTH_TEST),J.depthFunc(J.LEQUAL);else J.disable(J.DEPTH_TEST);J.depthMask(Q)}setProgramState(J,Z,q,Q,W,K){const X=this.gl;this.setGLBlendMode();const Y=this.state.getCycleType();let z,G,H,j;if(Q){const h=K+0&7,b=K+1&7;z=this.state.tiles[h],G=this.state.tiles[b],H=this.lookupTexture(h),j=Y==k0.G_CYC_2CYCLE?this.lookupTexture(b):null}const N=(this.state.getAlphaCompareType()&e9.G_AC_THRESHOLD)!=0,L=this.state.getAntiAliasEnabled()&&this.state.getCoverageTimesAlpha();let M=0;if(N)M=(this.state.blendColor>>>0&255)/255;else if(L)M=0;const V=this.getCurrentN64Shader();X.useProgram(V.program),V.vertexArray.bind(),V.vertexArray.setPosData(J,X.DYNAMIC_DRAW),V.vertexArray.setColorData(Z,X.DYNAMIC_DRAW),V.vertexArray.setUVData(q,X.DYNAMIC_DRAW),this.bindTexture(0,X.TEXTURE0,z,H,W,V.uSamplerUniform0,V.uTexScaleUniform0,V.uTexOffsetUniform0),this.bindTexture(1,X.TEXTURE1,G,j,W,V.uSamplerUniform1,V.uTexScaleUniform1,V.uTexOffsetUniform1),X.uniform1f(V.uAlphaThresholdUniform,M),X.uniform4f(V.uPrimColorUniform,(this.state.primColor>>>24&255)/255,(this.state.primColor>>>16&255)/255,(this.state.primColor>>>8&255)/255,(this.state.primColor>>>0&255)/255),X.uniform4f(V.uEnvColorUniform,(this.state.envColor>>>24&255)/255,(this.state.envColor>>>16&255)/255,(this.state.envColor>>>8&255)/255,(this.state.envColor>>>0&255)/255)}getCurrentN64Shader(){const J=this.state.combine.hi,Z=this.state.combine.lo,q=this.state.getCycleType(),Q=(this.state.getAlphaCompareType()&e9.G_AC_THRESHOLD)!=0,W=this.state.getAntiAliasEnabled()&&this.state.getCoverageTimesAlpha();return xW(this.gl,J,Z,q,Q||W)}lookupTexture(J){const Z=this.state.tiles[J];if(Z.line===0)return null;const q=this.state.tmem.calculateCRC(Z),Q=`${k(q)}_${Z.format}_${Z.size}_${Z.width}_${Z.height}_${Z.palette}`;if(this.textureCache.has(Q))return this.textureCache.get(Q);const W=this.decodeTexture(Z,this.state.getTextureLUTType(),Q);return this.textureCache.set(Q,W),W}decodeTexture(J,Z,q){const Q=this.gl;if(J.width==0||J.height==0)return null;const W=new gJ(Q,J.width,J.height);if(!W.$canvas[0].getContext)return null;this.$textureOutput.append(`${q}: ${j0.nameOf(J.format)}, ${d.nameOf(J.size)},${J.width}x${J.height}, <br>`);const K=W.$canvas[0].getContext("2d"),X=K.createImageData(W.width,W.height);if(this.state.tmem.convertTexels(J,Z,X))K.putImageData(X,0,0),this.$textureOutput.append(W.$canvas),this.$textureOutput.append("<br>");else{const z=`${j0.nameOf(J.format)}/${d.nameOf(J.size)} is unhandled`;this.$textureOutput.append(z),this.hleHalt(z)}return Q.activeTexture(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,W.texture),Q.texImage2D(Q.TEXTURE_2D,0,Q.RGBA,Q.RGBA,Q.UNSIGNED_BYTE,W.$canvas[0]),Q.generateMipmap(Q.TEXTURE_2D),Q.bindTexture(Q.TEXTURE_2D,null),W}bindTexture(J,Z,q,Q,W,K,X,Y){const z=this.gl;if(z.activeTexture(Z),!Q){z.bindTexture(z.TEXTURE_2D,null);return}let{left:G,top:H}=q,j=1/Q.width,N=1/Q.height;if(Q.width===56&&Q.height===29)j*=0.5,N*=0.5;if(W)j=1,N=1,G=0,H=0;if(j*=bK(q.shiftS),N*=bK(q.shiftT),z.bindTexture(z.TEXTURE_2D,Q.texture),z.uniform1i(K,J),z.uniform2f(X,j,N),z.uniform2f(Y,G,H),this.state.getTextureFilterType()==a8.G_TF_POINT)z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.NEAREST),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.NEAREST_MIPMAP_NEAREST);else z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.LINEAR_MIPMAP_NEAREST);const L=q.cmS===h9||q.maskS===0,M=q.cmT===h9||q.maskT===0,V=q.cmS===i4,h=q.cmT===i4,b=L?z.CLAMP_TO_EDGE:V?z.MIRRORED_REPEAT:z.REPEAT,C=M?z.CLAMP_TO_EDGE:h?z.MIRRORED_REPEAT:z.REPEAT;z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,b),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,C)}setGLBlendMode(){const J=this.gl,Z=this.state.getCoverageTimesAlpha(),q=this.state.getAlphaCoverageSelect(),Q=this.state.getCycleType();if(Q==k0.G_CYC_FILL||Q==k0.G_CYC_COPY){J.disable(J.BLEND);return}const W=this.state.rdpOtherModeL>>ZJ,K=(Q===k0.G_CYC_2CYCLE?W:W>>>2)&13107;let X=PK;switch(K){case 0:case 770:X=mJ;break;case 16:case 17:if(!q||Z)X=VK;break;case 272:X=mJ;break;case 784:case 4880:X=UK;break;case 12560:X=hK;break}let Y=!1;switch(X){case mJ:J.disable(J.BLEND);break;case VK:J.blendFunc(J.SRC_ALPHA,J.ONE_MINUS_SRC_ALPHA),J.blendEquation(J.FUNC_ADD),J.enable(J.BLEND);break;case UK:J.blendFunc(J.ZERO,J.ONE_MINUS_SRC_ALPHA),J.blendEquation(J.FUNC_ADD),J.enable(J.BLEND);break;case hK:Y=!0,J.disable(J.BLEND);break;case PK:Y=!0,J.disable(J.BLEND);break}if(Y)this.logUnhandledBlendMode(K,q,Z)}logUnhandledBlendMode(J,Z,q){if(RK.get(J))return;RK.set(J,!0),n64js.warn(`Unhandled blend mode: ${Z0(J)} = ${Q7(J)}, alphaCvgSel ${Z}, cvgXAlpha ${q}`)}}class DK{constructor(){this.initDimensions(320,240)}initDimensions(J,Z){this.viWidth=J,this.viHeight=Z,this.n64FramebufferToDevice=new xJ(new C0(2/J,-2/Z),new C0(-1,1));const q=J/2,Q=Z/2,W=512,K=511,X=new j6(q,-Q,W,1),Y=new j6(q,+Q,K,0);this.viTransform=new q5(X,Y)}convertN64ToDisplay(J){return this.n64FramebufferToDevice.transform(J)}}function BK(J){i0.initUI();const Z=J[0];if(_$(Z),!Q9)return;I6=new pJ(Q9,s0,640,480),I6.hleHalt=vK,i0.renderer=I6}function IK(){if(I6)I6.reset()}var _$=function(J){if(Q9)return;try{Q9=J.getContext("webgl2")}catch(Z){}if(!Q9)alert("Unable to initialize WebGL. Your browser may not support it.")};function CK(){return i0.running}function OK(){return i0.requested}function yK(){i0.toggle()}function EK(){i0.debugDisplayList()}function TK(J){i0.onNewTask(J),SK(J,null,-1)}function J3(){n64js.onPresent();const J=n64js.hardware(),Z=J.viRegDevice;if(J.timeline.addEvent(`Present ${k(Z.dramAddrReg)}`),wK!==0){I6.copyBackBufferToFrontBuffer();return}_K(Z);const q=Z.renderBackBuffer();if(!q)return;I6.copyPixelsToFrontBuffer(q,Z.screenWidth,Z.screenHeight,Z.bitDepth)}var SK=function(J,Z,q){if(wK++,!Q9)return;const Q=n64js.hardware(),W=Q.cachedMemDevice.mem.dataView;s0.reset(W,J.dataPtr);let K=AK(J,W),X=K.buildCommandTable();if(K.onLoadUcode((Y,z,G,H)=>{return J.loadUcode(Y,z,G,H),K=AK(J,W),X=K.buildCommandTable(),K}),_K(Q.viRegDevice),I6.newFrame(),i0.running)I6.debugClear();if(Z){i0.currentOp=0;while(s0.nextCommand())Z.begin(s0.cmd0,s0.cmd1,s0.dlistStack.length),X[s0.cmd0>>>24](s0.cmd0,s0.cmd1,Z),Z.end(),i0.currentOp++}else{i0.currentOp=0;while(s0.nextCommand())if(X[s0.cmd0>>>24](s0.cmd0,s0.cmd1),i0.postOp(q))break}Q9.bindFramebuffer(Q9.FRAMEBUFFER,null)},_K=function(J){const Z=J.computeDimensions();if(!Z)return;I6.nativeTransform.initDimensions(Z.srcWidth,Z.srcHeight);const q=document.getElementById("display");q.width=Z.screenWidth*B0.canvasScale,q.height=Z.screenHeight*B0.canvasScale},AK=function(J,Z){const q=$K(J,s0,Z);return q.debugController=i0,q.hleHalt=vK,q.gl=Q9,q.renderer=I6,q},vK=function(J){if(i0.running)return;n64js.ui().displayWarning(J),n64js.breakEmulationForDisplayListDebug(),i0.halt()};window.n64js=window.n64js||{};var wK=0,Q9=null,I6,s0=new uJ,i0=new kJ(s0,SK);var aJ={emulationMode:"LLE"},v$=J6.addFolder("Audio");v$.add(aJ,"emulationMode",{LLE:"LLE",Disabled:"Disabled"}).name("Emulation Mode");function uK(){const J=n64js.hardware(),Z=J.cachedMemDevice.u8,q=J.sp_mem.subRegion(f$,u$),Q=new fK(Z,q);let W=!1;switch(Q.type){case x$:if(B0.emulationMode=="HLE"){const K=J.timeline.startEvent(`HLE Task ${Q.detectVersionString()}`);if(TK(Q),J.miRegDevice.interruptDP(),K)K.stop();W=!0}break;case g$:if(aJ.emulationMode=="Disabled")W=!0;break;case m$:break;case p$:break}return W}var f$=4032,u$=64,C9=t({type:0,flags:4,ucodeBootPtr:8,ucodeBootSize:12,ucodePtr:16,ucodeSize:20,ucodeDataPtr:24,ucodeDataSize:28,dramStackPtr:32,dramStackSize:36,outputBuffPtr:40,outputBuffSize:44,dataPtr:48,dataSize:52,yieldDataPtr:56,yieldDataSize:60}),x$=1,g$=2,m$=3,p$=4;class fK{constructor(J,Z){this.ram_u8=J,this.type=Z.getU32(C9.type),this.codeAddr=Z.getU32(C9.ucodePtr)&536870911,this.codeSize=this.clampCodeSize(Z.getU32(C9.ucodeSize)),this.codeDataAddr=Z.getU32(C9.ucodeDataPtr)&536870911,this.codeDataSize=Z.getU32(C9.ucodeDataSize),this.dataPtr=Z.getU32(C9.dataPtr)}dumpCode(){const J=n64js.hardware().cachedMemDevice.mem,q=o2(J,4224,this.codeAddr,this.codeSize);let Q=`${this.detectVersionString()}\n`;for(let W of q)Q+=`${v(W.address,16)} ${W.disassembly}\n`;Q+="\nDMEM\n",Q+=YW(J,0,this.codeDataAddr,this.codeDataSize),console.log(Q)}loadUcode(J,Z,q,Q){this.codeAddr=J&536870911,this.codeSize=this.clampCodeSize(Z),this.codeDataAddr=q&536870911,this.codeDataSize=Q}clampCodeSize(J){if(J==0||J>4096)return 4096;return J}dataByte(J){return this.ram_u8[this.codeDataAddr+J]}codeByte(J){return this.ram_u8[this.codeAddr+J]}detectVersionString(){const J="R".charCodeAt(0),Z="S".charCodeAt(0),q="P".charCodeAt(0);for(let Q=0;Q+2<this.codeDataSize;++Q)if(this.dataByte(Q+0)===J&&this.dataByte(Q+1)===Z&&this.dataByte(Q+2)===q){let W="";for(let K=Q;K<this.codeDataSize;++K){const X=this.dataByte(K);if(X===0)break;if(X>=32)W+=String.fromCharCode(X)}return W}return""}computeMicrocodeHash(){let J=0;for(let Z=0;Z<this.codeSize;++Z)J=J*17+this.codeByte(Z)>>>0;return J}}class C6{constructor(J){this.msg=J}toString(){return this.msg}}class cJ{constructor(){this.cyclesToFirstEvent=0,this.firstEvent=null}reset(){this.cyclesToFirstEvent=0,this.firstEvent=null}nextEventCountdown(){return this.cyclesToFirstEvent}incrementCount(J){this.cyclesToFirstEvent-=J;while(this.cyclesToFirstEvent<=0){const Z=this.firstEvent;if(!Z)break;this.unlink(Z),Z.handler()}}unlink(J){if(J.prev)J.prev.cyclesToNextEvent=J.next?J.prev.cyclesToNextEvent+J.cyclesToNextEvent:0,J.prev.next=J.next;else this.cyclesToFirstEvent=J.next?this.cyclesToFirstEvent+J.cyclesToNextEvent:0,this.firstEvent=J.next;if(J.next)J.next.prev=J.prev;J.prev=null,J.next=null}insertAfter(J,Z,q,Q){const W=J?J.next:this.firstEvent;if(q.cyclesToNextEvent=W?Z-Q:0,J0(q.cyclesToNextEvent>=0,"cyclesToNextEvent must be positive or zero"),q.next=W,q.prev=J,W)W.prev=q;if(J)J.cyclesToNextEvent=Q,J.next=q;else this.cyclesToFirstEvent=Q,this.firstEvent=q}skipToNextEvent(J){if(!this.firstEvent||this.cyclesToFirstEvent<J)return 0;const Z=this.cyclesToFirstEvent-J;return this.cyclesToFirstEvent=J,Z}addEvent(J,Z,q){J0(!this.hasEvent(J),`Already has event of type ${J}`),J0(Z>0,"cycles must be positive");const Q=new xK(J,q);let W=null,K=this.cyclesToFirstEvent;for(let X=this.firstEvent;X;X=X.next){if(Z<=K){this.insertAfter(W,K,Q,Z);return}Z-=K,K=X.cyclesToNextEvent,W=X}this.insertAfter(W,K,Q,Z)}removeEvent(J){let Z=this.cyclesToFirstEvent;for(let q=this.firstEvent;q;q=q.next){if(q.type==J)return this.unlink(q),Z;Z+=q.cyclesToNextEvent}return-1}getEvent(J){for(let Z=this.firstEvent;Z;Z=Z.next)if(Z.type==J)return Z;return null}getCyclesUntilEvent(J){let Z=this.cyclesToFirstEvent;for(let q=this.firstEvent;q;q=q.next){if(q.type==J)return Z;Z+=q.cyclesToNextEvent}return-1}hasEvent(J){return Boolean(this.getEvent(J))}}class xK{constructor(J,Z){this.type=J,this.cyclesToNextEvent=0,this.handler=Z,this.prev=null,this.next=null}getName(){return this.type}}function gK(J,Z){Z6=J.memMap.getMemoryHandler.bind(J.memMap),M6=J.cachedMemDevice.mem.dataView,W9=Z}function Z3(J,Z,q){Z6(J).write32masked(J,Z,q)}function q3(J,Z,q){Z6(J).write64masked(J,Z,q)}function oJ(J){if(J<-2139095040){const Z=J+2147483648|0;return M6.getUint8(Z,!1)}return a$(J>>>0)}function dJ(J){if(J<-2139095040){const Z=J+2147483648|0;return M6.getInt8(Z,!1)}return n$(J>>>0)}function nJ(J){if((J&1)==0&&J<-2139095040){const Z=J+2147483648|0;return M6.getUint16(Z,!1)}return c$(J>>>0)}function lJ(J){if((J&1)==0&&J<-2139095040){const Z=J+2147483648|0;return M6.getInt16(Z,!1)}return l$(J>>>0)}function i8(J){if((J&3)==0&&J<-2139095040){const Z=J+2147483648|0;return M6.getUint32(Z,!1)}return o$(J>>>0)}function Q5(J){if((J&3)==0&&J<-2139095040){const Z=J+2147483648|0;return M6.getInt32(Z,!1)}return r$(J>>>0)}function q8(J){if((J&7)==0&&J<-2139095040){const Z=J+2147483648|0;return M6.getBigUint64(Z,!1)}return d$(J>>>0)}function rJ(J,Z){if(J<-2139095040){const q=J+2147483648|0;M6.setUint8(q,Z,!1);return}s$(J>>>0,Z)}function sJ(J,Z){if((J&1)==0&&J<-2139095040){const q=J+2147483648|0;M6.setUint16(q,Z,!1);return}i$(J>>>0,Z)}function W5(J,Z){if((J&3)==0&&J<-2139095040){const q=J+2147483648|0;M6.setUint32(q,Z,!1);return}t$(J>>>0,Z)}function K5(J,Z){if((J&7)==0&&J<-2139095040){const q=J+2147483648|0;M6.setBigUint64(q,Z,!1);return}e$(J>>>0,Z)}var a$=function(J){return Z6(J).readU8(J)},c$=function(J){if(J&1)W9.unalignedLoad(J);return Z6(J).readU16(J)},o$=function(J){if(J&3)W9.unalignedLoad(J);return Z6(J).readU32(J)},d$=function(J){if(J&7)W9.unalignedLoad(J);return Z6(J).readU64(J)},n$=function(J){return Z6(J).readU8(J)<<24>>24},l$=function(J){if(J&1)W9.unalignedLoad(J);return Z6(J).readU16(J)<<16>>16};function r$(J){if(J&3)W9.unalignedLoad(J);return Z6(J).readU32(J)>>0}var s$=function(J,Z){Z6(J).write8(J,Z)},i$=function(J,Z){if(J&1)W9.unalignedStore(J);Z6(J).write16(J,Z)},t$=function(J,Z){if(J&3)W9.unalignedStore(J);Z6(J).write32(J,Z)},e$=function(J,Z){if(J&7)W9.unalignedStore(J);Z6(J).write64(J,Z)},Z6,M6,W9;var t8=!0,Q8=!1;var Gj=function(J){return J<<zj},$j=function(J){return J<<MX},jj=function(J){return J<<PX},O6=function(J){const Z=J&U3,q=J&kj;if(Z==U3){if(q==0)return J&Y8?X9:K9;return J&Nj?N6:Y9}if(Z==0){if(q!=0)return y6;return J&Y8?Q1:q1}return hX},o6=function(J){const Z=J&h3,q=J&Mj;if(Z==h3){if(q==0)return J&z8?X9:K9;return J&Pj?N6:Y9}if(Z==0){if(q!=0)return y6;return J&z8?Q1:q1}return hX},V3=function(J){return J==N6||J==Y9},W8=function(J){return J==q1||J==Q1},d6=function(J){return J==K9||J==X9},Z1=function(J,Z,q){return J[Z*2+(q?1:0)]},RX=function(J){if(J.length!=8)throw"Case table is unexpected size.";return J},zX=function(J,Z){return J[Z]},W1=function(J){if(J.length!=R3)throw"Case table is unexpected size.";return J},$X=function(J,Z,q){return J[Z*R3+q]},b3=function(J){if(J.length!=R3*R3)throw"Case table is unexpected size.";return J},mK=0,pK=1,aK=2,cK=3,oK=4,dK=5,nK=6,lK=7,Q3=8,W3=9,K3=10,X3=11,Y3=12,z3=13,F3=14,H3=15,G3=32,$3=33,j3=36,k3=37,Zj=0,qj=1,Qj=2,Wj=3;var Kj=128,Xj=256;var rK=131072,sK=8388608,Yj=16777216,N3=3,O0=1,L3=2,X5=4,iK=8,c6=16,zj=2,MX=7,PX=12;var Fj=3968,tK=258048,Hj=25427967,Y8=2147483648,U3=2139095040,kj=8388607,Nj=1<<22,M3=2143289343,iJ=0,tJ=Y8,VX=8388608,Lj=Y8|VX,eK=U3,JX=Y8|U3,z8=0x8000_0000_0000_0000n,h3=0x7ff0_0000_0000_0000n,Mj=0x000f_ffff_ffff_ffffn,Pj=1n<<51n,P3=0x7ff7_ffff_ffff_ffffn,eJ=0n,J1=z8,UX=0x0010_0000_0000_0000n,Vj=z8|UX,ZX=h3,qX=z8|h3,QX=Number.MAX_SAFE_INTEGER,WX=Number.MIN_SAFE_INTEGER,KX=2147483647,XX=-2147483648,hX=0,q1=1,Q1=2,K9=3,X9=4,N6=5,Y9=6,y6=7,R3=8,YX=RX([tJ,iJ,tJ,iJ,tJ,VX,Lj,iJ]),Uj=RX([J1,eJ,J1,eJ,J1,UX,Vj,eJ]),T=0,A=1,n6=2,X0=3,Q0=4,y0=5,k6=6,e8=7,K8=8,X8=9,FX=W1([e8,e8,e8,e8,T,T,A,A]),HX=W1([K8,K8,K8,K8,K8,T,A,A]),GX=W1([X8,X8,X8,X8,X8,T,A,A]),jX=b3([X0,X0,X0,X0,X0,T,A,A,X0,X0,X0,X0,X0,T,A,A,X0,X0,X0,X0,X0,T,A,A,X0,X0,X0,X0,T,T,A,A,X0,X0,X0,T,X0,T,A,A,T,T,T,T,T,T,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A]),kX=b3([Q0,Q0,Q0,Q0,Q0,T,A,A,Q0,Q0,Q0,Q0,Q0,T,A,A,Q0,Q0,Q0,Q0,Q0,T,A,A,Q0,Q0,Q0,Q0,Q0,T,A,A,Q0,Q0,Q0,Q0,Q0,T,A,A,T,T,T,T,T,T,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A]),NX=b3([y0,y0,y0,y0,y0,T,A,A,y0,y0,y0,T,T,T,A,A,y0,y0,y0,T,T,T,A,A,y0,T,T,y0,y0,T,A,A,y0,T,T,y0,y0,T,A,A,T,T,T,T,T,T,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A]),LX=b3([k6,n6,n6,k6,k6,T,A,A,k6,T,n6,k6,k6,T,A,A,k6,T,n6,k6,k6,T,A,A,k6,n6,n6,T,T,T,A,A,k6,n6,n6,T,T,T,A,A,T,T,T,T,T,T,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A]),P6=0,E6=1,T6=2,S6=3;class K1{constructor(J){this.hardware=J,this.control=new Uint32Array(32),this.mem=new ArrayBuffer(256),this.regF32=new Float32Array(this.mem),this.regF64=new Float64Array(this.mem),this.regS32=new Int32Array(this.mem),this.regU32=new Uint32Array(this.mem),this.regS64=new BigInt64Array(this.mem),this.regU64=new BigUint64Array(this.mem),this.regIdx32_cop=new Uint8Array(new ArrayBuffer(32)),this.regIdx32_d=new Uint8Array(new ArrayBuffer(32)),this.regIdx32_s=new Uint8Array(new ArrayBuffer(32)),this.regIdx32_t=new Uint8Array(new ArrayBuffer(32)),this.regIdx64_cop=new Uint8Array(new ArrayBuffer(32)),this.regIdx64_d=new Uint8Array(new ArrayBuffer(32)),this.regIdx64_s=new Uint8Array(new ArrayBuffer(32)),this.regIdx64_t=new Uint8Array(new ArrayBuffer(32)),this.tempBuf=new ArrayBuffer(8),this.tempF32=new Float32Array(this.tempBuf),this.tempF64=new Float64Array(this.tempBuf),this.tempU32=new Uint32Array(this.tempBuf),this.tempS32=new Int32Array(this.tempBuf),this.tempU64=new BigUint64Array(this.tempBuf),this.tempS64=new BigInt64Array(this.tempBuf),this._fullMode=!0,this.fullMode=!0,this.reset()}reset(){for(let J=0;J<32;++J)this.control[J]=0,this.regS64[J]=0n;this.control[0]=2560,this.fullMode=!0}set fullMode(J){if(this._fullMode=J,this._fullMode)for(let Z=0;Z<32;Z++)this.regIdx32_cop[Z]=Z*2,this.regIdx32_d[Z]=Z*2,this.regIdx32_s[Z]=Z*2,this.regIdx32_t[Z]=Z*2,this.regIdx64_cop[Z]=Z,this.regIdx64_d[Z]=Z,this.regIdx64_s[Z]=Z,this.regIdx64_t[Z]=Z;else for(let Z=0;Z<32;Z++){const q=Z&~1;this.regIdx32_cop[Z]=q*2+(Z&1),this.regIdx32_d[Z]=Z*2,this.regIdx32_s[Z]=q*2,this.regIdx32_t[Z]=Z*2,this.regIdx64_cop[Z]=q,this.regIdx64_d[Z]=Z,this.regIdx64_s[Z]=q,this.regIdx64_t[Z]=Z}}execSInstr(J,Z,q,Q){if(J<48){switch(J){case mK:this.ADD_S(Z,q,Q);return;case pK:this.SUB_S(Z,q,Q);return;case aK:this.MUL_S(Z,q,Q);return;case cK:this.DIV_S(Z,q,Q);return;case oK:this.SQRT_S(Z,q);return;case dK:this.ABS_S(Z,q);return;case nK:this.MOV_S(Z,q);return;case lK:this.NEG_S(Z,q);return;case Q3:this.ConvertSToL(Z,q,P6);return;case W3:this.ConvertSToL(Z,q,E6);return;case K3:this.ConvertSToL(Z,q,T6);return;case X3:this.ConvertSToL(Z,q,S6);return;case Y3:this.ConvertSToW(Z,q,P6);return;case z3:this.ConvertSToW(Z,q,E6);return;case F3:this.ConvertSToW(Z,q,T6);return;case H3:this.ConvertSToW(Z,q,S6);return;case G3:this.raiseUnimplemented();return;case $3:this.CVT_D_S(Z,q);return;case j3:this.ConvertSToW(Z,q,this.roundingMode);return;case k3:this.ConvertSToL(Z,q,this.roundingMode);return}J0(!1,"unhandled S instruction"),this.raiseUnimplemented()}else this.handleFloatCompareSingle(J,q,Q)}execDInstr(J,Z,q,Q){if(J<48){switch(J){case mK:this.ADD_D(Z,q,Q);return;case pK:this.SUB_D(Z,q,Q);return;case aK:this.MUL_D(Z,q,Q);return;case cK:this.DIV_D(Z,q,Q);return;case oK:this.SQRT_D(Z,q);return;case dK:this.ABS_D(Z,q);return;case nK:this.MOV_D(Z,q);return;case lK:this.NEG_D(Z,q);return;case Q3:this.ConvertDToL(Z,q,P6);return;case W3:this.ConvertDToL(Z,q,E6);return;case K3:this.ConvertDToL(Z,q,T6);return;case X3:this.ConvertDToL(Z,q,S6);return;case Y3:this.ConvertDToW(Z,q,P6);return;case z3:this.ConvertDToW(Z,q,E6);return;case F3:this.ConvertDToW(Z,q,T6);return;case H3:this.ConvertDToW(Z,q,S6);return;case G3:this.CVT_S_D(Z,q);return;case $3:this.raiseUnimplemented();return;case j3:this.ConvertDToW(Z,q,this.roundingMode);return;case k3:this.ConvertDToL(Z,q,this.roundingMode);return}J0(!1,"unhandled D instruction"),this.raiseUnimplemented()}else this.handleFloatCompareDouble(J,q,Q)}execWInstr(J,Z,q,Q){switch(J){case Q3:this.raiseUnimplemented();return;case W3:this.raiseUnimplemented();return;case K3:this.raiseUnimplemented();return;case X3:this.raiseUnimplemented();return;case Y3:this.raiseUnimplemented();return;case z3:this.raiseUnimplemented();return;case F3:this.raiseUnimplemented();return;case H3:this.raiseUnimplemented();return;case G3:this.CVT_S_W(Z,q);return;case $3:this.CVT_D_W(Z,q);return;case j3:this.raiseUnimplemented();return;case k3:this.raiseUnimplemented();return}J0(!1,"unhandled W instruction"),this.raiseUnimplemented()}execLInstr(J,Z,q,Q){switch(J){case Q3:this.raiseUnimplemented();return;case W3:this.raiseUnimplemented();return;case K3:this.raiseUnimplemented();return;case X3:this.raiseUnimplemented();return;case Y3:this.raiseUnimplemented();return;case z3:this.raiseUnimplemented();return;case F3:this.raiseUnimplemented();return;case H3:this.raiseUnimplemented();return;case G3:this.CVT_S_L(Z,q);return;case $3:this.CVT_D_L(Z,q);return;case j3:this.raiseUnimplemented();return;case k3:this.raiseUnimplemented();return}J0(!1,"unhandled L instruction"),this.raiseUnimplemented()}handleFloatCompareSingle(J,Z,q){const Q=O6(this.loadU32(this.fsRegIdx32(Z))),W=O6(this.loadU32(this.ftRegIdx32(q)));let K=!1;if(V3(Q)||V3(W)){if(J&8||Q==N6||W==N6){if(this.raiseException(c6))return}if(J&1)K=!0}else{const X=this.loadF32(this.fsRegIdx32(Z)),Y=this.loadF32(this.ftRegIdx32(q));if(J&4)K|=X<Y;if(J&2)K|=X==Y}this.setCondition(K)}handleFloatCompareDouble(J,Z,q){const Q=o6(this.loadU64(this.fsRegIdx64(Z))),W=o6(this.loadU64(this.ftRegIdx64(q)));let K=!1;if(V3(Q)||V3(W)){if(J&8||Q==N6||W==N6){if(this.raiseException(c6))return}if(J&1)K=!0}else{const X=this.loadF64(this.fsRegIdx64(Z)),Y=this.loadF64(this.ftRegIdx64(q));if(J&4)K|=X<Y;if(J&2)K|=X==Y}this.setCondition(K)}DCFC1(J,Z){this.clearCause(),this.raiseUnimplemented()}DCTC1(J,Z){this.clearCause(),this.raiseUnimplemented()}MOV_S(J,Z){this.store64(this.fdRegIdx64(J),this.loadU64(this.fsRegIdx64(Z)))}SQRT_S(J,Z){this.f32UnaryOp(J,Z,FX)}ABS_S(J,Z){this.f32UnaryOp(J,Z,HX)}NEG_S(J,Z){this.f32UnaryOp(J,Z,GX)}ADD_S(J,Z,q){this.f32BinaryOp(J,Z,q,jX)}SUB_S(J,Z,q){this.f32BinaryOp(J,Z,q,kX)}MUL_S(J,Z,q){this.f32BinaryOp(J,Z,q,NX)}DIV_S(J,Z,q){this.f32BinaryOp(J,Z,q,LX)}MOV_D(J,Z){this.store64(this.fdRegIdx64(J),this.loadU64(this.fsRegIdx64(Z)))}SQRT_D(J,Z){this.f64UnaryOp(J,Z,FX)}ABS_D(J,Z){this.f64UnaryOp(J,Z,HX)}NEG_D(J,Z){this.f64UnaryOp(J,Z,GX)}ADD_D(J,Z,q){this.f64BinaryOp(J,Z,q,jX)}SUB_D(J,Z,q){this.f64BinaryOp(J,Z,q,kX)}MUL_D(J,Z,q){this.f64BinaryOp(J,Z,q,NX)}DIV_D(J,Z,q){this.f64BinaryOp(J,Z,q,LX)}CVT_S_D(J,Z){this.clearCause();const q=o6(this.loadU64(this.fsRegIdx64(Z)));let Q=0;switch(q){case Y9:case y6:this.raiseUnimplemented();return;case N6:Q|=c6,this.tempU32[0]=M3;break;case K9:this.tempU32[0]=eK;break;case X9:this.tempU32[0]=JX;break;default:{const W=this.loadF64(this.fsRegIdx64(Z));this.tempF32[0]=W;const K=O6(this.tempU32[0]);if(W!=this.tempF32[0])Q|=O0;if((K==y6||W8(K))&&W!=0)Q|=O0|L3,this.tempU32[0]=Z1(YX,this.control[31]&N3,W>0);if(!isFinite(this.tempF32[0]))Q|=X5}break}if(this.raiseException(Q))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}CVT_S_W(J,Z){this.clearCause();const q=this.loadS32(this.fsRegIdx32(Z));this.tempF32[0]=q;let Q=0;if(q!=this.tempF32[0])Q|=O0;if(this.raiseException(Q))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}CVT_S_L(J,Z){this.clearCause();const q=this.loadS64(this.fsRegIdx64(Z));if(q>=1n<<55n||q<-(1n<<55n)){this.raiseUnimplemented();return}this.tempF32[0]=Number(q);let Q=0;if(q!=this.tempF32[0])Q|=O0;if(this.raiseException(Q))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}f32UnaryOp(J,Z,q){this.clearCause();const Q=this.loadF32(this.fsRegIdx32(Z)),W=O6(this.loadU32(this.fsRegIdx32(Z))),K=zX(q,W);let X;switch(K){case A:this.raiseUnimplemented();return;case T:if(!this.raiseException(c6))this.store32ZeroExtend(this.fdRegIdx32(J),M3);return;case e8:if(Q<0){if(!this.raiseException(c6))this.store32ZeroExtend(this.fdRegIdx32(J),M3);return}X=Math.sqrt(Q);break;case K8:X=Math.abs(Q);break;case X8:X=-Q;break;default:throw`unhandled op case: ${K}`}this.tempF32[0]=X;const Y=O6(this.tempU32[0]);let z=0;if(X!=this.tempF32[0])z|=O0;if(d6(Y)&&!d6(W))z|=O0|X5;if(!this.raiseException(z))this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}f32BinaryOp(J,Z,q,Q){this.clearCause();const W=this.loadF32(this.fsRegIdx32(Z)),K=this.loadF32(this.ftRegIdx32(q)),X=this.loadU32(this.fsRegIdx32(Z)),Y=this.loadU32(this.ftRegIdx32(q)),z=O6(X),G=O6(Y),H=$X(Q,z,G);let j;switch(H){case A:this.raiseUnimplemented();return;case T:if(!this.raiseException(c6))this.store32ZeroExtend(this.fdRegIdx32(J),M3);return;case n6:if(!this.raiseException(iK)){const M=(X&Y8)==(Y&Y8);this.store32ZeroExtend(this.fdRegIdx32(J),M?eK:JX)}return;case X0:j=W+K;break;case Q0:j=W-K;break;case y0:j=W*K;break;case k6:j=W/K;break;default:throw`unhandled op case: ${H}`}this.tempF32[0]=j;const N=O6(this.tempU32[0]);let L=0;if(j!=this.tempF32[0])L|=O0;if(H==X0||H==Q0){if(!W8(G)&&j==W||!W8(z)&&j==K)L|=O0}if(d6(N)&&!d6(z)&&!d6(G))L|=O0|X5;if((N==y6||W8(N))&&j!=0)L|=O0|L3,this.tempU32[0]=Z1(YX,this.control[31]&N3,j>0);if(!this.raiseException(L))this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}CVT_D_S(J,Z){this.clearCause();let q=0;switch(O6(this.loadU32(this.fsRegIdx32(Z)))){case Y9:case y6:this.raiseUnimplemented();return;case N6:q|=c6,this.tempU64[0]=P3;break;case K9:this.tempU64[0]=ZX;break;case X9:this.tempU64[0]=qX;break;default:{const W=this.loadF32(this.fsRegIdx32(Z));this.tempF64[0]=W}break}if(this.raiseException(q))return;this.store64(this.fdRegIdx64(J),this.tempU64[0])}CVT_D_W(J,Z){this.clearCause(),this.tempF64[0]=this.loadS32(this.fsRegIdx32(Z)),this.store64(this.fdRegIdx64(J),this.tempU64[0])}CVT_D_L(J,Z){this.clearCause();const q=this.loadS64(this.fsRegIdx64(Z));if(q>=1n<<55n||q<-(1n<<55n)){this.raiseUnimplemented();return}let Q=0;if(this.tempF64[0]=Number(q),this.raiseException(Q))return;this.store64(this.fdRegIdx64(J),this.tempU64[0])}f64UnaryOp(J,Z,q){this.clearCause();const Q=this.loadF64(this.fsRegIdx64(Z)),W=o6(this.loadU64(this.fsRegIdx64(Z))),K=zX(q,W);let X;switch(K){case A:this.raiseUnimplemented();return;case T:if(!this.raiseException(c6))this.store64(this.fdRegIdx64(J),P3);return;case e8:if(Q<0){if(!this.raiseException(c6))this.store64(this.fdRegIdx64(J),P3);return}X=Math.sqrt(Q);break;case K8:X=Math.abs(Q);break;case X8:X=-Q;break;default:throw`unhandled op case: ${K}`}this.tempF64[0]=X;const Y=o6(this.tempU64[0]);let z=0;if(X!=this.tempF64[0])z|=O0;if(d6(Y)&&!d6(W))z|=O0|X5;if(!this.raiseException(z))this.store64(this.fdRegIdx64(J),this.tempU64[0])}f64BinaryOp(J,Z,q,Q){this.clearCause();const W=this.loadF64(this.fsRegIdx64(Z)),K=this.loadF64(this.ftRegIdx64(q)),X=this.loadU64(this.fsRegIdx64(Z)),Y=this.loadU64(this.ftRegIdx64(q)),z=o6(X),G=o6(Y),H=$X(Q,z,G);let j;switch(H){case A:this.raiseUnimplemented();return;case T:if(!this.raiseException(c6))this.store64(this.fdRegIdx64(J),P3);return;case n6:if(!this.raiseException(iK)){const M=(X&z8)==(Y&z8);this.store64(this.fdRegIdx64(J),M?ZX:qX)}return;case X0:j=W+K;break;case Q0:j=W-K;break;case y0:j=W*K;break;case k6:j=W/K;break;default:throw`unhandled op case: ${H}`}this.tempF64[0]=j;const N=o6(this.tempU64[0]);let L=0;if(H==X0||H==Q0){if(!W8(G)&&j==W||!W8(z)&&j==K)L|=O0}if(d6(N)&&!d6(z)&&!d6(G))L|=O0|X5;if((N==y6||W8(N))&&j!=0)L|=O0|L3,this.tempU64[0]=Z1(Uj,this.control[31]&N3,j>0);if(!this.raiseException(L))this.store64(this.fdRegIdx64(J),this.tempU64[0])}ConvertSToL(J,Z,q){this.clearCause();let Q=0;switch(O6(this.loadU32(this.fsRegIdx32(Z)))){case Y9:case N6:case y6:case K9:case X9:this.raiseUnimplemented();return;default:{const K=this.loadF32(this.fsRegIdx32(Z)),X=this.convertUsingMode(K,q);if(X>QX||X<WX){this.raiseUnimplemented();return}if(this.tempS64[0]=BigInt(X),K!=this.tempS64[0])Q|=O0}break}if(this.raiseException(Q))return;this.store64(this.fdRegIdx64(J),this.tempS64[0])}ConvertDToL(J,Z,q){this.clearCause();const Q=o6(this.loadU64(this.fsRegIdx64(Z)));let W=0;switch(Q){case Y9:case N6:case y6:case K9:case X9:this.raiseUnimplemented();return;default:{const K=this.loadF64(this.fsRegIdx64(Z)),X=this.convertUsingMode(K,q);if(X>QX||X<WX){this.raiseUnimplemented();return}if(this.tempS64[0]=BigInt(X),K!=this.tempS64[0])W|=O0}break}if(this.raiseException(W))return;this.store64(this.fdRegIdx64(J),this.tempS64[0])}ConvertSToW(J,Z,q){this.clearCause();const Q=O6(this.loadU32(this.fsRegIdx32(Z)));let W=0;switch(Q){case Y9:case N6:case y6:case K9:case X9:this.raiseUnimplemented();return;default:{const K=this.loadF32(this.fsRegIdx32(Z)),X=this.convertUsingMode(K,q);if(X>KX||X<XX){this.raiseUnimplemented();return}if(this.tempS32[0]=X,K!=this.tempS32[0])W|=O0}break}if(this.raiseException(W))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}ConvertDToW(J,Z,q){this.clearCause();const Q=o6(this.loadU64(this.fsRegIdx64(Z)));let W=0;switch(Q){case Y9:case N6:case y6:case K9:case X9:this.raiseUnimplemented();return;default:{const K=this.loadF64(this.fsRegIdx64(Z)),X=this.convertUsingMode(K,q);if(X>KX||X<XX){this.raiseUnimplemented();return}if(this.tempS32[0]=X,K!=this.tempS32[0])W|=O0}break}if(this.raiseException(W))return;this.store32ZeroExtend(this.fdRegIdx32(J),this.tempU32[0])}get roundingMode(){switch(this.control[31]&N3){case Zj:return P6;case qj:return E6;case Qj:return T6;case Wj:return S6}return J0(!1,"unknown rounding mode"),P6}convertUsingMode(J,Z){switch(Z){case P6:return this.round(J);case E6:return this.trunc(J);case T6:return Math.ceil(J);case S6:return Math.floor(J)}J0(!1,"unknown rounding mode")}round(J){const Z=Math.floor(J);if(J-Z==0.5){const Q=Math.ceil(J);if(J<0)return Q%2!=0?Z:Q;return Z%2!=0?Q:Z}return Math.round(J)}trunc(J){if(J<0)return Math.ceil(J);return Math.floor(J)}setCondition(J){if(J)this.control[31]|=sK;else this.control[31]&=~sK}get flushSubnormals(){return(this.control[31]&Yj)!=0}clearCause(){this.control[31]&=~tK}raiseException(J){if(!J)return!1;if(J&L3){if((this.control[31]&(Xj|Kj))!=0||!this.flushSubnormals)return this.raiseUnimplemented()}const Z=$j(J),q=jj(J),Q=Gj(J);return this.setStatusBits(Z,q,Q)}raiseUnimplemented(){return this.control[31]|=rK,this.hardware.cpu0.raiseFPE(),!0}setStatusBits(J,Z,q){if(this.control[31]&J)return this.control[31]|=Z,this.hardware.cpu0.raiseFPE(),!0;return this.control[31]|=q|Z,!1}setStatus(J){this.control[31]=J&Hj;const Z=(J&Fj)>>MX,q=(J&tK)>>PX;if(Z&q||J&rK)return this.hardware.cpu0.raiseFPE(),!0;return!1}copRegIdx32(J){return this.regIdx32_cop[J]}fdRegIdx32(J){return this.regIdx32_d[J]}fsRegIdx32(J){return this.regIdx32_s[J]}ftRegIdx32(J){return this.regIdx32_t[J]}copRegIdx64(J){return this.regIdx64_cop[J]}fdRegIdx64(J){return this.regIdx64_d[J]}fsRegIdx64(J){return this.regIdx64_s[J]}ftRegIdx64(J){return this.regIdx64_t[J]}store64(J,Z){this.regU64[J]=Z}store32ZeroExtend(J,Z){this.regU32[J]=Z|0,this.regU32[J+1]=0}store32(J,Z){this.regU32[J]=Z|0}loadS32(J){return this.regS32[J]}loadU32(J){return this.regU32[J]}loadF32(J){return this.regF32[J]}loadU64(J){return this.regU64[J]}loadF64(J){return this.regF64[J]}loadS64(J){return this.regS64[J]}dump(){let J="Regs: ";for(let Z=0;Z<6;+Z++)J+=k(this.regS32[Z])+", ";U(J),U(`float32: [${this.regF32[0]}, ${this.regF32[1]}, ${this.regF32[2]}, ${this.regF32[3]}, ${this.regF32[4]}, ${this.regF32[5]}, ...]`),U(`float64: [${this.regF64[0]}, ${this.regF64[1]}, ...]`),console.log("")}}function EX(J){J.needsDelayCheck=J.fragment.needsDelayCheck,J.isTrivial=!1;let Z="";if(bX)Z=q6(`
      if (c.pc != ${k(J.pc)}) {
        throw 'expected pc ${k(J.pc)}, got ' + c.pc.toString(16);
      }
    `);let q=Z+UL(J);if(J.dump)console.log(q);if(!J.isTrivial&&J.delayedPCUpdate!==0)J.fragment.bodyCode+=`// Applying delayed pc\nc.pc = ${k(J.delayedPCUpdate)};\n`,J.delayedPCUpdate=0;if(J.fragment.needsDelayCheck=J.needsDelayCheck,J.fragment.bailedOut|=J.bailOut,n64js.getSyncFlow())q=`if (!n64js.checkSyncState(sync, ${k(J.pc)})) { return ${J.fragment.opsCompiled}; }\n${q}`;const W=p2(J.pc,J.instruction,!1),K=bj(q,"  ");J.fragment.bodyCode+=`// ${W.disassembly}
{
${K}
}

`}var bj=function(J,Z){return q6(J).split("\n").filter((X)=>X!="").map((X)=>Z+X).join("\n")},q6=function(J){J=J.replace(/^\n/,"");const Z=J.match(/^\s+/);if(!Z)return J;const q=Z[0];return Z?J.replace(new RegExp("^"+q,"gm"),""):J},F8=function(J){if(!J.startsWith("\n"))J="\n"+J;if(!J.endsWith("\n"))J+="\n";return J},TX=function(J,Z,q){let Q="";if(Q+=Z.genAssert(`c.pc === ${k(Z.pc)}`,"pc mismatch"),Z.needsDelayCheck)Q+=`if (c.delayPC) { c.nextPC = c.delayPC; c.delayPC = 0; } else { c.nextPC = ${k(Z.pc+4)}; }\n`,Q+=F8(J),Q+="c.pc = c.nextPC;\n";else if(q)Q+=Z.genAssert("c.delayPC === 0","delay pc should be zero"),Q+=`c.nextPC = ${k(Z.pc+4)};\n`,Q+=F8(J),Q+="c.pc = c.nextPC;\n";else Q+=Z.genAssert("c.delayPC === 0","delay pc should be zero"),Q+=F8(J),Q+=`c.pc = ${k(Z.pc+4)};\n`;return Q},g=function(J,Z){let q="";if(q+=Z.genAssert(`c.pc === ${k(Z.pc)}`,"pc mismatch"),Z.needsDelayCheck)q+=`c.nextPC = c.delayPC || ${k(Z.pc+4)};\n`;else q+=Z.genAssert("c.delayPC === 0","delay pc should be zero"),q+=`c.nextPC = ${k(Z.pc+4)};\n`;if(q+="c.branchTarget = 0;\n",q+=F8(J),q+="c.pc = c.nextPC;\n",q+="c.delayPC = c.branchTarget;\n",Z.needsDelayCheck=!0,Q8)q+="c.incrementCount(1);\n";if(Z.bailOut)q+=`return ${Z.fragment.opsCompiled};\n`;else q+=`if (c.stuffToDo) { return ${Z.fragment.opsCompiled}; }\n`,q+=`if (c.pc !== ${k(Z.postPC)}) { return ${Z.fragment.opsCompiled}; }\n`;return q},W0=function(J,Z){let q="";if(q+=TX(J,Z,!0),q+=Z.genAssert("c.delayPC === 0","delay pc should be zero"),Z.needsDelayCheck=!1,Q8)q+="c.incrementCount(1);\n";return J0(!Z.bailOut,"Not expecting bailOut to be set for memory access"),q+=`if (c.stuffToDo) { return ${Z.fragment.opsCompiled}; }\n`,q+=`if (c.pc !== ${k(Z.postPC)}) { return ${Z.fragment.opsCompiled}; }\n`,q},d0=function(J,Z,q){let Q="";const W=Z.needsDelayCheck||q||Z.postPC!==Z.pc+4;if(Q+=TX(J,Z,q),Z.needsDelayCheck=!0,Q8)Q+="c.incrementCount(1);\n";if(Q+=Z.genAssert("c.stuffToDo === 0","stuffToDo should be zero"),Z.bailOut)Q+=`return ${Z.fragment.opsCompiled};\n`;else if(W)Q+=`if (c.pc !== ${k(Z.postPC)}) { return ${Z.fragment.opsCompiled}; }\n`;else Q+="// Skipping pc test\n";return Q},p=function(J,Z){let q="";if(q+=F8(J),Z.isTrivial=!0,Q8)q+="c.incrementCount(1);\n";if(Z.needsDelayCheck)q+=`if (c.delayPC) { c.pc = c.delayPC; c.delayPC = 0; } else { c.pc = ${k(Z.pc+4)}; }\n`,q+=`if (c.pc !== ${k(Z.postPC)}) { return ${Z.fragment.opsCompiled}; }\n`;else{q+=Z.genAssert("c.delayPC === 0","delay pc should be zero");const Q=Z.pc+4;if(Z.postPC!==Q)J0("postPC should always be pc+4 for trival ops?"),q+=`c.pc = ${k(Q)};\n`,q+=`if (c.pc !== ${k(Z.postPC)}) { return ${Z.fragment.opsCompiled}; }\n`;else if(q+="// Delaying pc update\n",Z.delayedPCUpdate=Q,bX)q+=`c.pc = ${k(Q)};\n`}return q+=Z.genAssert("c.delayPC === 0","delay pc should be zero"),Z.needsDelayCheck=!1,q+=Z.genAssert("c.stuffToDo === 0","stuffToDo should be zero"),q},SX=function(J,Z){return p(`// ${J}\n`,Z)},_X=function(J){if(J===0)return"0";return`c.getRegU32Lo(${J})`},y9=function(J){if(J===0)return"0n";return`c.getRegS64(${J})`},O9=function(J){if(J===0)return"0n";return`c.getRegU64(${J})`},B=function(J){const Z=`throw 'unknown op, pc ${k(J.pc)}, instruction: ${k(J.instruction)}'`;return g(Z,J)},Dj=function(J){if(J.instruction===0)return SX("NOP",J);const Z=`c.execSLL(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return p(Z,J)},Aj=function(J){const Z=`c.execSRL(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return p(Z,J)},wj=function(J){const Z=`c.execSRA(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return p(Z,J)},Bj=function(J){const Z=`c.execSLLV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Ij=function(J){const Z=`c.execSRLV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Cj=function(J){const Z=`c.execSRAV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Oj=function(J){const Z=`c.execDSLLV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},yj=function(J){const Z=`c.execDSRLV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Ej=function(J){const Z=`c.execDSRAV(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Tj=function(J){const Z=`c.execDSLL(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return p(Z,J)},Sj=function(J){const Z=`c.execDSLL32(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return p(Z,J)},_j=function(J){const Z=`c.execDSRL(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return p(Z,J)},vj=function(J){const Z=`c.execDSRL32(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return p(Z,J)},fj=function(J){const Z=`c.execDSRA(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return p(Z,J)},uj=function(J){const Z=`c.execDSRA32(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_sa()});`;return p(Z,J)},xj=function(J){return g("c.execRESERVED(0);",J)},gj=function(J){return g("c.execSYSCALL();",J)},mj=function(J){return g("c.execBREAK();",J)},pj=function(J){return g("c.execSYNC();",J)},aj=function(J){const Z=`c.execTGE(${J.instr_rt()}, ${J.instr_rs()});`;return g(Z,J)},cj=function(J){const Z=`c.execTGEU(${J.instr_rt()}, ${J.instr_rs()});`;return g(Z,J)},oj=function(J){const Z=`c.execTLT(${J.instr_rt()}, ${J.instr_rs()});`;return g(Z,J)},dj=function(J){const Z=`c.execTLTU(${J.instr_rt()}, ${J.instr_rs()});`;return g(Z,J)},nj=function(J){const Z=`c.execTEQ(${J.instr_rt()}, ${J.instr_rs()});`;return g(Z,J)},lj=function(J){const Z=`c.execTNE(${J.instr_rt()}, ${J.instr_rs()});`;return g(Z,J)},rj=function(J){const Z=`c.execMFHI(${J.instr_rd()});`;return p(Z,J)},sj=function(J){const Z=`c.execMFLO(${J.instr_rd()});`;return p(Z,J)},ij=function(J){const Z=`c.execMTHI(${J.instr_rs()});`;return p(Z,J)},tj=function(J){const Z=`c.execMTLO(${J.instr_rs()});`;return p(Z,J)},ej=function(J){const Z=`c.execMULT(${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Jk=function(J){const Z=`c.execMULTU(${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Zk=function(J){const Z=`c.execDMULT(${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},qk=function(J){const Z=`c.execDMULTU(${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Qk=function(J){const Z=`c.execDIV(${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Wk=function(J){const Z=`c.execDIVU(${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Kk=function(J){const Z=`c.execDDIV(${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Xk=function(J){const Z=`c.execDDIVU(${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Yk=function(J){const Z=`c.execADD(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return g(Z,J)},zk=function(J){const Z=`c.execDADD(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return g(Z,J)},Fk=function(J){const Z=`c.execADDU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Hk=function(J){const Z=`c.execDADDU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Gk=function(J){const Z=`c.execSUB(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return g(Z,J)},$k=function(J){const Z=`c.execDSUB(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return g(Z,J)},jk=function(J){const Z=`c.execSUBU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},kk=function(J){const Z=`c.execDSUBU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Nk=function(J){const Z=`c.execAND(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Lk=function(J){let Z;if(J.instr_rt()===0)if(J.instr_rs()===0)Z=`c.execCLEAR(${J.instr_rd()});`;else Z=`c.execMOV(${J.instr_rd()}, ${J.instr_rs()});`;else Z=`c.execOR(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Mk=function(J){const Z=`c.execXOR(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Pk=function(J){const Z=`c.execNOR(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Vk=function(J){const Z=`c.execSLT(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},Uk=function(J){const Z=`c.execSLTU(${J.instr_rd()}, ${J.instr_rt()}, ${J.instr_rs()});`;return p(Z,J)},hk=function(J){const Z=`c.execADDI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return g(Z,J)},Rk=function(J){const Z=`c.execDADDI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return g(Z,J)},bk=function(J){const Z=`c.execADDI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return p(Z,J)},Dk=function(J){const Z=`c.execDADDIU(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return p(Z,J)},Ak=function(J){const Z=`c.execMFC0(${J.instr_rt()}, ${J.instr_fs()});`;return g(Z,J)},wk=function(J){const Z=`c.execDMFC0(${J.instr_rt()}, ${J.instr_fs()});`;return g(Z,J)},Bk=function(J){if(J.instr_fs()===_0)J.fragment.cop1statusKnown=!1;const Z=`c.execMTC0(${J.instr_rt()}, ${J.instr_fs()});`;return g(Z,J)},Ik=function(J){if(J.instr_fs()===_0)J.fragment.cop1statusKnown=!1;const Z=`c.execDMTC0(${J.instr_rt()}, ${J.instr_fs()});`;return g(Z,J)},Ck=function(J){const Z=`c.execTLB(${J.instr_tlbop()});`;return g(Z,J)},Ok=function(J){const Z=`c.execMFC2(${J.instr_rt()});`;return g(Z,J)},yk=function(J){const Z=`c.execDMFC2(${J.instr_rt()});`;return g(Z,J)},Ek=function(J){const Z=`c.execCFC2(${J.instr_rt()});`;return g(Z,J)},Tk=function(J){const Z=`c.execDCFC2(${J.instr_rt()});`;return g(Z,J)},Sk=function(J){const Z=`c.execMTC2(${J.instr_rt()});`;return g(Z,J)},_k=function(J){const Z=`c.execDMTC2(${J.instr_rt()});`;return g(Z,J)},vk=function(J){const Z=`c.execCTC2(${J.instr_rt()});`;return g(Z,J)},fk=function(J){const Z=`c.execDCTC2(${J.instr_rt()});`;return g(Z,J)},uk=function(J){const Z=V9(J.pc,J.instruction),q="c.delayPC = "+k(Z)+";";return d0(q,J,!1)},xk=function(J){const Z=V9(J.pc,J.instruction),q=J.nextPC+4,Q=q&2147483648?-1:0,W=q6(`
      c.delayPC = ${k(Z)};
      c.setRegS64LoHi(${x6}, ${k(q)}, ${Q});
      `);return d0(W,J,!1)},gk=function(J){const Z=J.instr_rs(),q=J.instr_rd(),Q=J.nextPC+4,W=Q&2147483648?-1:0,K=q6(`
      c.delayPC = ${_X(Z)};
      c.setRegS64LoHi(${q}, ${k(Q)}, ${W});
      `);return d0(K,J,!1)},mk=function(J){const Z=`c.delayPC = ${_X(J.instr_rs())};`;return d0(Z,J,!1)},pk=function(J){const Z=J.instr_rs(),q=J.instr_rt(),Q=J.instr_offset(),W=o0(J.pc,J.instruction);let K="";if(Z===q){if(t8&&Q===-1)K+="c.speedHack();\n",J.bailOut=!0;K+=`c.delayPC = ${k(W)};\n`}else{if(K+=`if (${O9(Z)} === ${O9(q)}) {\n`,t8&&Q===-1)K+="  c.speedHack();\n",J.bailOut=!0;K+=`  c.delayPC = ${k(W)};\n`,K+="} else {\n",K+=`  c.delayPC = ${k(J.pc+8)};\n`,K+="}\n"}return d0(K,J,!1)},ak=function(J){const Z=J.instr_rs(),q=J.instr_rt(),Q=o0(J.pc,J.instruction),W=q6(`
      if (${O9(Z)} === ${O9(q)}) {
        c.delayPC = ${k(Q)};
      } else {
        c.nextPC += 4;
      }`);return d0(W,J,!0)},ck=function(J){const Z=J.instr_rs(),q=J.instr_rt(),Q=J.instr_offset(),W=o0(J.pc,J.instruction);let K="";if(K+=`if (${O9(Z)} !== ${O9(q)}) {\n`,t8&&Q===-1)K+="  c.speedHack();\n",J.bailOut=!0;return K+=`  c.delayPC = ${k(W)};\n`,K+="} else {\n",K+=`  c.delayPC = ${k(J.pc+8)};\n`,K+="}\n",d0(K,J,!1)},ok=function(J){const Z=J.instr_rs(),q=J.instr_rt(),Q=o0(J.pc,J.instruction),W=q6(`
      if (${O9(Z)} !== ${O9(q)}) {
        c.delayPC = ${k(Q)};
      } else {
        c.nextPC += 4;
      }
      `);return d0(W,J,!0)},dk=function(J){const Z=J.instr_rs(),q=o0(J.pc,J.instruction),Q=q6(`
      if ( ${y9(Z)} <= 0n) {
        c.delayPC = ${k(q)};
      } else {
        c.delayPC = ${k(J.pc+8)};
      }`);return d0(Q,J,!1)},nk=function(J){const Z=J.instr_rs(),q=o0(J.pc,J.instruction),Q=q6(`
      if ( ${y9(Z)} <= 0n) {
        c.delayPC = ${k(q)};
      } else {
        c.nextPC += 4;
      }`);return d0(Q,J,!0)},lk=function(J){const Z=J.instr_rs(),q=o0(J.pc,J.instruction),Q=q6(`
      if (${y9(Z)} > 0) {
        c.delayPC = ${k(q)};
      } else {
        c.delayPC = ${k(J.pc+8)};
      }`);return d0(Q,J,!1)},rk=function(J){const Z=J.instr_rs(),q=o0(J.pc,J.instruction),Q=q6(`
      if (${y9(Z)} > 0) {
        c.delayPC = ${k(q)};
      } else {
        c.nextPC += 4;
      }`);return d0(Q,J,!0)},sk=function(J){const Z=J.instr_rs(),q=o0(J.pc,J.instruction),Q=q6(`
      if (${y9(Z)} < 0n) {
        c.delayPC = ${k(q)};
      } else {
        c.delayPC = ${k(J.pc+8)};
      }`);return d0(Q,J,!1)},ik=function(J){const Z=J.instr_rs(),q=o0(J.pc,J.instruction),Q=q6(`
      if (${y9(Z)} < 0n) {
        c.delayPC = ${k(q)};
      } else {
        c.nextPC += 4;
      }`);return d0(Q,J,!0)},tk=function(J){const Z=J.instr_rs(),q=o0(J.pc,J.instruction),Q=q6(`
      if (${y9(Z)} >= 0n) {
        c.delayPC = ${k(q)};
      } else {
        c.delayPC = ${k(J.pc+8)};
      }`);return d0(Q,J,!1)},ek=function(J){const Z=J.instr_rs(),q=o0(J.pc,J.instruction),Q=q6(`
      if (${y9(Z)} >= 0n) {
        c.delayPC = ${k(q)};
      } else {
        c.nextPC += 4;
      }`);return d0(Q,J,!0)},JN=function(J){const Z=`c.execBLTZAL(${J.instr_rs()}, ${J.instr_imms()});`;return g(Z,J)},ZN=function(J){const Z=`c.execBGEZAL(${J.instr_rs()}, ${J.instr_imms()});`;return g(Z,J)},qN=function(J){const Z=`c.execBLTZALL(${J.instr_rs()}, ${J.instr_imms()});`;return g(Z,J)},QN=function(J){const Z=`c.execBGEZALL(${J.instr_rs()}, ${J.instr_imms()});`;return g(Z,J)},WN=function(J){const Z=`c.execTGEI(${J.instr_rs()}, ${J.instr_imms()});`;return g(Z,J)},KN=function(J){const Z=`c.execTGEIU(${J.instr_rs()}, ${J.instr_imms()});`;return g(Z,J)},XN=function(J){const Z=`c.execTLTI(${J.instr_rs()}, ${J.instr_imms()});`;return g(Z,J)},YN=function(J){const Z=`c.execTLTIU(${J.instr_rs()}, ${J.instr_imms()});`;return g(Z,J)},zN=function(J){const Z=`c.execTEQI(${J.instr_rs()}, ${J.instr_imms()});`;return g(Z,J)},FN=function(J){const Z=`c.execTNEI(${J.instr_rs()}, ${J.instr_imms()});`;return g(Z,J)},HN=function(J){const Z=`c.execSLTI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return p(Z,J)},GN=function(J){const Z=`c.execSLTIU(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imms()});`;return p(Z,J)},$N=function(J){const Z=`c.execANDI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imm()});`;return p(Z,J)},jN=function(J){const Z=`c.execORI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imm()});`;return p(Z,J)},kN=function(J){const Z=`c.execXORI(${J.instr_rt()}, ${J.instr_rs()}, ${J.instr_imm()});`;return p(Z,J)},NN=function(J){const Z=`c.execLUI(${J.instr_rt()}, ${J.instr_imm()});`;return p(Z,J)},LN=function(J){const Z=`c.execLB(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},MN=function(J){const Z=`c.execLBU(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},PN=function(J){const Z=`c.execLH(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},VN=function(J){const Z=`c.execLHU(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},UN=function(J){const Z=`c.execLW(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},hN=function(J){const Z=`c.execLWU(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},RN=function(J){const Z=`c.execLD(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},bN=function(J){const Z=`c.execLWL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},DN=function(J){const Z=`c.execLWR(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},AN=function(J){const Z=`c.execLDL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},wN=function(J){const Z=`c.execLDR(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},BN=function(J){J.fragment.usesCop1=!0;const Z=`c.execLWC1(${J.instr_ft()}, ${J.instr_base()}, ${J.instr_imms()});`;return g(Z,J)},IN=function(J){J.fragment.usesCop1=!0;const Z=`c.execLDC1(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return g(Z,J)},CN=function(J){const Z=`c.execLWC2(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},ON=function(J){const Z=`c.execLWC3(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},yN=function(J){const Z=`c.execLDC2(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},EN=function(J){const Z=`c.execSB(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},TN=function(J){const Z=`c.execSH(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},SN=function(J){const Z=`c.execSW(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},_N=function(J){const Z=`c.execSD(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},vN=function(J){const Z=`c.execSWL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},fN=function(J){const Z=`c.execSWR(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},uN=function(J){const Z=`c.execSDL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},xN=function(J){const Z=`c.execSDR(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},gN=function(J){J.fragment.usesCop1=!0;const Z=`c.execSWC1(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return g(Z,J)},mN=function(J){J.fragment.usesCop1=!0;const Z=`c.execSDC1(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return g(Z,J)},pN=function(J){const Z=`c.execSWC2(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},aN=function(J){const Z=`c.execSWC3(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},cN=function(J){const Z=`c.execSDC2(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},oN=function(J){const Z=`c.execLL(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},dN=function(J){const Z=`c.execLLD(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},nN=function(J){const Z=`c.execSC(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},lN=function(J){const Z=`c.execSCD(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return W0(Z,J)},rN=function(J){if(!n64js.cpu0.ignoreCacheOp(J.instr_rt())){const Z=`c.execCACHE(${J.instr_rt()}, ${J.instr_base()}, ${J.instr_imms()});`;return p(Z,J)}else return SX("CACHE (ignored)",J)},sN=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execMFC1(${J.instr_rt()}, ${J.instr_fs()});`},iN=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execDMFC1(${J.instr_rt()}, ${J.instr_fs()});`},tN=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execMTC1(${J.instr_rt()}, ${J.instr_fs()});`},eN=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execDMTC1(${J.instr_rt()}, ${J.instr_fs()});`},JL=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execCFC1(${J.instr_rt()}, ${J.instr_fs()});`},ZL=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!0,`c.execCTC1(${J.instr_rt()}, ${J.instr_fs()});`},qL=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!1,`c.execDCFC1(${J.instr_rt()}, ${J.instr_fs()});`},QL=function(J){return J.fragment.usesCop1=!0,J.isTrivial=!1,`c.execDCTC1(${J.instr_rt()}, ${J.instr_fs()});`},WL=function(J){const Z=J.instruction;J0((Z>>>18&7)===0,"cc bit is not 0");const q=(Z&65536)!==0,Q=(Z&131072)!==0,W=o0(J.pc,Z);J.fragment.usesCop1=!0,J.isTrivial=!1;let X=`const cond = (cpu1.control[31] & FPCSR_C) ${q?"!==":"==="} 0;\n`;if(Q)X+="if (cond) {\n",X+=`  c.branchTarget = ${k(W)};\n`,X+="} else {\n",X+="  c.nextPC += 4;\n",X+="}\n";else X+="if (cond) {\n",X+=`  c.branchTarget = ${k(W)};\n`,X+="} else {\n",X+=`  c.branchTarget = ${k(J.pc+8)};\n`,X+="}\n";return X},KL=function(J){const Z=J.instr_fs(),q=J.instr_ft(),Q=J.instr_fd();J.fragment.usesCop1=!0,J.isTrivial=!1;const W=G6(J.instruction);if(W<48){switch(W){case DX:return`cpu1.ADD_S(${Q}, ${Z}, ${q});`;case AX:return`cpu1.SUB_S(${Q}, ${Z}, ${q});`;case wX:return`cpu1.MUL_S(${Q}, ${Z}, ${q});`;case BX:return`cpu1.DIV_S(${Q}, ${Z}, ${q});`;case IX:return`cpu1.SQRT_S(${Q}, ${Z});`;case CX:return`cpu1.ABS_S(${Q}, ${Z});`;case OX:return`cpu1.MOV_S(${Q}, ${Z});`;case yX:return`cpu1.NEG_S(${Q}, ${Z});`;case D3:return`cpu1.ConvertSToL(${Q}, ${Z}, ${P6});`;case A3:return`cpu1.ConvertSToL(${Q}, ${Z}, ${E6});`;case w3:return`cpu1.ConvertSToL(${Q}, ${Z}, ${T6});`;case B3:return`cpu1.ConvertSToL(${Q}, ${Z}, ${S6});`;case I3:return`cpu1.ConvertSToW(${Q}, ${Z}, ${P6});`;case C3:return`cpu1.ConvertSToW(${Q}, ${Z}, ${E6});`;case O3:return`cpu1.ConvertSToW(${Q}, ${Z}, ${T6});`;case y3:return`cpu1.ConvertSToW(${Q}, ${Z}, ${S6});`;case E3:return"cpu1.raiseUnimplemented();";case T3:return`cpu1.CVT_D_S(${Q}, ${Z});`;case S3:return`cpu1.ConvertSToW(${Q}, ${Z}, cpu1.roundingMode);`;case _3:return`cpu1.ConvertSToL(${Q}, ${Z}, cpu1.roundingMode);`}return`unimplemented(${k(J.pc)},${k(J.instruction)});`}return`cpu1.handleFloatCompareSingle(${W}, ${Z}, ${q});`},XL=function(J){const Z=J.instr_fs(),q=J.instr_ft(),Q=J.instr_fd();J.fragment.usesCop1=!0,J.isTrivial=!1;const W=G6(J.instruction);if(W<48){switch(W){case DX:return`cpu1.ADD_D(${Q}, ${Z}, ${q});`;case AX:return`cpu1.SUB_D(${Q}, ${Z}, ${q});`;case wX:return`cpu1.MUL_D(${Q}, ${Z}, ${q});`;case BX:return`cpu1.DIV_D(${Q}, ${Z}, ${q});`;case IX:return`cpu1.SQRT_D(${Q}, ${Z});`;case CX:return`cpu1.ABS_D(${Q}, ${Z});`;case OX:return`cpu1.MOV_D(${Q}, ${Z});`;case yX:return`cpu1.NEG_D(${Q}, ${Z});`;case D3:return`cpu1.ConvertDToL(${Q}, ${Z}, ${P6});`;case A3:return`cpu1.ConvertDToL(${Q}, ${Z}, ${E6});`;case w3:return`cpu1.ConvertDToL(${Q}, ${Z}, ${T6});`;case B3:return`cpu1.ConvertDToL(${Q}, ${Z}, ${S6});`;case I3:return`cpu1.ConvertDToW(${Q}, ${Z}, ${P6});`;case C3:return`cpu1.ConvertDToW(${Q}, ${Z}, ${E6});`;case O3:return`cpu1.ConvertDToW(${Q}, ${Z}, ${T6});`;case y3:return`cpu1.ConvertDToW(${Q}, ${Z}, ${S6});`;case E3:return`cpu1.CVT_S_D(${Q}, ${Z});`;case T3:return"cpu1.raiseUnimplemented();";case S3:return`cpu1.ConvertDToW(${Q}, ${Z}, cpu1.roundingMode);`;case _3:return`cpu1.ConvertDToL(${Q}, ${Z}, cpu1.roundingMode);`}return`unimplemented(${k(J.pc)},${k(J.instruction)});`}return`cpu1.handleFloatCompareDouble(${W}, ${Z}, ${q});`},YL=function(J){const Z=J.instr_fs(),q=J.instr_fd();switch(J.fragment.usesCop1=!0,J.isTrivial=!1,G6(J.instruction)){case D3:return"cpu1.raiseUnimplemented();";case A3:return"cpu1.raiseUnimplemented();";case w3:return"cpu1.raiseUnimplemented();";case B3:return"cpu1.raiseUnimplemented();";case I3:return"cpu1.raiseUnimplemented();";case C3:return"cpu1.raiseUnimplemented();";case O3:return"cpu1.raiseUnimplemented();";case y3:return"cpu1.raiseUnimplemented();";case E3:return`cpu1.CVT_S_W(${q}, ${Z});`;case T3:return`cpu1.CVT_D_W(${q}, ${Z});`;case S3:return"cpu1.raiseUnimplemented();";case _3:return"cpu1.raiseUnimplemented();"}return`unimplemented(${k(J.pc)},${k(J.instruction)});`},zL=function(J){const Z=J.instr_fs(),q=J.instr_fd();switch(J.fragment.usesCop1=!0,J.isTrivial=!1,G6(J.instruction)){case D3:return"cpu1.raiseUnimplemented();";case A3:return"cpu1.raiseUnimplemented();";case w3:return"cpu1.raiseUnimplemented();";case B3:return"cpu1.raiseUnimplemented();";case I3:return"cpu1.raiseUnimplemented();";case C3:return"cpu1.raiseUnimplemented();";case O3:return"cpu1.raiseUnimplemented();";case y3:return"cpu1.raiseUnimplemented();";case E3:return`cpu1.CVT_S_L(${q}, ${Z});`;case T3:return`cpu1.CVT_D_L(${q}, ${Z});`;case S3:return"cpu1.raiseUnimplemented();";case _3:return"cpu1.raiseUnimplemented();"}return`unimplemented(${k(J.pc)},${k(J.instruction)});`},FL=function(J){const Z=LL[H6(J.instruction)],q=Z(J);let Q="";if(J.fragment.usesCop1=!0,J.fragment.cop1statusKnown)Q+=J.genAssert("(c.getControlU32(12) & SR_CU1) !== 0","cop1 should be enabled"),Q+=F8(q);else return Q+="if( (c.getControlU32(12) & SR_CU1) === 0 ) {\n",Q+=`  n64js.executeCop1_disabled(${k(J.instruction)});\n`,Q+="} else {\n",Q+="  "+F8(q),Q+="}\n",J.isTrivial=!1,J.fragment.cop1statusKnown=!0,g(Q,J);if(J.isTrivial)return p(Q,J);return g(Q,J)},HL=function(J){return g("c.execBreakpoint();",J)},GL=function(J){if(J.length!=64)throw"Special table is unexpected size.";return J},Y1=function(J){if(J.length!=32)throw"Cop table is unexpected size.";return J},$L=function(J){if(J.length!=32)throw"RegImm table is unexpected size.";return J},jL=function(J){if(J.length!=64)throw"Simple table is unexpected size.";return J},UL=function(J){if(Rj)return VL[I8(J.instruction)](J);const Z=`n64js.executeOp(${J.instruction});`;return g(Z,J)},hL=function(J){return kL[O8(J.instruction)](J)},RL=function(J){return PL[C8(J.instruction)](J)},bL=function(J){return NL[H6(J.instruction)](J)},DL=function(J){return ML[H6(J.instruction)](J)},AL=function(J){return g("c.execRESERVED(0);",J)},hj=!1,bX=!1,Rj=!0,DX=0,AX=1,wX=2,BX=3,IX=4,CX=5,OX=6,yX=7,D3=8,A3=9,w3=10,B3=11,I3=12,C3=13,O3=14,y3=15,E3=32,T3=33,S3=36,_3=37;class X1{constructor(){this.fragment=void 0,this.pc=0,this.instruction=0,this.postPC=0,this.bailOut=!1,this.nextPC=0,this.needsDelayCheck=!0,this.isTrivial=!1,this.delayedPCUpdate=0,this.dump=!1}genAssert(J,Z){if(hj)return"window.n64jsAssert("+J+', "'+Z+'");\n';return""}newFragment(){this.delayedPCUpdate=0}set(J,Z,q,Q,W){this.fragment=J,this.pc=Z,this.instruction=q,this.postPC=Q,this.nextPC=W,this.bailOut=!1,this.needsDelayCheck=!0,this.isTrivial=!1,this.dump=!1}instr_rs(){return O(this.instruction)}instr_rt(){return D(this.instruction)}instr_rd(){return u(this.instruction)}instr_sa(){return e0(this.instruction)}instr_fs(){return Y0(this.instruction)}instr_ft(){return g6(this.instruction)}instr_fd(){return J9(this.instruction)}instr_base(){return c(this.instruction)}instr_offset(){return G0(this.instruction)}instr_imms(){return x(this.instruction)}instr_imm(){return Z9(this.instruction)}instr_tlbop(){return y8(this.instruction)}}var kL=GL([Dj,B,Aj,wj,Bj,B,Ij,Cj,mk,gk,B,B,gj,mj,B,pj,rj,ij,sj,tj,Oj,B,yj,Ej,ej,Jk,Qk,Wk,Zk,qk,Kk,Xk,Yk,Fk,Gk,jk,Nk,Lk,Mk,Pk,B,B,Vk,Uk,zk,Hk,$k,kk,aj,cj,oj,dj,nj,B,lj,B,Tj,B,_j,fj,Sj,B,vj,uj]),NL=Y1([Ak,wk,B,B,Bk,Ik,B,B,B,B,B,B,B,B,B,B,Ck,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B]),LL=Y1([sN,iN,JL,qL,tN,eN,ZL,QL,WL,B,B,B,B,B,B,B,KL,XL,B,B,YL,zL,B,B,B,B,B,B,B,B,B,B]),ML=Y1([Ok,yk,Ek,Tk,Sk,_k,vk,fk,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B]),PL=$L([sk,tk,ik,ek,B,B,B,B,WN,KN,XN,YN,zN,B,FN,B,JN,ZN,qN,QN,B,B,B,B,B,B,B,B,B,B,B,B]),VL=jL([hL,RL,uk,xk,pk,ck,dk,lk,hk,bk,HN,GN,$N,jN,kN,NN,bL,FL,DL,AL,ak,ok,nk,rk,Rk,Dk,AN,wN,HL,B,B,xj,LN,PN,bN,UN,MN,VN,DN,hN,EN,TN,vN,SN,uN,xN,fN,rN,oN,BN,CN,ON,dN,IN,yN,RN,nN,gN,pN,aN,lN,mN,cN,_N]);window.n64jsAssert=(J,Z)=>{J0(J,Z)};var BL=function(J){const Z=J<256?BigInt(J)+256n:(BigInt(J)-256n<<1n)+512n;let q=1n<<17n,Q=512n;while(Q!=0){while(Z*(q+Q)*(q+Q)<1n<<44n)q+=Q;Q>>=1n}return Number(q>>1n&0xffffn)};function z1(J){if(J==-32768)return 4294901760;else if(J==0)return 2147483647;const Z=J>>>0>4294934528?J-1:J,q=Z>>31,Q=Z^q,W=Math.clz32(Q)+1,X=Q<<W>>>23;return(65536|wL[X])<<14>>>32-W^q}function F1(J){if(J==-32768)return 4294901760;else if(J==0)return 2147483647;const Z=J>>>0>4294934528?J-1:J,q=Z>>31,Q=Z^q,W=Math.clz32(Q)+1,X=Q<<W>>>24|(W&1)<<8;return(65536|IL[X])<<14>>>(32-W>>1)^q}var wL=function(){const J=[];J.push(65535);for(let Z=1;Z<512;Z++){const q=(1n<<34n)/(BigInt(Z)+512n);J.push(Number(q+1n>>8n&0xffffn))}return J}(),IL=function(){const J=[];for(let Z=0;Z<512;Z++)J.push(BL(Z));return J}();function eX(J){F=J.rsp}var JY=function(J){return J&63},E9=function(J){return(J&65535)<<16>>16},G1=function(J){return J>>>6&31},$0=function(J){return J>>>11&31},a=function(J){return J>>>16&31},e=function(J){return J>>>21&31},CL=function(J){return J>>>26&63},OL=function(J){return J>>>21&31},p0=function(J){return J>>>16&31},E0=function(J){return J>>>7&15},yL=function(J){return(J&127)<<25>>25},r=function(J){return J>>>21&15},$1=function(J){return J>>>11&31},s=function(J){return J>>>16&31},q0=function(J){return J>>>11&31},n=function(J){return J>>>6&31},EL=function(J){return J&67108863},v3=function(J){return J&65535},J4=function(J){return v3(J)<<16>>16},TL=function(J){return J>>>21&31},ZY=function(J,Z){return J&4026531840|EL(Z)*4},iX=function(J){return J*4},tX=function(J){return(J-H1)*4},mL=function(J){return gL[JY(J)](J)},T9=function(J){F.disassembleAll(),n64js.halt(`RSP: unknown op, pc: ${Z0(F.pc)}, instruction: ${k(J)}`)},oL=function(J){F.setRegS32($0(J),F.getRegS32(a(J))<<G1(J))},dL=function(J){F.setRegS32($0(J),F.getRegS32(a(J))>>>G1(J))},nL=function(J){F.setRegS32($0(J),F.getRegS32(a(J))>>G1(J))},lL=function(J){F.setRegS32($0(J),F.getRegS32(a(J))<<(F.getRegS32(e(J))&31))},rL=function(J){F.setRegS32($0(J),F.getRegS32(a(J))>>>(F.getRegS32(e(J))&31))},sL=function(J){F.setRegS32($0(J),F.getRegS32(a(J))>>(F.getRegS32(e(J))&31))},iL=function(J){F.jump(F.getRegS32(e(J)))},tL=function(J){const Z=F.getRegS32(e(J));F.setRegS32($0(J),F.nextPC+4),F.jump(Z)},eL=function(J){F.halt(_L)},JM=function(J){F.setRegS32($0(J),F.getRegS32(e(J))+F.getRegS32(a(J)))},ZM=function(J){F.setRegU32($0(J),F.getRegU32(e(J))+F.getRegU32(a(J)))},qM=function(J){F.setRegS32($0(J),F.getRegS32(e(J))-F.getRegS32(a(J)))},QM=function(J){F.setRegU32($0(J),F.getRegU32(e(J))-F.getRegU32(a(J)))},WM=function(J){F.setRegU32($0(J),F.getRegU32(e(J))&F.getRegU32(a(J)))},KM=function(J){F.setRegU32($0(J),F.getRegU32(e(J))|F.getRegU32(a(J)))},XM=function(J){F.setRegU32($0(J),F.getRegU32(e(J))^F.getRegU32(a(J)))},YM=function(J){F.setRegU32($0(J),~(F.getRegU32(e(J))|F.getRegU32(a(J))))},zM=function(J){F.setRegS32($0(J),F.getRegS32(e(J))<F.getRegS32(a(J))?1:0)},FM=function(J){F.setRegU32($0(J),F.getRegU32(e(J))<F.getRegU32(a(J))?1:0)},HM=function(J){F.conditionalBranch(F.getRegS32(e(J))<0,E9(J))},GM=function(J){F.conditionalBranch(F.getRegS32(e(J))>=0,E9(J))},$M=function(J){const Z=F.getRegS32(e(J))<0;F.setRegS32(j1,F.nextPC+4),F.conditionalBranch(Z,E9(J))},jM=function(J){const Z=F.getRegS32(e(J))>=0;F.setRegS32(j1,F.nextPC+4),F.conditionalBranch(Z,E9(J))},kM=function(J){F.setRegU32(a(J),F.moveFromControl($0(J)))},NM=function(J){F.moveToControl($0(J),F.getRegU32(a(J)))},LM=function(J){F.setRegS16SignExtend(a(J),F.getVecU16UnalignedWrap($0(J),E0(J)))},MM=function(J){F.setVecU16UnalignedNoWrap($0(J),E0(J),F.getRegU32(a(J)))},PM=function(J){let Z;switch($0(J)&3){case 0:Z=F.VCO<<16>>16;break;case 1:Z=F.VCC<<16>>16;break;case 2:Z=F.VCE;break;case 3:Z=F.VCE;break}F.setRegU32(a(J),Z)},VM=function(J){const Z=F.getRegS32(a(J));switch($0(J)&3){case 0:F.VCO=Z;break;case 1:F.VCC=Z;break;case 2:F.VCE=Z;break;case 3:F.VCE=Z;break}},UM=function(J,Z,q,Q){if(J>=0)return(J&~0x7fff_ffffn)!=0?Q:Number(J>>Z);return(~J&~0x7fff_ffffn)!=0?q:Number(J>>Z)},hM=function(J,Z,q,Q){if(J>=0)return(J&~0x7fff_ffffn)!=0?Q:Number(J>>Z);return q},qY=function(J){if(J<-32768)return-32768;if(J>32767)return 32767;return J},T0=function(J){const Z=q0(J),q=s(J);for(let Q=0,W=F.vecSelectU32[r(J)];Q<8;Q++,W>>=4){const K=F.getVecS16(Z,Q),X=F.getVecS16(q,W&7);F.setAccLow(Q,K+X)}F.setVecZero(n(J))},RM=function(J){T0(J)},bM=function(J){T0(J)},DM=function(J){T0(J)},AM=function(J){T0(J)},wM=function(J){T0(J)},BM=function(J){T0(J)},IM=function(J){T0(J)},CM=function(J){T0(J)},OM=function(J){T0(J)},yM=function(J){T0(J)},EM=function(J){T0(J)},TM=function(J){T0(J)},SM=function(J){T0(J)},_M=function(J){T0(J)},vM=function(J){T0(J)},fM=function(J){T0(J)},uM=function(J){T0(J)},xM=function(J){T0(J)},gM=function(J){T0(J)},mM=function(J){F.vectorMulFractions(q0(J),s(J),r(J),!1,32768),F.setVecFromAccSignedMid(n(J))},pM=function(J){F.vectorMulFractions(q0(J),s(J),r(J),!1,32768),F.setVecFromAccUnsignedMid(n(J))},aM=function(J){F.vectorMulFractions(q0(J),s(J),r(J),!0,0),F.setVecFromAccSignedMid(n(J))},cM=function(J){F.vectorMulFractions(q0(J),s(J),r(J),!0,0),F.setVecFromAccUnsignedMid(n(J))},oM=function(J){F.vectorRound(q0(J),s(J),r(J),!1),F.setVecFromAccSignedMid(n(J))},dM=function(J){F.vectorRound(q0(J),s(J),r(J),!0),F.setVecFromAccSignedMid(n(J))},nM=function(J){F.vectorMulPartialLow(q0(J),s(J),r(J),!1),F.setVecFromAccLow(n(J))},lM=function(J){F.vectorMulPartialLow(q0(J),s(J),r(J),!0),F.setVecFromAccSignedLow(n(J))},rM=function(J){F.vectorMulPartialMidM(q0(J),s(J),r(J),!1),F.setVecFromAccMid(n(J))},sM=function(J){F.vectorMulPartialMidM(q0(J),s(J),r(J),!0),F.setVecFromAccSignedMid(n(J))},iM=function(J){F.vectorMulPartialMidN(q0(J),s(J),r(J),!1),F.setVecFromAccLow(n(J))},tM=function(J){F.vectorMulPartialMidN(q0(J),s(J),r(J),!0),F.setVecFromAccSignedLow(n(J))},eM=function(J){F.vectorMulPartialHigh(q0(J),s(J),r(J),!1),F.setVecFromAccSignedMid(n(J))},JP=function(J){F.vectorMulPartialHigh(q0(J),s(J),r(J),!0),F.setVecFromAccSignedMid(n(J))},ZP=function(J){const Z=q0(J),q=s(J);for(let Q=0,W=F.vecSelectU32[r(J)];Q<8;Q++,W>>=4){const K=F.getVecS16(Z,Q),X=F.getVecS16(q,W&7),Y=BigInt(K*X)<<16n;F.setAccS48(Q,Y+(Y<0?0x1f0000n:0n))}F.setVecFromAccOddified(n(J))},qP=function(J){for(let Z=0;Z<8;Z++){const q=F.getAccS48(Z);let Q=0n;if((q&0x20_0000n)==0){const W=q>>22n;if(W<0)Q=0x20_0000n;else if(W>0)Q=-0x20_0000n}F.setAccS48(Z,q+Q)}F.setVecFromAccOddified(n(J))},QP=function(J){const Z=q0(J),q=s(J),Q=F.VCO,W=F.vecTemp;for(let K=0,X=F.vecSelectU32[r(J)];K<8;K++,X>>=4){const Y=F.getVecS16(Z,K),z=F.getVecS16(q,X&7),G=Q>>K&1,H=Y+z+G;F.setAccLow(K,H),W.setInt16(K*2,qY(H))}F.setVecFromTemp(n(J)),F.VCO=0},WP=function(J){const Z=q0(J),q=s(J),Q=F.VCO,W=F.vecTemp;for(let K=0,X=F.vecSelectU32[r(J)];K<8;K++,X>>=4){const Y=F.getVecS16(Z,K),z=F.getVecS16(q,X&7),G=Q>>K&1,H=Y-(z+G);F.setAccLow(K,H),W.setInt16(K*2,qY(H))}F.setVecFromTemp(n(J)),F.VCO=0},KP=function(J,Z){if(J<0)return-Z;if(J>0)return Z;return 0},XP=function(J){const Z=q0(J),q=s(J),Q=F.vecTemp;for(let W=0,K=F.vecSelectU32[r(J)];W<8;W++,K>>=4){const X=F.getVecS16(Z,W),Y=F.getVecU16(q,K&7),z=X<0&&Y==32768,G=KP(X,Y);F.setAccLow(W,z?32768:G),Q.setInt16(W*2,z?32767:G)}F.setVecFromTemp(n(J))},YP=function(J){const Z=q0(J),q=s(J);let Q=0;for(let W=0,K=F.vecSelectU32[r(J)];W<8;W++,K>>=4){const X=F.getVecU16(Z,W),Y=F.getVecU16(q,K&7),z=X+Y;F.setAccLow(W,z),Q|=z&~65535?1<<W:0}F.setVecFromAccLow(n(J)),F.VCO=Q},zP=function(J){const Z=q0(J),q=s(J);let Q=0;for(let W=0,K=F.vecSelectU32[r(J)];W<8;W++,K>>=4){const X=F.getVecU16(Z,W),Y=F.getVecU16(q,K&7),z=X-Y;F.setAccLow(W,z),Q|=z!=0?1<<W+8:0,Q|=z<0?1<<W+0:0}F.setVecFromAccLow(n(J)),F.VCO=Q},$P=function(J){const Z=n(J);switch(r(J)){case FP:for(let q=0;q<8;q++)F.setVecS16(Z,q,F.getAccHigh(q));break;case HP:for(let q=0;q<8;q++)F.setVecS16(Z,q,F.getAccMid(q));break;case GP:for(let q=0;q<8;q++)F.setVecS16(Z,q,F.getAccLow(q));break;default:for(let q=0;q<8;q++)F.setVecS16(Z,q,0);break}},jP=function(J){const Z=q0(J),q=s(J),Q=F.VCO;let W=0,K=0;for(let X=0,Y=F.vecSelectU32[r(J)];X<8;X++,Y>>=4){const z=F.getVecS16(Z,X),G=F.getVecS16(q,Y&7),H=1<<X,j=(Q&H)!=0,N=(Q&H<<8)!=0,L=j&&N,M=z<G||z==G&&L,V=M?z:G;W|=M?H:0,F.setAccLow(X,V)}F.setVecFromAccLow(n(J)),F.setVCCHiLo(K,W),F.VCO=0},kP=function(J){const Z=q0(J),q=s(J),Q=F.VCO;let W=0,K=0;for(let X=0,Y=F.vecSelectU32[r(J)];X<8;X++,Y>>=4){const z=F.getVecS16(Z,X),G=F.getVecS16(q,Y&7),H=1<<X,j=(Q&H<<8)!=0,N=z==G&&!j,L=G;W|=N?H:0,F.setAccLow(X,L)}F.setVecFromAccLow(n(J)),F.setVCCHiLo(K,W),F.VCO=0},NP=function(J){const Z=q0(J),q=s(J),Q=F.VCO;let W=0,K=0;for(let X=0,Y=F.vecSelectU32[r(J)];X<8;X++,Y>>=4){const z=F.getVecS16(Z,X),G=F.getVecS16(q,Y&7),H=1<<X,j=(Q&H<<8)!=0,N=z!=G||j,L=z;W|=N?H:0,F.setAccLow(X,L)}F.setVecFromAccLow(n(J)),F.VCC=K<<8|W,F.setVCCHiLo(K,W),F.VCO=0},LP=function(J){const Z=q0(J),q=s(J),Q=F.VCO;let W=0,K=0;for(let X=0,Y=F.vecSelectU32[r(J)];X<8;X++,Y>>=4){const z=F.getVecS16(Z,X),G=F.getVecS16(q,Y&7),H=1<<X,j=(Q&H)!=0,N=(Q&H<<8)!=0,L=j&&N,M=z>G||z==G&&!L,V=M?z:G;W|=M?H:0,F.setAccLow(X,V)}F.setVecFromAccLow(n(J)),F.setVCCHiLo(K,W),F.VCO=0},MP=function(J){const Z=q0(J),q=s(J),Q=F.VCCHi,W=F.VCCLo,K=F.VCE,X=F.VCOHi,Y=F.VCOLo;let z=0,G=0;for(let H=0,j=F.vecSelectU32[r(J)];H<8;H++,j>>=4){const N=F.getVecU16(Z,H),L=F.getVecU16(q,j&7);let M=W>>H&1,V=Q>>H&1;const h=K>>H&1,b=~(X>>H)&1,C=Y>>H&1;let _;if(C){if(b){const E=N+L&65535,S=N+L>65535;M=!h&&(!E&&!S)||h&&(!E||!S)}_=M?-L:N}else{if(b)V=N-L>=0;_=V?L:N}F.setAccLow(H,_),z|=V<<H,G|=M<<H}F.setVecFromAccLow(n(J)),F.setVCCHiLo(z,G),F.VCO=0,F.VCE=0},PP=function(J){const Z=q0(J),q=s(J);let Q=0,W=0,K=0,X=0,Y=0;for(let z=0,G=F.vecSelectU32[r(J)];z<8;z++,G>>=4){const H=F.getVecS16(Z,z),j=F.getVecS16(q,G&7);let N,L,M,V,h;const b=(H^j)<0;if(b){const C=H+j<<16>>16;L=j<0,N=C<=0,M=C==-1,V=C!=0&&H!=~j,h=N?-j:H}else{const C=H-j<<16>>16;N=j<0,L=C>=0,M=0,V=C!=0,h=L?j:H}F.setAccLow(z,h),Q|=L<<z,W|=N<<z,K|=V<<z,X|=b<<z,Y|=M<<z}F.setVecFromAccLow(n(J)),F.setVCCHiLo(Q,W),F.setVCOHiLo(K,X),F.VCE=Y},VP=function(J){const Z=q0(J),q=s(J);let Q=0,W=0;for(let K=0,X=F.vecSelectU32[r(J)];K<8;K++,X>>=4){const Y=F.getVecS16(Z,K),z=F.getVecS16(q,X&7);let G,H,j;if((Y^z)<0)H=z<0,G=Y+z+1<=0,j=G?~z:Y;else G=z<0,H=Y-z>=0,j=H?z:Y;W|=G<<K,Q|=H<<K,F.setAccLow(K,j)}F.setVecFromAccLow(n(J)),F.setVCCHiLo(Q,W),F.VCO=0,F.VCE=0},UP=function(J){const Z=q0(J),q=s(J);let Q=F.VCC;for(let W=0,K=F.vecSelectU32[r(J)];W<8;W++,Q>>=1,K>>=4){const X=F.getVecU16(Z,W),Y=F.getVecU16(q,K&7),z=Q&1?X:Y;F.setAccLow(W,z)}F.setVecFromAccLow(n(J)),F.VCO=0},hP=function(J){Z4(J,(Z,q)=>Z&q)},RP=function(J){Z4(J,(Z,q)=>~(Z&q))},bP=function(J){Z4(J,(Z,q)=>Z|q)},DP=function(J){Z4(J,(Z,q)=>~(Z|q))},AP=function(J){Z4(J,(Z,q)=>Z^q)},wP=function(J){Z4(J,(Z,q)=>~(Z^q))},Z4=function(J,Z){const q=q0(J),Q=s(J);for(let W=0,K=F.vecSelectU32[r(J)];W<8;W++,K>>=4){const X=F.getVecU16(q,W),Y=F.getVecU16(Q,K&7);F.setAccLow(W,Z(X,Y))}F.setVecFromAccLow(n(J))},BP=function(J){const Z=s(J),q=n(J),Q=$1(J)&7,W=F.vecSelectU32[r(J)];for(let K=0,X=W;K<8;K++,X>>=4){const Y=F.getVecS16(Z,X&7);F.setAccLow(K,Y)}F.setVecS16(q,Q&7,F.getVecS16(Z,W>>4*Q&7))},QY=function(J,Z){for(let q=0,Q=F.vecSelectU32[Z];q<8;q++,Q>>=4){const W=F.getVecS16(J,Q&7);F.setAccLow(q,W)}},WY=function(J){const Z=s(J),q=r(J);QY(Z,q),F.divDP=!0,F.divIn=F.getVecS16(Z,q&7),F.setVecS16(n(J),$1(J)&7,F.divOut)},f3=function(J,Z,q){const Q=s(J),W=r(J),K=F.getVecS16(Q,W&7),X=q&&F.divDP?F.divIn<<16|K&65535:K;QY(Q,W);const Y=Z(X);F.divDP=!1,F.divOut=Y>>16,F.setVecS16(n(J),$1(J)&7,Y&65535)},IP=function(J){f3(J,z1,!1)},CP=function(J){f3(J,z1,!0)},OP=function(J){WY(J)},yP=function(J){f3(J,F1,!1)},EP=function(J){f3(J,F1,!0)},TP=function(J){WY(J)},SP=function(J){},_P=function(J){},vP=function(J){F.jump(ZY(F.pc,J))},fP=function(J){F.setRegS32(j1,F.nextPC+4),F.jump(ZY(F.pc,J))},uP=function(J){F.conditionalBranch(F.getRegS32(e(J))===F.getRegS32(a(J)),E9(J))},xP=function(J){F.conditionalBranch(F.getRegS32(e(J))!==F.getRegS32(a(J)),E9(J))},gP=function(J){F.conditionalBranch(F.getRegS32(e(J))<=0,E9(J))},mP=function(J){F.conditionalBranch(F.getRegS32(e(J))>0,E9(J))},pP=function(J){F.setRegS32(a(J),F.getRegS32(e(J))+J4(J))},aP=function(J){F.setRegS32(a(J),F.getRegS32(e(J))+J4(J))},cP=function(J){F.setRegS32(a(J),F.getRegS32(e(J))<J4(J)?1:0)},oP=function(J){F.setRegS32(a(J),F.getRegU32(e(J))<J4(J)>>>0?1:0)},dP=function(J){F.setRegS32(a(J),F.getRegS32(e(J))&v3(J))},nP=function(J){F.setRegS32(a(J),F.getRegS32(e(J))|v3(J))},lP=function(J){F.setRegS32(a(J),F.getRegS32(e(J))^v3(J))},rP=function(J){F.setRegS32(a(J),J4(J)<<16)},sP=function(J){F.setRegS32(a(J),F.loadS8(F.calcAddress(J)))},iP=function(J){F.setRegU32(a(J),F.loadU8(F.calcAddress(J)))},tP=function(J){F.setRegS32(a(J),F.loadS16(F.calcAddress(J)))},eP=function(J){F.setRegU32(a(J),F.loadU16(F.calcAddress(J)))},JV=function(J){F.setRegS32(a(J),F.loadS32(F.calcAddress(J)))},ZV=function(J){F.setRegU32(a(J),F.loadU32(F.calcAddress(J)))},qV=function(J){F.store8(F.calcAddress(J),F.getRegS32(a(J)))},QV=function(J){F.store16(F.calcAddress(J),F.getRegS32(a(J)))},WV=function(J){F.store32(F.calcAddress(J),F.getRegS32(a(J)))},u3=function(J,Z){const q=F.calcVecAddress(J,Z),Q=p0(J),W=E0(J),K=16-W<Z?16-W:Z;for(let X=0;X<K;X++)F.setVecS8(Q,W+X,F.loadS8(q+X))},x3=function(J,Z){const q=F.calcVecAddress(J,Z),Q=p0(J),W=E0(J);for(let K=0;K<Z;K++)F.store8(q+K,F.getVecS8(Q,W+K&15))},KV=function(J){u3(J,1)},XV=function(J){u3(J,2)},YV=function(J){u3(J,4)},zV=function(J){u3(J,8)},FV=function(J){const Z=F.calcVecAddress(J,16),q=(Z&4080)+16,Q=p0(J),W=E0(J),K=Math.min(q-Z,16-W);for(let X=0;X<K;X++)F.setVecS8(Q,W+X,F.loadU8(Z+X))},HV=function(J){const Z=F.calcVecAddress(J,16),q=Z&4080,Q=p0(J),W=E0(J),K=Z&15,X=16-K+W,Y=Math.min(K,16-X);for(let z=0;z<Y;z++)F.setVecS8(Q,X+z,F.loadU8(q+z))},N1=function(J,Z,q,Q,W){const K=J&7,X=J&4088;for(let Y=0;Y<8;Y++){const z=16-q+Y*W+K&15;F.setVecS16(Z,Y,F.loadU8(X+z)<<Q)}},GV=function(J){N1(F.calcVecAddress(J,8),p0(J),E0(J),8,1)},$V=function(J){N1(F.calcVecAddress(J,8),p0(J),E0(J),7,1)},jV=function(J){N1(F.calcVecAddress(J,16),p0(J),E0(J),7,2)},kV=function(J){const Z=F.calcVecAddress(J,16),q=p0(J),Q=E0(J),W=Z&7,K=Z&4088,X=F.vecTemp;X.setInt16(0,F.loadU8(K+(W+0-Q&15))<<7,!1),X.setInt16(2,F.loadU8(K+(W+4-Q&15))<<7,!1),X.setInt16(4,F.loadU8(K+(W+8-Q&15))<<7,!1),X.setInt16(6,F.loadU8(K+(W+12-Q&15))<<7,!1),X.setInt16(8,F.loadU8(K+(W+8-Q&15))<<7,!1),X.setInt16(10,F.loadU8(K+(W+12-Q&15))<<7,!1),X.setInt16(12,F.loadU8(K+(W+0-Q&15))<<7,!1),X.setInt16(14,F.loadU8(K+(W+4-Q&15))<<7,!1);const Y=Math.min(8,16-Q);for(let z=Q,G=Q+Y;z<G;z++)F.setVecS8(q,z,X.getInt8(z,!1))},NV=function(J){},LV=function(J){const Z=F.calcVecAddress(J,16),q=p0(J),Q=E0(J),W=q&~7,K=Q>>1,X=Z&~7,Y=(Z&8)+Q;for(let z=0;z<8;z++){const G=K+z&7;F.setVecS8(W+G,z*2+0,F.loadU8(X+(Y+z*2+0&15))),F.setVecS8(W+G,z*2+1,F.loadU8(X+(Y+z*2+1&15)))}},MV=function(J){x3(J,1)},PV=function(J){x3(J,2)},VV=function(J){x3(J,4)},UV=function(J){x3(J,8)},hV=function(J){const Z=F.calcVecAddress(J,16),q=(Z&4080)+16,Q=p0(J),W=E0(J);let K=q-Z;for(let X=0;X<K;X++)F.store8(Z+X,F.getVecS8(Q,W+X&15))},RV=function(J){const Z=F.calcVecAddress(J,16),q=Z&4080,Q=p0(J),W=E0(J),K=Z&15,X=16-K+W,Y=K;for(let z=0;z<Y;z++)F.store8(q+z,F.getVecS8(Q,X+z&15))},bV=function(J){const Z=F.calcVecAddress(J,8),q=p0(J),Q=E0(J);for(let W=0;W<8;W++){const K=Q+W,X=K&8?7:8,Y=F.getVecS16(q,K&7)>>>X;F.store8(Z+W,Y)}},DV=function(J){const Z=F.calcVecAddress(J,8),q=p0(J),Q=E0(J);for(let W=0;W<8;W++){const K=Q+W,X=K&8?8:7,Y=F.getVecS16(q,K&7)>>>X;F.store8(Z+W,Y)}},AV=function(J){const Z=F.calcVecAddress(J,16),q=p0(J),Q=E0(J),W=Z&7,K=Z-W;for(let X=0;X<8;X++){const Y=Q+X*2,z=W+X*2&15,G=F.getVecU16UnalignedWrap(q,Y)>>>7;F.store8(K+z,G)}},BV=function(J){const Z=F.calcVecAddress(J,16),q=p0(J),Q=E0(J),W=Z&7,K=Z-W,X=wV.get(Q);if(X)for(let Y=0;Y<4;Y++){const z=W+Y*4&15;F.store8(K+z,F.getVecU16(q,X[Y])>>>7)}else for(let Y=0;Y<4;Y++){const z=W+Y*4&15;F.store8(K+z,0)}},IV=function(J){const Z=F.calcVecAddress(J,16),q=p0(J),Q=E0(J),W=Z&7,K=Z-W;for(let X=0;X<16;X++){const Y=Q+X&15,z=W+X&15;F.store8(K+z,F.getVecS8(q,Y))}},CV=function(J){const Z=F.calcVecAddress(J,16),q=p0(J),Q=E0(J),W=Z&4088,K=Z&15,X=Z&8,Y=q&~7,z=Q-(Z&8)>>1;for(let G=0;G<16;G++){const H=W+(K+G&15),j=Y+(z+(G>>1)&7),N=X+G&15;F.store8(H,F.getVecS8(j,N))}};window.n64js=window.n64js||{};var F,j1=31,vX=0,fX=1,uX=2,xX=3,gX=4,mX=5,pX=6,aX=7,H1=8,cX=9,oX=10,dX=11,nX=12,lX=13,rX=14,sX=15;var SL=1,_L=2;class k1{constructor(J){this.hardware=J,this.dmem=J.sp_mem.subRegion(0,4096),this.imem=J.sp_mem.subRegion(4096,4096),this.imemDV=this.imem.dataView,this.halted=!0,this.runEvent=null,this.pcDataView=J.sp_ibist_mem.dataView,this.pc=0,this.delayPC=0,this.nextPC=0,this.branchTarget=0;const Z=new ArrayBuffer(128);this.gprU32=new Uint32Array(Z),this.gprS32=new Int32Array(Z);const q=new ArrayBuffer(512);this.vpr=new DataView(q),this.vprS16=new Int16Array(q),this.vprS8=new Int8Array(q),this.vprU64=new BigUint64Array(q);const Q=new ArrayBuffer(64);this.vAcc=new BigInt64Array(Q),this.vAccS32=new Int32Array(Q),this.vAccU32=new Uint32Array(Q),this.vAccS16=new Int16Array(Q),this.vAccU16=new Uint16Array(Q),this.vuVCOReg=new Uint16Array(new ArrayBuffer(2)),this.vuVCCReg=new Uint16Array(new ArrayBuffer(2)),this.vuVCEReg=new Uint8Array(new ArrayBuffer(1)),this.divDP=!1,this.divIn=0,this.divOut=0,this.vecSelectU32=new Uint32Array(new ArrayBuffer(64)),this.vecSelectU32[0]=1985229328,this.vecSelectU32[1]=1985229328,this.vecSelectU32[2]=1715741184,this.vecSelectU32[3]=2002072337,this.vecSelectU32[4]=1145307136,this.vecSelectU32[5]=1431638289,this.vecSelectU32[6]=1717969442,this.vecSelectU32[7]=2004300595,this.vecSelectU32[8]=0,this.vecSelectU32[9]=286331153,this.vecSelectU32[10]=572662306,this.vecSelectU32[11]=858993459,this.vecSelectU32[12]=1145324612,this.vecSelectU32[13]=1431655765,this.vecSelectU32[14]=1717986918,this.vecSelectU32[15]=2004318071;const W=new ArrayBuffer(128);this.vecTemp=new DataView(W),this.vecTempU64=new BigUint64Array(W),this.reset()}reset(){this.halted=!0,this.runEvent=null,this.pc=0,this.delayPC=0,this.nextPC=0,this.branchTarget=0;for(let J=0;J<32;++J){this.gprS32[J]=0;for(let Z=0;Z<8;Z++)this.vprS16[J*8+Z]=0}this.vAcc[0]=0n,this.vuVCOReg[0]=0,this.vuVCCReg[0]=0,this.vuVCEReg[0]=0,this.divDP=!1,this.divIn=0,this.divOut=0}getRegS32(J){return this.gprS32[J]}getRegU32(J){return this.gprU32[J]}setRegS32(J,Z){if(J!=0)this.gprS32[J]=Z}setRegU32(J,Z){if(J!=0)this.gprU32[J]=Z}setRegS16SignExtend(J,Z){if(J!=0)this.gprS32[J]=Z<<16>>16}getAccS48(J){return this.vAcc[J]}setAccS48(J,Z){this.vAcc[J]=BigInt.asIntN(48,Z)}updateAccLow32(J,Z,q){this.updateAccHiLo(J,0,Z,q)}updateAccMid32(J,Z,q){const Q=Z>=0?0:-1,W=Z|0;this.updateAccHiLo(J,Q,W,q)}updateAccHigh32(J,Z,q){this.updateAccHiLo(J,Z>>16,Z<<16,q)}updateAccHiLo(J,Z,q,Q){if(Q){const W=this.vAccS32[J*2+1],K=this.vAccU32[J*2+0],X=K+q,Y=(K&q|(K|q)&~X)>>>31,z=W+Z+Y;this.vAccS32[J*2+1]=z<<16>>16,this.vAccU32[J*2+0]=X}else this.vAccU32[J*2+1]=Z,this.vAccU32[J*2+0]=q}setAccLow(J,Z){this.vAccS16[J*4+0]=Z}getAccLow(J){return this.vAccS16[J*4+0]}setAccMid(J,Z){this.vAccS16[J*4+1]=Z}getAccMid(J){return this.vAccS16[J*4+1]}setAccHigh(J,Z){this.vAccS16[J*4+2]=Z}getAccHigh(J){return this.vAccS16[J*4+2]}getAccHighMid(J){return this.vAccS16[J*4+2]<<16|this.vAccU16[J*4+1]}setVecFromAccSignedMid(J){for(let Z=0;Z<8;Z++){const q=this.getAccHighMid(Z);let Q;if(q>=0)Q=q&4294934528?32767:q;else Q=~q&4294934528?32768:q;this.setVecS16(J,Z,Q)}}setVecFromAccSignedLow(J){for(let Z=0;Z<8;Z++){const q=this.getAccHighMid(Z),Q=this.getAccLow(Z);let W;if(q>=0)W=q&4294934528?65535:Q;else W=~q&4294934528?0:Q;this.setVecS16(J,Z,W)}}setVecFromAccOddified(J){for(let Z=0;Z<8;Z++)this.setVecS16(J,Z,UM(this.vAcc[Z]>>1n,16n,32768,32767)&65520)}setVecFromAccUnsignedMid(J){for(let Z=0;Z<8;Z++)this.setVecS16(J,Z,hM(this.vAcc[Z],16n,0,65535))}setVecFromAccMid(J){for(let Z=0;Z<8;Z++)this.setVecS16(J,Z,this.getAccMid(Z))}setVecFromAccLow(J){for(let Z=0;Z<8;Z++)this.setVecS16(J,Z,this.getAccLow(Z))}vectorMulFractions(J,Z,q,Q,W){for(let K=0,X=this.vecSelectU32[q];K<8;K++,X>>=4){const Y=this.getVecS16(J,K),z=this.getVecS16(Z,X&7),G=Y*z*2+W;this.updateAccMid32(K,G,Q)}}vectorMulPartialLow(J,Z,q,Q){for(let W=0,K=this.vecSelectU32[q];W<8;W++,K>>=4){const X=this.getVecU16(J,W),Y=this.getVecU16(Z,K&7),z=X*Y>>>16;this.updateAccLow32(W,z,Q)}}vectorMulPartialMidM(J,Z,q,Q){for(let W=0,K=this.vecSelectU32[q];W<8;W++,K>>=4){const X=this.getVecS16(J,W),Y=this.getVecU16(Z,K&7);this.updateAccMid32(W,X*Y,Q)}}vectorMulPartialMidN(J,Z,q,Q){for(let W=0,K=this.vecSelectU32[q];W<8;W++,K>>=4){const X=this.getVecU16(J,W),Y=this.getVecS16(Z,K&7);this.updateAccMid32(W,X*Y,Q)}}vectorMulPartialHigh(J,Z,q,Q){for(let W=0,K=this.vecSelectU32[q];W<8;W++,K>>=4){const X=this.getVecS16(J,W),Y=this.getVecS16(Z,K&7);this.updateAccHigh32(W,X*Y,Q)}}vectorRound(J,Z,q,Q){const W=J&1?16:0;for(let K=0,X=this.vecSelectU32[q];K<8;K++,X>>=4){const Y=this.getAccS48(K),z=this.getVecS16(Z,X&7)<<W,G=Q?Y>=0:Y<0;this.setAccS48(K,Y+(G?BigInt(z):0n))}}get VCO(){return this.vuVCOReg[0]}get VCOHi(){return this.vuVCOReg[0]>>>8&255}get VCOLo(){return this.vuVCOReg[0]>>>0&255}get VCC(){return this.vuVCCReg[0]}get VCCHi(){return this.vuVCCReg[0]>>>8&255}get VCCLo(){return this.vuVCCReg[0]>>>0&255}get VCE(){return this.vuVCEReg[0]}set VCO(J){this.vuVCOReg[0]=J}set VCC(J){this.vuVCCReg[0]=J}set VCE(J){this.vuVCEReg[0]=J}setVCOHiLo(J,Z){this.vuVCOReg[0]=J<<8|Z}setVCCHiLo(J,Z){this.vuVCCReg[0]=J<<8|Z}getVecS16(J,Z){return this.vpr.getInt16(16*J+Z*2,!1)}getVecU16(J,Z){return this.vpr.getUint16(16*J+Z*2,!1)}getVecS8(J,Z){return this.vpr.getInt8(16*J+Z,!1)}getVecU8(J,Z){return this.vpr.getUint8(16*J+Z,!1)}setVecZero(J){this.vprU64[J*2+0]=0n,this.vprU64[J*2+1]=0n}setVecFromTemp(J){this.vprU64[J*2+0]=this.vecTempU64[0],this.vprU64[J*2+1]=this.vecTempU64[1]}setVecS16(J,Z,q){this.vpr.setInt16(16*J+Z*2,q,!1)}setVecS8(J,Z,q){this.vpr.setInt8(16*J+Z,q,!1)}getVecU16UnalignedWrap(J,Z){const q=this.getVecU8(J,Z&15),Q=this.getVecU8(J,Z+1&15);return q<<8|Q}setVecU16UnalignedNoWrap(J,Z,q){if(this.setVecS8(J,Z+0,q>>8),Z<15)this.setVecS8(J,Z+1,q)}sprintVecReg(J){let Z=[];for(let q=0;q<8;q++)Z.push(Z0(this.getVecS16(J,q)));return`V${J}: [${Z.join(", ")}]`}loadU8(J){return this.dmem.getU8(J&4095)}loadU16(J){return J<=4094?this.dmem.getU16(J):this.loadU16Wrapped(J)}loadU32(J){return J<=4092?this.dmem.getU32(J):this.loadU32Wrapped(J)}loadS8(J){return this.dmem.getS8(J&4095)}loadS16(J){return J<=4094?this.dmem.getS16(J):this.loadS16Wrapped(J)}loadS32(J){return J<=4092?this.dmem.getS32(J):this.loadS32Wrapped(J)}store8(J,Z){return this.dmem.set8(J&4095,Z)}store16(J,Z){return J<=4094?this.dmem.set16(J,Z):this.store16Wrapped(J,Z)}store32(J,Z){return J<=4092?this.dmem.set32(J,Z):this.store32Wrapped(J,Z)}store32masked(J,Z,q){const W=this.loadU32(J,!1)&~q|Z&q;this.store32(J,W)}loadU16Wrapped(J){return(this.loadU8(J+0)<<8|this.loadU8(J+1)<<0)>>>0}loadS16Wrapped(J){return this.loadU16Wrapped(J)<<16>>16}loadU32Wrapped(J){return(this.loadU8(J+0)<<24|this.loadU8(J+1)<<16|this.loadU8(J+2)<<8|this.loadU8(J+3)<<0)>>>0}loadS32Wrapped(J){return this.loadU32Wrapped(J)>>0}store16Wrapped(J,Z){this.store8(J+0,Z>>>8),this.store8(J+1,Z>>>0)}store32Wrapped(J,Z){this.store8(J+0,Z>>>24),this.store8(J+1,Z>>>16),this.store8(J+2,Z>>>8),this.store8(J+3,Z>>>0)}calcDebuggerAddress(J){return this.calcAddress(J)+2751463424}calcAddress(J){return this.getRegS32(TL(J))+J4(J)&4095}calcVecAddress(J,Z){return this.getRegS32(OL(J))+yL(J)*Z&4095}conditionalBranch(J,Z){const q=J?Z*4:4;this.branchTarget=this.pc+4+q|4096}jump(J){this.branchTarget=J>>>0|4096}unhalt(){if(this.halted=!1,this.runEvent)this.runEvent.stop();this.runEvent=this.hardware.timeline.startEvent("RSP")}step(){if(this.halted)return;this.nextPC=(this.delayPC||this.pc+4)&4092;const J=this.imemDV.getUint32(this.pc,!1);this.branchTarget=0,this.executeOp(J),this.pc=this.nextPC,this.delayPC=this.branchTarget}halt(J){if(this.hardware.spRegDevice.setStatusBits(J|SL),this.halted=!0,this.runEvent)this.runEvent.stop(),this.runEvent=null}disassembleAll(){const J=s5(this.imem,0,4096);for(let Z of J)console.log(`${v(Z.address,16)} ${Z.disassembly}`)}disassembleOp(J,Z){const q=o4(J,Z);console.log(`${v(q.address,16)} ${q.disassembly}`)}executeOp(J){cL[CL(J)](J)}moveFromControl(J){switch(J){case vX:case fX:case uX:case xX:case gX:case mX:case pX:case aX:return this.hardware.spRegDevice.readRegU32(iX(J));case H1:case cX:case oX:case dX:case nX:case lX:case rX:case sX:return this.hardware.dpcDevice.readRegU32(tX(J))}return console.log(`MFC0: ${J} unhandled - returning 0`),0}moveToControl(J,Z){switch(J){case vX:case fX:case uX:case xX:case gX:case mX:case pX:case aX:this.hardware.spRegDevice.writeReg32(iX(J),Z);break;case H1:case cX:case oX:case dX:case nX:case lX:case rX:case sX:this.hardware.dpcDevice.writeReg32(tX(J),Z);break;default:console.log(`Unhandled RSP MTC0 register: ${J} = ${k(Z)}`);break}}}var vL=(()=>{let J=[];for(let Z=0;Z<64;Z++)J[Z]=T9;return J[0]=oL,J[2]=dL,J[3]=nL,J[4]=lL,J[6]=rL,J[7]=sL,J[8]=iL,J[9]=tL,J[13]=eL,J[32]=JM,J[33]=ZM,J[34]=qM,J[35]=QM,J[36]=WM,J[37]=KM,J[38]=XM,J[39]=YM,J[42]=zM,J[43]=FM,J})(),fL=(()=>{let J=[];for(let Z=0;Z<32;Z++)J.push(T9);return J[0]=HM,J[1]=GM,J[16]=$M,J[17]=jM,J})(),uL=(()=>{let J=[];for(let Z=0;Z<32;Z++)J.push(T9);return J[0]=kM,J[4]=NM,J})(),xL=(()=>{let J=[];for(let Z=0;Z<32;Z++)J.push(T9);J[0]=LM,J[2]=PM,J[4]=MM,J[6]=VM;for(let Z=16;Z<32;Z++)J[Z]=mL;return J})(),gL=(()=>{let J=[];for(let Z=0;Z<64;Z++)J.push(T9);return J[0]=mM,J[1]=pM,J[2]=dM,J[3]=ZP,J[4]=nM,J[5]=rM,J[6]=iM,J[7]=eM,J[8]=aM,J[9]=cM,J[10]=oM,J[11]=qP,J[12]=lM,J[13]=sM,J[14]=tM,J[15]=JP,J[16]=QP,J[17]=WP,J[18]=RM,J[19]=XP,J[20]=YP,J[21]=zP,J[22]=bM,J[23]=DM,J[24]=AM,J[25]=wM,J[26]=BM,J[27]=IM,J[28]=CM,J[29]=$P,J[30]=OM,J[31]=yM,J[32]=jP,J[33]=kP,J[34]=NP,J[35]=LP,J[36]=MP,J[37]=PP,J[38]=VP,J[39]=UP,J[40]=hP,J[41]=RP,J[42]=bP,J[43]=DP,J[44]=AP,J[45]=wP,J[46]=EM,J[47]=TM,J[48]=IP,J[49]=CP,J[50]=OP,J[51]=BP,J[52]=yP,J[53]=EP,J[54]=TP,J[55]=SP,J[56]=SM,J[57]=_M,J[58]=vM,J[59]=fM,J[60]=uM,J[61]=xM,J[62]=gM,J[63]=_P,J})(),pL=(()=>{let J=[];for(let Z=0;Z<32;Z++)J.push(T9);return J[0]=KV,J[1]=XV,J[2]=YV,J[3]=zV,J[4]=FV,J[5]=HV,J[6]=GV,J[7]=$V,J[8]=jV,J[9]=kV,J[10]=NV,J[11]=LV,J})(),aL=(()=>{let J=[];for(let Z=0;Z<32;Z++)J.push(T9);return J[0]=MV,J[1]=PV,J[2]=VV,J[3]=UV,J[4]=hV,J[5]=RV,J[6]=bV,J[7]=DV,J[8]=AV,J[9]=BV,J[10]=IV,J[11]=CV,J})(),cL=(()=>{let J=[];for(let Z=0;Z<64;Z++)J.push(T9);return J[0]=(Z)=>vL[JY(Z)](Z),J[1]=(Z)=>fL[a(Z)](Z),J[2]=vP,J[3]=fP,J[4]=uP,J[5]=xP,J[6]=gP,J[7]=mP,J[8]=pP,J[9]=aP,J[10]=cP,J[11]=oP,J[12]=dP,J[13]=nP,J[14]=lP,J[15]=rP,J[16]=(Z)=>uL[e(Z)](Z),J[18]=(Z)=>xL[e(Z)](Z),J[32]=sP,J[33]=tP,J[35]=JV,J[36]=iP,J[37]=eP,J[39]=ZV,J[40]=qV,J[41]=QV,J[43]=WV,J[50]=(Z)=>pL[$0(Z)](Z),J[58]=(Z)=>aL[$0(Z)](Z),J})(),FP=8,HP=9,GP=10,wV=new Map([[0,[0,1,2,3]],[1,[6,7,4,5]],[4,[1,2,3,0]],[5,[7,4,5,6]],[8,[4,5,6,7]],[11,[3,0,1,2]],[12,[5,6,7,4]],[15,[0,1,2,3]]]);function kY(J){P=J.cpu0,i=J.cpu1,H8=J.cpu2,gK(J,P),n64js.cpu0=P}var kU=function(J){return J>>>13},NU=function(J){return(J&G5)>>mV},LU=function(J){return(J&U1)>>gV},h1=function(J,Z,q){return(~(J^Z)&(q^J)&LY)!=0},PY=function(J,Z,q){return((J^Z)&(q^J)&LY)!=0},R1=function(J,Z,q){return(~(J^Z)&(q^J)&MY)!=0n},VY=function(J,Z,q){return((J^Z)&(q^J)&MY)!=0n},D1=function(J){return J>>13&4095},PU=function(J){const q=D1(J)&2730;return(q|q>>1)<<13},VU=function(J){const Z=D1(J);if(Z&2048)return 1<<24;if(Z&512)return 1<<22;if(Z&128)return 1<<20;if(Z&32)return 1<<18;if(Z&8)return 1<<16;if(Z&2)return 1<<14;return 1<<12},UU=function(J){const Z=MU.get(J);if(Z)return Z;return`Unknown(${D1(J).toString(2)})`},w=function(J){throw`CPU: unknown op, pc: ${k(P.pc)}, instruction: ${k(J)}`},$Y=function(){},hU=function(J){return J&~3758096384},jY=function(J){return hU(J>>>0)>>>4},RU=function(J){J0((J>>>18&7)===0,"cc bit is not 0");const Z=(J&65536)!==0,q=(J&131072)!==0,W=(i.control[31]&NY)!==0===Z;if(q)P.conditionalBranchLikely(W,G0(J));else P.conditionalBranch(W,G0(J))},bU=function(J){if(J.length!=64)throw"Special table is unexpected size.";return J},AU=function(J){DU[O8(J)](J)},B1=function(J){if(J.length!=32)throw"Cop table is unexpected size.";return J},BU=function(J){wU[H6(J)](J)},CU=function(J){IU[H6(J)](J)},yU=function(J){OU[H6(J)](J)},EU=function(J){P.raiseRESERVEDException(0)},I1=function(J){J0((P.getControlU32(_0)&b1)===0,"SR_CU1 in inconsistent state"),P.raiseCopXUnusable(1)},TU=function(J){if(J.length!=32)throw"RegImm table is unexpected size.";return J},_U=function(J){return SU[C8(J)](J)},vU=function(J){if(J.length!=64)throw"Simple table is unexpected size.";return J},hY=function(J){return RY[I8(J)](J)},fU=function(J,Z,q){return J-=Z,J-=q,J^=q>>>13,Z-=q,Z-=J,Z^=J<<8,q-=J,q-=Z,q^=Z>>>13,J-=Z,J-=q,J^=q>>>12,Z-=q,Z-=J,Z^=J<<16,q-=J,q-=Z,q^=Z>>>5,J-=Z,J-=q,J^=q>>>3,Z-=q,Z-=J,Z^=J<<10,q-=J,q-=Z,q^=Z>>>15,J},uU=function(J,Z){if(!J.sync32(Z,"pc"))return!1;{let q=0;for(let Q=0;Q<32;++Q)q=fU(q,P.getRegU32Lo(Q),0);if(q=q>>>0,!J.sync32(q,"regs"))return!1}return!0},xU=function(J,Z,q){if(q.nextEventCountdown()<J.opsCompiled)return null;J.executionCount++;const Q=J.func();if(!Q8)Z.incrementCount(Q);return q.incrementCount(Q),J.getNextFragment(Z.pc,Q)},gU=function(J,Z,q,Q){if(J0(!J.func,`attempting to append op to already-compiled fragment ${k(J.entryPC)}`),J.opsCompiled===0)q4.newFragment();J.opsCompiled++,DY.addInstructionToFragment(J,Z),J.bodyCode+="rsp.step();\n",J.bodyCode+=`if (c.stuffToDo) { c.pc = ${Z}; return ${J.opsCompiled-1}; }\n`,J.bodyCode+="\n";const W=Z,K=Q.pc;if(q4.set(J,W,q,K,Q.nextPC),EX(q4),J.opsCompiled>8&&Q.pc!==Z+4||J.opsCompiled>=OV||Q.stuffToDo)mU(J),J=n4(Q.pc);else J.bodyCode+=`// Keep going: ops ${J.opsCompiled}, pc: ${k(Q.pc)}, entry+4: ${k(Z+4)}, stuff: ${Q.stuffToDo}\n`;return J},mU=function(J){let Z="";if(n64js.getSyncFlow())Z+="const sync = n64js.getSyncFlow();\n";if(J.usesCop1)Z+=`const SR_CU1 = ${k(b1)};\n`,Z+=`const FPCSR_C = ${k(NY)};\n`;if(q4.delayedPCUpdate!==0)J.bodyCode+=`c.pc = ${k(q4.delayedPCUpdate)};\n`,q4.delayedPCUpdate=0;J.bodyCode+=`return ${J.opsCompiled};\n`;const Q=`
  return function fragment_${k(J.entryPC)}_${J.opsCompiled}() {
  ${Z}
  ${J.bodyCode}
}`;J.bodyCode="",J.func=new Function("c","cpu1","rsp",Q)(P,i,F),J.nextFragments=[];for(let W=0;W<J.opsCompiled;W++)J.nextFragments.push(void 0)};window.n64js=window.n64js||{};var P,i,H8,p3=!1,OV=250,KY=2147483648;var Q6=2147484032,a3=1,F5=2,H5=4;var yV=67108864;var b1=536870912;var EV=28,TV=0xfff7_ffffn,XY=2147483648,SV=805306368,_V=28,vV=256,fV=512,L1=1024;var YY=32768,uV=65280;var zY=124,xV=BigInt(vV|fV);var NY=8388608;var U1=0xc000000000000000n,gV=62n,G5=0x000000ffffffe000n,mV=13n,Y5=0xffn,pV=0xc00000ffffffe0ffn;var aV=4,M1=2,P1=1,cV=0x3fffffffn,oV=2147483648;var dV=0x8000003fn;var nV=0x3fn;var lV=8388592,rV=4,sV=~0x7fffffn,iV=0x7fff_fff0n,tV=4n,eV=0x1_8000_0000n,JU=31n,ZU=0xfffffffe_00000000n,qU=0,QU=24576,WU=122880,KU=516096,XU=2088960,YU=8380416,zU=33546240,FU=8191,HU=0x01ffe000n,GU=0x0f00800fn,$U=0xffffffffn,jU=0xffn,V1=1<<0,g3=1<<1,FY=1<<2,HY="Compare",z5="Run For Cycles";n64js.getSyncFlow=()=>i9;var LY=2147483648,MY=0x8000_0000_0000_0000n,m3=4294967295,_6=0xffff_ffff_ffff_ffffn,GY=0xffff_ffffn;n64js.s32CheckAddOverflow=h1;n64js.s32CheckSubOverflow=PY;n64js.s64CheckAddOverflow=R1;n64js.s64CheckSubOverflow=VY;class UY{constructor(){this.pagemask=0,this.hi=0n,this.pfne=0,this.pfno=0,this.global=0,this.offsetMask=0,this.vpnmask64=G5,this.vpn2bits=0n,this.physEven=0,this.physOdd=0,this.checkbit=0}update(J,Z,q,Q,W){if(p3)U(`TLB update: index=${J}, pagemask=${k(Z)}, entryhi=${P9(q)}, entrylo0=${k(Q)}, entrylo1=${k(W)}`),U(`       ${UU(Z)} Pagesize`);const K=Q&W&P1;this.pagemask=PU(Z),this.hi=q,this.pfne=Q&~P1|K,this.pfno=W&~P1|K,this.global=K,this.offsetMask=(this.pagemask|FU)>>>1,this.vpnmask64=G5&BigInt(~this.pagemask),this.vpn2bits=q&this.vpnmask64,this.physEven=this.pfne<<6&~this.offsetMask,this.physOdd=this.pfno<<6&~this.offsetMask,this.checkbit=VU(this.pagemask)}}var MU=new Map([[qU,"4k"],[QU,"16k"],[WU,"64k"],[KU,"256k"],[XU,"1M"],[YU,"4M"],[zU,"16M"]]);class A1{constructor(J){this.hardware=J,this.opsExecuted=0,this.ramDV=J.cachedMemDevice.mem.dataView;const Z=new ArrayBuffer(256);this.gprU32=new Uint32Array(Z),this.gprS32=new Int32Array(Z),this.gprU64=new BigUint64Array(Z),this.gprS64=new BigInt64Array(Z);const q=new ArrayBuffer(256);this.controlRegU32=new Uint32Array(q),this.controlRegS32=new Int32Array(q),this.controlRegU64=new BigUint64Array(q),this.controlRegS64=new BigInt64Array(q),this.controlCountValue=0,this.lastControlRegWrite=0n,this.pc=0,this.delayPC=0,this.nextPC=0,this.branchTarget=0,this.llBit=0,this.stuffToDo=0,this.eventQueue=new cJ;const Q=new ArrayBuffer(8);this.multHiU32=new Uint32Array(Q),this.multHiS32=new Int32Array(Q),this.multHiU64=new BigUint64Array(Q),this.multHiS64=new BigInt64Array(Q);const W=new ArrayBuffer(8);this.multLoU32=new Uint32Array(W),this.multLoS32=new Int32Array(W),this.multLoU64=new BigUint64Array(W),this.multLoS64=new BigInt64Array(W),this.tlbEntries=[];for(let K=0;K<32;++K)this.tlbEntries.push(new UY);this.loadU8fast=oJ,this.loadU16fast=nJ,this.loadU32fast=i8,this.loadU64fast=q8,this.loadS8fast=dJ,this.loadS16fast=lJ,this.loadS32fast=Q5,this.store8fast=rJ,this.store16fast=sJ,this.store32fast=W5,this.store64fast=K5,this.store32masked=Z3,this.store64masked=q3,this.reset()}conditionalBranch(J,Z){const q=J?Z*4:4;this.branchTarget=this.pc+4+q}conditionalBranchLikely(J,Z){if(J)this.branchTarget=this.pc+4+Z*4;else this.nextPC+=4}jump(J){this.branchTarget=J}getOpsExecuted(){return this.controlCountValue}incrementCount(J){this.controlCountValue+=J}getRegS32Lo(J){return this.gprS32[J*2+0]}getRegU32Lo(J){return this.gprU32[J*2+0]}getRegS64(J){return this.gprS64[J]}getRegU64(J){return this.gprU64[J]}setRegU64(J,Z){if(J==0)return;const q=Z&_6;this.gprU64[J]=q}setRegU64Masked(J,Z,q){if(J==0)return;this.gprU64[J]=this.gprU64[J]&~q|Z&q}setRegS64LoHi(J,Z,q){if(J==0)return;this.gprS32[J*2+0]=Z,this.gprS32[J*2+1]=q}setRegS32ExtendMasked(J,Z,q){if(J==0)return;const Q=this.gprS32[J*2+0]&~q|Z&q;this.gprS32[J*2+0]=Q,this.gprS32[J*2+1]=Q>>31}setRegS32Extend(J,Z){if(J==0)return;this.gprS32[J*2+0]=Z,this.gprS32[J*2+1]=Z>>31}setRegU32Extend(J,Z){if(J==0)return;this.gprU32[J*2+0]=Z,this.gprU32[J*2+1]=0}getMultLoS64(){return this.multLoS64[0]}getMultLoU64(){return this.multLoU64[0]}setMultLoS32Extend(J){this.multLoS64[0]=BigInt.asIntN(32,J)}setMultLoS64(J){this.multLoS64[0]=J}setMultLoU64(J){this.multLoU64[0]=J}getMultHiS64(){return this.multHiS64[0]}getMultHiU64(){return this.multHiU64[0]}setMultHiS32Extend(J){this.multHiS64[0]=BigInt.asIntN(32,J)}setMultHiS64(J){this.multHiS64[0]=J}setMultHiU64(J){this.multHiU64[0]=J}setControlU32(J,Z){this.controlRegU32[J*2+0]=Z}setControlS32(J,Z){this.controlRegS32[J*2+0]=Z}getControlU32(J){return this.controlRegU32[J*2+0]}getControlS32(J){return this.controlRegS32[J*2+0]}setControlS32Extend(J,Z){this.controlRegS32[J*2+0]=Z,this.controlRegS32[J*2+1]=Z>>31}setControlU64(J,Z){this.controlRegU64[J]=Z}setControlS64(J,Z){this.controlRegS64[J]=Z}getControlU64(J){return this.controlRegU64[J]}getControlS64(J){return this.controlRegS64[J]}maskControlBits32(J,Z,q){const Q=J*2+0;this.controlRegU32[Q]=this.controlRegU32[Q]&~Z|q&Z}setControlBits32(J,Z){this.controlRegU32[J*2+0]|=Z}clearControlBits32(J,Z){this.controlRegU32[J*2+0]&=~Z}maskControlBits64(J,Z,q){this.controlRegU64[J]=this.controlRegU64[J]&~Z|q&Z}setControlBits64(J,Z){this.controlRegU64[J]|=Z}clearControlBits64(J,Z){this.controlRegU64[J]&=~Z}reset(){VW();for(let J=0;J<32;++J)this.gprU64[J]=0n,this.controlRegU64[J]=0n;for(let J=0;J<32;++J)this.tlbEntries[J].update(J,0,0x80000000n,0,0);this.pc=0,this.delayPC=0,this.nextPC=0,this.branchTarget=0,this.stuffToDo=0,this.eventQueue.reset(),this.multLoU32[0]=this.multLoU32[1]=0,this.multHiU32[0]=this.multHiU32[1]=0,this.setControlU32(O4,31),this.setControlU32(_0,1883242500),this.setControlU32(v4,1879499875),this.cop1ControlChanged()}cop1ControlChanged(){const J=this.getControlU32(_0),Z=(J&b1)!==0;if(RY[17]=Z?CU:I1,this.hardware.cpu1)this.hardware.cpu1.fullMode=(J&yV)!==0}moveToControl(J,Z){switch(this.lastControlRegWrite=Z,J){case A8:this.setControlU64(J,Z&dV);break;case y4:case E4:this.setControlU64(J,Z&cV);break;case T4:this.setControlU64(J,Z&sV);break;case S4:this.setControlU64(J,Z&HU);break;case h2:this.setControlU64(J,Z&nV),this.setControlU64(O4,31n);break;case M9:this.setControlU64(J,Z&pV);break;case O4:case _4:case o5:case vq:break;case v4:this.maskControlBits64(J,GU,Z);break;case c0:U(`Setting cause register to ${k(Z)}`),n64js.check(Z===0,"Should only write 0 to Cause register."),this.maskControlBits64(J,xV,Z);break;case _0:this.setControlU64(J,Z&TV),this.statusRegisterChanged();break;case s9:this.controlCountValue=Number(Z)*2;break;case w8:this.setCompare(Number(Z&0xffff_ffffn));break;case b2:this.maskControlBits64(J,ZU,Z);break;case t6:case fq:case uq:this.setControlU64(J,Z);break;case d5:this.maskControlBits64(J,$U,Z);break;case R2:case D2:case A2:case w2:case B2:case I2:case C2:break;case _q:this.setControlU64(J,Z&jU);break;case f4:this.setControlU64(J,Z);break;default:this.setControlU64(J,Z),U(`Write to cpu0 control register. ${P9(Z)} --> ${E8[J]}`);break}}moveFromControl(J){if(J===c0)this.checkCauseIP3Consistent();switch(J){case O4:return BigInt(this.getRandom());case R2:case D2:case A2:case w2:case B2:case I2:case C2:return this.lastControlRegWrite;case s9:return BigInt(this.controlCountValue)>>1n;default:return this.getControlU64(J)}}breakExecution(){this.stuffToDo|=V1}run(J){this.stuffToDo&=~V1,this.checkCauseIP3Consistent(),n64js.hardware().checkSIStatusConsistent(),this.addRunForCyclesEvent(J);while(this.hasEvent(z5))try{this.runImpl();break}catch(q){if(q instanceof C6)this.handleEmulatedException();else if(q instanceof $Y)n64js.stopForBreakpoint();else{n64js.halt("Exception :"+q);break}}let Z=this.removeEvent(z5);if(Z<0)Z=0;if(Z<J)this.opsExecuted+=J-Z}runImpl(){const J=this.eventQueue;while(this.hasEvent(z5)){let Z=n4(this.pc);while(!this.stuffToDo)if(Z&&Z.func)Z=xU(Z,this,J);else{if(F.step(),this.stuffToDo)break;const q=this.pc,Q=this.pc|0;this.nextPC=this.delayPC||this.pc+4;let W=i8(Q);if(this.branchTarget=0,hY(W),this.pc=this.nextPC,this.delayPC=this.branchTarget,this.incrementCount(1),J.incrementCount(1),Z)Z=gU(Z,q,W,this);else if(this.pc<q)Z=n4(this.pc)}if(this.stuffToDo&=~FY,this.stuffToDo&g3)this.stuffToDo&=~g3,this.handleInterrupt();else if(this.stuffToDo&V1)break;else if(this.stuffToDo){n64js.warn("Don't know how to handle this event!");break}}}handleEmulatedException(){this.pc=this.nextPC,this.delayPC=0,this.branchTarget=0,this.incrementCount(1),this.eventQueue.incrementCount(1)}speedHack(){if(!F.halted)return;if(n64js.hardware().memMap.readMemoryInternal32(this.pc+4)!==0)return;const Z=this.removeEvent(z5),q=this.eventQueue.skipToNextEvent(1);if(this.controlCountValue+=q,Z>=0)this.addRunForCyclesEvent(Z)}updateCause3(){if(n64js.hardware().miRegDevice.interruptsUnmasked())this.setControlBits32(c0,L1),this.updateStuffToDoForInterrupts();else this.clearControlBits32(c0,L1);this.checkCauseIP3Consistent()}checkCauseIP3Consistent(){const Z=n64js.hardware().miRegDevice.interruptsUnmasked(),q=(this.getControlU32(c0)&L1)!==0;J0(Z===q,`CAUSE_IP3 ${q} inconsistent with MI_INTR_REG ${Z}`)}statusRegisterChanged(){this.cop1ControlChanged(),this.updateStuffToDoForInterrupts()}checkForUnmaskedInterrupts(){const J=this.getControlU32(_0);if((J&(F5|H5|a3))===a3){const Z=this.getControlU32(c0);if((J&Z&uV)!==0)return!0}return!1}updateStuffToDoForInterrupts(){if(this.checkForUnmaskedInterrupts())this.stuffToDo|=g3;else this.stuffToDo&=~g3}setBadVAddr(J){this.setControlU64(_4,J)}setContext(J){const Z=Number(J&0xffffffffn),q=kU(Z)<<rV;this.maskControlBits32(T4,lV,q)}setXContext(J){const Z=NU(J)<<tV|LU(J)<<JU,q=iV|eV;this.maskControlBits64(b2,q,Z)}checkCopXUsable(J){const Z=1<<EV+J;if((this.getControlU32(_0)&Z)==0)return this.raiseCopXUnusable(J),!1;return!0}maybeRaiseTRAPException(J){if(J)this.raiseTRAPException()}raiseCopXUnusable(J){this.raiseExceptionCopCode(Q6,J,dq)}raiseSYSCALLException(){this.raiseExceptionCopCode(Q6,0,aq)}raiseBREAKException(){this.raiseExceptionCopCode(Q6,0,cq)}raiseRESERVEDException(J){this.raiseExceptionCopCode(Q6,J,oq)}raiseTRAPException(){this.raiseExceptionCopCode(Q6,0,lq)}raiseOverflowException(){this.raiseExceptionCopCode(Q6,0,nq)}raiseFPE(){this.raiseExceptionCopCode(Q6,0,rq)}raiseAdELException(J){this.raiseAddressException(Q6,mq,J)}raiseAdESException(J){this.raiseAddressException(Q6,pq,J)}raiseTLBException(J,Z,q){const Q=BigInt(q>>0);this.setBadVAddr(Q),this.setContext(Q),this.setXContext(Q),this.maskControlBits64(M9,G5,Q),this.raiseExceptionCopCode(J,0,Z)}raiseAddressException(J,Z,q){const Q=BigInt(q>>0);this.setBadVAddr(Q),this.setContext(Q),this.setXContext(Q),this.raiseExceptionCopCode(J,0,Z)}raiseExceptionCopCode(J,Z,q){const Q=zY|SV,W=q<<O2,K=Z<<_V;this.raiseException(Q,W|K,J)}raiseException(J,Z,q){if(this.maskControlBits32(c0,J,Z),this.setControlBits32(_0,F5),this.delayPC)this.setControlBits32(c0,XY),this.setControlS32Extend(t6,this.pc-4);else this.clearControlBits32(c0,XY),this.setControlS32Extend(t6,this.pc);this.nextPC=q}handleInterrupt(){if(this.checkForUnmaskedInterrupts())this.raiseException(zY,xq<<O2,Q6),this.pc=Q6,this.delayPC=0;else J0(!1,"Was expecting an unmasked interrupt - something wrong with kStuffToDoCheckInterrupts?")}setCompare(J){if(this.clearControlBits32(c0,YY),J===this.getControlU32(w8));else{const Z=this.controlCountValue/2>>0,q=J-Z>>>0;this.removeEvent(HY),this.addCompareEvent(q),this.setControlU32(w8,J)}}addEvent(J,Z,q){return this.eventQueue.addEvent(J,Z,q)}removeEvent(J){return this.eventQueue.removeEvent(J)}getCyclesUntilEvent(J){return this.eventQueue.getCyclesUntilEvent(J)}hasEvent(J){return this.eventQueue.hasEvent(J)}addCompareEvent(J){const Z=this;this.addEvent(HY,J,()=>{Z.setControlBits32(c0,YY),Z.updateStuffToDoForInterrupts()})}addRunForCyclesEvent(J){const Z=this;this.addEvent(z5,J,()=>{Z.stuffToDo|=FY})}getRandom(){const J=this.getControlU32(h2),Z=J>=32?0:J&31,q=J>=32?64:32;let Q=Math.floor(Math.random()*(q-Z))+Z;if(J0(Q>=Z&&Q<q,`Ooops - random should be in range [${Z},${q}), but got ${Q}`),i9)Q=i9.reflect32(Q);return Q}setTLB(J){const Z=J&31,q=this.getControlU32(S4),Q=this.getControlU64(M9),W=this.getControlU32(E4),K=this.getControlU32(y4);this.tlbEntries[Z].update(Z,q,Q,K,W)}tlbWriteIndex(){this.setTLB(this.getControlU32(A8))}tlbWriteRandom(){this.setTLB(this.getRandom())}tlbRead(){const J=this.getControlU32(A8)&31,Z=this.tlbEntries[J],q=(U1|G5|Y5)&BigInt(~Z.pagemask);if(this.setControlU32(S4,Z.pagemask),this.setControlU64(M9,Z.hi&q),this.setControlU32(y4,Z.pfne&67108863),this.setControlU32(E4,Z.pfno&67108863),p3)U("TLB Read Index "+v0(J)+"."),U("  PageMask: "+k(this.getControlU32(S4))),U("  EntryHi:  "+P9(this.getControlU64(M9))),U("  EntryLo0: "+k(this.getControlU32(y4))),U("  EntryLo1: "+k(this.getControlU32(E4)))}tlbProbe(){const J=this.getControlU64(M9),Z=J&Y5;for(let q=0;q<32;++q){const Q=this.tlbEntries[q],W=Q.vpnmask64|U1;if((Q.hi&W)!==(J&W))continue;if(!Q.global&&(Q.hi&Y5)!==Z)continue;if(p3)U("TLB Probe. EntryHi:"+k(J)+". Found matching TLB entry - "+v0(q));this.setControlU32(A8,q);return}if(p3)U("TLB Probe. EntryHi:"+k(J)+". Didn't find matching entry");this.setControlU32(A8,oV)}tlbFindEntry(J){const q=this.getControlU64(M9)&Y5,Q=BigInt(J>>>0);for(let W=0;W<32;++W){const K=this.tlbEntries[W];if((Q&K.vpnmask64)!==K.vpn2bits)continue;if(!K.global&&(K.hi&Y5)!==q)continue;return K}return null}translateReadInternal(J){const Z=this.tlbFindEntry(J);if(!Z)return 0;const q=J&Z.checkbit;if(((q?Z.pfno:Z.pfne)&M1)===0)return 0;const W=q?Z.physOdd:Z.physEven,K=J&Z.offsetMask;return W|K}translateRead(J){const Z=this.tlbFindEntry(J);if(!Z)throw this.raiseTLBException(KY,y2,J),new C6("TLBL UT_VEC");const q=J&Z.checkbit;if(((q?Z.pfno:Z.pfne)&M1)===0)throw this.raiseTLBException(Q6,y2,J),new C6("TLBL E_VEC");const W=q?Z.physOdd:Z.physEven,K=J&Z.offsetMask;return W|K}translateWrite(J){const Z=this.tlbFindEntry(J);if(!Z)throw this.raiseTLBException(KY,E2,J),new C6("TLBS UT_VEC");const q=J&Z.checkbit,Q=q?Z.pfno:Z.pfne;if((Q&M1)===0)throw this.raiseTLBException(Q6,E2,J),new C6("TLBS E_VEC");if((Q&aV)===0)throw this.raiseTLBException(Q6,gq,J),new C6("Mod E_VEC");const W=q?Z.physOdd:Z.physEven,K=J&Z.offsetMask;return W|K}unalignedLoad(J){throw this.raiseAdELException(J),new C6("AdEL load")}unalignedStore(J){throw this.raiseAdESException(J),new C6("AdES store")}execBreakpoint(){throw new $Y}execSLL(J,Z,q){this.setRegS32Extend(J,this.getRegS32Lo(Z)<<q)}execSRL(J,Z,q){this.setRegS32Extend(J,this.getRegU32Lo(Z)>>>q)}execSRA(J,Z,q){this.setRegS32Extend(J,Number(this.getRegS64(Z)>>BigInt(q)&0xffff_ffffn))}execSLLV(J,Z,q){this.setRegS32Extend(J,this.getRegS32Lo(Z)<<(this.getRegS32Lo(q)&31))}execSRLV(J,Z,q){this.setRegS32Extend(J,this.getRegS32Lo(Z)>>>(this.getRegS32Lo(q)&31))}execSRAV(J,Z,q){this.setRegS32Extend(J,Number(this.getRegS64(Z)>>BigInt(this.getRegS32Lo(q)&31)&0xffff_ffffn))}execDSLLV(J,Z,q){this.setRegU64(J,this.getRegU64(Z)<<BigInt(this.getRegU32Lo(q)&63))}execDSRLV(J,Z,q){this.setRegU64(J,this.getRegU64(Z)>>BigInt(this.getRegU32Lo(q)&63))}execDSRAV(J,Z,q){this.setRegU64(J,this.getRegS64(Z)>>BigInt(this.getRegU32Lo(q)&63))}execDSLL(J,Z,q){this.setRegU64(J,this.getRegU64(Z)<<BigInt(q))}execDSRL(J,Z,q){this.setRegU64(J,this.getRegU64(Z)>>BigInt(q))}execDSRA(J,Z,q){this.setRegU64(J,this.getRegS64(Z)>>BigInt(q))}execDSLL32(J,Z,q){this.setRegU64(J,this.getRegU64(Z)<<BigInt(q+32))}execDSRL32(J,Z,q){this.setRegU64(J,this.getRegU64(Z)>>BigInt(q+32))}execDSRA32(J,Z,q){this.setRegU64(J,this.getRegS64(Z)>>BigInt(q+32))}execRESERVED(J){this.raiseRESERVEDException(J)}execSYSCALL(){this.raiseSYSCALLException()}execBREAK(){this.raiseBREAKException()}execSYNC(){}execMFHI(J){this.setRegU64(J,this.getMultHiU64())}execMFLO(J){this.setRegU64(J,this.getMultLoU64())}execMTHI(J){this.setMultHiU64(this.getRegU64(J))}execMTLO(J){this.setMultLoU64(this.getRegU64(J))}execMULT(J,Z){const q=BigInt(this.getRegS32Lo(Z))*BigInt(this.getRegS32Lo(J));this.setMultLoS32Extend(q&GY),this.setMultHiS32Extend(q>>32n)}execDMULT(J,Z){const q=this.getRegS64(Z)*this.getRegS64(J);this.setMultLoS64(q&_6),this.setMultHiS64(q>>64n)}execMULTU(J,Z){const q=BigInt(this.getRegU32Lo(Z))*BigInt(this.getRegU32Lo(J));this.setMultLoS32Extend(q&GY),this.setMultHiS32Extend(q>>32n)}execDMULTU(J,Z){const q=this.getRegU64(Z)*this.getRegU64(J);this.setMultLoU64(q&_6),this.setMultHiU64(q>>64n)}execDIV(J,Z){const q=this.getRegS32Lo(Z),Q=this.getRegS32Lo(J);let W,K;if(Q)W=q/Q>>0,K=q%Q;else W=q<0?1:-1,K=q;this.setMultLoS32Extend(BigInt(W)),this.setMultHiS32Extend(BigInt(K))}execDDIV(J,Z){const q=this.getRegS64(J),Q=this.getRegS64(Z);let W,K;if(q)W=Q/q,K=Q%q;else W=Q<0?1n:-1n,K=Q;this.setMultLoS64(W),this.setMultHiS64(K)}execDIVU(J,Z){const q=this.getRegU32Lo(Z),Q=this.getRegU32Lo(J);let W,K;if(Q)W=q/Q>>0,K=q%Q;else W=-1,K=q;this.setMultLoS32Extend(BigInt(W)),this.setMultHiS32Extend(BigInt(K))}execDDIVU(J,Z){const q=this.getRegU64(J),Q=this.getRegU64(Z);let W,K;if(q)W=Q/q,K=Q%q;else W=-1n,K=Q;this.setMultLoU64(W),this.setMultHiU64(K)}execADD(J,Z,q){const Q=this.getRegS32Lo(q),W=this.getRegS32Lo(Z),K=Q+W;if(h1(Q,W,K)){this.raiseOverflowException();return}this.setRegS32Extend(J,K)}execDADD(J,Z,q){const Q=this.getRegS64(q),W=this.getRegS64(Z),K=Q+W;if(R1(Q,W,K)){this.raiseOverflowException();return}this.setRegU64(J,K)}execADDU(J,Z,q){const Q=this.getRegS32Lo(q),W=this.getRegS32Lo(Z),K=Q+W;this.setRegS32Extend(J,K)}execDADDU(J,Z,q){const Q=this.getRegS64(q),W=this.getRegS64(Z),K=Q+W;this.setRegU64(J,K)}execSUB(J,Z,q){const Q=this.getRegS32Lo(q),W=this.getRegS32Lo(Z),K=Q-W;if(PY(Q,W,K)){this.raiseOverflowException();return}this.setRegS32Extend(J,K)}execDSUB(J,Z,q){const Q=this.getRegS64(q),W=this.getRegS64(Z),K=Q-W;if(VY(Q,W,K)){this.raiseOverflowException();return}this.setRegU64(J,K)}execSUBU(J,Z,q){const Q=this.getRegS32Lo(q),W=this.getRegS32Lo(Z),K=Q-W;this.setRegS32Extend(J,K)}execDSUBU(J,Z,q){const Q=this.getRegS64(q),W=this.getRegS64(Z),K=Q-W;this.setRegU64(J,K)}execAND(J,Z,q){this.setRegU64(J,this.getRegU64(q)&this.getRegU64(Z))}execOR(J,Z,q){this.setRegU64(J,this.getRegU64(q)|this.getRegU64(Z))}execXOR(J,Z,q){this.setRegU64(J,this.getRegU64(q)^this.getRegU64(Z))}execNOR(J,Z,q){this.setRegU64(J,~(this.getRegU64(q)|this.getRegU64(Z)))}execCLEAR(J){this.setRegU64(J,0n)}execMOV(J,Z){this.setRegU64(J,this.getRegU64(Z))}execSLT(J,Z,q){const Q=this.getRegS64(q)<this.getRegS64(Z)?1:0;this.setRegU32Extend(J,Q)}execSLTU(J,Z,q){const Q=this.getRegU64(q)<this.getRegU64(Z)?1:0;this.setRegU32Extend(J,Q)}execADDI(J,Z,q){const Q=this.getRegS32Lo(Z),W=Q+q;if(h1(Q,q,W)){this.raiseOverflowException();return}this.setRegS32Extend(J,W)}execDADDI(J,Z,q){const Q=this.getRegS64(Z),W=BigInt(q),K=Q+W;if(R1(Q,W,K)){this.raiseOverflowException();return}this.setRegU64(J,K)}execADDIU(J,Z,q){this.setRegS32Extend(J,this.getRegS32Lo(Z)+q)}execDADDIU(J,Z,q){this.setRegU64(J,this.getRegS64(Z)+BigInt(q))}execSLTI(J,Z,q){this.setRegU32Extend(J,this.getRegS64(Z)<BigInt(q)?1:0)}execSLTIU(J,Z,q){const Q=BigInt.asUintN(64,BigInt(q));this.setRegU32Extend(J,this.getRegU64(Z)<Q?1:0)}execANDI(J,Z,q){this.setRegU64(J,this.getRegU64(Z)&BigInt(q))}execORI(J,Z,q){this.setRegU64(J,this.getRegU64(Z)|BigInt(q))}execXORI(J,Z,q){this.setRegU64(J,this.getRegU64(Z)^BigInt(q))}execLUI(J,Z){this.setRegS32Extend(J,Z<<16)}addrS32(J,Z){return this.getRegS32Lo(J)+Z>>0}addrU32(J,Z){return this.getRegS32Lo(J)+Z>>>0}calcDebuggerAddress(J){return this.addrS32(c(J),x(J))}execLB(J,Z,q){const Q=dJ(this.addrS32(Z,q));this.setRegS32Extend(J,Q)}execLBU(J,Z,q){const Q=oJ(this.addrS32(Z,q));this.setRegU32Extend(J,Q)}execLH(J,Z,q){const Q=lJ(this.addrS32(Z,q));this.setRegS32Extend(J,Q)}execLHU(J,Z,q){const Q=nJ(this.addrS32(Z,q));this.setRegU32Extend(J,Q)}execLW(J,Z,q){const Q=Q5(this.addrS32(Z,q));if(J==0){console.log("LW to register 0");return}this.setRegS32Extend(J,Q)}execLWU(J,Z,q){const Q=i8(this.addrS32(Z,q));this.setRegU32Extend(J,Q)}execLD(J,Z,q){const Q=q8(this.addrS32(Z,q));this.setRegU64(J,Q)}execLWL(J,Z,q){const Q=this.addrU32(Z,q),W=i8((Q&~3)>>>0),K=8*(Q&3);this.setRegS32ExtendMasked(J,W<<K,m3<<K)}execLWR(J,Z,q){const Q=this.addrU32(Z,q),W=i8((Q&~3)>>>0),K=8*(3-(Q&3));this.setRegS32ExtendMasked(J,W>>>K,m3>>>K)}execLDL(J,Z,q){const Q=this.addrU32(Z,q),W=BigInt(8*(Q&7)),K=q8((Q&~7)>>>0);this.setRegU64Masked(J,K<<W&_6,_6<<W&_6)}execLDR(J,Z,q){const Q=this.addrU32(Z,q),W=BigInt(8*(7-(Q&7))),K=q8((Q&~7)>>>0);this.setRegU64Masked(J,K>>W,_6>>W)}execLWC1(J,Z,q){if(!this.checkCopXUsable(1))return;i.store32(i.copRegIdx32(J),Q5(this.addrS32(Z,q)))}execLWC2(J,Z,q){if(!this.checkCopXUsable(2))return;this.unimplemented(this.pc,"LWC2")}execLWC3(J,Z,q){if(!this.checkCopXUsable(3))return;this.unimplemented(this.pc,"LWC3")}execLDC1(J,Z,q){if(!this.checkCopXUsable(1))return;const Q=q8(this.addrS32(Z,q));i.store64(i.copRegIdx64(J),Q)}execLDC2(J,Z,q){if(!this.checkCopXUsable(2))return;this.unimplemented(this.pc,"LDC2")}execSB(J,Z,q){rJ(this.addrS32(Z,q),this.getRegS32Lo(J))}execSH(J,Z,q){sJ(this.addrS32(Z,q),this.getRegS32Lo(J))}execSW(J,Z,q){W5(this.addrS32(Z,q),this.getRegS32Lo(J))}execSD(J,Z,q){K5(this.addrS32(Z,q),this.getRegU64(J))}execSWL(J,Z,q){const Q=this.addrU32(Z,q),W=8*(Q&3),K=this.getRegU32Lo(J);Z3(Q,K>>>W,m3>>>W)}execSWR(J,Z,q){const Q=this.addrU32(Z,q),W=8*(3-(Q&3)),K=this.getRegU32Lo(J);Z3(Q,K<<W,m3<<W)}execSDL(J,Z,q){const Q=this.addrU32(Z,q),W=BigInt(8*(Q&7)),K=this.getRegU64(J);q3(Q,K>>W,_6>>W)}execSDR(J,Z,q){const Q=this.addrU32(Z,q),W=this.getRegU64(J),K=BigInt(8*(7-(Q&7)));q3(Q,W<<K&_6,_6<<K&_6)}execSWC1(J,Z,q){if(!this.checkCopXUsable(1))return;W5(this.addrS32(Z,q),i.loadU32(i.copRegIdx32(J)))}execSWC2(J,Z,q){if(!this.checkCopXUsable(2))return;this.unimplemented(this.pc,"SWC2")}execSWC3(J,Z,q){if(!this.checkCopXUsable(3))return;this.unimplemented(this.pc,"SWC3")}execSDC1(J,Z,q){if(!this.checkCopXUsable(1))return;K5(this.addrS32(Z,q),i.loadU64(i.copRegIdx64(J)))}execSDC2(J,Z,q){if(!this.checkCopXUsable(2))return;this.unimplemented(this.pc,"SDC2")}execLL(J,Z,q){const Q=this.addrS32(Z,q);this.setControlU32(d5,jY(Q)),this.setRegS32Extend(J,Q5(Q)),this.llBit=1}execLLD(J,Z,q){const Q=this.addrS32(Z,q);this.setControlU32(d5,jY(Q)),this.setRegU64(J,q8(Q)),this.llBit=1}execSC(J,Z,q){let Q=0;if(this.llBit)W5(this.addrS32(Z,q),this.getRegS32Lo(J)),this.llBit=0,Q=1;this.setRegU32Extend(J,Q)}execSCD(J,Z,q){let Q=0;if(this.llBit)K5(this.addrS32(Z,q),this.getRegU64(J)),this.llBit=0,Q=1;this.setRegU32Extend(J,Q)}execCACHE(J,Z,q){if(!this.ignoreCacheOp(J))DY.invalidateEntry(this.addrU32(Z,q))}ignoreCacheOp(J){const Z=J&3,q=J>>>2&7;return Z!==0||q!==0&&q!==4}execTGE(J,Z){this.maybeRaiseTRAPException(this.getRegS64(Z)>=this.getRegS64(J))}execTGEU(J,Z){this.maybeRaiseTRAPException(this.getRegU64(Z)>=this.getRegU64(J))}execTLT(J,Z){this.maybeRaiseTRAPException(this.getRegS64(Z)<this.getRegS64(J))}execTLTU(J,Z){this.maybeRaiseTRAPException(this.getRegU64(Z)<this.getRegU64(J))}execTEQ(J,Z){this.maybeRaiseTRAPException(this.getRegS64(Z)==this.getRegS64(J))}execTNE(J,Z){this.maybeRaiseTRAPException(this.getRegS64(Z)!=this.getRegS64(J))}execTGEI(J,Z){this.maybeRaiseTRAPException(this.getRegS64(J)>=BigInt(Z))}execTGEIU(J,Z){this.maybeRaiseTRAPException(this.getRegU64(J)>=BigInt.asUintN(64,BigInt(Z)))}execTLTI(J,Z){this.maybeRaiseTRAPException(this.getRegS64(J)<BigInt(Z))}execTLTIU(J,Z){this.maybeRaiseTRAPException(this.getRegU64(J)<BigInt.asUintN(64,BigInt(Z)))}execTEQI(J,Z){this.maybeRaiseTRAPException(this.getRegS64(J)==BigInt(Z))}execTNEI(J,Z){this.maybeRaiseTRAPException(this.getRegS64(J)!=BigInt(Z))}execJ(J){this.jump(J)}execJR(J){this.jump(this.getRegU32Lo(J))}execJAL(J){this.setRegS32Extend(x6,this.nextPC+4),this.jump(J)}execJALR(J,Z){const q=this.getRegU32Lo(Z);this.setRegS32Extend(J,this.nextPC+4),this.jump(q)}execBEQ(J,Z,q){const Q=this.getRegU64(Z)===this.getRegU64(J);if(this.conditionalBranch(Q,q),t8&&Q&&q===-1)this.speedHack()}execBNE(J,Z,q){this.conditionalBranch(this.getRegU64(Z)!==this.getRegU64(J),q)}execBEQL(J,Z,q){this.conditionalBranchLikely(this.getRegU64(Z)===this.getRegU64(J),q)}execBNEL(J,Z,q){this.conditionalBranchLikely(this.getRegU64(Z)!==this.getRegU64(J),q)}execBGEZ(J,Z){this.conditionalBranch(this.getRegS64(J)>=0n,Z)}execBGTZ(J,Z){this.conditionalBranch(this.getRegS64(J)>0n,Z)}execBLEZ(J,Z){this.conditionalBranch(this.getRegS64(J)<=0n,Z)}execBLTZ(J,Z){this.conditionalBranch(this.getRegS64(J)<0n,Z)}execBGEZL(J,Z){this.conditionalBranchLikely(this.getRegS64(J)>=0n,Z)}execBGTZL(J,Z){this.conditionalBranchLikely(this.getRegS64(J)>0n,Z)}execBLEZL(J,Z){this.conditionalBranchLikely(this.getRegS64(J)<=0n,Z)}execBLTZL(J,Z){this.conditionalBranchLikely(this.getRegS64(J)<0n,Z)}execBLTZAL(J,Z){const q=this.getRegS64(J)<0n;this.setRegS32Extend(x6,this.nextPC+4),this.conditionalBranch(q,Z)}execBGEZAL(J,Z){const q=this.getRegS64(J)>=0n;this.setRegS32Extend(x6,this.nextPC+4),this.conditionalBranch(q,Z)}execBLTZALL(J,Z){const q=this.getRegS64(J)<0n;this.setRegS32Extend(x6,this.nextPC+4),this.conditionalBranchLikely(q,Z)}execBGEZALL(J,Z){const q=this.getRegS64(J)>=0n;this.setRegS32Extend(x6,this.nextPC+4),this.conditionalBranchLikely(q,Z)}execMFC0(J,Z){this.setRegS32Extend(J,Number(this.moveFromControl(Z)&0xffff_ffffn))}execDMFC0(J,Z){this.setRegU64(J,this.moveFromControl(Z))}execMTC0(J,Z){this.moveToControl(Z,BigInt(this.getRegS32Lo(J)))}execDMTC0(J,Z){this.moveToControl(Z,this.getRegU64(J))}execTLB(J){switch(J){case 1:this.tlbRead();return;case 2:this.tlbWriteIndex();return;case 6:this.tlbWriteRandom();return;case 8:this.tlbProbe();return;case 24:this.execERET();return}n64js.warn(`CPU: unknown TLB op, pc: ${k(this.pc)}, op: ${k(J)}`)}execERET(){if(this.getControlU32(_0)&H5)this.nextPC=this.getControlU32(f4),this.clearControlBits32(_0,H5),U(`ERET from error trap - ${k(this.nextPC)}`);else this.nextPC=this.getControlU32(t6),this.clearControlBits32(_0,F5);this.llBit=0}execMFC1(J,Z){this.setRegS32Extend(J,i.loadS32(i.copRegIdx32(Z)))}execDMFC1(J,Z){this.setRegU64(J,i.loadU64(i.copRegIdx64(Z)))}execMTC1(J,Z){i.store32(i.copRegIdx32(Z),this.getRegS32Lo(J))}execDMTC1(J,Z){i.store64(i.copRegIdx64(Z),this.getRegS64(J))}execCFC1(J,Z){switch(Z){case 0:case 31:this.setRegS32Extend(J,i.control[Z]);break}}execCTC1(J,Z){if(Z===31)i.setStatus(this.getRegU32Lo(J))}execDCFC1(J,Z){i.DCFC1(J,Z)}execDCTC1(J,Z){i.DCTC1(Z,J)}execMFC2(J){if(!this.checkCopXUsable(2))return;this.setRegS32Extend(J,H8.getReg32())}execDMFC2(J){if(!this.checkCopXUsable(2))return;this.setRegU64(J,H8.getReg64())}execCFC2(J){if(!this.checkCopXUsable(2))return;this.setRegS32Extend(J,H8.getReg32())}execDCFC2(J){if(!this.checkCopXUsable(2))return;this.raiseRESERVEDException(2)}execMTC2(J){if(!this.checkCopXUsable(2))return;H8.setReg64(this.getRegU64(J))}execDMTC2(J){if(!this.checkCopXUsable(2))return;H8.setReg64(this.getRegU64(J))}execCTC2(J){if(!this.checkCopXUsable(2))return;H8.setReg64(this.getRegU64(J))}execDCTC2(J){if(!this.checkCopXUsable(2))return;this.raiseRESERVEDException(2)}unimplemented(J,Z){n64js.warn(`${J}: ${Z} is unimplemented`)}}class w1{constructor(J){this.hardware=J;const Z=new ArrayBuffer(8);this.regU32=new Uint32Array(Z),this.regU64=new BigUint64Array(Z)}reset(){this.regU64[0]=0n}setReg32(J){this.regU32[0]=J,this.regU32[1]=J>>31}setReg64(J){this.regU64[0]=J}getReg32(){return this.regU32[0]}getReg64(){return this.regU64[0]}}var DU=bU([(J)=>P.execSLL(u(J),D(J),e0(J)),w,(J)=>P.execSRL(u(J),D(J),e0(J)),(J)=>P.execSRA(u(J),D(J),e0(J)),(J)=>P.execSLLV(u(J),D(J),O(J)),w,(J)=>P.execSRLV(u(J),D(J),O(J)),(J)=>P.execSRAV(u(J),D(J),O(J)),(J)=>P.execJR(O(J)),(J)=>P.execJALR(u(J),O(J)),w,w,(J)=>P.execSYSCALL(),(J)=>P.execBREAK(),w,(J)=>P.execSYNC(),(J)=>P.execMFHI(u(J)),(J)=>P.execMTHI(O(J)),(J)=>P.execMFLO(u(J)),(J)=>P.execMTLO(O(J)),(J)=>P.execDSLLV(u(J),D(J),O(J)),w,(J)=>P.execDSRLV(u(J),D(J),O(J)),(J)=>P.execDSRAV(u(J),D(J),O(J)),(J)=>P.execMULT(D(J),O(J)),(J)=>P.execMULTU(D(J),O(J)),(J)=>P.execDIV(D(J),O(J)),(J)=>P.execDIVU(D(J),O(J)),(J)=>P.execDMULT(D(J),O(J)),(J)=>P.execDMULTU(D(J),O(J)),(J)=>P.execDDIV(D(J),O(J)),(J)=>P.execDDIVU(D(J),O(J)),(J)=>P.execADD(u(J),D(J),O(J)),(J)=>P.execADDU(u(J),D(J),O(J)),(J)=>P.execSUB(u(J),D(J),O(J)),(J)=>P.execSUBU(u(J),D(J),O(J)),(J)=>P.execAND(u(J),D(J),O(J)),(J)=>P.execOR(u(J),D(J),O(J)),(J)=>P.execXOR(u(J),D(J),O(J)),(J)=>P.execNOR(u(J),D(J),O(J)),w,w,(J)=>P.execSLT(u(J),D(J),O(J)),(J)=>P.execSLTU(u(J),D(J),O(J)),(J)=>P.execDADD(u(J),D(J),O(J)),(J)=>P.execDADDU(u(J),D(J),O(J)),(J)=>P.execDSUB(u(J),D(J),O(J)),(J)=>P.execDSUBU(u(J),D(J),O(J)),(J)=>P.execTGE(D(J),O(J)),(J)=>P.execTGEU(D(J),O(J)),(J)=>P.execTLT(D(J),O(J)),(J)=>P.execTLTU(D(J),O(J)),(J)=>P.execTEQ(D(J),O(J)),w,(J)=>P.execTNE(D(J),O(J)),w,(J)=>P.execDSLL(u(J),D(J),e0(J)),w,(J)=>P.execDSRL(u(J),D(J),e0(J)),(J)=>P.execDSRA(u(J),D(J),e0(J)),(J)=>P.execDSLL32(u(J),D(J),e0(J)),w,(J)=>P.execDSRL32(u(J),D(J),e0(J)),(J)=>P.execDSRA32(u(J),D(J),e0(J))]);n64js.executeUnknown=w;var wU=B1([(J)=>P.execMFC0(D(J),Y0(J)),(J)=>P.execDMFC0(D(J),Y0(J)),w,w,(J)=>P.execMTC0(D(J),Y0(J)),(J)=>P.execDMTC0(D(J),Y0(J)),w,w,w,w,w,w,w,w,w,w,(J)=>P.execTLB(y8(J)),w,w,w,w,w,w,w,w,w,w,w,w,w,w,w]),IU=B1([(J)=>P.execMFC1(D(J),Y0(J)),(J)=>P.execDMFC1(D(J),Y0(J)),(J)=>P.execCFC1(D(J),Y0(J)),(J)=>P.execDCFC1(D(J),Y0(J)),(J)=>P.execMTC1(D(J),Y0(J)),(J)=>P.execDMTC1(D(J),Y0(J)),(J)=>P.execCTC1(D(J),Y0(J)),(J)=>P.execDCTC1(D(J),Y0(J)),RU,w,w,w,w,w,w,w,(J)=>i.execSInstr(G6(J),J9(J),Y0(J),g6(J)),(J)=>i.execDInstr(G6(J),J9(J),Y0(J),g6(J)),w,w,(J)=>i.execWInstr(G6(J),J9(J),Y0(J),g6(J)),(J)=>i.execLInstr(G6(J),J9(J),Y0(J),g6(J)),w,w,w,w,w,w,w,w,w,w]),OU=B1([(J)=>P.execMFC2(D(J)),(J)=>P.execDMFC2(D(J)),(J)=>P.execCFC2(D(J)),(J)=>P.execDCFC2(D(J)),(J)=>P.execMTC2(D(J)),(J)=>P.execDMTC2(D(J)),(J)=>P.execCTC2(D(J)),(J)=>P.execDCTC2(D(J)),w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w,w]);n64js.executeCop1_disabled=I1;var SU=TU([(J)=>P.execBLTZ(O(J),G0(J)),(J)=>P.execBGEZ(O(J),G0(J)),(J)=>P.execBLTZL(O(J),G0(J)),(J)=>P.execBGEZL(O(J),G0(J)),w,w,w,w,(J)=>P.execTGEI(O(J),x(J)),(J)=>P.execTGEIU(O(J),x(J)),(J)=>P.execTLTI(O(J),x(J)),(J)=>P.execTLTIU(O(J),x(J)),(J)=>P.execTEQI(O(J),x(J)),w,(J)=>P.execTNEI(O(J),x(J)),w,(J)=>P.execBLTZAL(O(J),G0(J)),(J)=>P.execBGEZAL(O(J),G0(J)),(J)=>P.execBLTZALL(O(J),G0(J)),(J)=>P.execBGEZALL(O(J),G0(J)),w,w,w,w,w,w,w,w,w,w,w,w]),RY=vU([AU,_U,(J)=>P.execJ(V9(P.pc,J)),(J)=>P.execJAL(V9(P.pc,J)),(J)=>P.execBEQ(D(J),O(J),G0(J)),(J)=>P.execBNE(D(J),O(J),G0(J)),(J)=>P.execBLEZ(O(J),G0(J)),(J)=>P.execBGTZ(O(J),G0(J)),(J)=>P.execADDI(D(J),O(J),x(J)),(J)=>P.execADDIU(D(J),O(J),x(J)),(J)=>P.execSLTI(D(J),O(J),x(J)),(J)=>P.execSLTIU(D(J),O(J),x(J)),(J)=>P.execANDI(D(J),O(J),Z9(J)),(J)=>P.execORI(D(J),O(J),Z9(J)),(J)=>P.execXORI(D(J),O(J),Z9(J)),(J)=>P.execLUI(D(J),Z9(J)),BU,I1,yU,EU,(J)=>P.execBEQL(D(J),O(J),G0(J)),(J)=>P.execBNEL(D(J),O(J),G0(J)),(J)=>P.execBLEZL(O(J),G0(J)),(J)=>P.execBGTZL(O(J),G0(J)),(J)=>P.execDADDI(D(J),O(J),x(J)),(J)=>P.execDADDIU(D(J),O(J),x(J)),(J)=>P.execLDL(D(J),c(J),x(J)),(J)=>P.execLDR(D(J),c(J),x(J)),(J)=>P.execBreakpoint(),w,w,(J)=>P.execRESERVED(0),(J)=>P.execLB(D(J),c(J),x(J)),(J)=>P.execLH(D(J),c(J),x(J)),(J)=>P.execLWL(D(J),c(J),x(J)),(J)=>P.execLW(D(J),c(J),x(J)),(J)=>P.execLBU(D(J),c(J),x(J)),(J)=>P.execLHU(D(J),c(J),x(J)),(J)=>P.execLWR(D(J),c(J),x(J)),(J)=>P.execLWU(D(J),c(J),x(J)),(J)=>P.execSB(D(J),c(J),x(J)),(J)=>P.execSH(D(J),c(J),x(J)),(J)=>P.execSWL(D(J),c(J),x(J)),(J)=>P.execSW(D(J),c(J),x(J)),(J)=>P.execSDL(D(J),c(J),x(J)),(J)=>P.execSDR(D(J),c(J),x(J)),(J)=>P.execSWR(D(J),c(J),x(J)),(J)=>P.execCACHE(D(J),c(J),x(J)),(J)=>P.execLL(D(J),c(J),x(J)),(J)=>P.execLWC1(D(J),c(J),x(J)),(J)=>P.execLWC2(D(J),c(J),x(J)),(J)=>P.execLWC3(D(J),c(J),x(J)),(J)=>P.execLLD(D(J),c(J),x(J)),(J)=>P.execLDC1(D(J),c(J),x(J)),(J)=>P.execLDC2(D(J),c(J),x(J)),(J)=>P.execLD(D(J),c(J),x(J)),(J)=>P.execSC(D(J),c(J),x(J)),(J)=>P.execSWC1(D(J),c(J),x(J)),(J)=>P.execSWC2(D(J),c(J),x(J)),(J)=>P.execSWC3(D(J),c(J),x(J)),(J)=>P.execSCD(D(J),c(J),x(J)),(J)=>P.execSDC1(D(J),c(J),x(J)),(J)=>P.execSDC2(D(J),c(J),x(J)),(J)=>P.execSD(D(J),c(J),x(J))]);n64js.singleStep=function(){const J=n64js.breakpoints();let Z=0;if(J.isBreakpoint(P.pc))Z=P.pc,J.toggle(Z);if(P.run(1),Z)J.toggle(Z)};class bY{constructor(){this.kNumEntries=16384,this.entries=[];for(let J=0;J<this.kNumEntries;++J)this.entries.push(new Set)}addressToCacheLine(J){return Math.floor(J>>>5)}addressToCacheLineRoundUp(J){return Math.floor(J+31>>>5)}lookupEntry(J){const q=this.addressToCacheLine(J)%this.entries.length;return this.entries[q]}addInstructionToFragment(J,Z){J.updateMinMax(Z),this.lookupEntry(Z).add(J)}invalidateEntry(J){const Z=this.lookupEntry(J),q=this.addressToCacheLine(J);for(let[Q,W]of Z.entries())if(this.addressToCacheLine(Q.minPC)<=q&&this.addressToCacheLineRoundUp(Q.maxPC)>=q)Q.invalidate(),Z.delete(Q)}}var DY=new bY,q4=new X1;n64js.checkSyncState=uU;n64js.executeOp=hY;class l{constructor(J,Z,q,Q,W){this.name=J,this.hardware=Z,this.mem=q,this.u8=q?q.u8:null,this.rangeStart=Q,this.rangeEnd=W,this.quiet=!0}setMem(J){this.mem=J,this.u8=J.u8}reset(){}calcEA(J){return J-this.rangeStart}calcInternalEA(J){return this.calcEA(J)}calcReadEA(J){return this.calcEA(J)}calcWriteEA(J){return this.calcEA(J)}readInternal32(J){const Z=this.calcInternalEA(J);if(Z+4<=this.u8.length)return this.mem.getU32(Z);return 3722304989}writeInternal32(J,Z){const q=this.calcInternalEA(J);if(q+4<=this.u8.length)this.mem.set32(q,Z)}logRead(J){}logWrite(J,Z,q){}readU64(J){const Z=this.calcReadEA(J);if(Z+8>this.u8.length)return 0;return this.mem.getU64(Z)}readU32(J){const Z=this.calcReadEA(J);if(Z+4>this.u8.length)return 0;return this.mem.getU32(Z)}readU16(J){const Z=this.calcReadEA(J);if(Z+2>this.u8.length)return 0;return this.mem.getU16(Z)}readU8(J){const Z=this.calcReadEA(J);if(Z+1>this.u8.length)return 0;return this.mem.getU8(Z)}write64masked(J,Z,q){const Q=this.calcWriteEA(J)&~7;if(Q+8>this.u8.length)return;this.mem.set64masked(Q,Z,q)}write32masked(J,Z,q){const Q=this.calcWriteEA(J)&~3;if(Q+4>this.u8.length)return;this.mem.set32masked(Q,Z,q)}write64(J,Z){const q=this.calcWriteEA(J);if(q+8>this.u8.length)return;this.mem.set64(q,Z)}write32(J,Z){const q=this.calcWriteEA(J);if(q+4>this.u8.length)return;this.mem.set32(q,Z)}write16(J,Z){const q=this.calcWriteEA(J);if(q+2>this.u8.length)return;this.mem.set16(q,Z)}write8(J,Z){const q=this.calcWriteEA(J);if(q+1>this.u8.length)return;this.mem.set8(q,Z)}}var C1=0,AY=4,z0=8,$5=12,aU=128,cU=256,oU=512,dU=1024,nU=2048,lU=4096,rU=8192,wY=128,BY=256,IY=512,sU=1,iU=2,tU=4,eU=8,Jh=16,Zh=32,qh=64,Qh=128,Wh=256,Kh=512,Xh=1024,Yh=2048;var W4=1,z9=2,j5=4,k5=8,N5=16,Q4=32;class O1 extends l{constructor(J,Z,q){super("MIReg",J,J.mi_reg,Z,q)}reset(){this.mem.set32(AY,33685762)}interruptsUnmasked(){return(this.mem.getU32($5)&this.mem.getU32(z0))!==0}intrReg(){return this.mem.getU32(z0)}intrMaskReg(){return this.mem.getU32($5)}setInterruptBit(J){this.mem.setBits32(z0,J),n64js.cpu0.updateCause3()}interruptSP(){this.setInterruptBit(W4)}interruptDP(){this.setInterruptBit(Q4)}write32(J,Z){const q=this.calcWriteEA(J);if(q+4>this.u8.length)throw"Write is out of range";switch(q){case C1:if(!this.quiet)U(`Wrote to MI mode register: ${k(Z)}`);this.writeModeReg(Z);break;case $5:if(!this.quiet)U(`Wrote to MI interrupt mask register: ${k(Z)}`);this.writeIntrMaskReg(Z);break;case AY:case z0:break;default:U(`Unhandled write to MIReg: ${k(Z)} -> [${k(J)}]`),this.mem.set32(q,Z);break}}writeModeReg(J){let Z=this.mem.getU32(C1);if(J&rU)Z|=IY;if(J&lU)Z&=~IY;if(J&cU)Z|=wY;if(J&aU)Z&=~wY;if(J&dU)Z|=BY;if(J&oU)Z&=~BY;if(this.mem.set32(C1,Z),J&nU)this.mem.clearBits32(z0,Q4),n64js.cpu0.updateCause3()}writeIntrMaskReg(J){let Z=0,q=0;Z|=(J&sU)>>>0,Z|=(J&tU)>>>1,Z|=(J&Jh)>>>2,Z|=(J&qh)>>>3,Z|=(J&Wh)>>>4,Z|=(J&Xh)>>>5,q|=(J&iU)>>>1,q|=(J&eU)>>>2,q|=(J&Zh)>>>3,q|=(J&Qh)>>>4,q|=(J&Kh)>>>5,q|=(J&Yh)>>>6;let Q=this.mem.getU32($5);Q&=~Z,Q|=q,this.mem.set32($5,Q),n64js.cpu0.updateCause3()}}var CY=function(J,Z){return J&~(Z-1)},f0=function(J,Z){const q=document.querySelector(J);if(q)q.textContent=Z};window.n64js=window.n64js||{};class y1{constructor(){this.active=!1,this.$cpuContent=$("#cpu-content"),this.cpuTabs=[$("#cpu0-content"),$("#cpu1-content")],this.$cpu0Disassembly=$("#cpu-disasm"),this.$rspContent=$("#rsp-content"),this.rspTabs=[$("#rsp-scalar-content"),$("#rsp-vector-content"),$("#rsp-task-content")],this.$rspDisassembly=$("#rsp-disasm"),this.$dynarecContent=$("#dynarec-content"),this.$memoryContent=$("#memory-content"),this.$timelineContent=$("#timeline-content"),this.cpu0State=new OY,this.rspState=new yY,this.lastOpExecuted=0,this.recentMemoryAccesses=[],this.lastMemoryAccessAddress=0,this.lastStore=null,this.labelMap=new Map,this.debugCycles=Math.pow(10,0),VQ($(".output"),()=>{return k(P.pc)}),n64js.addResetCallback(this.onReset.bind(this)),$("#output").find("#clear").click(function(){UQ()});const J=this;$("#cpu-speed").change(function(){J.debugCycles=Math.pow(10,$(this).val()|0),U("Speed is now "+J.debugCycles)}),$("#cpu").find("#address").change(function(){J.disasmAddress=parseInt($(this).val(),16),J.updateCPU()}),this.refreshLabelSelect(),this.$memoryContent.find("input").change(function(){J.lastMemoryAccessAddress=parseInt($(this).val(),16),J.updateMemoryView()}),this.updateMemoryView(),$("body").keydown(function(Z){let q=!1;switch(Z.key){case"ArrowDown":q=!0,J.disassemblerDown();break;case"ArrowUp":q=!0,J.disassemblerUp();break;case"PageDown":q=!0,J.disassemblerPageDown();break;case"PageUp":q=!0,J.disassemblerPageUp();break;case"F8":q=!0,n64js.toggleRun();break;case"F9":q=!0,yK();break;case"F10":q=!0,n64js.step();break}if(q)Z.preventDefault()}),document.querySelector("#cpu-tab").addEventListener("click",()=>{this.updateCPU()}),document.querySelector("#rsp-tab").addEventListener("click",()=>{this.updateRSP()}),document.querySelector("#memory-tab").addEventListener("click",()=>{this.updateMemoryView()}),document.querySelector("#dynarec-tab").addEventListener("click",()=>{this.updateDynarec()}),document.querySelector("#timeline-tab").addEventListener("click",()=>{this.updateTimeline()})}visible(){return this.active}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}toggle(){this.setVisible(!this.active)}setVisible(J){this.active=J,document.querySelectorAll(".debug").forEach((Z)=>{Z.classList.toggle("hidden",!J)}),LW(J)}showTimeline(){this.updateTimeline(),this.show(),$("#timeline-tab").tab("show")}updateMemoryView(){const J=this.lastMemoryAccessAddress||2147483648;this.$memoryContent.find("pre").empty().append(this.makeMemoryAccessRow(J,1024))}refreshLabelSelect(){const J=$("#cpu").find("#labels"),Z=Array.from(this.labelMap.keys()),q=this;Z.sort((Q,W)=>{const K=q.labelMap.get(Q),X=q.labelMap.get(W);return K.localeCompare(X)}),J.html("");for(let Q of Z){const W=this.labelMap.get(Q),K=$(`<option value="${W}">${W}</option>`);K.data("address",Q),J.append(K)}J.change(()=>{let Q=J.find("option:selected").data("address");q.cpu0State.disasmAddress=Q>>>0,q.updateCPU()})}onReset(){this.restoreLabelMap(),this.updateCPU(),this.updateRSP()}restoreLabelMap(){this.labelMap=n64js.getLocalStorageItem("debugLabelMap")||new Map,this.refreshLabelSelect()}storeLabelMap(){n64js.setLocalStorageItem("debugLabelMap",this.labelMap)}makeMemoryAccessRow(J,Z,q=64,Q=null){let W=CY(J,q)-CY(Z/2,q),K=W+Z,X="";for(let Y=W;Y<K;Y+=q){let z=v(Y,32)+":";for(let G=0;G<q;G+=4){let H=Y+G>>>0,j=n64js.hardware().memMap.readMemoryInternal32(H),N="";if(Q&&Q.has(H))N=` style="background-color: ${Q.get(H)}"`;z+=` <span id="mem-${v(H,32)}"${N}>${v(j,32)}</span>`}z+="\n",X+=z}return $(`<span>${X}</span>`)}makeRecentMemoryAccessRow(J,Z){let q=Z==="store"?"#faa":"#ffa";if(Z==="update")q="#afa";let Q=new Map,W=(J&~3)>>>0;return Q.set(W,q),this.makeMemoryAccessRow(J,32,32,Q)}makeLabelColor(J){let Z=J>>>2,q=Z>>>16^(Z&65535)*2803,Q=q&31,W=q>>>5&31,K=q>>>10&31,X=q>>>15&3;switch(Q*=4,W*=4,K*=4,X){case 0:Q*=2,W*=2;break;case 1:W*=2,K*=2;break;case 2:K*=2,Q*=2;break;default:Q*=2,W*=2,K*=2;break}return"#"+v(Q,8)+v(W,8)+v(K,8)}setLabelText(J,Z){if(this.labelMap.has(Z))J.append(` (${this.labelMap.get(Z)})`)}setLabelColor(J,Z){J.css("color",this.makeLabelColor(Z))}makeLabelText(J){let Z=this.labelMap.get(J)||"";while(Z.length<20)Z+=" ";return Z}onLabelClicked(J){let Z=$(J.delegateTarget),q=Z.data("address")>>>0,Q=this.labelMap.get(q)||"",W=$(`<input class="input-mini" value="${Q}" />`);const K=this;W.keypress((X)=>{if(X.which==13){const Y=W.val();if(Y)K.labelMap.set(q,Y.toString());else K.labelMap.delete(q);K.storeLabelMap(),K.refreshLabelSelect(),this.updateCPU()}}),W.blur(()=>{Z.html(K.makeLabelText(q))}),Z.empty().append(W),W.focus()}onFragmentClicked(J){let q=$(J.delegateTarget).data("fragment");U(`<pre>${q.func.toString()}</pre>`)}onClickBreakpoint(J){let q=$(J.delegateTarget).data("address")>>>0;n64js.breakpoints().toggle(q),this.updateCPU()}updateCPU(){this.cpu0State.setPC(P.pc);let J=P.getOpsExecuted(),Z=this.lastOpExecuted===J-1;this.lastOpExecuted=J;let q=r2(),Q=this.cpu0State.disassembleRange(),W=$("<pre/>"),K=$("<pre/>"),X;for(let z=0;z<Q.length;++z){let G=Q[z],H=G.instruction.address,j=G.isJumpTarget||this.labelMap.has(H),N=(j?'<span class="dis-address-target">':'<span class="dis-address">')+v(H,32)+":</span>",L=`<span class="dis-label">${this.makeLabelText(H)}</span>`,M=`${N}  ${v(G.instruction.opcode,32)}  ${L}${G.disassembly}`,V=q.get(H);if(V){const _=`<span class="dis-fragment-link"> frag - ops=${V.opsCompiled} hit=${V.executionCount}</span>`;M+=_}let h=$(`<span class="dis-line">${M}</span>`);if(h.find(".dis-label").data("address",H).css("color",this.makeLabelColor(H)).click(this.onLabelClicked.bind(this)),V)h.find(".dis-fragment-link").data("fragment",V).click(this.onFragmentClicked.bind(this));if(H===P.pc)X=G.instruction,h.addClass("dis-line-cur");if(j)h.addClass("dis-line-target"),this.setLabelColor(h.find(".dis-address-target"),H);K.append(h),K.append("<br>");let b="&nbsp;";if(n64js.breakpoints().isBreakpoint(H))b="&bull;";let C=$(`<span>${b}</span>`).data("address",H).click(this.onClickBreakpoint.bind(this));W.append(C),W.append("<br>")}K.find(".dis-address-jump").each(function(){let z=parseInt($(this).text(),16);this.setLabelText($(this),z),this.setLabelColor($(this),z),$(this).click(function(){this.cpu0state.disasmAddress=z,this.redraw()})}.bind(this));let Y=this.makeRegisterColours(X);for(let[z,G]of Y)K.find(".dis-reg-"+z).css("background-color",G);this.$cpu0Disassembly.find(".dis-recent-memory").html(this.makeRecentMemoryAccesses(Z,X,P.calcDebuggerAddress.bind(P))),this.$cpu0Disassembly.find(".dis-gutter").empty().append(W),this.$cpu0Disassembly.find(".dis-view").empty().append(K),this.cpu0State.updateStatusTable(),this.cpuTabs[0].empty().append(this.cpu0State.makeCop0RegistersTable(Y)),this.cpuTabs[1].empty().append(this.cpu0State.makeCop1RegistersTable(Y))}updateRSP(){this.rspState.setPC(F.pc);const J=!0;let Z=this.rspState.disassembleRange(),q=$("<pre/>"),Q=$("<pre/>");for(let Y=0;Y<Z.length;++Y){let z=Z[Y],G=z.instruction.address,H=z.isJumpTarget||this.labelMap.has(G),j=(H?'<span class="dis-address-target">':'<span class="dis-address">')+v(G,32)+":</span>",N=`<span class="dis-label">${this.makeLabelText(G)}</span>`,L=`${j}  ${v(z.instruction.opcode,32)}  ${N}${z.disassembly}`,M=$(`<span class="dis-line">${L}</span>`);if(M.find(".dis-label").data("address",G).css("color",this.makeLabelColor(G)).click(this.onLabelClicked.bind(this)),G===F.pc)M.addClass("dis-line-cur");if(H)M.addClass("dis-line-target"),this.setLabelColor(M.find(".dis-address-target"),G);Q.append(M),Q.append("<br>");let V="&nbsp;";if(n64js.breakpoints().isBreakpoint(G))V="&bull;";let h=$(`<span>${V}</span>`).data("address",G).click(this.onClickBreakpoint.bind(this));q.append(h),q.append("<br>")}Q.find(".dis-address-jump").each(function(){let Y=parseInt($(this).text(),16);this.setLabelText($(this),Y),this.setLabelColor($(this),Y),$(this).click(function(){this.rspstate.disasmAddress=Y,this.redraw()})}.bind(this));const K=o4(F.pc,F.imem.getU32(F.pc)).instruction;let X=this.makeRegisterColours(K);for(let[Y,z]of X)Q.find(".dis-reg-"+Y).css("background-color",z);this.$rspDisassembly.find(".dis-recent-memory").html(this.makeRecentMemoryAccesses(J,K,F.calcDebuggerAddress.bind(F))),this.$rspDisassembly.find(".dis-gutter").empty().append(q),this.$rspDisassembly.find(".dis-view").empty().append(Q),this.rspState.updateStatusTable(),this.rspTabs[0].empty().append(this.rspState.makeScalarRegistersTable(X)),this.rspTabs[1].empty().append(this.rspState.makeVectorRegistersTable(X)),this.rspTabs[2].empty().append(this.rspState.makeTaskTable())}makeRegisterColours(J){const Z=["#fd7e14","#198754","#0d6efd"];let q=new Map;if(J){let Q=0;for(let W in J.srcRegs)if(!Object.prototype.hasOwnProperty.call(q,W))q.set(W,Z[Q++]);for(let W in J.dstRegs)if(!Object.prototype.hasOwnProperty.call(q,W))q.set(W,Z[Q++])}return q}makeRecentMemoryAccesses(J,Z,q){const Q=P.opsExecuted;if(J){if(this.lastStore){if(this.lastStore.cycle+1===Q){let X=this.makeRecentMemoryAccessRow(this.lastStore.address,"update");this.lastStore.element.append(X)}this.lastStore=null}const K=Z.memory;if(K){const X=q(Z.opcode);let Y=this.makeRecentMemoryAccessRow(X,K.mode);if(K.mode==="store")this.lastStore={address:X,cycle:Q,element:Y};if(this.recentMemoryAccesses.push({element:Y}),this.recentMemoryAccesses.length>4)this.recentMemoryAccesses.splice(0,1);this.lastMemoryAccessAddress=X}}else this.recentMemoryAccesses=[],this.lastStore=null;let W=$("<pre />");if(this.recentMemoryAccesses.length>0){const K=["#bbb","#999","#666","#333"];for(let X=0;X<this.recentMemoryAccesses.length;++X){let Y=this.recentMemoryAccesses[X].element;Y.css("color",K[X]),W.append(Y)}}return W}updateDynarec(){let J=new Map,Z=0,q=[];r2().forEach((X)=>{let Y=X.executionCount>0?Math.floor(Math.log10(X.executionCount)):0;J.set(Y,(J.get(Y)||0)+1),q.push(X),Z=Math.max(Z,Y)}),q.sort((X,Y)=>{return Y.opsCompiled*Y.executionCount-X.opsCompiled*X.executionCount});let Q=$('<div class="container-fluid" />'),W="";W+='<div class="row">',W+='<table class="table table-condensed table-nonfluid"><tr><th>Execution Count</th><th>Frequency</th></tr>';for(let X=0;X<=Z;X++){let Y=J.get(X)||0,z=`< ${Math.pow(10,X+1)}`;W+=`<tr><td>${z}</td><td>${Y}</td></tr>`}W+="</table>",W+="</div>",Q.append(W),W="",W+='<div class="row">',W+='  <div class="col-lg-6" id="fragments" />',W+='  <div class="col-lg-6" id="fragment-code" />',W+="</div>";let K=$(W);this.createHotFragmentsTable(K,q),Q.append(K),this.$dynarecContent.empty().append(Q)}createHotFragmentsTable(J,Z){let q=J.find("#fragment-code"),Q=$('<table class="table table-condensed" />'),W=["Address","Execution Count","Length","ExecCount * Length"];Q.append(`<tr><th>${W.join("</th><th>")}</th></tr>`);for(let K=0;K<Z.length&&K<20;++K){let X=Z[K],Y=[k(X.entryPC),X.executionCount,X.opsCompiled,X.executionCount*X.opsCompiled],z=$(`<tr><td>${Y.join("</td><td>")}</td></tr>`);this.initFragmentRow(z,X,q),Q.append(z)}if(J.find("#fragments").append(Q),Z.length>0)q.append(`<pre>${Z[0].func.toString()}</pre>`)}initFragmentRow(J,Z,q){J.click(()=>{q.html(`<pre>${Z.func.toString()}</pre>`)})}updateTimeline(){const J=n64js.hardware().timeline,Z=this.$timelineContent.find(".timeline-panel");Z.empty();let q=Number.MAX_VALUE,Q=0;J.tracks.forEach((z)=>{z.events.forEach((G)=>{if(G.start<q)q=G.start;if(G.end>Q)Q=G.end})});const W=Q-q;if(W<=0)return;const K=4000,X=30;let Y=0;J.tracks.forEach((z)=>{let G=0;z.events.forEach((H)=>{const j=K*(H.start-q)/W,N=K*(H.end-H.start)/W,L=N<1?1:N,M=(Y+H.depth)*X,V=X,h=H.name;let b="";if(b+=`<div class="timeline-block" style="left: ${j.toFixed(0)}px; top: ${M.toFixed(0)}px; width: ${L.toFixed(0)}px; height: ${V.toFixed(0)}px">`,b+=`<div class="timeline-name">${h}</div>`,b+="</div>",Z.append(b),H.depth>G)G=H.depth}),Y+=G+1})}disassemblerDown(){this.scrollActiveDisassemblyWindow(1),this.redraw()}disassemblerUp(){this.scrollActiveDisassemblyWindow(-1),this.redraw()}disassemblerPageDown(){this.scrollActiveDisassemblyWindow(16),this.redraw()}disassemblerPageUp(){this.scrollActiveDisassemblyWindow(-16),this.redraw()}scrollActiveDisassemblyWindow(J){const Z=this.activeDisassemblyWindow();if(Z)Z.scroll(J)}activeDisassemblyWindow(){if(this.$cpuContent.hasClass("active"))return this.cpu0State;if(this.$rspContent.hasClass("active"))return this.rspState;return null}redraw(){if(!this.active)return;if(this.$cpuContent.hasClass("active"))this.updateCPU();if(this.$rspContent.hasClass("active"))this.updateRSP();if(this.$memoryContent.hasClass("active"))this.updateMemoryView();if(this.$dynarecContent.hasClass("active"))this.updateDynarec()}}class E1{constructor(){this.disasmAddress=0,this.lastPC=-1}setPC(J){if(J!==this.lastPC)this.disasmAddress=J,this.lastPC=J}scroll(J){this.disasmAddress+=J*4}}class OY extends E1{disassembleRange(){return iQ(this.disasmAddress-64,this.disasmAddress+64,!0)}updateStatusTable(){f0("#cpu0-status-opsexecuted",P.opsExecuted),f0("#cpu0-status-pc",k(P.pc)),f0("#cpu0-status-delaypc",k(P.delayPC)),f0("#cpu0-status-epc",k(P.getControlU32(t6))),f0("#cpu0-status-cause",k(Number(P.moveFromControl(c0)&0xffff_ffffn))),f0("#cpu0-status-count",k(Number(P.moveFromControl(s9)&0xffff_ffffn))),f0("#cpu0-status-compare",k(P.getControlU32(w8))),f0("#cpu0-status-multhi",P9(P.getMultHiU64())),f0("#cpu0-status-multlo",P9(P.getMultLoU64())),this.updateStatusRegisterRow(),this.updateMipsInterruptsRow();let J=$("#cpu0-status-events").find("tbody");J.empty(),J.append("<tr><td>&nbsp;</td></tr>"),J.append("<tr><td>Events</td></tr>");const Z=P.eventQueue;let q=Z.cyclesToFirstEvent;for(let Q=Z.firstEvent;Q;Q=Q.next)J.append(`<tr><td>${Q.getName()}</td><td class="fixed">${q}</td></tr>`),q+=Q.cyclesToNextEvent}updateStatusRegisterRow(){const J=P.getControlU32(_0);f0("#cpu0-status-sr",k(J));const Z={"#cpu0-status-sr-ie":a3,"#cpu0-status-sr-exl":F5,"#cpu0-status-sr-erl":H5};for(let[q,Q]of Object.entries(Z)){const W=document.querySelector(q);if(!W)continue;const K=(J&Q)!==0;W.classList.toggle("cpu0-status-bit-set",K)}}updateMipsInterruptsRow(){const J=n64js.hardware().miRegDevice,Z=J.intrReg(),q=J.intrMaskReg(),Q={"#cpu0-status-mi-sp":W4,"#cpu0-status-mi-si":z9,"#cpu0-status-mi-ai":j5,"#cpu0-status-mi-vi":k5,"#cpu0-status-mi-pi":N5,"#cpu0-status-mi-dp":Q4};for(let[W,K]of Object.entries(Q)){const X=document.querySelector(W);if(!X)continue;const Y=(Z&K)!==0,z=(q&K)!==0;X.classList.toggle("cpu0-status-bit-enabled",z),X.classList.toggle("cpu0-status-bit-set",Y)}}makeCop0RegistersTable(J){let Z=$('<table class="register-table"><tbody></tbody></table>'),q=Z.find("tbody");const Q=2;for(let W=0;W<32;W+=Q){let K=$("<tr />");for(let X=0;X<Q;++X){let Y=g2[W+X],z=$(`<td>${Y}</td><td class="fixed">${P9(P.getRegU64(W+X))}</td>`);if(J.has(Y))z.attr("bgcolor",J.get(Y));K.append(z)}q.append(K)}return Z}makeCop1RegistersTable(J){let Z=$('<table class="register-table"><tbody></tbody></table>'),q=Z.find("tbody");for(let Q=0;Q<32;++Q){let W=m2[Q],K;if((Q&1)===0)K=$(`<td>${W}</td>
                 <td class="fixed fp-w">${k(i.regU32[Q])}</td>
                 <td class="fixed fp-s">${i.regF32[Q]}</td>
                 <td class="fixed fp-d">${i.regF64[Q/2]}</td>`);else K=$(`<td>${W}</td>
                 <td class="fixed fp-w">${k(i.regU32[Q])}</td>
                 <td class="fixed fp-s">${i.regF32[Q]}</td>
                 <td></td>`);let X=$("<tr />");if(X.append(K),J.has(W))X.attr("bgcolor",J.get(W));else if(J.has(W+"-w"))X.find(".fp-w").attr("bgcolor",J.get(W+"-w"));else if(J.has(W+"-s"))X.find(".fp-s").attr("bgcolor",J.get(W+"-s"));else if(J.has(W+"-d"))X.find(".fp-d").attr("bgcolor",J.get(W+"-d"));q.append(X)}return Z}}class yY extends E1{disassembleRange(){return s5(F.imem,this.disasmAddress-64,this.disasmAddress+64,!0)}updateStatusTable(){f0("#rsp-status-halted",F.halted),f0("#rsp-status-pc",k(F.pc)),f0("#rsp-status-delaypc",k(F.delayPC)),f0("#rsp-status-nextpc",k(F.nextPC)),f0("#rsp-status-branchtarget",k(F.branchTarget)),f0("#rsp-status-vco",Z0(F.VCO)),f0("#rsp-status-vcc",Z0(F.VCC)),f0("#rsp-status-vce",v0(F.VCE))}makeScalarRegistersTable(J){let Z=$('<table class="register-table"><tbody></tbody></table>'),q=Z.find("tbody");const Q=2;for(let W=0;W<32;W+=Q){let K=$("<tr />");for(let X=0;X<Q;++X){let Y=c2[W+X],z=$(`<td>${Y}</td><td class="fixed">${k(F.getRegU32(W+X))}</td>`);if(J.has(Y))z.attr("bgcolor",J.get(Y));K.append(z)}q.append(K)}return Z}makeVectorRegistersTable(J){let Z=$('<table class="register-table"><tbody></tbody></table>'),q=Z.find("tbody");for(let Q=0;Q<32;Q++){let W=$("<tr />");const K=`V${Q}`;W.append($(`<td>${K}</td>`));for(let X=0;X<8;++X){let Y=$(`<td class="fixed">${v(F.getVecU16(Q,X),16)}</td>`);if(J.has(K))Y.attr("bgcolor",J.get(K));W.append(Y)}q.append(W)}return Z}makeTaskTable(){const q=n64js.hardware().sp_mem.subRegion(4032,64);let Q=$('<table class="register-table"><tbody></tbody></table>'),W=Q.find("tbody");for(let K=0;K<64;K+=4){const X=$(`<tr><td>${C9.nameOf(K)}</td><td class="fixed">${v(q.getU32(K),32)}</td></tr>`);W.append(X)}return Q}}function EY(J){const Z=new DataView(J);switch(Z.getUint32(0)){case 2151092800:break;case 1074935680:T1(J,3,2,1,0);break;case 306217015:T1(J,2,3,0,1);break;case 931151890:T1(J,1,0,3,2);break;default:throw"Unhandled byteswapping: "+Z.getUint32(0).toString(16)}}var T1=function(J,Z,q,Q,W){const K=new Uint8Array(J);for(let X=0;X<K.length;X+=4){const Y=K[X+Z],z=K[X+q],G=K[X+Q],H=K[X+W];K[X+0]=Y,K[X+1]=z,K[X+2]=G,K[X+3]=H}};function TY(J){const Z=String.fromCodePoint(...J);return btoa(Z)}function S1(J){const Z=atob(J);return Uint8Array.from(Z,(q)=>q.codePointAt(0))}var SY=0;class v1{constructor(J){this.getOpsExecuted=J,this.recording=!1,this.tracks=[new _1(this,"Default"),new _1(this,"Audio")],this.eventCount=0,this.curFrameEvent=0,this.frameCount=0}startRecording(){this.recording=!0;for(let J=0;J<this.tracks.length;J++)this.tracks[J].reset();this.eventCount=0,this.frameCount=0}newFrame(){if(!this.recording)return null;if(this.curFrameEvent)this.curFrameEvent.stop();if(this.tracks[1].curEvent=null,this.curFrameEvent=this.startEventInternal(`Frame ${this.frameCount}`,1),this.frameCount++,this.eventCount>=1e4||this.frameCount>=10)this.recording=!1,this.curFrameEvent=null,n64js.debugger().showTimeline()}addEvent(J,Z){if(!this.curFrameEvent)return null;const q=this.startEventInternal(J,Z);if(q)q.stop()}startEvent(J,Z){if(!this.curFrameEvent)return null;return this.startEventInternal(J,Z)}startEventInternal(J,Z){const q=Z==null?1:Z,Q=this.tracks[q];return this.eventCount++,Q.startEvent(J)}}class _1{constructor(J,Z){this.timeline=J,this.name=Z,this.events=[],this.curEvent=null}reset(){this.events=[],this.curEvent=null}startEvent(J){const Z=this.timeline.getOpsExecuted(),q=new _Y(this,this.curEvent,J,Z);return this.events.push(q),this.curEvent=q,q}stopEvent(J){if(J.end=this.timeline.getOpsExecuted(),this.curEvent==J)this.curEvent=J.parent}}class _Y{constructor(J,Z,q,Q){this.track=J,this.parent=Z,this.depth=Z?Z.depth+1:0,this.name=q,this.start=Q,this.end=Q}stop(){this.track.stopEvent(this)}}var Rh=function(J){if(J<xY)return xY;if(J>gY)return gY;return J},Fh=0,Hh=4,Gh=8,vY=12,$h=16,jh=20,kh=1,Nh=17825792,Lh=33554432,Mh=1073741824,Ph=2147483648,Vh=16777208,Uh=262136,fY="AI DMA",uY=0.005,xY=3000,gY=96000,hh=0.1,mY=5;class f1 extends l{constructor(J,Z,q){super("AIReg",J,J.ai_reg,Z,q);this.audioContext=new window.AudioContext,this.pendingAddress=0,this.dmaAddresses=new Uint32Array(2),this.dmaLengths=new Uint32Array(2),this.dmaDurations=new Uint32Array(2),this.dmaCount=0,this.dmaEnable=!1,this.dacRate=0,this.bitRate=15,this.precision=16,this.frequency=32000,this.time=0,this.dynamicRate=1,this.lastLogTime=0}readU32(J){const Z=this.calcWriteEA(J);if(Z+4>this.u8.length)throw"Write is out of range";if(!this.quiet)U(`Read from ${k(Z)}`);if(Z==vY){let q=Nh;return q|=this.dmaEnable?Lh:0,q|=this.dmaCount>0?Mh:0,q|=this.dmaCount>1?Ph:0,q|=this.dmaCount>1?kh:0,q}return this.dmaLengthRemaining()>>>0}write32(J,Z){const q=this.calcWriteEA(J);if(q+4>this.u8.length)throw"Write is out of range";switch(q){case Fh:if(!this.quiet)U(`Wrote to AI_DRAM_ADDR_REG: ${k(Z)}`);this.pendingAddress=Z&Vh;break;case Hh:if(!this.quiet)U(`Wrote to AI_LEN_REG: ${k(Z)}`);this.pushDMA(Z&Uh);break;case Gh:if(!this.quiet)U(`Wrote to AI_CONTROL_REG: ${k(Z)}`);this.dmaEnable=(Z&1)!=0;break;case vY:this.clearAI();break;case $h:if(this.dacRate=Z&16383,this.frequency=Math.max(1,this.viClock/(this.dacRate+1))>>0,!this.quiet)U(`AI dacrate changed to ${this.dacRate}, vi clock is ${this.viClock}, freq ${this.frequency}`);break;case jh:if(!this.quiet)U(`Wrote to AI_BITRATE_REG: ${k(Z)}`);this.bitRate=Z&15,this.precision=this.bitRate+1;break;default:U(`Unhandled write to AIReg: ${k(Z)} -> [${k(J)}]`);break}}get viClock(){return this.hardware.viRegDevice.videoClock}pushDMA(J){if(!J){n64js.warn("AI received zero length write");return}if(this.dmaCount>=2){n64js.warn("AI DMA FIFO is full");return}if(this.dmaAddresses[this.dmaCount]=this.pendingAddress,this.dmaLengths[this.dmaCount]=J,this.dmaDurations[this.dmaCount]=this.estimateDMACyclesFromLength(J),this.dmaCount++,this.dmaCount==1)this.startPlayback()}popDMA(){if(this.dmaCount<=0){n64js.warn("AI DMA underflow");return}if(this.dmaCount==2)this.dmaAddresses[0]=this.dmaAddresses[1],this.dmaLengths[0]=this.dmaLengths[1],this.dmaDurations[0]=this.dmaDurations[1];if(this.dmaCount--,this.dmaCount==1)this.startPlayback()}estimateDMACyclesFromLength(J){const q=(this.bitRate+1<<1)/8*this.frequency;return J*this.viClock/q>>>0}startPlayback(){const J=this.dmaAddresses[0],Z=this.dmaLengths[0],q=this.dmaDurations[0],Q=Z/4,W=new Float32Array(Q),K=new Float32Array(Q),X=this.hardware.cachedMemDevice.u8,Y=new DataView(X.buffer,J,Z);for(let L=0;L<Q;L++)W[L]=Y.getInt16(L*4+0)/32768,K[L]=Y.getInt16(L*4+2)/32768;const z=this.audioContext.currentTime,G=this.time-z;this.dynamicRate=G>0?+uY:-uY;const H=Rh(this.frequency*(1+this.dynamicRate));if(mY>0&&z-this.lastLogTime>mY){const L=G>0?"leading":"lagging";console.log(`AI sync: timeDelta ${G}, ${L}, dynamic ${this.dynamicRate}, ${this.frequency} -> ${H}`),this.lastLogTime=z}const j=new AudioBuffer({length:Q,sampleRate:H,numberOfChannels:2});j.copyToChannel(W,0),j.copyToChannel(K,1);const N=new AudioBufferSourceNode(this.audioContext,{buffer:j});if(N.connect(this.audioContext.destination),N.start(this.time),G<0)this.time=z;this.time+=j.duration,this.raiseAI(),this.addAIDMAEvent(q)}shouldSkipFrame(){return this.time-this.audioContext.currentTime>hh}dmaLengthRemaining(){if(this.dmaCount==0||this.dmaDurations[0]==0)return 0;const J=n64js.cpu0.getCyclesUntilEvent(fY);if(J<=0)return 0;return J*this.dmaLengths[0]/this.dmaDurations[0]&~7}addAIDMAEvent(J){const Z=n64js.hardware().timeline.startEvent("AI DMA",SY),q=this;n64js.cpu0.addEvent(fY,J,()=>{if(q.dmaComplete(),Z)Z.stop()})}dmaComplete(){this.popDMA()}raiseAI(){this.hardware.mi_reg.setBits32(z0,j5),n64js.cpu0.updateCause3()}clearAI(){this.hardware.mi_reg.clearBits32(z0,j5),n64js.cpu0.updateCause3()}}var u1=0,x1=4,g1=8,K4=12,bh=16,Dh=20,Ah=24,wh=28,Bh=1,Ih=2,Ch=4,Oh=8,yh=16,Eh=32;var m1=1,pY=2,aY=4,cY=8;var oY=32;var Th=128;var dY=1024,p1=16777208,Sh=2047;class a1 extends l{constructor(J,Z,q){super("DPC",J,J.dpc_mem,Z,q)}get startReg(){return this.mem.getU32(u1)}get endReg(){return this.mem.getU32(x1)}get currentReg(){return this.mem.getU32(g1)}get statusReg(){return this.mem.getU32(K4)}set startReg(J){this.mem.set32(u1,J&p1)}set endReg(J){this.mem.set32(x1,J&p1)}set currentReg(J){this.mem.set32(g1,J&p1)}set statusReg(J){this.mem.set32(K4,J&Sh)}setStatusBits(J,Z){this.mem.set32masked(K4,Z?J:0,J)}get xbusDmemDMA(){return(this.statusReg&m1)!=0}get startValid(){return(this.statusReg&dY)!=0}set startValid(J){this.setStatusBits(dY,J)}write32(J,Z){this.writeReg32(this.calcWriteEA(J),Z)}writeReg32(J,Z){if(J+4>this.u8.length)throw"Write is out of range";switch(J){case u1:if(!this.quiet)U(`DPC start set to: ${k(Z)}`);if(this.startValid);else this.startReg=Z,this.startValid=!0;break;case x1:if(!this.quiet)U(`DPC end set to: ${k(Z)}`);if(this.currentReg=this.startReg,this.endReg=Z,this.startValid);this.startValid=!1,this.setStatusBits(Th|oY|cY,!0),this.processBuffer();break;case K4:this.updateStatus(Z);break;case g1:case bh:case Dh:case Ah:case wh:U("Wrote to read only DPC reg");break;default:this.mem.set32(J,Z);break}}readU32(J){return this.logRead(J),this.readRegU32(this.calcReadEA(J))}readRegU32(J){if(J+4>this.u8.length)throw"Read is out of range";return this.mem.getU32(J)}updateStatus(J){let Z=this.mem.getU32(K4);if(J&Bh)Z&=~m1;if(J&Ih)Z|=m1;if(J&Ch)Z&=~pY;if(J&Oh)Z|=pY;if(J&yh)Z&=~aY;if(J&Eh)Z|=aY;this.mem.set32(K4,Z)}processBuffer(){let J;if(this.xbusDmemDMA){const Z=this.hardware.sp_mem.subRegion(0,4096).dataView;J=new Z8(Z,this.currentReg,this.endReg,4095)}else{const Z=this.hardware.cachedMemDevice.mem.dataView;J=new Z8(Z,this.currentReg,this.endReg)}if(B0.dumpRDP)console.log(`Processing RDP buffer: start ${k(this.startReg)}, current ${k(this.currentReg)}, end ${k(this.endReg)}, xbus ${this.xbusDmemDMA}`),nW(J).forEach((q)=>{console.log(`${v(q.address,24)}: ${q.disassembly}`)}),B0.dumpRDP=!1;this.hardware.rdp.run(J),this.currentReg=J.curAddr}syncFull(){this.setStatusBits(oY|cY,!1),this.hardware.mi_reg.setBits32(z0,Q4),n64js.cpu0.updateCause3()}}class c1 extends l{constructor(J,Z,q){super("DPS",J,J.dps_mem,Z,q)}write32(J,Z){if(this.calcWriteEA(J)+4>this.u8.length)throw"Write is out of range";throw"DPS writes are unhandled"}readU32(J){if(this.logRead(J),this.calcReadEA(J)+4>this.u8.length)throw"Read is out of range";throw"DPS reads are unhandled"}}function sh(J){return J>=dh&&J<n1}function ih(J){return J>=n1&&J<L5}function lY(J){return J>=L5&&J<l1}function th(J){return J>=l1&&J<=lh}function eh(J){return J>=iY&&J<=rh}var rY=function(J){return J>=L5&&J<=nh},X4=0,Y4=4,o1=8,d1=12,l6=16,_h=20,vh=24,fh=28,uh=32,xh=36,gh=40,mh=44,ph=48,c3=1;var ah=4,nY=8,ch=1,oh=2,dh=83886080,n1=100663296,L5=134217728,nh=134348799,l1=268435456,lh=532676607,iY=533725184,rh=2147483647,sY="PI Interrupt";class r1 extends l{constructor(J,Z,q){super("PIReg",J,J.pi_reg,Z,q);this.haveSetMemorySize=!1}reset(){this.haveSetMemorySize=!1}setMemorySize(){if(!this.haveSetMemorySize){const J=this.hardware.rominfo.cic==="6105"?2147484656:2147484440;this.hardware.ram.set32(J-2147483648,8388608),U("Setting memory size"),this.haveSetMemorySize=!0}}readU32(J){const Z=this.calcReadEA(J);if(Z+4>this.u8.length)throw"Read is out of range";let q=this.mem.getS32(Z);switch(Z){case X4:q&=16777214;break;case Y4:q&=4294967294;break;case o1:case d1:q=127;break}if(!this.quiet)U(`Reading from PIReg: [${k(J)}] -> ${k(q)}`);return q>>>0}write32(J,Z){const q=this.calcWriteEA(J);if(q+4>this.u8.length)throw"Write is out of range";if(!this.quiet)U(`Writing to PIReg: ${k(Z)} -> [${k(J)}]`);if(this.busy()&&q!=l6){n64js.warn("Write to PI registers while DMA or IO busy"),this.mem.setBits32(l6,ah);return}switch(q){case X4:case Y4:this.mem.set32(q,Z);break;case o1:this.mem.set32(q,Z),this.copyFromRDRAM();break;case d1:this.mem.set32(q,Z),this.copyToRDRAM();break;case l6:if(Z&ch){if(!this.quiet)U("PI_STATUS_REG reset");this.mem.set32(l6,0),this.removePIInterrupt()}if(Z&oh){if(!this.quiet)U("PI interrupt cleared");this.mem.clearBits32(l6,nY),this.hardware.mi_reg.clearBits32(z0,N5),n64js.cpu0.updateCause3()}break;case _h:case vh:case fh:case uh:case xh:case gh:case mh:case ph:this.mem.set32(q,Z);break;default:U(`Unhandled write to PIReg: ${k(Z)} -> [${k(J)}]`),this.mem.set32(q,Z);break}}busy(){return this.mem.getBits32(l6,c3)!=0}copyFromRDRAM(){const J=this.mem.getU32(X4)&16777214,Z=this.mem.getU32(Y4)&4294967294;let q=(this.mem.getU32(o1)&16777215)+1,Q,W=0,K=4096;if(q>=127&&q&1)q++;if(lY(Z))if(rY(Z))switch(this.hardware.saveType){case"SRAM":Q=this.hardware.saveMem,W=Z-L5,this.hardware.saveDirty=!0;break;case"FlashRam":if(Q=this.hardware.romD2A2Device.flashBuffer,W=0,q>Q.length)n64js.warn(`PI DMA to FlashRam exceeds buffer length (${q} > ${Q.length})`),q=Q.length;break}else n64js.halt(`PI: unknown dom2addr2 address for ram->cart DMA: ${k(Z)}`);else n64js.halt(`PI: unknown cart address for ram->cart DMA: ${k(Z)}`);if(Q)Q.copy(W,this.hardware.ram,J,q);this.mem.setBits32(l6,c3),this.addPIInterrupt(K)}copyToRDRAM(){const J=this.mem.getU32(X4)&16777214,Z=this.mem.getU32(Y4)&4294967294;let q=(this.mem.getU32(d1)&16777215)+1;if(!this.quiet)U(`PI: copying ${q} bytes of data from ${k(Z)} to ${k(J)}`);if(q>=127&&q&1)q++;if(q<=128)q-=J&7;let Q,W=0,K=this.estimateDMACyclesFromLength(q);if(ih(Z))Q=this.hardware.rom,W=Z-n1;else if(th(Z))Q=this.hardware.rom,W=Z-l1;else if(eh(Z))Q=this.hardware.rom,W=Z-iY;else if(sh(Z))n64js.halt("PI: dom2addr1 transfer is unhandled (save)");else if(lY(Z))if(rY(Z)){switch(W=Z-L5,this.hardware.saveType){case"SRAM":Q=this.hardware.saveMem;break;case"FlashRam":Q=this.hardware.romD2A2Device.flashDMASource();break}K=4096}else n64js.halt(`PI: unknown dom2addr2 address for cart->ram DMA: ${k(Z)}`);else n64js.halt(`PI: unknown cart address for cart->ram DMA: ${k(Z)}`);if(Q)this.hardware.ram.copy(J,Q,W,q);this.setMemorySize(),this.mem.setBits32(l6,c3),this.mem.set32(X4,this.mem.getU32(X4)+q+7&~7),this.mem.set32(Y4,this.mem.getU32(Y4)+q+1&~1),this.addPIInterrupt(K)}estimateDMACyclesFromLength(J){const Z=J>>>3;if(Z)return Z;return 16}removePIInterrupt(){n64js.cpu0.removeEvent(sY)}addPIInterrupt(J){const Z=n64js.hardware().timeline.startEvent("PI DMA"),q=this;n64js.cpu0.addEvent(sY,J,()=>{if(q.dmaComplete(),Z)Z.stop()})}dmaComplete(){this.mem.clearBits32(l6,c3),this.mem.setBits32(l6,nY),this.hardware.mi_reg.setBits32(z0,N5),n64js.cpu0.updateCause3()}}var s1=0,JR=4,ZR=16,_9=24;var z4=4096;class i1 extends l{constructor(J,Z,q){super("SIReg",J,J.si_reg,Z,q)}readU32(J){this.logRead(J);const Z=this.calcReadEA(J);if(Z+4>this.u8.length)throw"Read is out of range";if(Z===_9)this.checkStatusConsistent();return this.mem.getU32(Z)}write32(J,Z){const q=this.calcWriteEA(J);if(q+4>this.u8.length)throw"Write is out of range";switch(q){case s1:if(!this.quiet)U(`Writing to SI dram address reigster: ${k(Z)}`);this.mem.set32(q,Z);break;case JR:this.mem.set32(q,Z),this.copyToRDRAM();break;case ZR:this.mem.set32(q,Z),this.copyFromRDRAM();break;case _9:if(!this.quiet)U("SI interrupt cleared");this.mem.clearBits32(_9,z4),this.hardware.mi_reg.clearBits32(z0,z9),n64js.cpu0.updateCause3();break;default:U(`Unhandled write to SIReg: ${k(Z)} -> [${k(J)}]`),this.mem.set32(q,Z);break}}checkStatusConsistent(){const J=this.hardware.mi_reg.getBits32(z0,z9)!==0,Z=this.mem.getBits32(_9,z4)!==0;if(J!==Z)n64js.halt("SI_STATUS register is in an inconsistent state")}copyFromRDRAM(){const J=this.mem.getU32(s1)&536870911;if(!this.quiet)U(`SI: copying from ${k(J)} to PIF RAM`);n64js.joybus().dmaWrite(this.hardware.ram,J),this.mem.setBits32(_9,z4),this.hardware.mi_reg.setBits32(z0,z9),n64js.cpu0.updateCause3()}copyToRDRAM(){const J=this.mem.getU32(s1)&536870911;if(!this.quiet)U(`SI: copying from PIF RAM to ${k(J)}`);n64js.joybus().dmaRead(this.hardware.ram,J),this.mem.setBits32(_9,z4),this.hardware.mi_reg.setBits32(z0,z9),n64js.cpu0.updateCause3()}}class t1 extends l{constructor(J,Z,q){super("PIFMEM",J,J.pif_mem,Z,q)}readU32(J){const Z=this.calcReadEA(J);if(Z+4>this.u8.length)throw"Read is out of range";const q=this.mem.getU32(Z);if(Z<1984)U(`Reading from PIF rom (${k(J)}). Got ${k(q)}`);else{const Q=Z-1984;switch(Q){case 36:U(`Reading PIF CIC values: ${k(q)}`);break;case 60:U(`Reading PIF Control byte: ${k(q)}`);break;default:U(`Reading from PIF ram [${k(J)}]. Got ${k(q)}`);break}n64js.joybus().cpuRead(Q)}return q}readU8(J){const Z=this.calcReadEA(J),q=this.mem.getU8(Z);if(Z<1984)U(`Reading from PIF rom (${k(J)}). Got ${v0(q)}`);else{const Q=Z-1984;switch(Q){case 36:U(`Reading PIF CIC values: ${v0(q)}`);break;case 60:U(`Reading PIF Control byte: ${v0(q)}`);break;default:U(`Reading from PIF ram [${k(J)}]. Got ${v0(q)}`);break}n64js.joybus().cpuRead(Q)}return q}write32(J,Z){const q=this.calcWriteEA(J);if(q<1984){U("Attempting to write to PIF ROM");return}this.mem.set32(q,Z);const Q=q-1984;switch(Q){case 36:U(`Writing PIF CIC values: ${k(Z)}`);break;case 60:U(`Writing PIF Control byte: ${k(Z)}`),this.updateControl();break;default:U(`Writing directly to PIF ram [${k(J)}] <-- ${k(Z)}`);break}n64js.joybus().cpuWrite(Q)}write16(J,Z){const q=this.calcWriteEA(J);if(q<1984){U("Attempting to write to PIF ROM");return}const Q=q&~3,W=8*(2-(q&2));this.mem.set32(Q,Z<<W)}write8(J,Z){const q=this.calcWriteEA(J);if(q<1984){U("Attempting to write to PIF ROM");return}const Q=q&~3,W=8*(3-(q&3));this.mem.set32(Q,Z<<W)}updateControl(){const J=this.mem.subRegion(0,1984),Z=this.mem.subRegion(1984,64),q=Z.getU8(63);switch(q){case 1:U("PIF: execute block");break;case 8:U("PIF: interrupt control"),Z.set8(63,0),this.hardware.si_reg.setBits32(_9,z4),this.hardware.mi_reg.setBits32(z0,z9),n64js.cpu0.updateCause3();break;case 16:U("PIF: clear rom"),J.clear();break;case 48:U("PIF: set 0x80 control "),Z.set8(63,128);break;case 192:U("PIF: clear ram"),Z.clear();break;default:n64js.halt(`Unknown PIF control value: ${v0(q)}`);break}}}class M5 extends l{constructor(J,Z,q){super("VMEM",J,J.ram,Z,q)}calcInternalEA(J){return n64js.cpu0.translateReadInternal(J)&8388607}calcReadEA(J){return n64js.cpu0.translateRead(J)&8388607}calcWriteEA(J){return n64js.cpu0.translateWrite(J)&8388607}}class e1 extends l{constructor(J,Z,q){super("RAM",J,J.ram,Z,q);this.dataView=this.mem.dataView,this.s32=this.mem.s32Array()}readU32(J){const Z=J-2147483648;return this.dataView.getUint32(Z,!1)}write32(J,Z){const q=J-2147483648;this.dataView.setUint32(q,Z,!1)}}class JZ extends l{constructor(J,Z,q){super("RAM",J,J.ram,Z,q)}}class o3 extends l{constructor(J,Z,q){super("Invalid",J,null,Z,q)}read(J){return U(`Reading from invalid address ${k(J)}`),0}write(J){U(`Writing to invalid address ${k(J)}`)}readU32(J){return this.read(J)>>>0}readU16(J){return this.read(J)&65535}readU8(J){return this.read(J)&255}write32(J,Z){this.write(J,Z)}write16(J,Z){this.write(J,Z)}write8(J,Z){this.write(J,Z)}}class ZZ extends l{constructor(J,Z,q){super("RDRAMReg",J,J.rdram_reg,Z,q)}calcEA(J){return J&255}}var QR=12;class qZ extends l{constructor(J,Z,q){super("RIReg",J,J.ri_reg,Z,q)}reset(){this.mem.set32(QR,1)}}class F9{constructor(J,Z,q){if(Z===void 0)Z=0;if(q===void 0)q=J.byteLength-Z;this.arrayBuffer=J,this.offset=Z,this.length=q,this.u8=new Uint8Array(J,Z,q),this.dataView=new DataView(J,Z,q)}clear(){for(let J=0;J<this.u8.length;++J)this.u8[J]=0}set(J,Z,q){for(let Q=0;Q<Z;++Q)this.u8[J+Q]=q}subRegion(J,Z){if(J+Z>this.length)throw"end is out of bounds";return new F9(this.arrayBuffer,this.offset+J,Z)}s32Array(){return new Int32Array(this.arrayBuffer,this.offset,this.length/4)}copy(J,Z,q,Q){if(J+Q>this.u8.length)throw"overflow dst";if(q+Q>Z.u8.length)throw"overflow src";for(let W=0;W<Q;++W)this.u8[J+W]=Z.u8[q+W]}getU64(J){return this.dataView.getBigUint64(J,!1)}getU32(J){return this.dataView.getUint32(J,!1)}getU16(J){return this.dataView.getUint16(J,!1)}getU8(J){return this.dataView.getUint8(J,!1)}getS64(J){return this.dataView.getBigInt64(J,!1)}getS32(J){return this.dataView.getInt32(J,!1)}getS16(J){return this.dataView.getInt16(J,!1)}getS8(J){return this.dataView.getInt8(J,!1)}set64masked(J,Z,q){const W=this.getU64(J,!1)&~q|Z&q;this.set64(J,W,!1)}set32masked(J,Z,q){const W=this.getU32(J,!1)&~q|Z&q;this.set32(J,W)}set64(J,Z){this.dataView.setBigUint64(J,Z,!1)}set32(J,Z){this.dataView.setUint32(J,Z,!1)}set16(J,Z){this.dataView.setUint16(J,Z,!1)}set8(J,Z){this.dataView.setUint8(J,Z,!1)}clearBits32(J,Z){const q=this.getU32(J)&~Z;return this.set32(J,q),q}setBits32(J,Z){const q=this.getU32(J)|Z;return this.set32(J,q),q}getBits32(J,Z){return this.getU32(J)&Z}}var jR=function(J){return(J<<16|J&65535)>>>0},WR=3019833364,QZ=3019833376,d3=512,KR=QZ+d3,XR=75,YR=120,zR=165,FR=180,HR=210,GR=225,$R=240,tY=0,eY=1,Jz=2,Zz=3,qz=4;class WZ extends l{constructor(J,Z,q){super("ROMd1a1",J,J.rom,Z,q)}write32(J,Z){throw`Writing to rom d1a1 ${k(Z)} -> [${k(J)}]`}write16(J,Z){throw`Writing to rom d1a1 ${Z0(Z)} -> [${k(J)}]`}write8(J,Z){throw`Writing to rom d1a1 ${v0(Z)} -> [${k(J)}]`}}class KZ extends l{constructor(J,Z,q){super("ROMd1a2",J,J.rom,Z,q);this.lastWrite=0,this.hasLastWrite=!1,this.debugBuffer=new ArrayBuffer(d3),this.debugBufferU32=new Uint32Array(this.debugBuffer),this.debugBufferU8=new Uint8Array(this.debugBuffer),this.output=""}calcEA(J){return J-this.rangeStart+2&~2}write64(J,Z){this.cacheLastWrite(Number(Z>>32n))}write32(J,Z){if(J==WR)return this.writeDebugBufferLen(Z);if(J>=QZ&&J<KR)return this.writeDebugBuffer32(J-QZ,Z);this.cacheLastWrite(Z>>>0)}write16(J,Z){const q=8*(2-(J&2));this.cacheLastWrite(Z<<q&4294967295)}write8(J,Z){const q=8*(3-(J&3));this.cacheLastWrite(Z<<q&4294967295)}readU32(J){if(this.hasLastWrite)return this.consumeLastWrite()>>>0;return super.readU32(J)}readU16(J){if(this.hasLastWrite)return this.consumeLastWrite()>>>16;return super.readU16(J)}readU8(J){if(this.hasLastWrite)return this.consumeLastWrite()>>>24;return super.readU8(J)}cacheLastWrite(J){if(!this.hasLastWrite)this.lastWrite=J,this.hasLastWrite=!0}consumeLastWrite(){return this.hasLastWrite=!1,this.lastWrite}writeDebugBufferLen(J){if(J>d3)console.log(`debug buffer value too long (${J}), truncating`),J=d3;for(let Z=0;Z<J;Z++)this.output+=String.fromCharCode(this.debugBufferU8[Z^3]);this.flushDebugOutput()}writeDebugBuffer32(J,Z){const q=J>>>2;this.debugBufferU32[q]=Z}flushDebugOutput(){const J=this.output.lastIndexOf("\n");if(J>=0)console.log(this.output.substring(0,J+1)),this.output=this.output.substring(J+1)}}class XZ extends l{constructor(J,Z,q){super("ROMd1a3",J,J.rom,Z,q)}write32(J,Z){throw`Writing to rom d1a3 ${k(Z)} -> [${k(J)}]`}write16(J,Z){throw`Writing to rom d1a3 ${Z0(Z)} -> [${k(J)}]`}write8(J,Z){throw`Writing to rom d1a3 ${v0(Z)} -> [${k(J)}]`}}class YZ extends l{constructor(J,Z,q){super("ROMd2a1",J,null,Z,q)}read(J){if(J==2768241928)return U("Reading from ROMd2a1 0xa5000508 - spoofing ~0 value"),~0;return U(`Reading from invalid ROMd2a1 address ${k(J)}`),0}readU32(J){return this.read(J)>>>0}readU16(J){return this.read(J)&65535}readU8(J){return this.read(J)&255}write32(J,Z){throw`Writing to rom ${k(Z)} -> [${k(J)}]`}write16(J,Z){throw`Writing to rom ${Z0(Z)} -> [${k(J)}]`}write8(J,Z){throw`Writing to rom ${v0(Z)} -> [${k(J)}]`}}class zZ extends l{constructor(J,Z,q){super("ROMd2a2",J,null,Z,q);this.flashMode=tY,this.flashStatus=new F9(new ArrayBuffer(8)),this.flashBuffer=new F9(new ArrayBuffer(128)),this.flashOffset=0}hasFlashRam(){return this.hardware.saveType=="FlashRam"}readU32(J){const Z=this.calcWriteEA(J);if(Z>=557056)return jR(J);if(this.hasFlashRam()){const q=Z&4;return this.flashStatus.getU32(q)}throw`Reading s32 from rom d2a2 [${k(J)}]`}readU16(J){throw`Reading 16 bits from rom d2a2 [${k(J)}]`}readU8(J){throw`Reading 8 bits from rom d2a2 [${k(J)}]`}write32(J,Z){const q=this.calcWriteEA(J);if(this.hasFlashRam()){if(q!=0)this.flashCommand(Z);return}throw`Writing s32 to rom ${k(Z)} -> [${k(J)}]`}write16(J,Z){throw`Writing s16 to rom ${Z0(Z)} -> [${k(J)}]`}write8(J,Z){throw`Writing s8 to rom ${v0(Z)} -> [${k(J)}]`}flashDMASource(){switch(this.flashMode){case Zz:return this.hardware.saveMem;case qz:return this.flashStatus}return n64js.warn(`Unexpected mode for flash DMA: ${this.flashMode}`),null}flashCommand(J){const Z=J>>>24&255;switch(Z){case XR:if(this.flashOffset=(J&65535)*128,!this.quiet)U(`set erase offset: ${k(this.flashOffset)}`);break;case YR:if(!this.quiet)U("set mode ERASE");this.flashMode=eY,this.flashStatus.set64(0,0x1111_8008_00c2_001dn);break;case zR:if(this.flashOffset=(J&65535)*128,!this.quiet)U(`set write offset: ${k(this.flashOffset)}`);this.flashStatus.set64(0,0x1111_8004_00c2_001dn);break;case FR:if(!this.quiet)U("setting mode WRITE");this.flashMode=Jz;break;case HR:switch(this.flashMode){case tY:if(!this.quiet)U("execute IDLE (ignored)");break;case eY:if(!this.quiet)U(`execute ERASE flash @ ${k(this.flashOffset)} (set saveMem to 0xff)`);this.hardware.saveMem.set(this.flashOffset,128,255),this.hardware.saveDirty=!0;break;case Jz:if(!this.quiet)U(`execute WRITE flash @ ${k(this.flashOffset)} (copy flashBuffer to saveMem)`);this.hardware.saveMem.copy(this.flashOffset,this.flashBuffer,0,128),this.hardware.saveDirty=!0;break;default:U(`execute (${k(J)}) with unhandled mode: ${this.flashMode}`);break}break;case GR:if(!this.quiet)U("setting mode STATUS");this.flashMode=qz,this.flashStatus.set64(0,0x1111_8001_00c2_001dn);break;case $R:if(!this.quiet)U("setting mode READ");this.flashMode=Zz,this.flashStatus.set64(0,0x1111_8004_f000_001dn);break;default:if(!this.quiet)U(`execute with unknown command ${k(Z)}`)}}}var kR=!0,FZ=0,HZ=4,GZ=8,$Z=12,P5=16,Qz=20,Wz=24,Kz=28,NR=4294967288,LR=4294967288,Xz=4287627256,Yz=4287627256,zz=4096,Fz=4293918720,Hz=20,F4=1044480,Gz=12,H4=4095,G4=0,jZ=1,kZ=2,$z=4,NZ=8,LZ=16,jz=32,kz=64,Nz=128,Lz=256,Mz=512,Pz=1024,Vz=2048,Uz=4096,hz=8192,Rz=16384,bz=32768,Dz=65536,Az=131072,wz=262144,Bz=524288,Iz=1048576,Cz=2097152,Oz=4194304,yz=8388608,Ez=16777216,MZ=1,Tz=2,Sz=4,_z=8;var MR=32,vz=64,PR=128,VR=256,xz=512,UR=1024,hR=2048,RR=4096,bR=8192,DR=16384;var AR=xz,fz=0,wR=4092,BR="SP DMA",uz=1,IR=2;class gz{constructor(J,Z,q,Q){this.isRead=J,this.spMemAddr=Z,this.rdRamAddr=q,this.len=Q}}class PZ extends l{constructor(J,Z,q){super("SPMem",J,J.sp_mem,Z,q);this.pendingSPMemAddr=0,this.pendingDRAMAddr=0}calcEA(J){return(J-this.rangeStart)%8192}write64(J,Z){const q=this.calcWriteEA(J);this.mem.set32(q,Number(Z>>32n))}write16(J,Z){const q=this.calcWriteEA(J),Q=q&~3,W=8*(2-(q&2));this.mem.set32(Q,Z<<W)}write8(J,Z){const q=this.calcWriteEA(J),Q=q&~3,W=8*(3-(q&3));this.mem.set32(Q,Z<<W)}}class VZ extends l{constructor(J,Z,q){super("SPIBIST",J,J.sp_ibist_mem,Z,q)}write32(J,Z){switch(this.calcWriteEA(J)){case fz:this.hardware.rsp.pc=Z&wR;break;default:U(`Unhandled write to SPIBISTReg: ${k(Z)} -> [${k(J)}]`)}}readU32(J){const Z=this.calcReadEA(J);if(Z+4>this.u8.length)throw"Read is out of range";let q=0;switch(Z){case fz:q=this.hardware.rsp.pc,console.log(`value is ${k(q)}`);break;default:U(`Unhandled read from SPIBISTReg: [${k(J)}]`)}return q}}class UZ extends l{constructor(J,Z,q){super("SPReg",J,J.sp_reg,Z,q);this.dmaQueue=[]}write32(J,Z){this.writeReg32(this.calcWriteEA(J),Z)}writeReg32(J,Z){if(J+4>this.u8.length)throw"Write is out of range";switch(J){case FZ:this.pendingSPMemAddr=Z&NR;break;case HZ:this.pendingDRAMAddr=Z&LR;break;case GZ:this.mem.set32(J,Z&Xz),this.pushDMA(uz,Z&Xz);break;case $Z:this.mem.set32(J,Z&Yz),this.pushDMA(IR,Z&Yz);break;case P5:this.spUpdateStatus(Z);break;case Qz:case Wz:break;case Kz:this.mem.set32(J,0);break;default:U(`Unhandled write to SPReg: ${k(Z)} -> [${k(J)}]`),this.mem.set32(J,Z)}}readU32(J){return this.logRead(J),this.readRegU32(this.calcReadEA(J))}readRegU32(J){if(J+4>this.u8.length)throw"Read is out of range";const Z=this.mem.getU32(J);if(J==Kz)this.mem.set32(J,1);return Z}setStatusBits(J){if(this.mem.setBits32(P5,J)&vz)this.hardware.miRegDevice.interruptSP()}spUpdateStatus(J){if(!this.quiet){if(J&jZ)U("SP: Clearing Halt");if(J&kZ)U("SP: Setting Halt");if(J&$z)U("SP: Clearing Broke");if(J&NZ)U("SP: Clearing Interrupt");if(J&LZ)U("SP: Setting Interrupt");if(J&jz)U("SP: Clearing Single Step");if(J&kz)U("SP: Setting Single Step");if(J&Nz)U("SP: Clearing Interrupt on break");if(J&Lz)U("SP: Setting Interrupt on break");if(J&Mz)U("SP: Clearing Sig0 (Yield)");if(J&Pz)U("SP: Setting Sig0 (Yield)");if(J&Vz)U("SP: Clearing Sig1 (Yielded)");if(J&Uz)U("SP: Setting Sig1 (Yielded)");if(J&hz)U("SP: Clearing Sig2 (TaskDone)");if(J&Rz)U("SP: Setting Sig2 (TaskDone)");if(J&bz)U("SP: Clearing Sig3");if(J&Dz)U("SP: Setting Sig3");if(J&Az)U("SP: Clearing Sig4");if(J&wz)U("SP: Setting Sig4");if(J&Bz)U("SP: Clearing Sig5");if(J&Iz)U("SP: Setting Sig5");if(J&Cz)U("SP: Clearing Sig6");if(J&Oz)U("SP: Setting Sig6");if(J&yz)U("SP: Clearing Sig7");if(J&Ez)U("SP: Setting Sig7")}function Z(K,X,Y,z,G){const H=X&z,j=X&Y;if(H&&!j)return K|G;else if(j&&!H)return K&~G;return K}let q=this.mem.getU32(P5),Q=!1,W=!1;if(J&kZ&&J&jZ);else if(J&kZ)q|=MZ,W=!0;else if(J&jZ)q&=~MZ,Q=!0;if(J&LZ&&J&NZ);else if(J&LZ)this.hardware.mi_reg.setBits32(z0,W4),n64js.cpu0.updateCause3();else if(J&NZ)this.hardware.mi_reg.clearBits32(z0,W4),n64js.cpu0.updateCause3();if(q=Z(q,J,$z,0,Tz),q=Z(q,J,jz,kz,MR),q=Z(q,J,Nz,Lz,vz),q=Z(q,J,Mz,Pz,PR),q=Z(q,J,Vz,Uz,VR),q=Z(q,J,hz,Rz,xz),q=Z(q,J,bz,Dz,UR),q=Z(q,J,Az,wz,hR),q=Z(q,J,Bz,Iz,RR),q=Z(q,J,Cz,Oz,bR),q=Z(q,J,yz,Ez,DR),this.mem.set32(P5,q),Q)if(uK()||!kR)this.hardware.spRegDevice.setStatusBits(AR|Tz|MZ);else F.unhalt();else if(W)F.halt(0)}pushDMA(J,Z){if(this.dmaQueue.length>=2){n64js.warn("RSP DMA FIFO is full");return}const q=J==uz,Q=new gz(q,this.pendingSPMemAddr,this.pendingDRAMAddr,Z);if(this.dmaQueue.push(Q),this.setDMAStatus(),this.dmaQueue.length==1)this.startDMA(Q)}startDMA(J){if(J.isRead)this.spCopyFromRDRAM(J.spMemAddr,J.rdRamAddr,J.len);else this.spCopyToRDRAM(J.spMemAddr,J.rdRamAddr,J.len)}dmaComplete(){if(this.dmaQueue.shift(),this.dmaQueue.length>0)this.startDMA(this.dmaQueue[0]);this.setDMAStatus()}setDMAStatus(){const J=this.dmaQueue.length>=2?_z:0,Z=this.dmaQueue.length>=1?Sz:0;this.mem.set32(Qz,J?1:0),this.mem.set32(Wz,Z?1:0),this.mem.set32masked(P5,J|Z,_z|Sz)}spCopyFromRDRAM(J,Z,q){const Q=J&8191,W=Z&16777215,K=((q&H4)>>>G4|7)+1,X=((q&F4)>>>Gz)+1,Y=(q&Fz)>>>Hz,z=Q&zz;if(!this.quiet)U(`SP: copying ${K} bytes from ram ${k(W)} to sp ${Z0(Q)}, count ${X}, skip ${Y}`);let G=Q,H=W;for(let N=0;N<X;N++){for(let L=0;L<K;++L)this.hardware.sp_mem.u8[z|G&4095]=this.hardware.ram.u8[H],G++,H++;H+=Y}this.mem.set32(FZ,z|G&4095),this.mem.set32(HZ,H),this.mem.set32masked(GZ,4088<<G4,F4|H4),this.mem.set32masked($Z,4088<<G4,F4|H4);const j=this.estimateDMACyclesFromLength(X,K);this.addSPDMAEvent(j)}spCopyToRDRAM(J,Z,q){const Q=J&8191,W=Z&16777215,K=((q&H4)>>>G4|7)+1,X=((q&F4)>>>Gz)+1,Y=(q&Fz)>>>Hz,z=Q&zz;if(!this.quiet)U(`SP: copying ${K} bytes from sp ${Z0(Q)} to ram ${k(W)}, count ${X}, skip ${Y}`);let G=W,H=Q;for(let N=0;N<X;N++){for(let L=0;L<K;++L)this.hardware.ram.u8[G]=this.hardware.sp_mem.u8[z|H&4095],G++,H++;G+=Y}this.mem.set32(FZ,z|H&4095),this.mem.set32(HZ,G),this.mem.set32masked(GZ,4088<<G4,F4|H4),this.mem.set32masked($Z,4088<<G4,F4|H4);const j=this.estimateDMACyclesFromLength(X,K);this.addSPDMAEvent(j)}estimateDMACyclesFromLength(J,Z){const Q=J*Z>>>3;if(Q)return Q;return 16}addSPDMAEvent(J){const Z=this;n64js.cpu0.addEvent(BR,J,()=>{Z.dmaComplete()})}}var mR=function(J){switch(J){case B8:return xR;case x4:return dz;case sq:return gR}return dz},pR=function(J){return J==B8?50:60},mz=0,pz=4,az=8,hZ=12,RZ=16,CR=20,n3=24,OR=28,yR=32,ER=36,TR=40,SR=44,_R=48,vR=52,cz=2,oz=3;var fR=64;var uR=3,xR=49656530,dz=48681812,gR=48628316,bZ="VI Interrupt";class DZ extends l{constructor(J,Z,q){super("VIReg",J,J.vi_reg,Z,q);this.field=0,this.videoClock=0,this.refreshRate=0,this.countPerScanline=0,this.countPerVbl=0,this.reset()}reset(){const J=this.hardware.rominfo.tvType==x4;this.videoClock=mR(J),this.refreshRate=pR(J),this.countPerScanline=0,this.countPerVbl=0,this.screenWidth=640,this.screenHeight=J?480:576,this.hScanMin=J?108:128,this.hScanMax=this.hScanMin+this.screenWidth,this.vScanMin=J?34:44,this.vScanMax=this.vScanMin+this.screenHeight,this.dims=new nz(this.screenWidth,this.screenHeight)}get controlReg(){return this.mem.getU32(mz)}get dramAddrReg(){return this.mem.getU32(pz)}get hWidthReg(){return this.mem.getU32(az)}get vIntrReg(){return this.mem.getU32(hZ)}get vCurrentLineReg(){return this.mem.getU32(RZ)}get timingReg(){return this.mem.getU32(CR)}get vSyncReg(){return this.mem.getU32(n3)}get hSyncReg(){return this.mem.getU32(OR)}get hSyncLeapReg(){return this.mem.getU32(yR)}get hVideoReg(){return this.mem.getU32(ER)}get vVideoReg(){return this.mem.getU32(TR)}get vBurstReg(){return this.mem.getU32(SR)}get xScaleReg(){return this.mem.getU32(_R)}get yScaleReg(){return this.mem.getU32(vR)}get interlaced(){return(this.controlReg&fR)!=0}get modeType(){return this.controlReg&uR}get is32BitMode(){return this.modeType==oz}get is16BitMode(){return this.modeType==cz}get xScale(){return(this.xScaleReg&4095)/1024}get yScale(){return(this.yScaleReg&4095)/1024}get bitDepth(){switch(this.modeType){case oz:return 32;case cz:return 16}return 0}dump(){console.log(`VI_CONTROL = ${k(this.controlReg)}`),console.log(`VI_DRAM_ADDR = ${k(this.dramAddrReg)}`),console.log(`VI_H_WIDTH = ${k(this.hWidthReg)}`),console.log(`VI_V_INTR = ${k(this.vIntrReg)}`),console.log(`VI_V_CURRENT_LINE = ${k(this.vCurrentLineReg)}`),console.log(`VI_TIMING = ${k(this.timingReg)}`),console.log(`VI_V_SYNC = ${k(this.vSyncReg)}`),console.log(`VI_H_SYNC = ${k(this.hSyncReg)}`),console.log(`VI_H_SYNC_LEAP = ${k(this.hSyncLeapReg)}`),console.log(`VI_H_VIDEO = ${k(this.hVideoReg)}`),console.log(`VI_V_VIDEO = ${k(this.vVideoReg)}`),console.log(`VI_V_BURST = ${k(this.vBurstReg)}`),console.log(`VI_X_SCALE = ${k(this.xScaleReg)} = ${this.xScale}`),console.log(`VI_Y_SCALE = ${k(this.yScaleReg)} = ${this.yScale}`)}verticalBlank(){this.hardware.verticalBlank(),this.field^=this.interlaced?1:0,this.addInterruptEvent(),this.hardware.mi_reg.setBits32(z0,k5),n64js.cpu0.updateCause3(),J3(),n64js.returnControlToSystem()}initInterrupt(){if(n64js.cpu0.hasEvent(bZ))return;const J=this.mem.getU32(hZ),Z=this.mem.getU32(n3);if(J>=Z){U(`not setting VI interrupt - intr ${J} >= sync ${Z}`);return}this.addInterruptEvent()}addInterruptEvent(){n64js.cpu0.addEvent(bZ,this.countPerVbl,()=>{this.verticalBlank()})}getVblCount(){const J=n64js.cpu0.getCyclesUntilEvent(bZ);return J>=0?J:0}write32(J,Z){const q=this.calcWriteEA(J);if(q+4>this.u8.length)throw"Write is out of range";switch(q){case pz:this.mem.set32(q,Z);break;case mz:if(!this.quiet)U(`VI control set to: ${k(Z)}`);this.mem.set32(q,Z);break;case az:if(!this.quiet)U(`VI width set to: ${Z}`);this.mem.set32(q,Z);break;case hZ:if(!this.quiet)U(`VI intr set to: ${Z}`);this.mem.set32(q,Z),this.initInterrupt();break;case RZ:if(!this.quiet)U(`VI current set to: ${k(Z)}`);if(!this.quiet)U("VI interrupt cleared");this.hardware.mi_reg.clearBits32(z0,k5),n64js.cpu0.updateCause3();break;case n3:if(this.mem.getU32(q)!=Z){const W=Z+1;this.countPerScanline=this.hardware.systemFrequency/this.refreshRate/W>>0,this.countPerVbl=W*this.countPerScanline,U(`VI_V_SYNC_REG set to ${Z}, cycles per scanline = ${this.countPerScanline}, cycles per vbl = ${this.countPerVbl}`),this.mem.set32(q,Z),this.initInterrupt()}break;default:this.mem.set32(q,Z);break}}readU32(J){this.logRead(J);const Z=this.calcReadEA(J);if(Z+4>this.u8.length)throw"Read is out of range";if(Z===RZ){const q=this.getVblCount(),W=(this.countPerVbl-q)/this.countPerScanline>>0,K=this.mem.getU32(n3);let X=W;if(X>=K)X-=K;X=X&~1|this.field,this.mem.set32(Z,X)}return this.mem.getU32(Z)}computeDimensions(){if(this.modeType==0)return U("mode type is 0 - not rendering"),null;const J=this.hVideoReg,Z=J>>16&1023,q=J&1023;let Q=Math.max(Z,this.hScanMin),W=Math.min(q,this.hScanMax);const K=this.vVideoReg,X=K>>16&1023,Y=K&1023;let z=Math.max(X,this.vScanMin),G=Y<X?this.vScanMax:Math.min(Y,this.vScanMax);if(Q>=this.hScanMin)Q+=8;if(W<this.hScanMax)W-=7;const H=this.dims;H.interlaced=this.interlaced,H.field=this.field,H.xSubpixel=this.xScaleReg>>16&4095,H.ySubpixel=this.yScaleReg>>16&4095,H.xScale=this.xScaleReg&4095,H.yScale=this.yScaleReg&4095,H.sx0=Q-Z,H.sy0=z-X,H.dx0=Q-this.hScanMin,H.dy0=z-this.vScanMin,H.dstWidth=W-Q,H.dstHeight=G-z,H.srcPitch=this.hWidthReg;const j=(H.sx0+H.dstWidth)*H.xScale>>10,N=(H.sy0+H.dstHeight)*H.yScale>>11,L=H.srcPitch>768||H.srcPitch>=j*2?2:1;return H.srcWidth=j,H.srcHeight=N*L,H}renderBackBuffer(){const J=this.computeDimensions();if(!J)return null;const Z=this.dramAddrReg&16777214;if(!Z)return null;const q=this.hardware.cachedMemDevice.mem.dataView;if(this.is32BitMode)return J.renderBackBuffer32(q,Z);if(this.is16BitMode)return J.renderBackBuffer16(q,Z);return null}}class nz{constructor(J,Z){this.screenWidth=640,this.screenHeight=480,this.pixels32bpp=new Uint8Array(J*Z*4),this.pixels16bpp=new Uint16Array(J*Z),this.interlaced=!1,this.field=0,this.dstWidth=640,this.dstHeight=480,this.srcPitch=320,this.srcWidth=320,this.srcHeight=240,this.xSubpixel=0,this.ySubpixel=0,this.xScale=512,this.yScale=1024,this.sx0=0,this.sy0=0,this.dx0=0,this.dy0=0}renderBackBuffer32(J,Z){const q=this.pixels32bpp,Q=-this.screenWidth;let W=(this.screenHeight-1-this.dy0)*this.screenWidth;const K=255;let X=this.sy0*this.yScale+this.ySubpixel;for(let Y=0;Y<this.dstHeight;Y++){if(!this.interlaced||(this.dy0+Y&1)!=this.field){const z=Z+(X>>>11)*this.srcPitch*4;let G=W+this.dx0,H=this.sx0*this.xScale+this.xSubpixel;for(let j=0;j<this.dstWidth;j++){const N=J.getInt32(z+(H>>>10)*4,!1);q[G*4+0]=N>>>24,q[G*4+1]=N>>>16,q[G*4+2]=N>>>8,q[G*4+3]=K,G++,H+=this.xScale}}X+=this.yScale,W+=Q}return q}renderBackBuffer16(J,Z){const q=this.pixels16bpp,Q=-this.screenWidth;let W=(this.screenHeight-1-this.dy0)*this.screenWidth;const K=1;let X=this.sy0*this.yScale+this.ySubpixel;for(let Y=0;Y<this.dstHeight;Y++){if(!this.interlaced||(this.dy0+Y&1)!=this.field){const z=Z+(X>>>11)*this.srcPitch*2;let G=W+this.dx0,H=this.sx0*this.xScale+this.xSubpixel;for(let j=0;j<this.dstWidth;j++)q[G++]=J.getInt16(z+(H>>>10)*2,!1)|K,H+=this.xScale}X+=this.yScale,W+=Q}return q}}class AZ{constructor(J){this.map=this.createMemMap(J)}createMemMap(J){const Z=[];for(let q=0;q<16384;++q)Z.push(void 0);if(J.map((q)=>{const Q=q.rangeStart>>>18,W=q.rangeEnd-1>>>18;for(let K=Q;K<=W;++K)Z[K]=q}),Z.length!==16384)throw"initialisation error";return Z}getMemoryHandler(J){const Z=this.map[J>>>18];if(Z)return Z;throw U(`accessing unhandled location ${k(J)}`),`unhandled access ${k(J)}`}readMemoryInternal32(J){const Z=this.map[J>>>18];if(Z)return Z.readInternal32(J);return 3722304989}writeMemoryInternal32(J,Z){const q=this.map[J>>>18];if(q)q.writeInternal32(J,Z)}}var W6=function(J){return new F9(new ArrayBuffer(J))},wZ=64,aR=4096,cR=93750000;class V5{constructor(){this.data=new Uint8Array(32768),this.dirty=!1}init(J){this.dirty=!1;for(let Z=0;Z<this.data.length;Z++)this.data[Z]=0;if(J&&J.data){const Z=S1(J.data);for(let q=0;q<Z.length&&q<this.data.length;q++)this.data[q]=Z[q]}}}class BZ{constructor(J){this.rominfo=J,this.timeline=new v1(this.getOpsExecuted.bind(this)),this.systemFrequency=cR,this.rom=null,this.pif_mem=W6(2048),this.ram=W6(8388608),this.sp_mem=W6(8192),this.sp_reg=W6(32),this.sp_ibist_mem=W6(8),this.dpc_mem=W6(32),this.dps_mem=W6(16),this.rdram_reg=W6(48),this.mi_reg=W6(16),this.vi_reg=W6(56),this.ai_reg=W6(24),this.pi_reg=W6(52),this.ri_reg=W6(32),this.si_reg=W6(28),this.saveMem=null,this.saveDirty=!1,this.mempacks=[new V5,new V5,new V5,new V5],this.mappedMemDevice=new M5(this,0,2147483648),this.invalidCachedMemDevice=new o3(this,2147483648,2684354560),this.cachedMemDevice=new e1(this,2147483648,2155872256),this.invalidUnachedMemDevice=new o3(this,2684354560,3221225472),this.uncachedMemDevice=new JZ(this,2684354560,2692743168),this.rdRamRegDevice=new ZZ(this,2750414848,2751463424),this.spMemDevice=new PZ(this,2751463424,2751725568),this.spRegDevice=new UZ(this,2751725568,2751725600),this.spIbistDevice=new VZ(this,2751987712,2751987720),this.dpcDevice=new a1(this,2752512000,2752512032),this.dpsDevice=new c1(this,2753560576,2753560592),this.miRegDevice=new O1(this,2754609152,2754609168),this.viRegDevice=new DZ(this,2755657728,2755657784),this.aiRegDevice=new f1(this,2756706304,2756706328),this.piRegDevice=new r1(this,2757754880,2757754932),this.riRegDevice=new qZ(this,2758803456,2758803488),this.siRegDevice=new i1(this,2759852032,2759852060),this.romD2A1Device=new YZ(this,2768240640,2785017856),this.romD1A1Device=new WZ(this,2785017856,2818572288),this.romD2A2Device=new zZ(this,2818572288,2952790016),this.romD1A2Device=new KZ(this,2952790016,3217031168),this.pifMemDevice=new t1(this,3217031168,3217033216),this.romD1A3Device=new XZ(this,3218079744,3221225472),this.mappedMem2Device=new M5(this,3221225472,3758096384),this.mappedMem3Device=new M5(this,3758096384,4294967296),this.devices=[this.mappedMemDevice,this.invalidCachedMemDevice,this.cachedMemDevice,this.invalidUnachedMemDevice,this.uncachedMemDevice,this.rdRamRegDevice,this.spMemDevice,this.spRegDevice,this.spIbistDevice,this.dpcDevice,this.dpsDevice,this.miRegDevice,this.viRegDevice,this.aiRegDevice,this.piRegDevice,this.riRegDevice,this.siRegDevice,this.romD2A1Device,this.romD1A1Device,this.romD2A2Device,this.romD1A2Device,this.pifMemDevice,this.romD1A3Device,this.mappedMem2Device,this.mappedMem3Device],this.memMap=new AZ(this.devices),this.cpu0=new A1(this),this.cpu1=new K1(this),this.cpu2=new w1(this),this.rsp=new k1(this),this.rdp=new LJ(this)}reset(){this.cpu0.reset(),this.cpu1.reset(),this.cpu2.reset(),this.pif_mem.clear(),this.ram.clear(),this.sp_mem.clear(),this.sp_reg.clear(),this.sp_ibist_mem.clear(),this.rdram_reg.clear(),this.dpc_mem.clear(),this.dps_mem.clear(),this.mi_reg.clear(),this.vi_reg.clear(),this.ai_reg.clear(),this.pi_reg.clear(),this.ri_reg.clear(),this.si_reg.clear(),this.initSaveGame();for(let J of this.devices)J.reset()}getOpsExecuted(){return this.cpu0.getOpsExecuted()}createROM(J){if(Math.max(J.byteLength<8388608))J=J.transfer(8388608);const q=new F9(J);return this.rom=q,this.romD1A1Device.setMem(q),this.romD1A2Device.setMem(q),this.romD1A3Device.setMem(q),q}loadROM(){if(this.rom)this.sp_mem.copy(wZ,this.rom,wZ,aR-wZ)}verticalBlank(){this.flushSaveData(),this.timeline.newFrame()}initSaveGame(){for(let[Z,q]of this.mempacks.entries()){const Q=n64js.getLocalStorageItem(`mempack${Z}`);q.init(Q)}const J=this.saveSizeBytes();if(J){const Z=new F9(new ArrayBuffer(J)),q=n64js.getLocalStorageItem("save");if(q&&q.data){const Q=S1(q.data);for(let W=0;W<Q.length&&W<Z.u8.length;W++)Z.u8[W]=Q[W]}this.saveMem=Z}else this.saveMem=null;this.saveDirty=!1}saveSizeBytes(){switch(this.saveType){case"Eeprom4k":return 512;case"Eeprom16k":return 2048;case"SRAM":return 32768;case"FlashRam":return 131072}if(this.saveType)n64js.ui().displayWarning(`Unhandled savegame type: ${this.saveType}.`);return 0}get saveType(){return this.rominfo.save}flushSaveData(){if(this.saveMem&&this.saveDirty)this.saveU8Array("save",this.saveMem.u8),this.saveDirty=!1;for(let[J,Z]of this.mempacks.entries())if(Z.dirty)this.saveU8Array(`mempack${J}`,Z.data),Z.dirty=!1}saveU8Array(J,Z){const q={name:this.rominfo.name,id:this.rominfo.id,data:TY(Z)};n64js.setLocalStorageItem(J,q)}checkSIStatusConsistent(){this.siRegDevice.checkStatusConsistent()}}var oR=function(J,Z){if(typeof Z==="object"&&Z!==null){if(Z instanceof Map)return{_meta:{type:"map"},value:Array.from(Z.entries())};else if(Z instanceof Set)return{_meta:{type:"set"},value:Array.from(Z.values())};else if("_meta"in Z)return{...Z,_meta:{type:"escaped-meta",value:Z._meta}}}return Z},dR=function(J,Z){if(typeof Z==="object"&&Z!==null){if("_meta"in Z)if(Z._meta.type==="map")return new Map(Z.value);else if(Z._meta.type==="set")return new Set(Z.value);else if(Z._meta.type==="escaped-meta")return{...Z,_meta:Z._meta.value};else console.warn("Unexpected meta",Z._meta)}return Z},IZ=(J)=>JSON.stringify(J,oR),lz=(J)=>JSON.parse(J,dR);var rz=function(J){return J>>24&255|J>>8&65280|J<<8&16711680|J<<24&4278190080};function sz(J,Z){return v(rz(J),32)+v(rz(Z),32)}function iz(J){let Z=0;for(let q=0;q<4032;q++)Z=Z+J[64+q];switch(Z){case 211495:return"6101";case 213534:return"6101";case 213060:return"6102";case 219088:return"6103";case 293505:return"6105";case 225740:return"6106";case 213961:return"6106";default:return U("Unknown CIC Code "+k(Z)),"6102"}}function tz(J,Z,q){let Q="";for(let W=0;W<q;++W){const K=J[Z+W];if(K===0)break;Q+=String.fromCharCode(K)}return Q}var ez={"134c3f03a7e79e31":{name:"007 - The World is Not Enough",save:"Eeprom4k"},"9516943beb5e0af9":{name:"007 - The World is Not Enough",save:"Eeprom4k"},"61f1ba1ff1541c2c":{name:"1080 Snowboarding",save:"SRAM"},"253ffd588daa2ed9":{name:"1080 Snowboarding",save:"SRAM"},"091da5abd9ba68c6":{name:"40 Winks",save:"Eeprom4k"},d927f2df69814d0d:{name:"A Bug's Life"},fd04dc82f4822dcf:{name:"A Bug's Life"},c0ae382b10b85063:{name:"A Bug's Life"},"96c0128fe117dc45":{name:"A Bug's Life"},f18b591b459ba2ec:{name:"Aero Fighters Assault",save:"Eeprom4k"},"95bef662d6d602f1":{name:"Aero Fighters Assault",save:"Eeprom4k"},"3e46beae4b4671cc":{name:"AeroGauge",save:"Eeprom4k"},"3111f480f6454638":{name:"AeroGauge",save:"Eeprom4k"},c84530d8363a9df2:{name:"AeroGauge",save:"Eeprom4k"},a682c18cb0cad0c2:{name:"AI Shogi 3"},ccffc42d215affc8:{name:"Aidyn Chronicles - The First Mage",save:"SRAM"},"4f5aa9e623ead2ba":{name:"Aidyn Chronicles - The First Mage",save:"SRAM"},"0cb6456c300ee5dc":{name:"Airboarder 64",save:"Eeprom4k"},d025c427c1992d8c:{name:"Airboarder 64",save:"Eeprom4k"},"941a95b6af49c863":{name:"Akumajou Dracula Mokushiroku"},"063153a55b5ef2b9":{name:"Akumajou Dracula Mokushiroku Gaiden"},fc81607a787a8fff:{name:"Alice no Wakuwaku Trump World",save:"Eeprom4k"},ad84d7df036642ae:{name:"All Star Tennis '99",save:"Eeprom4k"},"91e285e16d76504e":{name:"All Star Tennis '99",save:"Eeprom4k"},"2907d2674c7796f6":{name:"All Star! Dairantou Smash Brothers"},"4d7a545e9507e690":{name:"All-Star Baseball 2000"},efc64654bb478ee1:{name:"All-Star Baseball 2001"},a7233ec41a68b140:{name:"All-Star Baseball 99"},"4dd5edd974e2b86b":{name:"All-Star Baseball 99"},"0290aeb967a3b6c1":{name:"Animal Forest",save:"Eeprom4k"},"17dbf6c032d5e080":{name:"Armorines - Project S.W.A.R.M."},"32d9b51f1b48a93b":{name:"Armorines - Project S.W.A.R.M."},"5071c73c87b9cd21":{name:"Armorines - Project S.W.A.R.M."},b2bb524c6b0fabce:{name:"Army Men - Air Combat"},"57062c866d89fd8d":{name:"Army Men - Sarge's Heroes"},"19df10b21a8db598":{name:"Army Men - Sarge's Heroes"},b6730fb234fc7529:{name:"Army Men - Sarge's Heroes 2"},abd8f7d146043b29:{name:"Asteroids Hyper 64"},c45db2418667721b:{name:"Automobili Lamborghini",save:"Eeprom4k"},bf9777fc3ce8954a:{name:"Automobili Lamborghini",save:"Eeprom4k"},"9ca440e3418d3174":{name:"Baku Bomberman",save:"Eeprom4k"},"4f7c3ce738b893af":{name:"Baku Bomberman 2",save:"Eeprom4k"},"5db998df78098458":{name:"Bakuretsu Muteki Bangaioh",save:"Eeprom4k"},"0a98cf88b52ed58e":{name:"Bakushou Jinsei 64 - Mezase! Resort Ou"},"20d568510dcd5fca":{name:"Banjo to Kazooie no Dai Bouken",save:"Eeprom4k"},"00694b518198b1b4":{name:"Banjo to Kazooie no Dai Bouken 2",save:"Eeprom16k"},ac5975cdaef56cb2:{name:"Banjo-Kazooie",save:"Eeprom4k"},"0693bfa4d1df0cbf":{name:"Banjo-Kazooie",save:"Eeprom4k"},b1cc3f73f9924844:{name:"Banjo-Kazooie",save:"Eeprom4k"},"9aaae9c2aa705d47":{name:"Banjo-Tooie",save:"Eeprom16k"},"396d17c9d17947ea":{name:"Banjo-Tooie",save:"Eeprom16k"},df7c5b152573daf0:{name:"Banjo-Tooie",save:"Eeprom16k"},b4fb88b01d4b1e44:{name:"Bass Hunter 64",save:"Eeprom4k"},caa237d15350b662:{name:"Bass Tsuri No. 1 (Shigesato Itoi's Bass Fishing)"},aaccfabcefd814b8:{name:"Bassmasters 2000"},c18944202bcf8612:{name:"Batman Beyond - Return of the Joker"},"847f9f2526ed9e7c":{name:"Batman Beyond - Return of the Joker"},e7dda46ae7f4e2e3:{name:"BattleTanx"},"47e2a4753d960860":{name:"BattleTanx - Global Assault"},e617ad0c97b7a571:{name:"BattleTanx - Global Assault"},cec4d4558ac75377:{name:"Battlezone - Rise of the Black Dogs"},"3d1c69914d5bacf4":{name:"Beast Wars Metals"},"16d3794d331b50e8":{name:"Beast Wars Transmetal"},a819f4edcc0419bf:{name:"Beetle Adventure Racing!"},d218739cc10dae24:{name:"Beetle Adventure Racing!"},"614ab6a10b9414d0":{name:"Beetle Adventure Racing!"},b7a4ff08b653f401:{name:"Big Mountain 2000",save:"Eeprom4k"},"95351208def11005":{name:"Bio F.R.E.A.K.S."},"1d107cabb0c858ec":{name:"Bio F.R.E.A.K.S."},"8824ae7e5aa3409d":{name:"Bio Hazard 2",save:"SRAM"},dbe6647cdb24b955:{name:"Blast Corps",save:"Eeprom4k"},"257c647ce601d9d9":{name:"Blast Corps (v1.0)",save:"Eeprom4k"},"657e647c05d34819":{name:"Blast Corps (v1.1)",save:"Eeprom4k"},"514423656f34d3eb":{name:"Blast Dozer",save:"Eeprom16k"},"128bd07c89ff5311":{name:"Blues Brothers 2000",save:"SRAM"},"83c871d5cf3f2d82":{name:"Blues Brothers 2000",save:"SRAM"},"6f692653c3999afe":{name:"Body Harvest",save:"Eeprom4k"},cdb8580bd291b2b7:{name:"Body Harvest",save:"Eeprom4k"},c651d4b3e258cbe1:{name:"Bokujo Monogatari 2"},f4f06fdf3842d129:{name:"Bomberman 64",save:"Eeprom4k"},"1ed568f51eba497e":{name:"Bomberman 64",save:"Eeprom4k"},"3603165ab0377bbc":{name:"Bomberman 64",save:"Eeprom4k"},b4737e23376b3bd6:{name:"Bomberman 64 - The Second Attack!",save:"Eeprom4k"},d6fd4644088278e3:{name:"Bomberman Hero",save:"Eeprom4k"},cc12ff671202bf76:{name:"Bomberman Hero",save:"Eeprom4k"},"294e5cd8af76e288":{name:"Bomberman Hero",save:"Eeprom4k"},"4dd12fd7c432ed1f":{name:"Bottom of the 9th"},"2ecf221e13c8aa42":{name:"Brunswick Circuit Pro Bowling"},"1a78ae855df056c7":{name:"Buck Bumble"},b662c7d742963df8:{name:"Buck Bumble"},"9c33b2d5edcabcca":{name:"Buck Bumble"},"73f0868a4be545cd":{name:"Bust-A-Move 2 - Arcade Edition"},"1ededcce02053a51":{name:"Bust-A-Move 2 - Arcade Edition"},fab428e3e1284a00:{name:"Bust-A-Move 3 DX"},"9fd8224237b6e0af":{name:"Bust-A-Move '99"},"0e4016ac1a075dcf":{name:"California Speed"},"4e2d0ff0f4aa0f34":{name:"Carmageddon 64"},ec620158f18b10e3:{name:"Carmageddon 64 (censored)"},f5018ee49b1fe5e6:{name:"Carmageddon 64 (uncensored)"},"47ffcd4b8fafa3aa":{name:"Castlevania v1.2"},"955f5df3693dfe8a":{name:"Castlevania"},cab7f1645537a271:{name:"Castlevania"},"3863c01c26893887":{name:"Castlevania - Legacy of Darkness"},e74bc5a2b2cb1967:{name:"Castlevania - Legacy of Darkness"},"3421cfdc7835d69d":{name:"Centre Court Tennis"},"5a53206462800250":{name:"Chameleon Twist",save:"Eeprom4k"},"21f5f2a48e16ebf0":{name:"Chameleon Twist",save:"Eeprom4k"},c68cafb99ff1c9de:{name:"Chameleon Twist",save:"Eeprom4k"},e48c53cdf9fc8a61:{name:"Chameleon Twist 2"},"5a76490542d0b993":{name:"Chameleon Twist 2"},"019da607a1417d9a":{name:"Chameleon Twist 2"},e8960e1e6b82284e:{name:"Charlie Blast's Territory"},d0483cfb9ff6288d:{name:"Charlie Blast's Territory"},"94ad4c21243b1abe":{name:"Chopper Attack",save:"Eeprom4k"},"3993352ea6eda53f":{name:"Chopper Attack",save:"Eeprom4k"},c4f9cc2b6f9f3d40:{name:"Choro Q 64",save:"Eeprom4k"},"540fcd26e0efeb53":{name:"Choro Q 64 II",save:"Eeprom4k"},"281594a79d19f161":{name:"Chou Snobow Kids"},f40f183af78a8e5c:{name:"Chou Kuukan Night Pro Yakyuu King 2",save:"Eeprom4k"},b09d00f82318296b:{name:"City-Tour GP - All Japan Grand Touring Car Champion"},ff3d5afab9cdc9b4:{name:"Clay Fighter - Sculptor's Cut"},ca243cf0cc7b23c5:{name:"Clay Fighter 63 1/3"},b392968e2abb6442:{name:"Clay Fighter 63 1/3"},c0a76f2b2512a709:{name:"Clay Fighter 63 1/3 (beta)"},ad5b02b5fd7526d3:{name:"Command & Conquer",save:"FlashRam"},b46e28958fd56ab7:{name:"Command & Conquer",save:"FlashRam"},"65945bae76654dc5":{name:"Command & Conquer",save:"FlashRam"},"50acc7302d070477":{name:"Conker's Bad Fur Day",save:"Eeprom16k"},"89583f370aa86c9a":{name:"Conker's Bad Fur Day",save:"Eeprom16k"},aff7a346d091750f:{name:"Cruis'n Exotica",save:"Eeprom4k"},"542540b304c04073":{name:"Cruis'n USA",save:"Eeprom4k"},"60a73e50960e30e1":{name:"Cruis'n USA",save:"Eeprom4k"},b42f2fff9a1461d1:{name:"Cruis'n USA (v1.0)",save:"Eeprom4k"},"45cf06535092c4cb":{name:"Cruis'n USA (v1.1)",save:"Eeprom4k"},"5311e6dfe61861d7":{name:"Cruis'n World",save:"Eeprom16k"},"1e93f3833d2272cb":{name:"Cruis'n World",save:"Eeprom16k"},"870bcb835754327e":{name:"Custom Robo",save:"Eeprom4k"},b9019507ab3202ab:{name:"Custom Robo V2",save:"Eeprom16k"},a18efce89183739f:{name:"CyberTiger"},"078aa7d13edda352":{name:"CyberTiger"},"45f48871680a4184":{name:"Dance Dance Revolution - Disney Dancing Museum"},"582ba5a441987523":{name:"Dark Rift"},d47cd67e6d5e41b4:{name:"Dark Rift"},"493336f51bd2f9db":{name:"Deadly Arts"},d9a9663f005bcb9b:{name:"Defi au Tetris Magique"},e167f6a51fbd1fda:{name:"Derby Stallion 64",save:"FlashRam"},"614ac517e7f2834a":{name:"Densha de GO! 64",save:"SRAM"},a284e5de8711160f:{name:"Destruction Derby 64"},"7da30a63dbd76b89":{name:"Destruction Derby 64"},"9c167989a0f689f1":{name:"Dezaemon 3D",save:"SRAM"},"725629d51570b59c":{name:"Diddy Kong CRACKED",save:"Eeprom4k"},"5aa389f362557817":{name:"Diddy Kong Racing",save:"Eeprom4k"},e740d45311b01975:{name:"Diddy Kong Racing (v1.0)",save:"Eeprom4k"},"75f773fd5a752497":{name:"Diddy Kong Racing (v1.0)",save:"Eeprom4k"},"0d4302e49dfcfcd2":{name:"Diddy Kong Racing (v1.1)",save:"Eeprom4k"},"5b146e599f87d9f7":{name:"Diddy Kong Racing (v1.1)",save:"Eeprom4k"},"1b426cc1f78015a2":{name:"Disney's Donald Duck - Goin' Quackers",save:"Eeprom4k"},"2313264c1a5e294f":{name:"Disney's Tarzan"},c769fecb2aabc0f2:{name:"Disney's Tarzan",save:"Eeprom4k"},d03b1a001adeb3af:{name:"Disney's Tarzan"},bfe514d6c1bc6da7:{name:"Disney's Tarzan",save:"Eeprom4k"},"6d208ebd1c5ec398":{name:"Doubutsu No Mori",save:"Eeprom4k"},"8074f13d5aed3d19":{name:"Donald Duck - Quack Attack"},bfea58ec69717cad:{name:"Donkey Kong 64",save:"Eeprom16k"},a7893c05024306a5:{name:"Donkey Kong 64",save:"Eeprom16k"},"8c6d9311434b2c6f":{name:"Donkey Kong 64",save:"Eeprom16k"},ababd40d1ea9a2b5:{name:"Donkey Kong 64 - Kiosk",save:"Eeprom16k"},"1a103ea89db637e9":{name:"Doom 64"},f4963e425bf088ce:{name:"Doom 64"},"365ba67aade5cefd":{name:"Doom 64"},ac9e732c2677f79e:{name:"Doom 64"},c2b1f7bf8e14bfae:{name:"Doraemon - Mittsu no Seireiseki",save:"Eeprom4k"},"996e30b6b2d23eb6":{name:"Doraemon 2 - Hikari no Shinden",save:"Eeprom16k"},"405127a8e856b0b9":{name:"Doraemon 3 - Nobi Dai No Machi SOS!",save:"Eeprom16k"},"134d9d76fe3f23da":{name:"Dr. Mario 64",save:"Eeprom4k"},a0ecde3fb29b9f39:{name:"Dragon Sword 64"},c33022a6884483f0:{name:"Dual Heroes"},"63ab6e05d5fc15c2":{name:"Dual Heroes"},"614452b6b1046ded":{name:"Dual Heroes"},faf1b9fb8986f86b:{name:"Duck Dodgers Starring Daffy Duck",save:"Eeprom4k"},"7ff0da0488e6180d":{name:"Duke Nukem - ZER0 H0UR"},"4b97ca32509cc2b2":{name:"Duke Nukem - ZER0 H0UR"},"6a6236dccb70373f":{name:"Duke Nukem - ZER0 H0UR"},"56ab73a29adb33da":{name:"Duke Nukem 64"},"3d88121e1827b9d3":{name:"Duke Nukem 64"},"4df7bf57437774de":{name:"Duke Nukem 64"},cfb6db349d7806ea:{name:"Earthworm Jim 3D Ru",save:"Eeprom4k"},"914157df3d12b59e":{name:"Earthworm Jim 3D",save:"Eeprom4k"},e89d2b491cc8ccc6:{name:"Earthworm Jim 3D",save:"Eeprom4k"},"6d76f9bd708d06bd":{name:"ECW Hardcore Revolution"},dbe5388cd7277cb3:{name:"ECW Hardcore Revolution"},cb53a6f23b3b6360:{name:"Elmo's Letter Adventure"},"8f53b102d0884bc9":{name:"Elmo's Number Journey"},dce23ae1e85cb64f:{name:"Eltale Monsters"},"421886079fbc2ea1":{name:"Excitebike 64",save:"Eeprom16k"},"19351c86e51c09f6":{name:"Excitebike 64",save:"Eeprom16k"},e48e2a20898bf883:{name:"Excitebike 64",save:"Eeprom16k"},"7b4f75af8173d11d":{name:"Excitebike 64 - Kiosk",save:"Eeprom16k"},d245a2fd473d4aa7:{name:"Extreme-G"},c42d80ee7dd50b69:{name:"Extreme-G"},"4e839d8ea9298b1e":{name:"Extreme-G"},"0b15d45cf1c20c47":{name:"Extreme-G XG2"},"819b9b3911ad33d5":{name:"Extreme-G XG2"},"85ec851131775a4b":{name:"Extreme-G XG2"},"7a6882ae8d383f9a":{name:"F-1 Pole Position 64"},b248d2fd0e029a56:{name:"F-1 Pole Position 64"},b8bcec3c07bf2661:{name:"F1 Racing Championship"},"3426443860f0b366":{name:"F-1 World Grand Prix",save:"Eeprom4k"},b3c83ccca405c40e:{name:"F-1 World Grand Prix",save:"Eeprom4k"},e5ae0bb7a805503a:{name:"F-1 World Grand Prix",save:"Eeprom4k"},c447bf64ba22bdf4:{name:"F-1 World Grand Prix",save:"Eeprom4k"},"6e86c107decc7557":{name:"F-1 World Grand Prix II",save:"Eeprom16k"},"374cff6dfd63b7b1":{name:"Famista 64"},"4f47294f7a70cb30":{name:"F-Cup Maniax"},decd1acbf21d29cf:{name:"FIFA - Road to World Cup 98"},"673c73f53a97a317":{name:"FIFA - Road to World Cup 98"},f0ed310ed54972c3:{name:"FIFA - Road to World Cup 98"},"30a61376f396d63e":{name:"FIFA 99"},"51a69801849d21fc":{name:"FIFA 99"},"5991f1c35abcd265":{name:"FIFA Soccer 64"},"70e594fe9c3a87e4":{name:"Fighter's Destiny",save:"Eeprom4k"},"0588f752b7ca8f8b":{name:"Fighter's Destiny",save:"Eeprom4k"},c2f9410c0d7a7101:{name:"Fighter's Destiny",save:"Eeprom4k"},"4bc7f136399902f2":{name:"Fighter's Destiny",save:"Eeprom4k"},"452fefaef1307ef9":{name:"Fighter's Destiny 2",save:"Eeprom4k"},"2d6ce4490c111a7b":{name:"Fighting Cup"},cbc7ef32203feac3:{name:"Fighting Force 64"},fe0fcf669c7f69ad:{name:"Fighting Force 64"},"2d56d52850aed5e4":{name:"Fire Electric Pen",save:"Eeprom4k"},e5522da955b6261d:{name:"Flying Dragon"},"3f62e922ad520eb6":{name:"Flying Dragon"},"1a8fff35bee3796e":{name:"Flying Dragon Fighters (Hiro no Ken Twin)"},"79b1e5e8e830aa44":{name:"Frogger 2 (Alpha)"},ff76cdc3decb9d9b:{name:"Forsaken"},"010c339eba14038c":{name:"Forsaken"},aa172a14968d0213:{name:"Forsaken"},"79d4613225bc0ded":{name:"Fox Sports College Hoops '99"},eeea74f73eb1d8f0:{name:"Fushigi no Dungeon - Furai no Shiren 2",save:"FlashRam"},a9d183398c150420:{name:"F-Zero DXP",save:"SRAM"},"78d90eb3f9c90330":{name:"F-Zero X",save:"SRAM"},"2e623e4d4e8b829b":{name:"F-Zero X",save:"SRAM"},f64666772bacb906:{name:"F-Zero X",save:"SRAM"},b67986afbf11105e:{name:"G.A.S.P! Fighter's NEXTream",save:"Eeprom16k"},"26f7fc68bc8c6549":{name:"G.A.S.P! Fighter's NEXTream",save:"Eeprom16k"},"8b162c83aecda256":{name:"Ganbare Goemon"},d99c7b455253c509:{name:"Ganbare Goemon 2 - Deoru Dero Douchuu Obake Tenko"},"0afdff21981d0dfa":{name:"Ganbare Nippon Olympics 2000"},"325e9b7280d928b7":{name:"Gauntlet Legends"},"0e26b0704cd01667":{name:"Gauntlet Legends"},d6bc43d556e2a52b:{name:"Gauntlet Legends"},e6849c48f9496e4c:{name:"Getter Love!! Cho Renai Party Game"},"127edc3ec91c6ce2":{name:"Gex 3 - Deep Cover Gecko"},"59931799c3ebe72f":{name:"Gex 3 - Deep Cover Gecko"},a43347875a7423a8:{name:"Gex 3 - Deep Cover Gecko"},"74d7fe891be2afca":{name:"Gex 64 - Enter the Gecko"},"0e008ae6dd669163":{name:"Gex 64 - Enter the Gecko"},ff016e8e48f9b4cc:{name:"Glover",save:"Eeprom4k"},"017323f593eee399":{name:"Glover",save:"Eeprom4k"},"7fd2c6b2fd8ca42d":{name:"Goemon Mononoke Sugoroku"},ada552424ebf6fae:{name:"Goemon's Great Adventure"},"1cfb9046446dd54c":{name:"Golden Nugget 64"},d150bcdca31afd09:{name:"GoldenEye 007",save:"Eeprom4k"},f14c4fa2ba2723a8:{name:"GoldenEye 007",save:"Eeprom4k"},"61ca1404aab8572e":{name:"GoldenEye 007",save:"Eeprom4k"},a2dc9ac4621b50f1:{name:"GT 64 Championship Edition",save:"Eeprom4k"},"330e4aeec988d58f":{name:"GT 64 Championship Edition",save:"Eeprom4k"},"1401a8957f2ab7e0":{name:"Hamster Monogatari 64",save:"Eeprom4k"},bf2ff236f2128931:{name:"Hanafuda 64 - Tenshi no Yakusoku"},b157ae0937562a18:{name:"Harukanaru Augusta Masters 98",save:"Eeprom4k"},fc9ddf9889c10666:{name:"Harvest Moon 64",save:"SRAM"},"66e8703ee8ba3844":{name:"Heiwa Pachinko World",save:"Eeprom4k"},"77eb3c7f0a038189":{name:"Hercules - The Legendary Journeys"},ebdb90ae2391b879:{name:"Hercules - The Legendary Journeys"},"0ab5b39a056166bc":{name:"Hexen"},bd5f1b5c3416967e:{name:"Hexen"},ea6aab9c001cc687:{name:"Hexen"},"571a75666e9da254":{name:"Hexen"},"0bb3b295c115642b":{name:"Hexen"},"5d0ef1d379a52e05":{name:"Hey You, Pikachu!",save:"Eeprom4k"},"140efa7505d1b3c9":{name:"Holy Magic Century"},b0eb5fb304b22774:{name:"Holy Magic Century"},"9d127b27ff7938dd":{name:"Holy Magic Century"},bd02d7c14765416d:{name:"Hoshi no Kirby 64",save:"Eeprom4k"},"8e8fc9c7de5d1442":{name:"Hot Wheels Turbo Racing"},"9301d2e7938e15c1":{name:"Hot Wheels Turbo Racing"},"7d1d6172d2bd1999":{name:"HSV Adventure Racing"},"2e97355595328ebd":{name:"Human Grand Prix"},"6ac9dbe8eee2c9da":{name:"Hybrid Heaven"},bf882810ca884843:{name:"Hybrid Heaven"},"36cee20de6291dd4":{name:"Hybrid Heaven"},"7f3a1d6466048286":{name:"Hybrid Heaven"},eb65dcc804898c3d:{name:"Hydro Thunder"},e98889b5e84bfcb1:{name:"Hydro Thunder"},"9e8b456936f995fc":{name:"Iggy-kun no Bura Bura Poyon"},bcb516e6888b65c9:{name:"Iggy's Reckin' Balls"},"5ecc92d672d058ec":{name:"Iggy's Reckin' Balls"},"15cc9daf883d721a":{name:"Indiana Jones and the Infernal Machine",save:"Eeprom4k"},"7a4636e49b8fde82":{name:"Indy Racing 2000",save:"Eeprom4k"},e08b138c460e7095:{name:"In-Fisherman Bass Hunter 64",save:"Eeprom4k"},"3754838eb44857cd":{name:"International Superstar Soccer 2000"},a0646333bfd5c806:{name:"International Superstar Soccer 2000"},"71e8e8ba4e94ff35":{name:"International Superstar Soccer 2000"},c463275fe52a4162:{name:"International Superstar Soccer 64"},f07cd3e2ae4e7ef5:{name:"International Superstar Soccer 64"},"43631bf4e66106c1":{name:"International Superstar Soccer 98"},"09da0f7f0bce6160":{name:"International Superstar Soccer '98"},c73b072011013b5e:{name:"International Track and Field 2000"},"79c712671d78723b":{name:"International Track and Field Summer Games"},"476776876571c291":{name:"J. League Dynamite Soccer"},aa0acec619f017d1:{name:"J. League Tactics Soccer (1.1)"},"29a4bf4f15bb2069":{name:"J. League Eleven Beat 1997"},"424a5554fb5f98e4":{name:"J. League Live 64"},a09dd2e8941de615:{name:"J. League Tactics Soccer"},"16d03ac77d53c548":{name:"Jangou Simulation Mahjong Do 64"},"6064256986f5a3b9":{name:"Jeopardy!"},a5b130bbce12f7fc:{name:"Jeremy McGrath Supercross 2000"},fbabf721e8a78a6a:{name:"Jeremy McGrath Supercross 2000"},b609608a50e1ac94:{name:"Jet Force Gemini",save:"FlashRam"},dea1d7684a837900:{name:"Jet Force Gemini",save:"FlashRam"},"47abd8df89ebdb3c":{name:"Jet Force Gemini - Kiosk",save:"FlashRam"},f5d919afcc2302b7:{name:"Jikkyou G1 Stable"},"532a11638fa89fa2":{name:"Jikkyou J. League 1999 - Perfect Striker 2"},"66436c14b3dea672":{name:"Jikkyou J. League Perfect Striker"},"1c1f89d78837e4c3":{name:"Jikkyou Pawafuru Puroyakyu 4 (1.1)"},d144c20a05c60e1f:{name:"Jikkyou Pawapuro Puroyakyu 2000"},"23df6442f7bd28be":{name:"Jikkyou Pawapuro Puroyakyu 2000"},"2056ea3f40db5674":{name:"Jikkyou World Cup France '98"},"8cb354c9b3be626f":{name:"Jikkyou World Cup France '98"},d6abc7e1287f704e:{name:"Jikkyou World Cup France '98"},"8c9fa7e0fa97cc32":{name:"Jikkyou World Soccer 3"},edf6aa4aad286437:{name:"Jinsei Game 64"},b01a15d04ba15cfe:{name:"John Romero's Daikatana"},"4b3c7e9d6c4a0fe6":{name:"John Romero's Daikatana"},"9531740f95dba6d8":{name:"John Romero's Daikatana"},"231f2836cf569700":{name:"Ken Griffey Jr.'s Slugfest",save:"FlashRam"},"3e269b97040047f8":{name:"Killer Instinct Gold",save:"Eeprom4k"},bae28f9e7007278b:{name:"Killer Instinct Gold (v1.0)",save:"Eeprom4k"},facd8f9e2b65f549:{name:"Killer Instinct Gold (v1.0)",save:"Eeprom4k"},"4cca08f927434636":{name:"Killer Instinct Gold (v1.2)",save:"Eeprom4k"},e1a49e51e88475eb:{name:"King Hill 64 - Extreme Snowboarding"},d66abc75c92b5578:{name:"Kiratto Kaiketsu! 64 Tanteidan"},b49f03462c823703:{name:"Kirby 64 - The Crystal Shards",save:"Eeprom4k"},"11ba930da6683868":{name:"Kirby 64 - The Crystal Shards",save:"Eeprom4k"},"6fb81bcac5a5cc41":{name:"Kirby 64 - The Crystal Shards (1.1)",save:"Eeprom4k"},"7a1c580ce4206e3d":{name:"Kirby 64 - The Crystal Shards (1.2)",save:"Eeprom4k"},"9ff8b1bca2520706":{name:"Kirby 64 - The Crystal Shards (1.3)",save:"Eeprom4k"},"99d7e0fc546c3165":{name:"Knife Edge - Nose Gunner"},"3fef1a93906b19ef":{name:"Knife Edge - Nose Gunner"},"747c994a997f08e2":{name:"Knife Edge - Nose Gunner"},"9c9094082dd8d4da":{name:"Knockout Kings 2000"},"95a7d6e33c5d1c2a":{name:"Knockout Kings 2000"},"94846b611092508a":{name:"Kobe Bryant's NBA Courtside",save:"Eeprom16k"},baef3917683ab4d0:{name:"Kobe Bryant's NBA Courtside",save:"Eeprom16k"},e8603e5e95d4b54a:{name:"Kuiki Uhabi Suigo"},"9940307f7652cf52":{name:"Last Legion UX",save:"Eeprom4k"},ea406a09100abe8a:{name:"LEGO Racers"},b3d878f46ddd1697:{name:"LEGO Racers"},"2bc6673d5031d031":{name:"Let's Smash Tennis"},df1850253aaed657:{name:"Lode Runner 3-D",save:"Eeprom4k"},"0bdd4a96db1392b2":{name:"Lode Runner 3-D",save:"Eeprom4k"},"80064660720e5f30":{name:"Lode Runner 3-D",save:"Eeprom4k"},"5b05a00a65df3776":{name:"Looney Tunes - Duck Dodgers",save:"Eeprom4k"},"2ce9cbf412ed92b3":{name:"Lylat Wars",save:"Eeprom4k"},"2bf283245e026e13":{name:"Lylat Wars",save:"Eeprom4k"},"5007706bfe21d629":{name:"Mace - The Dark Age"},"3d444511db0e6111":{name:"Mace - The Dark Age"},"8616b80c815ad85f":{name:"Madden 2000"},"89638313763c5b26":{name:"Madden Football 64"},"52cb97a10ede2075":{name:"Madden Football 64"},"8d4f13d7b5001ac1":{name:"Madden NFL 2002",save:"Eeprom16k"},"92f738eb46a20e19":{name:"Madden NFL 2001"},ba8bb7de9dbdf652:{name:"Madden NFL 99"},"25d625395ec7838c":{name:"Madden NFL 99"},f793efe10b8b9014:{name:"Magical Tetris Challenge"},"4716b67578bfda7a":{name:"Magical Tetris Challenge"},"4a56c880ab659c92":{name:"Magical Tetris Challenge"},"796690e4053f249f":{name:"Magical Tetris Challenge"},"41dc3ec55993e1ec":{name:"Mahjong 64"},"1e82cccc838ae896":{name:"Mahjong Hourouki Classic"},"702cc40fcdf15487":{name:"Mahjong Master"},"5cc0c180f45e06ea":{name:"Major League Baseball Featuring Ken Griffey Jr.",save:"SRAM"},be98b9cdc8a52410:{name:"Major League Baseball Featuring Ken Griffey Jr.",save:"SRAM"},d4a34b66b7808a67:{name:"Mario Golf 64",save:"SRAM"},d14489d40e3ad9b0:{name:"Mario Golf 64",save:"SRAM"},d057e9625d5ac17f:{name:"Mario Golf 64",save:"SRAM"},b655503e52da922e:{name:"Mario Kart 64",save:"Eeprom4k"},"5847ff6b5e5dffe5":{name:"Mario Kart 64 (v1.0)",save:"Eeprom4k"},"9ddeb6c376ded265":{name:"Mario Kart 64 (v1.0)",save:"Eeprom4k"},"87a9c3c94c341058":{name:"Mario Kart 64 (v1.1)",save:"Eeprom4k"},d4c77725aeaa8fd1:{name:"Mario Kart 64 (v1.1)",save:"Eeprom4k"},ac90989adf13c3f0:{name:"Mario No Photopie"},"7e652928771862a0":{name:"Mario Party",save:"Eeprom4k"},be15a8ad2f622860:{name:"Mario Party",save:"Eeprom4k"},"6930669c804af280":{name:"Mario Party",save:"Eeprom4k"},"5858a99e18b672af":{name:"Mario Party 2",save:"Eeprom4k"},"0f7d56ed1589b038":{name:"Mario Party 2",save:"Eeprom4k"},"87033882d944c7df":{name:"Mario Party 2",save:"Eeprom4k"},d929387cce47826e:{name:"Mario Party 3",save:"Eeprom16k"},cdb40a0b3789157b:{name:"Mario Party 3",save:"Eeprom16k"},"604167c53c455f0f":{name:"Mario Party 3",save:"Eeprom16k"},dccda73ba0524e46:{name:"Mario Story",save:"FlashRam"},"4fcf0150bdb30cf3":{name:"Mario Tennis",save:"Eeprom16k"},b5426c3a1bdaca1a:{name:"Mario Tennis",save:"Eeprom16k"},d53a9f83fa156d40:{name:"Mario Tennis",save:"Eeprom16k"},f558c10e96683efb:{name:"Mega Man 64",save:"FlashRam"},"0cf10110c1d8513d":{name:"Mia Hamm Soccer 64"},c26661e3e5a21386:{name:"Michael Owens WLS 2000"},"71458cfac0f9e7bb":{name:"Mickey's Speedway USA",save:"Eeprom4k"},"9addd0dea72582e7":{name:"Mickey's Speedway USA",save:"Eeprom4k"},afe66a73c7e91741:{name:"Mickey no Racing Challenge USA",save:"Eeprom4k"},"350c85f11279e0ac":{name:"Micro Machines 64 Turbo"},"8d01492a024a03d0":{name:"Micro Machines 64 Turbo"},"4c5eb3e4c95cc41a":{name:"Midway's Greatest Arcade Hits Volume 1"},"163ed509b968b23a":{name:"Mike Piazza's Strike Zone"},cd5e952e840800f3:{name:"Milo's Astro Lanes"},"9d0d499adc3a018f":{name:"Milo's Astro Lanes"},"1b05930bf9813d60":{name:"Mischief Makers",save:"Eeprom4k"},"98da8b41580f8a24":{name:"Mischief Makers",save:"Eeprom4k"},"7e3feb93445e6781":{name:"Mission Impossible",save:"Eeprom4k"},f85c032635912b80:{name:"Mission Impossible",save:"Eeprom4k"},"345b0920879e3d34":{name:"Mission Impossible",save:"Eeprom4k"},dc49a9ebbdecba39:{name:"Mission Impossible",save:"Eeprom4k"},daec56229c1bab71:{name:"Mission Impossible",save:"Eeprom4k"},e2046a5f0d07fad4:{name:"Mission Impossible",save:"Eeprom4k"},"6d8d76286c9779b3":{name:"Monaco Grand Prix",save:"Eeprom4k"},e183c35a87e312d7:{name:"Monopoly",save:"Eeprom4k"},"99d99ab11851587e":{name:"Monster Truck Madness 64"},fc06d8d3a8a23ab4:{name:"Monster Truck Madness 64"},"70dde8e898d15d41":{name:"Morita Shogi 64",save:"Eeprom4k"},f4d47d41e22f481b:{name:"Mortal Kombat 4",save:"Eeprom4k"},"3b6f0373e9690dce":{name:"Mortal Kombat 4",save:"Eeprom4k"},ac0443c321c0792d:{name:"Mortal Kombat Mythologies - Sub-Zero"},c4ed44ff1392ae1a:{name:"Mortal Kombat Mythologies - Sub-Zero"},"125cf7d9599b85a8":{name:"Mortal Kombat Trilogy"},"92113d8ce172f1be":{name:"Mortal Kombat Trilogy"},a93af3830dd401a9:{name:"Mortal Kombat Trilogy (v1.2)"},"5cb6f92ad7a2e285":{name:"MRC - Multi Racing Championship",save:"Eeprom4k"},"13b4b6a6cc13d115":{name:"MRC - Multi Racing Championship",save:"Eeprom4k"},"03bdf0b89e187944":{name:"MRC - Multi Racing Championship",save:"Eeprom4k"},"5c52381956966e58":{name:"Ms. Pac-Man Maze Madness"},"21cbbcfc6b3c9072":{name:"Mystical Ninja - Starring Goemon"},be0f36f51d69f12b:{name:"Mystical Ninja - Starring Goemon"},d345937fdeca1e84:{name:"Mystical Ninja 2 - Starring Goemon"},"8725c27e23e31aef":{name:"Nagano Olympic Hockey '98"},"3730f490f570535c":{name:"Nagano Olympic Hockey '98"},"353a2dae1ad4f024":{name:"Nagano Olympic Hockey '98"},"98ae2b8dbf2537d7":{name:"Nagano Winter Olympics '98"},"4cc3c52f9dcc057a":{name:"Nagano Winter Olympics '98"},"1620456dee093c71":{name:"Nagano Winter Olympics '98"},dab629518c3cef9d:{name:"Namco Museum 64"},"181a33df44e0d45f":{name:"NASCAR 2000"},"78957423fd58dc80":{name:"NASCAR 99"},"49140000c99249ae":{name:"NASCAR 99"},c99249ae53b25392:{name:"NASCAR 99"},"57ebf724f4f9b374":{name:"NBA Courtside 2 - Featuring Kobe Bryant",save:"FlashRam"},d8526891efeadb73:{name:"NBA Courtside 2 - Featuring Kobe Bryant",save:"FlashRam"},"87b4694e90e218fe":{name:"NBA Hangtime"},aedc88c70a0003bd:{name:"NBA Hangtime"},"011fe1aa45a02526":{name:"NBA In the Zone 2000"},"185bf98d7b49daec":{name:"NBA In the Zone 2000"},"9f4f05b3b59eb696":{name:"NBA In the Zone 2000"},"3019126a74c25c66":{name:"NBA In the Zone '98"},"9bbaac36944d8df2":{name:"NBA In the Zone '98"},"4f5292a2492a6c3d":{name:"NBA In the Zone '99"},dba8eeeb3cb2ecf2:{name:"NBA Jam 2000"},a0cad0b6c893f4e3:{name:"NBA Jam 2000"},f6290781c1cf3fe0:{name:"NBA Jam 99"},"1e8300e6a822f459":{name:"NBA Jam 99"},eeb0255fdbc12762:{name:"NBA Live 2000"},"8f9c49ebb66745cd":{name:"NBA Live 2000"},"9b1cf85735fa3311":{name:"NBA Live 99"},"5ff484cfebf6e400":{name:"NBA Live 99"},"2f96deac7ff8cbb2":{name:"NBA Pro 98"},b680178d76b9b357:{name:"NBA Pro 99"},f480fe3f7e5fc1a7:{name:"NBA Showtime - NBA on NBC"},db0e7e142cb1c536:{name:"Neon Genesis Evangelion",save:"Eeprom16k"},"4fd5ea30f60b6231":{name:"NFL Blitz - Special Edition"},"70b194d0ccb5c4d7":{name:"NFL Blitz"},"6909a01585a2e534":{name:"NFL Blitz 2000"},eb35fa36362e5ee8:{name:"NFL Blitz 2001"},d04eabe3d20d0483:{name:"NFL Quarterback Club 2000"},"9e5abd88bfdf1fe8":{name:"NFL Quarterback Club 2000"},"224678288529b2ff":{name:"NFL Quarterback Club 2001"},f8e29bd8df7ac999:{name:"NFL Quarterback Club 98"},f49e624b9b1db299:{name:"NFL Quarterback Club 98"},ffed76be092d4520:{name:"NFL Quarterback Club 99"},"47cfa352fc3bc14e":{name:"NFL Quarterback Club 99"},"6e801a591d92e6a5":{name:"NHL 99"},"1e607d28aef8f4ab":{name:"NHL 99"},"30dcef8261246a80":{name:"NHL Blades of Steel '99"},c3cdfd6dc801e74d:{name:"NHL Breakaway 98"},"9276ce297985c571":{name:"NHL Breakaway 98"},d06817444ff2737d:{name:"NHL Breakaway 99"},cb21468727c13100:{name:"NHL Breakaway 99"},d95c89a96c012070:{name:"NHL Pro 99"},"4d675728da3743cc":{name:"Nightmare Creatures"},df3c3ccdfa937731:{name:"Nintama Rantarou 64"},"45b8508f2fd229d7":{name:"Nuclear Strike 64"},bbdd9849bcaeb7f7:{name:"Nuclear Strike 64"},"97a1978ac1f62d27":{name:"Nuclear Strike 64"},"20b93bd8166440cc":{name:"Nushi Zuri 64"},"18169b5b49c6431b":{name:"Nushi Tsuri 64 - Shiokaze ni Notte"},ec939031ef09c20f:{name:"Off Road Challenge"},d08922819632e5c2:{name:"Off Road Challenge"},c59b41e6e31d0169:{name:"Ogre Battle 64 - Person of Lordly Caliber",save:"SRAM"},"67cf7503aa3fa956":{name:"Ogre Battle 64 - Person of Lordly Caliber (v1.1)",save:"SRAM"},"6910969c8d48eaf5":{name:"Ohzumou 64",save:"Eeprom4k"},"168bc185af2296df":{name:"Ohzumou 64 2",save:"Eeprom4k"},"669464dcd9f02f57":{name:"Onegai Monsters"},"3b4b5574b5bcaef4":{name:"Pachinko 365 Nichi"},"3ae5ee653c737ded":{name:"Paper Mario",save:"FlashRam"},af29ab1928cd1bc7:{name:"Paper Mario",save:"FlashRam"},"129b52893bed5308":{name:"Paperboy"},"9e8d193e7e26e1f2":{name:"Paperboy"},"386b97ac7ac9a9c3":{name:"Paperboy"},"31cbe2cf1d1e6b4d":{name:"Parlor! Pro 64 Pachinko Jikki Simulation Game"},"6647dd6ea89b3ea9":{name:"Pawapuro Puroyakyu 2001"},ad5b4934269d2e50:{name:"Pawapuro Puroyakyu 4"},da4329d2c0772bac:{name:"Pawapuro Puroyakyu 5"},b7205eb7fdfdfeb3:{name:"Pawapuro Puroyakyu 6"},"8c1168f44ee42ee3":{name:"PD Ultraman Battle Collection 64",save:"Eeprom16k"},fbb1ab739360ca9c:{name:"Penny Racers",save:"Eeprom4k"},"83eb3cc81962c5fd":{name:"Penny Racers",save:"Eeprom4k"},b47e749643b24b10:{name:"Perfect Dark",save:"Eeprom16k"},"0780b0e433ff02a6":{name:"Perfect Dark",save:"Eeprom16k"},cc60f4ddc034a63c:{name:"Perfect Dark (v1.0)",save:"Eeprom16k"},"8fb9f24166b458b4":{name:"Perfect Dark (v1.1)",save:"Eeprom16k"},"81e84cb52661cbbc":{name:"PGA European Tour",save:"Eeprom4k"},"02c608eea6d5c26b":{name:"PGA European Tour",save:"Eeprom4k"},"0553243faa740bfc":{name:"Pikachu Genki Dechu"},"1c9651c8faaafc78":{name:"Pilot Wings 64",save:"Eeprom4k"},"0148cc0991e42ee4":{name:"Pilot Wings 64",save:"Eeprom4k"},d55aa01a802df546:{name:"Pilot Wings 64",save:"Eeprom4k"},"0d690fec8c43a732":{name:"Pocket Monsters Snap",save:"FlashRam"},"59825e661dbd98d0":{name:"Pocket Monsters Stadium",save:"FlashRam"},"865877637b0eb85f":{name:"Pocket Monsters Stadium 2",save:"FlashRam"},ac47477a23ecee44:{name:"Pokemon Puzzle League",save:"FlashRam"},a753c519524b0fa7:{name:"Pokemon Puzzle League",save:"FlashRam"},f3e6b23efe9e2f06:{name:"Pokemon Puzzle League",save:"FlashRam"},"53d11c4af8ae30d8":{name:"Pokemon Puzzle League",save:"FlashRam"},"6f97f54fd859f5ac":{name:"Pokemon Snap",save:"FlashRam"},"6a287d81167441ef":{name:"Pokemon Snap",save:"FlashRam"},"0d7253574d888a2a":{name:"Pokemon Snap",save:"FlashRam"},"47b512cae44efa71":{name:"Pokemon Snap",save:"FlashRam"},"3a296cba38a3af9f":{name:"Pokemon Snap",save:"FlashRam"},"4650c8c0051b0561":{name:"Pokemon Snap",save:"FlashRam"},"408db17b59851383":{name:"Pokemon Snap",save:"FlashRam"},"729811399f2e7207":{name:"Pokemon Snap Station",save:"FlashRam"},"432d121a0faf7dc1":{name:"Pokemon Stadium - Kiosk",save:"FlashRam"},"2da83fa55dc1e2da":{name:"Pokemon Stadium",save:"FlashRam"},"5de0c991b9af3aad":{name:"Pokemon Stadium",save:"FlashRam"},"1b1e0142b52d55e3":{name:"Pokemon Stadium",save:"FlashRam"},b3d9f590f0dc0e9d:{name:"Pokemon Stadium",save:"FlashRam"},a35335a2392dbf42:{name:"Pokemon Stadium",save:"FlashRam"},"757207849c5b3157":{name:"Pokemon Stadium",save:"FlashRam"},ce49e5b6c03481dc:{name:"Pokemon Stadium",save:"FlashRam"},"821157036dd02f89":{name:"Pokemon Stadium 2",save:"FlashRam"},c7a55aacc3cdb0a9:{name:"Pokemon Stadium 2",save:"FlashRam"},"727e9b435d49a1c1":{name:"Pokemon Stadium 2",save:"FlashRam"},"0bfca1d04b07b82f":{name:"Pokemon Stadium 2",save:"FlashRam"},"00afceef48480922":{name:"Pokemon Stadium 2",save:"FlashRam"},"5bfca1d04b07b82f":{name:"Pokemon Stadium 2",save:"FlashRam"},"9c365229a8c3e4b6":{name:"Pokemon Stadium 2",save:"FlashRam"},c2d74fee38d9f19c:{name:"Pokemon Stadium GS",save:"FlashRam"},"9207384145e067a1":{name:"Polaris Sno Cross"},fadca6d7b7b6fecc:{name:"Power League Baseball 64"},ad5789cfa97ed596:{name:"Power Rangers - Lightspeed Rescue"},"110cf6397dba2eab":{name:"Power Rangers - Lightspeed Rescue"},"75d474fcab78029a":{name:"Powerpuff Girls - Chemical X-Traction",save:"Eeprom4k"},"547fd2f3f9ac11c1":{name:"Premier Manager 64"},"4e0ca19bd3ab0804":{name:"Pro Mahjong Kiwame 64"},"0fb3dc1b76d832a1":{name:"Pro Mahjong Tsuwamono 64"},"8366ce8a6e42ba3f":{name:"Pro Yak Yu King Baseball"},b972464be75dbe2d:{name:"Puyo Puyo 4 - Puyo Puyo Party",save:"Eeprom4k"},"6b7e8094e462cc60":{name:"Puyo Puyo Sun 64",save:"Eeprom4k"},"4707dec0d372dfa2":{name:"Puzzle Bobble 64"},"9cf75b9fa008fed2":{name:"Quake 64"},"741d9316346ddc65":{name:"Quake 64"},"43f1a8bd622dafb1":{name:"Quake II"},d7d93374d022432c:{name:"Quake II"},d94dbbc80b435fcc:{name:"Quest 64"},a55f70280e6909b5:{name:"Racing Simulation - Monaco Grand Prix",save:"Eeprom4k"},"2dac77289a13dcc3":{name:"Racing Simulation 2"},f0ca1e9f0e8ac4ee:{name:"Rakuga Kids"},"6818d267614042c5":{name:"Rakuga Kids"},"0cbad935865548df":{name:"Rally '99"},"3d8ea87371c5c53a":{name:"Rally Challenge 2000",save:"Eeprom4k"},e4f99fc27dfe4b26:{name:"Rampage - World Tour"},"4844d484b019ca67":{name:"Rampage - World Tour"},"9b093d67de08c8a4":{name:"Rampage 2 - Universal Tour"},"4942fc5d079c5299":{name:"Rampage 2 - Universal Tour"},"8ec40403b80140ac":{name:"Rat Attack"},f10bfd20871dcff5:{name:"Rat Attack"},"9bbfc5f3e2330f16":{name:"Rayman 2 - The Great Escape"},"0be1d56046eded8b":{name:"Rayman 2 - The Great Escape"},"4a831839290cb515":{name:"Razor Freestyle Scooter"},"29b4b7ea572cc9ba":{name:"Ready 2 Rumble Boxing"},"34a3d48b058b131e":{name:"Ready 2 Rumble Boxing"},"339521e9bdaffb13":{name:"Ready 2 Rumble Boxing Round 2"},a5b118aaeb6adb07:{name:"Resident Evil 2",save:"SRAM"},"8e0e509bb35005e9":{name:"Resident Evil 2",save:"SRAM"},"87a91f0fa6afc1bf":{name:"Re-Volt"},"9ee2e7c3cc51725d":{name:"Re-Volt"},"6c7450f00b827b24":{name:"Road Rash 64"},"6a36d8029cefab6c":{name:"Road Rash 64"},db4d6b0b82e67196:{name:"Roadsters"},"707ae874d4ae9362":{name:"Roadsters"},d3a5bc747e5f944a:{name:"Roadsters Trophy"},"0f692b27777a0aad":{name:"Robot Ponkottsu 64 - Caramel of the 7 Seas",save:"Eeprom4k"},"93b8a075b521a34c":{name:"Robotech - Crystal Dreams"},"324b8eac2673b4e7":{name:"Robotron 64"},"4f9df69f59005f19":{name:"Robotron 64"},f875d39fc82df345:{name:"Rocket - Robot on Wheels",save:"Eeprom4k"},"85e05e0c3edd67a1":{name:"Rocket - Robot on Wheels",save:"Eeprom4k"},"3b5966d6075ca2d7":{name:"Rockman Dash",save:"FlashRam"},"7e260025cec37e2a":{name:"RR64 - Ridge Racer 64",save:"Eeprom16k"},"1070e9fea0a9944e":{name:"RR64 - Ridge Racer 64",save:"Eeprom16k"},"378f8f658dd21318":{name:"RTL World League Soccer 2000"},c5b3020cb811259e:{name:"Rugrats - Scavenger Hunt"},dadf3a4daefc9875:{name:"Rugrats - Treasure Hunt"},"0fca1a458abc6378":{name:"Rugrats - Treasure Hunt"},b46c692bd8dc937b:{name:"Rugrats - Treasure Hunt"},"3215c21fd466640b":{name:"Rugrats in Paris - The Movie"},"391dc60aa603faab":{name:"Rugrats in Paris - The Movie"},"31e0d6ed13601368":{name:"Rush 2 - Extreme Racing USA"},"3621cfb715a70afa":{name:"Rush 2 - Extreme Racing USA"},f34791760ec13320:{name:"S.C.A.R.S."},"602d8e913e6865f8":{name:"S.C.A.R.S."},"20186b2a66f4bc6a":{name:"San Francisco Rush - Extreme Racing"},b016d1610cd624fa:{name:"San Francisco Rush - Extreme Racing"},a2eca9b98ee4aa17:{name:"San Francisco Rush 2049"},"1894d251e36ab4d5":{name:"San Francisco Rush 2049"},c44e810ca85cfe58:{name:"Scooby-Doo - Classic Creep Capers"},"1d22bde3d334083c":{name:"Scooby-Doo - Classic Creep Capers"},b7f6f5eb39d756c9:{name:"SD Hiryuu no Ken Densetsu"},"75fdd584df3cfdbb":{name:"Shadow Man"},b560473a10d4742d:{name:"Shadow Man"},c3f806eaeddec207:{name:"Shadow Man"},e537c460e31e25a2:{name:"Shadow Man"},ce97680354fad4e0:{name:"Shadowgate 64 - Trials of the Four Towers"},"556fb4020b8d7761":{name:"Shadowgate 64 - Trials of the Four Towers"},"84ea4ed8b4f1b245":{name:"Shadowgate 64 - Trials of the Four Towers"},f2fcc12bf40d9a7b:{name:"Shadowgate 64 - Trials of the Four Towers"},"0c28d5b12abca74b":{name:"Sim City 2000"},b00fbcb6982181e3:{name:"Sin and Punishment - Tsumi To Batsu",save:"Eeprom4k"},"19d5f42e5e0c4ac6":{name:"Snow Speeder"},"9deaf4dbc0823e33":{name:"Snowboard Kids"},ff04fc84e93c25b1:{name:"Snowboard Kids"},a0cdd75fad51bbd9:{name:"Snowboard Kids"},ea290c93bf459293:{name:"Snowboard Kids 2",save:"Eeprom4k"},"1a1d75c2ff9bc1f8":{name:"Snowboard Kids 2",save:"Eeprom4k"},"512321224b594640":{name:"Sonic Wings Assault",save:"Eeprom4k"},"39e9cb7e9517333c":{name:"South Park"},"6236b5209f89617b":{name:"South Park"},"48a90cc04bd3608e":{name:"South Park - Chef's Luv Shack"},"76b2f307393d8fec":{name:"South Park Rally"},"3afc8a4ff22d91f7":{name:"South Park Rally"},"123446378d38c5ea":{name:"Space Dynamites",save:"Eeprom4k"},"9723feeb34da74ff":{name:"Space Invaders"},"8438e2bfafea48ef":{name:"Spacestation Silicon Valley",save:"Eeprom4k"},"72e270fcaae7ff08":{name:"Spacestation Silicon Valley",save:"Eeprom4k"},"71d10ea66ed0853d":{name:"Spider-Man"},"6805ed0d5e510215":{name:"St. Andrews Old Course"},f815d0a743aa8922:{name:"Star Fox 64",save:"Eeprom4k"},c1a7caff37858568:{name:"Star Fox 64",save:"Eeprom4k"},a00b78ba34db210f:{name:"Star Fox 64",save:"Eeprom4k"},"853cd9dde881e3da":{name:"Star Soldier Vanishing Earth",save:"Eeprom4k"},"23eb03b73ae5aa28":{name:"Star Soldier Vanishing Earth",save:"Eeprom4k"},"42a263f13b9b44f2":{name:"Star Twins"},"124aa266c26aaf22":{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},a2bd5c164622a605:{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},c1919121613c1833:{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},ec4ba2664fd9ad2e:{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},bbe8e07eaa11e449:{name:"Star Wars - Rogue Squadron",save:"Eeprom4k"},"63ac24fe17aa411b":{name:"Star Wars - Shadows of the Empire",save:"Eeprom4k"},"8166484d45927dab":{name:"Star Wars - Shadows of the Empire",save:"Eeprom4k"},"5c7e4d2622468718":{name:"Star Wars - Shadows of the Empire (v1.0)",save:"Eeprom4k"},"91b0474160102563":{name:"Star Wars - Shadows of the Empire (v1.1)",save:"Eeprom4k"},"54edd74d7d28f974":{name:"Star Wars - Shadows of the Empire (v1.2)",save:"Eeprom4k"},"90487e82dc688495":{name:"Star Wars - Shuggeki Rogue Chitai",save:"Eeprom4k"},"9b98023de281a3d4":{name:"Star Wars Episode I - Battle for Naboo",save:"Eeprom4k"},e2ace6ea84430b02:{name:"Star Wars Episode I - Battle for Naboo",save:"Eeprom4k"},"9803f7728ba95665":{name:"Star Wars Episode I - Racer",save:"Eeprom16k"},"52b1f561ab226104":{name:"Star Wars Episode I - Racer",save:"Eeprom16k"},c42ded5302802506:{name:"Star Wars Episode I - Racer",save:"Eeprom16k"},fbfb8406a5a83e5d:{name:"StarCraft 64",save:"FlashRam"},a35ecf42df34139a:{name:"StarCraft 64",save:"FlashRam"},c32c9bbca54dd04e:{name:"StarCraft 64 (beta)",save:"FlashRam"},b8a5ed9403e97386:{name:"Starshot - Space Circus Fever",save:"Eeprom4k"},"550e9ed89aa97ab1":{name:"Starshot - Space Circus Fever",save:"Eeprom4k"},d7d81095d20d1035:{name:"Stunt Racer 64"},"696b64f4951075c5":{name:"Super B-Daman - Battle Phoenix 64"},"5a211daa9abecb91":{name:"Super Bowling 64"},"85f3f2f37f0c496e":{name:"Super Bowling 64"},f08cbca5f651bad8:{name:"Super Mario 64 - Star Road",save:"Eeprom4k"},"76d1fe61f9bb05ea":{name:"Super Mario 64 - The Missing Stars v2",save:"Eeprom4k"},"88aefe21241410a4":{name:"Super Mario 64 - The Missing Stars",save:"Eeprom4k"},d5ba7f26dcfa9375:{name:"Super Mario 64 Ru",save:"Eeprom4k"},c5425a63dc8ec5bd:{name:"Super Mario 64 Extended",save:"Eeprom4k"},ff2b5a632623028b:{name:"Super Mario 64",save:"Eeprom4k"},"0e3daa4e247c7574":{name:"Super Mario 64",save:"Eeprom4k"},"36f03ca0d2c5c1bc":{name:"Super Mario 64",save:"Eeprom4k"},a8a4fbd62caa2663:{name:"Super Mario 64 Shindou Edition",save:"Eeprom4k"},"80205766e148e328":{name:"Super Robot Spirits"},"10d84916d2d63af7":{name:"Super Robot Taisen 64"},"5b8b6b91a4850b78":{name:"Super Smash Brothers",save:"SRAM"},"485f9493302e0f5c":{name:"Super Smash Brothers",save:"SRAM"},a1fd26dde36b4acb:{name:"Super Smash Brothers",save:"SRAM"},"222ee09cb0f16e20":{name:"Super Speed Race 64"},"532545c1d9247b5d":{name:"Supercross 2000"},"7f12bb2cd8bfc209":{name:"Supercross 2000"},"5bf3e8a2d987dcc9":{name:"Superman - The Animated Series"},"74ab4cb4299a0207":{name:"Superman - The Animated Series"},f311e83524277999:{name:"Susume! Taisen Puzzle Dama Toukon! Marumata Chou"},"56a48bb9af762b5b":{name:"Tamagotchi World 64",save:"Eeprom4k"},"54ddbcae4a83ff15":{name:"Taz Express",save:"Eeprom4k"},bb2f04d97c99fffc:{name:"Telefoot Soccer 2000"},a6db3a969bc8d5f7:{name:"Tetris 64"},beda1f3cbae0a402:{name:"Tetrisphere",save:"Eeprom4k"},a984e60fc47ab78b:{name:"Tetrisphere",save:"Eeprom4k"},"161b7d91e19b1f83":{name:"The Legend of Zelda - OoT Nightmare Mod",save:"SRAM"},c7c7b1f831a4fc1e:{name:"The Legend of Zelda - Ocarina of Time Ru",save:"SRAM"},"4fecec6a144892f0":{name:"The Legend of Zelda - Majora's Mask ",save:"FlashRam"},E585C39FC705CC3E:{name:"The Legend of Zelda - Majora's Mask Debug",save:"FlashRam"},b71170ec2bd71676:{name:"The Legend of Zelda - Ocarina of Time (v1.0)",save:"SRAM"},"1a0034f006ed47ae":{name:"The Legend of Zelda - Ocarina of Time Master Quest (GC)",save:"SRAM"},"69b544b085193c37":{name:"The Legend of Zelda - Ocarina of Time (v1.0)",save:"SRAM"},"1fa83dd4191e1e02":{name:"The Legend of Zelda - Ocarina of Time (v1.1)",save:"SRAM"},bd5f05b20c4eab0b:{name:"The Legend of Zelda - Ocarina of Time (v1.1)",save:"SRAM"},aea23b699f4ef1b7:{name:"The Legend of Zelda - Ocarina of Time (v1.2)",save:"SRAM"},c35a46091b50cbf8:{name:"The Legend of Zelda - Ocarina of Time (GC)",save:"SRAM"},f6187d915354bc69:{name:"The Legend of Zelda - Zelda's Birthday",save:"SRAM"},"08eb43b49311b34d":{name:"The Legend of Zelda - Majora's Mask (GC)",save:"FlashRam"},"459379bf027aff39":{name:"The Legend of Zelda - Majora's Mask (Demo)",save:"FlashRam"},"1c635453f0dea203":{name:"The Legend of Zelda - Majora's Mask",save:"FlashRam"},c65579e9388d33bc:{name:"The Legend of Zelda - Majora's Mask",save:"FlashRam"},ba35ddf375e05241:{name:"The Legend of Zelda - Ocarina of Time (GC)",save:"SRAM"},f336411da9ee63af:{name:"The Legend of Zelda - OOT (Master Quest)",save:"SRAM"},"3f14532151632d99":{name:"The New Tetris",save:"SRAM"},"0aff1ce6710d1cce":{name:"The New Tetris",save:"SRAM"},"33ddbf4e849d4c66":{name:"Tigger's Honey Hunt",save:"FlashRam"},"2ff7c4e006159e76":{name:"Tigger's Honey Hunt",save:"FlashRam"},"1c39e76333eacce6":{name:"Tom and Jerry in Fists of Furry",save:"Eeprom4k"},fb4e4f2bfe11c543:{name:"Tom and Jerry in Fists of Furry",save:"Eeprom4k"},"3329418ddb648f58":{name:"Tom Clancy's Rainbow Six"},"35f36b4881cc4d03":{name:"Tom Clancy's Rainbow Six"},"420c2a397de790b7":{name:"Tom Clancy's Rainbow Six"},"3daf7548a2d3669a":{name:"Tom Clancy's Rainbow Six"},"14979eef7d2c3bc0":{name:"Tonic Trouble"},"6e913f0998b60844":{name:"Tonic Trouble"},"22c04e2085d119b1":{name:"Tony Hawk's Pro Skater (v1.0)"},"804114e0c9780b65":{name:"Tony Hawk's Pro Skater (v1.1)"},a526899f09b48705:{name:"Tony Hawk's Pro Skater"},"57b5ea840f198ac8":{name:"Tony Hawk's Pro Skater 2"},"180e1599a5e66612":{name:"Tony Hawk's Pro Skater 2"},"99150E181266E6A5":{name:"Tony Hawk's Pro Skater 2"},b5707f1afdb9b700:{name:"Tony Hawk's Pro Skater 3"},bf6e749a99ea0228:{name:"Toon Panic (Proto)"},f002cc8e81de8b7f:{name:"Top Gear Hyper-Bike",save:"Eeprom4k"},c6493f5fb014c70d:{name:"Top Gear Hyper-Bike",save:"Eeprom4k"},"80cd41d712b9a9ac":{name:"Top Gear Overdrive",save:"Eeprom4k"},"4ff2780517bf7591":{name:"Top Gear Overdrive",save:"Eeprom4k"},"38a59bd089541a1c":{name:"Top Gear Overdrive",save:"Eeprom4k"},"3d9b2662e8b111fe":{name:"Top Gear Rally",save:"Eeprom4k"},"4762590e8b4b3d75":{name:"Top Gear Rally",save:"Eeprom4k"},"01e7437fd1286353":{name:"Top Gear Rally",save:"Eeprom4k"},e07359beb8edb089:{name:"Top Gear Rally 2"},d62cefcfe673e9c9:{name:"Top Gear Rally 2"},"77b6babee4b5b051":{name:"Top Gear Rally 2"},"77d32df847b33f8c":{name:"Top Gear Rally 2"},a43c70efc99a4a4d:{name:"Toukon Road - Brave Spirits"},"437f1c551c834991":{name:"Toukon Road 2 - The Next Generation"},"75902a781d6352e5":{name:"Toy Story 2"},"3e7450a1cd2225cf":{name:"Toy Story 2"},"97db93cbd5635c7f":{name:"Toy Story 2"},"5838ebcc972d9526":{name:"Toy Story 2"},"436b4bfea7291d08":{name:"Triple Play 2000"},"0ffae466d0c788de":{name:"Turok - Legenden des Verlorenen Landes"},"8b49b9ad558ff2da":{name:"Turok - Rage Wars"},"1462a21e0f9090e7":{name:"Turok - Rage Wars"},dd09702f53ac3bfc:{name:"Turok - The Dinosaur Hunter"},"63d95f661266ccb5":{name:"Turok - The Dinosaur Hunter"},b8e66a9122ab1788:{name:"Turok - The Dinosaur Hunter"},"0df1702fff87415c":{name:"Turok - The Dinosaur Hunter (v1.0)"},dd095f6653ac3bfc:{name:"Turok - The Dinosaur Hunter (v1.0)"},cd0d702fc9c56c17:{name:"Turok - The Dinosaur Hunter (v1.1/v1.2)"},"49770e2e599db4b8":{name:"Turok 2 - Seeds of Evil"},"942bb9e025e0a7b9":{name:"Turok 2 - Seeds of Evil"},"0b8405fe0c329393":{name:"Turok 2 - Seeds of Evil"},"118a08497e959464":{name:"Turok 2 - Seeds of Evil"},"942bb9e0bd7ce880":{name:"Turok 2 - Seeds of Evil"},fc5ac9e8da21d135:{name:"Turok 2 - Seeds of Evil - Kiosk"},f179a589ef977e66:{name:"Turok 3 - Shadow of Oblivion"},f22f166a4c709320:{name:"Turok 3 - Shadow of Oblivion"},"329dc9bb80aa7d11":{name:"Twisted Edge Extreme Snowboarding"},b8a588e6183f4bb1:{name:"Twisted Edge Extreme Snowboarding"},"7851da6ec1fe96d3":{name:"Vigilante 8"},"6a0571ea474821e4":{name:"Vigilante 8"},a282bce294d61c59:{name:"Vigilante 8"},f4791f15e5c8ed8e:{name:"Vigilante 8"},"6d86c5f5d9132705":{name:"Vigilante 8 - 2nd Offense"},"7ebc10dd51b300f9":{name:"Vigilante 8 - 2nd Offense"},"986c006081a30526":{name:"Violence Killer - Turok New Generation"},"8b24b3824d243ee7":{name:"Virtual Chess 64"},"21a2da2fcea788a5":{name:"Virtual Chess 64"},"43764a4ed73974a3":{name:"Virtual Pool 64"},d0f2f9989cf0d903:{name:"Virtual Pool 64"},c4085c048b79fd4a:{name:"Virtual Pro Wrestling",save:"Eeprom4k"},"354209cd624b0788":{name:"Virtual Pro Wrestling 2",save:"SRAM"},"3890053c8221bfc8":{name:"V-Rally Edition 99",save:"Eeprom4k"},a524024d9457eb1b:{name:"V-Rally Edition 99",save:"Eeprom4k"},"196b6e635fdc7de5":{name:"V-Rally Edition 99",save:"Eeprom4k"},"8ad56680c1cadec3":{name:"Waialae Country Club - True Golf Classics",save:"Eeprom4k"},"75300593430f1e26":{name:"Waialae Country Club - True Golf Classics",save:"Eeprom4k"},ad57500c6e126e04:{name:"Waialae Country Club - True Golf Classics (1.1)",save:"Eeprom4k"},e28c31ddba9837b7:{name:"Waialae Country Club - True Golf Classics (1.1)",save:"Eeprom4k"},f628fef7c3acf2c3:{name:"War Gods"},"70cc15d7d6f51c27":{name:"War Gods"},d691915c06c30ab3:{name:"Wave Race 64",save:"Eeprom4k"},"96fa0e65a7f9dd30":{name:"Wave Race 64",save:"Eeprom4k"},"531fe17d9d2f8774":{name:"Wave Race 64 (v1.0)",save:"Eeprom4k"},"614b2f496a14e504":{name:"Wave Race 64 (v1.1)",save:"Eeprom4k"},e2f35d53f1899760:{name:"Wave Race 64 Shindou Edition",save:"Eeprom4k"},"59aa3bdc6a45bb0a":{name:"Wayne Gretzky's 3D Hockey v1.1"},"3f22456b565c0ef0":{name:"Wayne Gretzky's 3D Hockey"},"431030f11a5480fd":{name:"Wayne Gretzky's 3D Hockey"},"4b090922af59952c":{name:"Wayne Gretzky's 3D Hockey"},"59389d5a10e7aa97":{name:"Wayne Gretzky's 3D Hockey '98"},f3451b666d26d69e:{name:"Wayne Gretzky's 3D Hockey '98"},dd5a6f39a7ec9366:{name:"WCW Backstage Assault"},d68cbe33126918ec:{name:"WCW Mayhem"},"58067baa7b93969c":{name:"WCW Mayhem"},"1a5ac4d45eb225f4":{name:"WCW Nitro"},"68afdb8b364b5b34":{name:"WCW vs. NWO - World Tour"},bd193e2c5eee1351:{name:"WCW vs. NWO - World Tour (v1.0)"},b960be713cfbdb1d:{name:"WCW vs. NWO - World Tour (v1.2)"},ab96e5dee77a3baf:{name:"WCW-NWO Revenge",save:"SRAM"},"75a8e86886a4e70c":{name:"WCW-NWO Revenge",save:"SRAM"},"4fb5a8ce03d5217f":{name:"Wetrix"},faeab6dca3cfbbc6:{name:"Wetrix"},"2b0996e84e4d24dc":{name:"Wheel of Fortune"},c7c4eb0c32e99c0c:{name:"Wild Choppers",save:"Eeprom4k"},"7e9598edacdc4282":{name:"WinBack - Covert Operations"},e056a01f6a94b9a4:{name:"WinBack - Covert Operations"},af8c89d55bb60760:{name:"WinBack - Covert Operations"},"32272d1318910ec7":{name:"Wipeout 64"},"7d0e3154d830546b":{name:"Wipeout 64"},"65973ce4bec1b105":{name:"Wonder Project J2"},"38594b3a9d986fa2":{name:"Wonder Project J2 (English)"},f7881e4f963f5a4a:{name:"Wonder Project J2 (English)"},"6a6d63bdba541f5d":{name:"World Cup 98"},"9030fcf9c24e01ff":{name:"World Cup 98"},c8fe8d30f6b52ece:{name:"World Driver Championship"},"782706acb8fcaddf":{name:"World Driver Championship"},a059e913b0ca930e:{name:"Worms - Armageddon",save:"Eeprom4k"},"7bc5212d8cc5e48f":{name:"Worms - Armageddon",save:"Eeprom4k"},"0fec5bcd0810fd86":{name:"WWF - War Zone"},a475a233594450b8:{name:"WWF - War Zone"},c851318f45f53a4f:{name:"WWF Attitude"},"142fbed288374538":{name:"WWF Attitude"},"7b5bf45be8ee6b59":{name:"WWF Attitude"},"40064b4efbbc491b":{name:"WWF No Mercy",save:"FlashRam"},"8ef08d6dcfc308d0":{name:"WWF No Mercy (v1.0)",save:"FlashRam"},c294db8cf0c646cb:{name:"WWF No Mercy (v1.1)",save:"FlashRam"},"0390a59064980831":{name:"WWF WrestleMania 2000",save:"SRAM"},a57d731259919623:{name:"WWF Wrestlemania 2000",save:"SRAM"},be5313c7eea609aa:{name:"WWF WrestleMania 2000",save:"SRAM"},"9dae5305c1e0d8ea":{name:"Xena Warrior Princess - Talisman of Fate"},c767160aa6463329:{name:"Xena Warrior Princess - Talisman of Fate"},c3968b9fdc9411a0:{name:"Yakouchuu II - Satsujun Kouru"},e8d83723ec7c8e6b:{name:"Yoshi's Story",save:"Eeprom16k"},"60cacf2d47b15483":{name:"Yoshi's Story",save:"Eeprom16k"},"497df9d35b132469":{name:"Yoshi's Story",save:"Eeprom16k"},"8d3bda777c0d2b16":{name:"Yosuke no Mahjong Juku",save:"Eeprom4k"},"2d16e69f37407ee9":{name:"Yuke Yuke!! Trouble Makers"},c1d0738466061223:{name:"Zelda no Densetsu 2 - Mujura no Kamen",save:"FlashRam"},b82df5f736e69521:{name:"Zelda no Densetsu - Toki no Ocarina Collectors Ed.",save:"SRAM"},baf411f65c1384c5:{name:"Zelda no Densetsu - Toki no Ocarina (GC)",save:"SRAM"},ba453bf46f9b0e2f:{name:"Zelda no Densetsu - Toki no Ocarina (GC)",save:"SRAM"},"127341ec5fde31eb":{name:"Zelda no Densetsu 2 - Mujura no Kamen",save:"FlashRam"},"3804ae69f3f3632c":{name:"Zelda no Densetsu 2 - Mujura no Kamen (1.1)",save:"FlashRam"},cd0c011cfab7d322:{name:"Zool - Majou Tsukai Densetsu"},"54a43977662af5a2":{name:"A HORiZON64 RELEASE"},"91d8ab5ccef62962":{name:"Fishy by NaN v0.3141"},bc069a1355006b41:{name:"Mind Present-Readme"},b1cb11c87c61b78f:{name:"Mind Present / DNX"},"54f53fcb0bcd7387":{name:"Tron Demo"},"4549049c0c0b1ed3":{name:"POM99 - README"},"7a7d3b994df0542e":{name:"POM99 - MADEIRAGAMES"},"575aa9a37dc2e69f":{name:"POM99 - WET DREAMS"},"95c03bca0a864996":{name:"POM99 - CAN-BETA"},d44a7da4f981fa8b:{name:"Manic Miner 64"},"2d369c9d086be65b":{name:"Shag-a-delic/CAMELOT"},c479518fdc263580:{name:"Space Rotator"},"70bb552625997d66":{name:"O.D.T.",save:"Controller"},a61564e8535b3998:{name:"O.D.T.",save:"Controller"}};var t3={};EH(t3,{write:()=>{{return YF}},viewport:()=>{{return h5}},variationPlacements:()=>{{return l3}},top:()=>{{return P0}},start:()=>{{return r6}},right:()=>{{return D0}},reference:()=>{{return OZ}},read:()=>{{return ZF}},preventOverflow:()=>{{return pZ}},popperOffsets:()=>{{return E5}},popperGenerator:()=>{{return L4}},popper:()=>{{return G8}},placements:()=>{{return R5}},offset:()=>{{return gZ}},modifierPhases:()=>{{return yZ}},main:()=>{{return WF}},left:()=>{{return h0}},hide:()=>{{return xZ}},flip:()=>{{return uZ}},eventListeners:()=>{{return O5}},end:()=>{{return v9}},detectOverflow:()=>{{return K6}},createPopperLite:()=>{{return Vb}},createPopperBase:()=>{{return Mb}},createPopper:()=>{{return T5}},computeStyles:()=>{{return C5}},clippingParents:()=>{{return CZ}},bottom:()=>{{return I0}},beforeWrite:()=>{{return XF}},beforeRead:()=>{{return JF}},beforeMain:()=>{{return QF}},basePlacements:()=>{{return H9}},auto:()=>{{return U5}},arrow:()=>{{return TZ}},applyStyles:()=>{{return b5}},afterWrite:()=>{{return zF}},afterRead:()=>{{return qF}},afterMain:()=>{{return KF}}});var P0="top",I0="bottom",D0="right",h0="left",U5="auto",H9=[P0,I0,D0,h0],r6="start",v9="end",CZ="clippingParents",h5="viewport",G8="popper",OZ="reference",l3=H9.reduce(function(J,Z){return J.concat([Z+"-"+r6,Z+"-"+v9])},[]),R5=[].concat(H9,[U5]).reduce(function(J,Z){return J.concat([Z,Z+"-"+r6,Z+"-"+v9])},[]),JF="beforeRead",ZF="read",qF="afterRead",QF="beforeMain",WF="main",KF="afterMain",XF="beforeWrite",YF="write",zF="afterWrite",yZ=[JF,ZF,qF,QF,WF,KF,XF,YF,zF];function u0(J){return J?(J.nodeName||"").toLowerCase():null}function N0(J){if(J==null)return window;if(J.toString()!=="[object Window]"){var Z=J.ownerDocument;return Z?Z.defaultView||window:window}return J}var V6=function(J){var Z=N0(J).Element;return J instanceof Z||J instanceof Element},S0=function(J){var Z=N0(J).HTMLElement;return J instanceof Z||J instanceof HTMLElement},$4=function(J){if(typeof ShadowRoot==="undefined")return!1;var Z=N0(J).ShadowRoot;return J instanceof Z||J instanceof ShadowRoot};var lR=function(J){var Z=J.state;Object.keys(Z.elements).forEach(function(q){var Q=Z.styles[q]||{},W=Z.attributes[q]||{},K=Z.elements[q];if(!S0(K)||!u0(K))return;Object.assign(K.style,Q),Object.keys(W).forEach(function(X){var Y=W[X];if(Y===!1)K.removeAttribute(X);else K.setAttribute(X,Y===!0?"":Y)})})},rR=function(J){var Z=J.state,q={popper:{position:Z.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};if(Object.assign(Z.elements.popper.style,q.popper),Z.styles=q,Z.elements.arrow)Object.assign(Z.elements.arrow.style,q.arrow);return function(){Object.keys(Z.elements).forEach(function(Q){var W=Z.elements[Q],K=Z.attributes[Q]||{},X=Object.keys(Z.styles.hasOwnProperty(Q)?Z.styles[Q]:q[Q]),Y=X.reduce(function(z,G){return z[G]="",z},{});if(!S0(W)||!u0(W))return;Object.assign(W.style,Y),Object.keys(K).forEach(function(z){W.removeAttribute(z)})})}},b5={name:"applyStyles",enabled:!0,phase:"write",fn:lR,effect:rR,requires:["computeStyles"]};function x0(J){return J.split("-")[0]}var{max:v6,min:$8,round:G9}=Math;function j4(){var J=navigator.userAgentData;if(J!=null&&J.brands&&Array.isArray(J.brands))return J.brands.map(function(Z){return Z.brand+"/"+Z.version}).join(" ");return navigator.userAgent}function D5(){return!/^((?!chrome|android).)*safari/i.test(j4())}function U6(J,Z,q){if(Z===void 0)Z=!1;if(q===void 0)q=!1;var Q=J.getBoundingClientRect(),W=1,K=1;if(Z&&S0(J))W=J.offsetWidth>0?G9(Q.width)/J.offsetWidth||1:1,K=J.offsetHeight>0?G9(Q.height)/J.offsetHeight||1:1;var X=V6(J)?N0(J):window,Y=X.visualViewport,z=!D5()&&q,G=(Q.left+(z&&Y?Y.offsetLeft:0))/W,H=(Q.top+(z&&Y?Y.offsetTop:0))/K,j=Q.width/W,N=Q.height/K;return{width:j,height:N,top:H,right:G+j,bottom:H+N,left:G,x:G,y:H}}function j8(J){var Z=U6(J),q=J.offsetWidth,Q=J.offsetHeight;if(Math.abs(Z.width-q)<=1)q=Z.width;if(Math.abs(Z.height-Q)<=1)Q=Z.height;return{x:J.offsetLeft,y:J.offsetTop,width:q,height:Q}}function A5(J,Z){var q=Z.getRootNode&&Z.getRootNode();if(J.contains(Z))return!0;else if(q&&$4(q)){var Q=Z;do{if(Q&&J.isSameNode(Q))return!0;Q=Q.parentNode||Q.host}while(Q)}return!1}function t0(J){return N0(J).getComputedStyle(J)}function EZ(J){return["table","td","th"].indexOf(u0(J))>=0}function a0(J){return((V6(J)?J.ownerDocument:J.document)||window.document).documentElement}function $9(J){if(u0(J)==="html")return J;return J.assignedSlot||J.parentNode||($4(J)?J.host:null)||a0(J)}var FF=function(J){if(!S0(J)||t0(J).position==="fixed")return null;return J.offsetParent},sR=function(J){var Z=/firefox/i.test(j4()),q=/Trident/i.test(j4());if(q&&S0(J)){var Q=t0(J);if(Q.position==="fixed")return null}var W=$9(J);if($4(W))W=W.host;while(S0(W)&&["html","body"].indexOf(u0(W))<0){var K=t0(W);if(K.transform!=="none"||K.perspective!=="none"||K.contain==="paint"||["transform","perspective"].indexOf(K.willChange)!==-1||Z&&K.willChange==="filter"||Z&&K.filter&&K.filter!=="none")return W;else W=W.parentNode}return null};function f6(J){var Z=N0(J),q=FF(J);while(q&&EZ(q)&&t0(q).position==="static")q=FF(q);if(q&&(u0(q)==="html"||u0(q)==="body"&&t0(q).position==="static"))return Z;return q||sR(J)||Z}function k8(J){return["top","bottom"].indexOf(J)>=0?"x":"y"}function N8(J,Z,q){return v6(J,$8(Z,q))}function HF(J,Z,q){var Q=N8(J,Z,q);return Q>q?q:Q}function w5(){return{top:0,right:0,bottom:0,left:0}}function B5(J){return Object.assign({},w5(),J)}function I5(J,Z){return Z.reduce(function(q,Q){return q[Q]=J,q},{})}var tR=function(J){var Z,q=J.state,Q=J.name,W=J.options,K=q.elements.arrow,X=q.modifiersData.popperOffsets,Y=x0(q.placement),z=k8(Y),G=[h0,D0].indexOf(Y)>=0,H=G?"height":"width";if(!K||!X)return;var j=iR(W.padding,q),N=j8(K),L=z==="y"?P0:h0,M=z==="y"?I0:D0,V=q.rects.reference[H]+q.rects.reference[z]-X[z]-q.rects.popper[H],h=X[z]-q.rects.reference[z],b=f6(K),C=b?z==="y"?b.clientHeight||0:b.clientWidth||0:0,_=V/2-h/2,E=j[L],S=C-N[H]-j[M],m=C/2-N[H]/2+_,o=N8(E,m,S),L0=z;q.modifiersData[Q]=(Z={},Z[L0]=o,Z.centerOffset=o-m,Z)},eR=function(J){var{state:Z,options:q}=J,Q=q.element,W=Q===void 0?"[data-popper-arrow]":Q;if(W==null)return;if(typeof W==="string"){if(W=Z.elements.popper.querySelector(W),!W)return}if(!A5(Z.elements.popper,W))return;Z.elements.arrow=W},iR=function J(Z,q){return Z=typeof Z==="function"?Z(Object.assign({},q.rects,{placement:q.placement})):Z,B5(typeof Z!=="number"?Z:I5(Z,H9))},TZ={name:"arrow",enabled:!0,phase:"main",fn:tR,effect:eR,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function h6(J){return J.split("-")[1]}var Zb=function(J,Z){var{x:q,y:Q}=J,W=Z.devicePixelRatio||1;return{x:G9(q*W)/W||0,y:G9(Q*W)/W||0}};function GF(J){var Z,q=J.popper,Q=J.popperRect,W=J.placement,K=J.variation,X=J.offsets,Y=J.position,z=J.gpuAcceleration,G=J.adaptive,H=J.roundOffsets,j=J.isFixed,N=X.x,L=N===void 0?0:N,M=X.y,V=M===void 0?0:M,h=typeof H==="function"?H({x:L,y:V}):{x:L,y:V};L=h.x,V=h.y;var b=X.hasOwnProperty("x"),C=X.hasOwnProperty("y"),_=h0,E=P0,S=window;if(G){var m=f6(q),o="clientHeight",L0="clientWidth";if(m===N0(q)){if(m=a0(q),t0(m).position!=="static"&&Y==="absolute")o="scrollHeight",L0="scrollWidth"}if(m=m,W===P0||(W===h0||W===D0)&&K===v9){E=I0;var R0=j&&m===S&&S.visualViewport?S.visualViewport.height:m[o];V-=R0-Q.height,V*=z?1:-1}if(W===h0||(W===P0||W===I0)&&K===v9){_=D0;var F0=j&&m===S&&S.visualViewport?S.visualViewport.width:m[L0];L-=F0-Q.width,L*=z?1:-1}}var H0=Object.assign({position:Y},G&&Jb),Y6=H===!0?Zb({x:L,y:V},N0(q)):{x:L,y:V};if(L=Y6.x,V=Y6.y,z){var n0;return Object.assign({},H0,(n0={},n0[E]=C?"0":"",n0[_]=b?"0":"",n0.transform=(S.devicePixelRatio||1)<=1?"translate("+L+"px, "+V+"px)":"translate3d("+L+"px, "+V+"px, 0)",n0))}return Object.assign({},H0,(Z={},Z[E]=C?V+"px":"",Z[_]=b?L+"px":"",Z.transform="",Z))}var qb=function(J){var{state:Z,options:q}=J,Q=q.gpuAcceleration,W=Q===void 0?!0:Q,K=q.adaptive,X=K===void 0?!0:K,Y=q.roundOffsets,z=Y===void 0?!0:Y,G={placement:x0(Z.placement),variation:h6(Z.placement),popper:Z.elements.popper,popperRect:Z.rects.popper,gpuAcceleration:W,isFixed:Z.options.strategy==="fixed"};if(Z.modifiersData.popperOffsets!=null)Z.styles.popper=Object.assign({},Z.styles.popper,GF(Object.assign({},G,{offsets:Z.modifiersData.popperOffsets,position:Z.options.strategy,adaptive:X,roundOffsets:z})));if(Z.modifiersData.arrow!=null)Z.styles.arrow=Object.assign({},Z.styles.arrow,GF(Object.assign({},G,{offsets:Z.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:z})));Z.attributes.popper=Object.assign({},Z.attributes.popper,{"data-popper-placement":Z.placement})},Jb={top:"auto",right:"auto",bottom:"auto",left:"auto"},C5={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:qb,data:{}};var Qb=function(J){var{state:Z,instance:q,options:Q}=J,W=Q.scroll,K=W===void 0?!0:W,X=Q.resize,Y=X===void 0?!0:X,z=N0(Z.elements.popper),G=[].concat(Z.scrollParents.reference,Z.scrollParents.popper);if(K)G.forEach(function(H){H.addEventListener("scroll",q.update,r3)});if(Y)z.addEventListener("resize",q.update,r3);return function(){if(K)G.forEach(function(H){H.removeEventListener("scroll",q.update,r3)});if(Y)z.removeEventListener("resize",q.update,r3)}},r3={passive:!0},O5={name:"eventListeners",enabled:!0,phase:"write",fn:function J(){},effect:Qb,data:{}};var Wb={left:"right",right:"left",bottom:"top",top:"bottom"};function k4(J){return J.replace(/left|right|bottom|top/g,function(Z){return Wb[Z]})}var Kb={start:"end",end:"start"};function s3(J){return J.replace(/start|end/g,function(Z){return Kb[Z]})}function L8(J){var Z=N0(J),q=Z.pageXOffset,Q=Z.pageYOffset;return{scrollLeft:q,scrollTop:Q}}function M8(J){return U6(a0(J)).left+L8(J).scrollLeft}function SZ(J,Z){var q=N0(J),Q=a0(J),W=q.visualViewport,K=Q.clientWidth,X=Q.clientHeight,Y=0,z=0;if(W){K=W.width,X=W.height;var G=D5();if(G||!G&&Z==="fixed")Y=W.offsetLeft,z=W.offsetTop}return{width:K,height:X,x:Y+M8(J),y:z}}function _Z(J){var Z,q=a0(J),Q=L8(J),W=(Z=J.ownerDocument)==null?void 0:Z.body,K=v6(q.scrollWidth,q.clientWidth,W?W.scrollWidth:0,W?W.clientWidth:0),X=v6(q.scrollHeight,q.clientHeight,W?W.scrollHeight:0,W?W.clientHeight:0),Y=-Q.scrollLeft+M8(J),z=-Q.scrollTop;if(t0(W||q).direction==="rtl")Y+=v6(q.clientWidth,W?W.clientWidth:0)-K;return{width:K,height:X,x:Y,y:z}}function P8(J){var Z=t0(J),q=Z.overflow,Q=Z.overflowX,W=Z.overflowY;return/auto|scroll|overlay|hidden/.test(q+W+Q)}function i3(J){if(["html","body","#document"].indexOf(u0(J))>=0)return J.ownerDocument.body;if(S0(J)&&P8(J))return J;return i3($9(J))}function f9(J,Z){var q;if(Z===void 0)Z=[];var Q=i3(J),W=Q===((q=J.ownerDocument)==null?void 0:q.body),K=N0(Q),X=W?[K].concat(K.visualViewport||[],P8(Q)?Q:[]):Q,Y=Z.concat(X);return W?Y:Y.concat(f9($9(X)))}function N4(J){return Object.assign({},J,{left:J.x,top:J.y,right:J.x+J.width,bottom:J.y+J.height})}var Xb=function(J,Z){var q=U6(J,!1,Z==="fixed");return q.top=q.top+J.clientTop,q.left=q.left+J.clientLeft,q.bottom=q.top+J.clientHeight,q.right=q.left+J.clientWidth,q.width=J.clientWidth,q.height=J.clientHeight,q.x=q.left,q.y=q.top,q},$F=function(J,Z,q){return Z===h5?N4(SZ(J,q)):V6(Z)?Xb(Z,q):N4(_Z(a0(J)))},Yb=function(J){var Z=f9($9(J)),q=["absolute","fixed"].indexOf(t0(J).position)>=0,Q=q&&S0(J)?f6(J):J;if(!V6(Q))return[];return Z.filter(function(W){return V6(W)&&A5(W,Q)&&u0(W)!=="body"})};function vZ(J,Z,q,Q){var W=Z==="clippingParents"?Yb(J):[].concat(Z),K=[].concat(W,[q]),X=K[0],Y=K.reduce(function(z,G){var H=$F(J,G,Q);return z.top=v6(H.top,z.top),z.right=$8(H.right,z.right),z.bottom=$8(H.bottom,z.bottom),z.left=v6(H.left,z.left),z},$F(J,X,Q));return Y.width=Y.right-Y.left,Y.height=Y.bottom-Y.top,Y.x=Y.left,Y.y=Y.top,Y}function y5(J){var{reference:Z,element:q,placement:Q}=J,W=Q?x0(Q):null,K=Q?h6(Q):null,X=Z.x+Z.width/2-q.width/2,Y=Z.y+Z.height/2-q.height/2,z;switch(W){case P0:z={x:X,y:Z.y-q.height};break;case I0:z={x:X,y:Z.y+Z.height};break;case D0:z={x:Z.x+Z.width,y:Y};break;case h0:z={x:Z.x-q.width,y:Y};break;default:z={x:Z.x,y:Z.y}}var G=W?k8(W):null;if(G!=null){var H=G==="y"?"height":"width";switch(K){case r6:z[G]=z[G]-(Z[H]/2-q[H]/2);break;case v9:z[G]=z[G]+(Z[H]/2-q[H]/2);break;default:}}return z}function K6(J,Z){if(Z===void 0)Z={};var q=Z,Q=q.placement,W=Q===void 0?J.placement:Q,K=q.strategy,X=K===void 0?J.strategy:K,Y=q.boundary,z=Y===void 0?CZ:Y,G=q.rootBoundary,H=G===void 0?h5:G,j=q.elementContext,N=j===void 0?G8:j,L=q.altBoundary,M=L===void 0?!1:L,V=q.padding,h=V===void 0?0:V,b=B5(typeof h!=="number"?h:I5(h,H9)),C=N===G8?OZ:G8,_=J.rects.popper,E=J.elements[M?C:N],S=vZ(V6(E)?E:E.contextElement||a0(J.elements.popper),z,H,X),m=U6(J.elements.reference),o=y5({reference:m,element:_,strategy:"absolute",placement:W}),L0=N4(Object.assign({},_,o)),R0=N===G8?L0:m,F0={top:S.top-R0.top+b.top,bottom:R0.bottom-S.bottom+b.bottom,left:S.left-R0.left+b.left,right:R0.right-S.right+b.right},H0=J.modifiersData.offset;if(N===G8&&H0){var Y6=H0[W];Object.keys(F0).forEach(function(n0){var o9=[D0,I0].indexOf(n0)>=0?1:-1,d9=[P0,I0].indexOf(n0)>=0?"y":"x";F0[n0]+=Y6[d9]*o9})}return F0}function fZ(J,Z){if(Z===void 0)Z={};var q=Z,Q=q.placement,W=q.boundary,K=q.rootBoundary,X=q.padding,Y=q.flipVariations,z=q.allowedAutoPlacements,G=z===void 0?R5:z,H=h6(Q),j=H?Y?l3:l3.filter(function(M){return h6(M)===H}):H9,N=j.filter(function(M){return G.indexOf(M)>=0});if(N.length===0)N=j;var L=N.reduce(function(M,V){return M[V]=K6(J,{placement:V,boundary:W,rootBoundary:K,padding:X})[x0(V)],M},{});return Object.keys(L).sort(function(M,V){return L[M]-L[V]})}var zb=function(J){if(x0(J)===U5)return[];var Z=k4(J);return[s3(J),Z,s3(Z)]},Fb=function(J){var{state:Z,options:q,name:Q}=J;if(Z.modifiersData[Q]._skip)return;var W=q.mainAxis,K=W===void 0?!0:W,X=q.altAxis,Y=X===void 0?!0:X,z=q.fallbackPlacements,G=q.padding,H=q.boundary,j=q.rootBoundary,N=q.altBoundary,L=q.flipVariations,M=L===void 0?!0:L,V=q.allowedAutoPlacements,h=Z.options.placement,b=x0(h),C=b===h,_=z||(C||!M?[k4(h)]:zb(h)),E=[h].concat(_).reduce(function(D8,L9){return D8.concat(x0(L9)===U5?fZ(Z,{placement:L9,boundary:H,rootBoundary:j,padding:G,flipVariations:M,allowedAutoPlacements:V}):L9)},[]),S=Z.rects.reference,m=Z.rects.popper,o=new Map,L0=!0,R0=E[0];for(var F0=0;F0<E.length;F0++){var H0=E[F0],Y6=x0(H0),n0=h6(H0)===r6,o9=[P0,I0].indexOf(Y6)>=0,d9=o9?"width":"height",z6=K6(Z,{placement:H0,boundary:H,rootBoundary:j,altBoundary:N,padding:G}),w6=o9?n0?D0:h0:n0?I0:P0;if(S[d9]>m[d9])w6=k4(w6);var g5=k4(w6),n9=[];if(K)n9.push(z6[Y6]<=0);if(Y)n9.push(z6[w6]<=0,z6[g5]<=0);if(n9.every(function(D8){return D8})){R0=H0,L0=!1;break}o.set(H0,n9)}if(L0){var m5=M?3:1,M2=function D8(L9){var C4=E.find(function(a5){var l9=o.get(a5);if(l9)return l9.slice(0,L9).every(function(P2){return P2})});if(C4)return R0=C4,"break"};for(var I4=m5;I4>0;I4--){var p5=M2(I4);if(p5==="break")break}}if(Z.placement!==R0)Z.modifiersData[Q]._skip=!0,Z.placement=R0,Z.reset=!0},uZ={name:"flip",enabled:!0,phase:"main",fn:Fb,requiresIfExists:["offset"],data:{_skip:!1}};var jF=function(J,Z,q){if(q===void 0)q={x:0,y:0};return{top:J.top-Z.height-q.y,right:J.right-Z.width+q.x,bottom:J.bottom-Z.height+q.y,left:J.left-Z.width-q.x}},kF=function(J){return[P0,D0,I0,h0].some(function(Z){return J[Z]>=0})},Hb=function(J){var{state:Z,name:q}=J,Q=Z.rects.reference,W=Z.rects.popper,K=Z.modifiersData.preventOverflow,X=K6(Z,{elementContext:"reference"}),Y=K6(Z,{altBoundary:!0}),z=jF(X,Q),G=jF(Y,W,K),H=kF(z),j=kF(G);Z.modifiersData[q]={referenceClippingOffsets:z,popperEscapeOffsets:G,isReferenceHidden:H,hasPopperEscaped:j},Z.attributes.popper=Object.assign({},Z.attributes.popper,{"data-popper-reference-hidden":H,"data-popper-escaped":j})},xZ={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Hb};function Gb(J,Z,q){var Q=x0(J),W=[h0,P0].indexOf(Q)>=0?-1:1,K=typeof q==="function"?q(Object.assign({},Z,{placement:J})):q,X=K[0],Y=K[1];return X=X||0,Y=(Y||0)*W,[h0,D0].indexOf(Q)>=0?{x:Y,y:X}:{x:X,y:Y}}var $b=function(J){var{state:Z,options:q,name:Q}=J,W=q.offset,K=W===void 0?[0,0]:W,X=R5.reduce(function(H,j){return H[j]=Gb(j,Z.rects,K),H},{}),Y=X[Z.placement],z=Y.x,G=Y.y;if(Z.modifiersData.popperOffsets!=null)Z.modifiersData.popperOffsets.x+=z,Z.modifiersData.popperOffsets.y+=G;Z.modifiersData[Q]=X},gZ={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:$b};var jb=function(J){var{state:Z,name:q}=J;Z.modifiersData[q]=y5({reference:Z.rects.reference,element:Z.rects.popper,strategy:"absolute",placement:Z.placement})},E5={name:"popperOffsets",enabled:!0,phase:"read",fn:jb,data:{}};function mZ(J){return J==="x"?"y":"x"}var kb=function(J){var{state:Z,options:q,name:Q}=J,W=q.mainAxis,K=W===void 0?!0:W,X=q.altAxis,Y=X===void 0?!1:X,z=q.boundary,G=q.rootBoundary,H=q.altBoundary,j=q.padding,N=q.tether,L=N===void 0?!0:N,M=q.tetherOffset,V=M===void 0?0:M,h=K6(Z,{boundary:z,rootBoundary:G,padding:j,altBoundary:H}),b=x0(Z.placement),C=h6(Z.placement),_=!C,E=k8(b),S=mZ(E),m=Z.modifiersData.popperOffsets,o=Z.rects.reference,L0=Z.rects.popper,R0=typeof V==="function"?V(Object.assign({},Z.rects,{placement:Z.placement})):V,F0=typeof R0==="number"?{mainAxis:R0,altAxis:R0}:Object.assign({mainAxis:0,altAxis:0},R0),H0=Z.modifiersData.offset?Z.modifiersData.offset[Z.placement]:null,Y6={x:0,y:0};if(!m)return;if(K){var n0,o9=E==="y"?P0:h0,d9=E==="y"?I0:D0,z6=E==="y"?"height":"width",w6=m[E],g5=w6+h[o9],n9=w6-h[d9],m5=L?-L0[z6]/2:0,M2=C===r6?o[z6]:L0[z6],I4=C===r6?-L0[z6]:-o[z6],p5=Z.elements.arrow,D8=L&&p5?j8(p5):{width:0,height:0},L9=Z.modifiersData["arrow#persistent"]?Z.modifiersData["arrow#persistent"].padding:w5(),C4=L9[o9],a5=L9[d9],l9=N8(0,o[z6],D8[z6]),P2=_?o[z6]/2-m5-l9-C4-F0.mainAxis:M2-l9-C4-F0.mainAxis,AH=_?-o[z6]/2+m5+l9+a5+F0.mainAxis:I4+l9+a5+F0.mainAxis,V2=Z.elements.arrow&&f6(Z.elements.arrow),wH=V2?E==="y"?V2.clientTop||0:V2.clientLeft||0:0,wq=(n0=H0==null?void 0:H0[E])!=null?n0:0,BH=w6+P2-wq-wH,IH=w6+AH-wq,Bq=N8(L?$8(g5,BH):g5,w6,L?v6(n9,IH):n9);m[E]=Bq,Y6[E]=Bq-w6}if(Y){var Iq,CH=E==="x"?P0:h0,OH=E==="x"?I0:D0,r9=m[S],c5=S==="y"?"height":"width",Cq=r9+h[CH],Oq=r9-h[OH],U2=[P0,h0].indexOf(b)!==-1,yq=(Iq=H0==null?void 0:H0[S])!=null?Iq:0,Eq=U2?Cq:r9-o[c5]-L0[c5]-yq+F0.altAxis,Tq=U2?r9+o[c5]+L0[c5]-yq-F0.altAxis:Oq,Sq=L&&U2?HF(Eq,r9,Tq):N8(L?Eq:Cq,r9,L?Tq:Oq);m[S]=Sq,Y6[S]=Sq-r9}Z.modifiersData[Q]=Y6},pZ={name:"preventOverflow",enabled:!0,phase:"main",fn:kb,requiresIfExists:["offset"]};function aZ(J){return{scrollLeft:J.scrollLeft,scrollTop:J.scrollTop}}function cZ(J){if(J===N0(J)||!S0(J))return L8(J);else return aZ(J)}var Nb=function(J){var Z=J.getBoundingClientRect(),q=G9(Z.width)/J.offsetWidth||1,Q=G9(Z.height)/J.offsetHeight||1;return q!==1||Q!==1};function oZ(J,Z,q){if(q===void 0)q=!1;var Q=S0(Z),W=S0(Z)&&Nb(Z),K=a0(Z),X=U6(J,W,q),Y={scrollLeft:0,scrollTop:0},z={x:0,y:0};if(Q||!Q&&!q){if(u0(Z)!=="body"||P8(K))Y=cZ(Z);if(S0(Z))z=U6(Z,!0),z.x+=Z.clientLeft,z.y+=Z.clientTop;else if(K)z.x=M8(K)}return{x:X.left+Y.scrollLeft-z.x,y:X.top+Y.scrollTop-z.y,width:X.width,height:X.height}}var Lb=function(J){var Z=new Map,q=new Set,Q=[];J.forEach(function(K){Z.set(K.name,K)});function W(K){q.add(K.name);var X=[].concat(K.requires||[],K.requiresIfExists||[]);X.forEach(function(Y){if(!q.has(Y)){var z=Z.get(Y);if(z)W(z)}}),Q.push(K)}return J.forEach(function(K){if(!q.has(K.name))W(K)}),Q};function dZ(J){var Z=Lb(J);return yZ.reduce(function(q,Q){return q.concat(Z.filter(function(W){return W.phase===Q}))},[])}function nZ(J){var Z;return function(){if(!Z)Z=new Promise(function(q){Promise.resolve().then(function(){Z=void 0,q(J())})});return Z}}function lZ(J){var Z=J.reduce(function(q,Q){var W=q[Q.name];return q[Q.name]=W?Object.assign({},W,Q,{options:Object.assign({},W.options,Q.options),data:Object.assign({},W.data,Q.data)}):Q,q},{});return Object.keys(Z).map(function(q){return Z[q]})}var LF=function(){for(var J=arguments.length,Z=new Array(J),q=0;q<J;q++)Z[q]=arguments[q];return!Z.some(function(Q){return!(Q&&typeof Q.getBoundingClientRect==="function")})};function L4(J){if(J===void 0)J={};var Z=J,q=Z.defaultModifiers,Q=q===void 0?[]:q,W=Z.defaultOptions,K=W===void 0?NF:W;return function X(Y,z,G){if(G===void 0)G=K;var H={placement:"bottom",orderedModifiers:[],options:Object.assign({},NF,K),modifiersData:{},elements:{reference:Y,popper:z},attributes:{},styles:{}},j=[],N=!1,L={state:H,setOptions:function h(b){var C=typeof b==="function"?b(H.options):b;V(),H.options=Object.assign({},K,H.options,C),H.scrollParents={reference:V6(Y)?f9(Y):Y.contextElement?f9(Y.contextElement):[],popper:f9(z)};var _=dZ(lZ([].concat(Q,H.options.modifiers)));return H.orderedModifiers=_.filter(function(E){return E.enabled}),M(),L.update()},forceUpdate:function h(){if(N)return;var b=H.elements,C=b.reference,_=b.popper;if(!LF(C,_))return;H.rects={reference:oZ(C,f6(_),H.options.strategy==="fixed"),popper:j8(_)},H.reset=!1,H.placement=H.options.placement,H.orderedModifiers.forEach(function(F0){return H.modifiersData[F0.name]=Object.assign({},F0.data)});for(var E=0;E<H.orderedModifiers.length;E++){if(H.reset===!0){H.reset=!1,E=-1;continue}var S=H.orderedModifiers[E],m=S.fn,o=S.options,L0=o===void 0?{}:o,R0=S.name;if(typeof m==="function")H=m({state:H,options:L0,name:R0,instance:L})||H}},update:nZ(function(){return new Promise(function(h){L.forceUpdate(),h(H)})}),destroy:function h(){V(),N=!0}};if(!LF(Y,z))return L;L.setOptions(G).then(function(h){if(!N&&G.onFirstUpdate)G.onFirstUpdate(h)});function M(){H.orderedModifiers.forEach(function(h){var{name:b,options:C}=h,_=C===void 0?{}:C,E=h.effect;if(typeof E==="function"){var S=E({state:H,name:b,instance:L,options:_}),m=function o(){};j.push(S||m)}})}function V(){j.forEach(function(h){return h()}),j=[]}return L}}var NF={placement:"bottom",modifiers:[],strategy:"absolute"},Mb=L4();var Pb=[O5,E5,C5,b5],Vb=L4({defaultModifiers:Pb});var Ub=[O5,E5,C5,b5,gZ,uZ,pZ,TZ,xZ],T5=L4({defaultModifiers:Ub});var iF=function(J,Z){return Z&&`${Z}::${MF++}`||J.uidEvent||MF++},tF=function(J){const Z=iF(J);return J.uidEvent=Z,iZ[Z]=iZ[Z]||{},iZ[Z]},yb=function(J,Z){return function q(Q){if(kq(Q,{delegateTarget:J}),q.oneOff)I.off(J,Q.type,Z);return Z.apply(J,[Q])}},Eb=function(J,Z,q){return function Q(W){const K=J.querySelectorAll(Z);for(let{target:X}=W;X&&X!==this;X=X.parentNode)for(let Y of K){if(Y!==X)continue;if(kq(W,{delegateTarget:X}),Q.oneOff)I.off(J,W.type,Z,q);return q.apply(X,[W])}}},eF=function(J,Z,q=null){return Object.values(J).find((Q)=>Q.callable===Z&&Q.delegationSelector===q)},JH=function(J,Z,q){const Q=typeof Z==="string",W=Q?q:Z||q;let K=ZH(J);if(!Ob.has(K))K=J;return[Q,W,K]},PF=function(J,Z,q,Q,W){if(typeof Z!=="string"||!J)return;let[K,X,Y]=JH(Z,q,Q);if(Z in sF)X=((M)=>{return function(V){if(!V.relatedTarget||V.relatedTarget!==V.delegateTarget&&!V.delegateTarget.contains(V.relatedTarget))return M.call(this,V)}})(X);const z=tF(J),G=z[Y]||(z[Y]={}),H=eF(G,X,K?q:null);if(H){H.oneOff=H.oneOff&&W;return}const j=iF(X,Z.replace(Bb,"")),N=K?Eb(J,q,X):yb(J,X);N.delegationSelector=K?q:null,N.callable=X,N.oneOff=W,N.uidEvent=j,G[j]=N,J.addEventListener(Y,N,K)},Gq=function(J,Z,q,Q,W){const K=eF(Z[q],Q,W);if(!K)return;J.removeEventListener(q,K,Boolean(W)),delete Z[q][K.uidEvent]},Tb=function(J,Z,q,Q){const W=Z[q]||{};for(let[K,X]of Object.entries(W))if(K.includes(Q))Gq(J,Z,q,X.callable,X.delegationSelector)},ZH=function(J){return J=J.replace(Ib,""),sF[J]||J},kq=function(J,Z={}){for(let[q,Q]of Object.entries(Z))try{J[q]=Q}catch(W){Object.defineProperty(J,q,{configurable:!0,get(){return Q}})}return J},VF=function(J){if(J==="true")return!0;if(J==="false")return!1;if(J===Number(J).toString())return Number(J);if(J===""||J==="null")return null;if(typeof J!=="string")return J;try{return JSON.parse(decodeURIComponent(J))}catch(Z){return J}},tZ=function(J){return J.replace(/[A-Z]/g,(Z)=>`-${Z.toLowerCase()}`)},kw=function(J,Z,q){if(!J.length)return J;if(q&&typeof q==="function")return q(J);const W=new window.DOMParser().parseFromString(J,"text/html"),K=[].concat(...W.body.querySelectorAll("*"));for(let X of K){const Y=X.nodeName.toLowerCase();if(!Object.keys(Z).includes(Y)){X.remove();continue}const z=[].concat(...X.attributes),G=[].concat(Z["*"]||[],Z[Y]||[]);for(let H of z)if(!jw(H,G))X.removeAttribute(H.nodeName)}return W.body.innerHTML};/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */var u9=new Map,rZ={set(J,Z,q){if(!u9.has(J))u9.set(J,new Map);const Q=u9.get(J);if(!Q.has(Z)&&Q.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(Q.keys())[0]}.`);return}Q.set(Z,q)},get(J,Z){if(u9.has(J))return u9.get(J).get(Z)||null;return null},remove(J,Z){if(!u9.has(J))return;const q=u9.get(J);if(q.delete(Z),q.size===0)u9.delete(J)}},hb=1e6,Rb=1000,Hq="transitionend",oF=(J)=>{if(J&&window.CSS&&window.CSS.escape)J=J.replace(/#([^\s"#']+)/g,(Z,q)=>`#${CSS.escape(q)}`);return J},bb=(J)=>{if(J===null||J===void 0)return`${J}`;return Object.prototype.toString.call(J).match(/\s([a-z]+)/i)[1].toLowerCase()},Db=(J)=>{do J+=Math.floor(Math.random()*hb);while(document.getElementById(J));return J},Ab=(J)=>{if(!J)return 0;let{transitionDuration:Z,transitionDelay:q}=window.getComputedStyle(J);const Q=Number.parseFloat(Z),W=Number.parseFloat(q);if(!Q&&!W)return 0;return Z=Z.split(",")[0],q=q.split(",")[0],(Number.parseFloat(Z)+Number.parseFloat(q))*Rb},dF=(J)=>{J.dispatchEvent(new Event(Hq))},j9=(J)=>{if(!J||typeof J!=="object")return!1;if(typeof J.jquery!=="undefined")J=J[0];return typeof J.nodeType!=="undefined"},x9=(J)=>{if(j9(J))return J.jquery?J[0]:J;if(typeof J==="string"&&J.length>0)return document.querySelector(oF(J));return null},b4=(J)=>{if(!j9(J)||J.getClientRects().length===0)return!1;const Z=getComputedStyle(J).getPropertyValue("visibility")==="visible",q=J.closest("details:not([open])");if(!q)return Z;if(q!==J){const Q=J.closest("summary");if(Q&&Q.parentNode!==q)return!1;if(Q===null)return!1}return Z},g9=(J)=>{if(!J||J.nodeType!==Node.ELEMENT_NODE)return!0;if(J.classList.contains("disabled"))return!0;if(typeof J.disabled!=="undefined")return J.disabled;return J.hasAttribute("disabled")&&J.getAttribute("disabled")!=="false"},nF=(J)=>{if(!document.documentElement.attachShadow)return null;if(typeof J.getRootNode==="function"){const Z=J.getRootNode();return Z instanceof ShadowRoot?Z:null}if(J instanceof ShadowRoot)return J;if(!J.parentNode)return null;return nF(J.parentNode)},Y2=()=>{},f5=(J)=>{J.offsetHeight},lF=()=>{if(window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery"))return window.jQuery;return null},sZ=[],wb=(J)=>{if(document.readyState==="loading"){if(!sZ.length)document.addEventListener("DOMContentLoaded",()=>{for(let Z of sZ)Z()});sZ.push(J)}else J()},R6=()=>document.documentElement.dir==="rtl",D6=(J)=>{wb(()=>{const Z=lF();if(Z){const q=J.NAME,Q=Z.fn[q];Z.fn[q]=J.jQueryInterface,Z.fn[q].Constructor=J,Z.fn[q].noConflict=()=>{return Z.fn[q]=Q,J.jQueryInterface}}})},X6=(J,Z=[],q=J)=>{return typeof J==="function"?J(...Z):q},rF=(J,Z,q=!0)=>{if(!q){X6(J);return}const Q=5,W=Ab(Z)+Q;let K=!1;const X=({target:Y})=>{if(Y!==Z)return;K=!0,Z.removeEventListener(Hq,X),X6(J)};Z.addEventListener(Hq,X),setTimeout(()=>{if(!K)dF(Z)},W)},jq=(J,Z,q,Q)=>{const W=J.length;let K=J.indexOf(Z);if(K===-1)return!q&&Q?J[W-1]:J[0];if(K+=q?1:-1,Q)K=(K+W)%W;return J[Math.max(0,Math.min(K,W-1))]},Bb=/[^.]*(?=\..*)\.|.*/,Ib=/\..*/,Cb=/::\d+$/,iZ={},MF=1,sF={mouseenter:"mouseover",mouseleave:"mouseout"},Ob=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]),I={on(J,Z,q,Q){PF(J,Z,q,Q,!1)},one(J,Z,q,Q){PF(J,Z,q,Q,!0)},off(J,Z,q,Q){if(typeof Z!=="string"||!J)return;const[W,K,X]=JH(Z,q,Q),Y=X!==Z,z=tF(J),G=z[X]||{},H=Z.startsWith(".");if(typeof K!=="undefined"){if(!Object.keys(G).length)return;Gq(J,z,X,K,W?q:null);return}if(H)for(let j of Object.keys(z))Tb(J,z,j,Z.slice(1));for(let[j,N]of Object.entries(G)){const L=j.replace(Cb,"");if(!Y||Z.includes(L))Gq(J,z,X,N.callable,N.delegationSelector)}},trigger(J,Z,q){if(typeof Z!=="string"||!J)return null;const Q=lF(),W=ZH(Z),K=Z!==W;let X=null,Y=!0,z=!0,G=!1;if(K&&Q)X=Q.Event(Z,q),Q(J).trigger(X),Y=!X.isPropagationStopped(),z=!X.isImmediatePropagationStopped(),G=X.isDefaultPrevented();const H=kq(new Event(Z,{bubbles:Y,cancelable:!0}),q);if(G)H.preventDefault();if(z)J.dispatchEvent(H);if(H.defaultPrevented&&X)X.preventDefault();return H}},k9={setDataAttribute(J,Z,q){J.setAttribute(`data-bs-${tZ(Z)}`,q)},removeDataAttribute(J,Z){J.removeAttribute(`data-bs-${tZ(Z)}`)},getDataAttributes(J){if(!J)return{};const Z={},q=Object.keys(J.dataset).filter((Q)=>Q.startsWith("bs")&&!Q.startsWith("bsConfig"));for(let Q of q){let W=Q.replace(/^bs/,"");W=W.charAt(0).toLowerCase()+W.slice(1,W.length),Z[W]=VF(J.dataset[Q])}return Z},getDataAttribute(J,Z){return VF(J.getAttribute(`data-bs-${tZ(Z)}`))}};class D4{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(J){return J=this._mergeConfigObj(J),J=this._configAfterMerge(J),this._typeCheckConfig(J),J}_configAfterMerge(J){return J}_mergeConfigObj(J,Z){const q=j9(Z)?k9.getDataAttribute(Z,"config"):{};return{...this.constructor.Default,...typeof q==="object"?q:{},...j9(Z)?k9.getDataAttributes(Z):{},...typeof J==="object"?J:{}}}_typeCheckConfig(J,Z=this.constructor.DefaultType){for(let[q,Q]of Object.entries(Z)){const W=J[q],K=j9(W)?"element":bb(W);if(!new RegExp(Q).test(K))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${q}" provided type "${K}" but expected type "${Q}".`)}}}var Sb="5.3.3";class A6 extends D4{constructor(J,Z){super();if(J=x9(J),!J)return;this._element=J,this._config=this._getConfig(Z),rZ.set(this._element,this.constructor.DATA_KEY,this)}dispose(){rZ.remove(this._element,this.constructor.DATA_KEY),I.off(this._element,this.constructor.EVENT_KEY);for(let J of Object.getOwnPropertyNames(this))this[J]=null}_queueCallback(J,Z,q=!0){rF(J,Z,q)}_getConfig(J){return J=this._mergeConfigObj(J,this._element),J=this._configAfterMerge(J),this._typeCheckConfig(J),J}static getInstance(J){return rZ.get(x9(J),this.DATA_KEY)}static getOrCreateInstance(J,Z={}){return this.getInstance(J)||new this(J,typeof Z==="object"?Z:null)}static get VERSION(){return Sb}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(J){return`${J}${this.EVENT_KEY}`}}var eZ=(J)=>{let Z=J.getAttribute("data-bs-target");if(!Z||Z==="#"){let q=J.getAttribute("href");if(!q||!q.includes("#")&&!q.startsWith("."))return null;if(q.includes("#")&&!q.startsWith("#"))q=`#${q.split("#")[1]}`;Z=q&&q!=="#"?q.trim():null}return Z?Z.split(",").map((q)=>oF(q)).join(","):null},f={find(J,Z=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(Z,J))},findOne(J,Z=document.documentElement){return Element.prototype.querySelector.call(Z,J)},children(J,Z){return[].concat(...J.children).filter((q)=>q.matches(Z))},parents(J,Z){const q=[];let Q=J.parentNode.closest(Z);while(Q)q.push(Q),Q=Q.parentNode.closest(Z);return q},prev(J,Z){let q=J.previousElementSibling;while(q){if(q.matches(Z))return[q];q=q.previousElementSibling}return[]},next(J,Z){let q=J.nextElementSibling;while(q){if(q.matches(Z))return[q];q=q.nextElementSibling}return[]},focusableChildren(J){const Z=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((q)=>`${q}:not([tabindex^="-"])`).join(",");return this.find(Z,J).filter((q)=>!g9(q)&&b4(q))},getSelectorFromElement(J){const Z=eZ(J);if(Z)return f.findOne(Z)?Z:null;return null},getElementFromSelector(J){const Z=eZ(J);return Z?f.findOne(Z):null},getMultipleElementsFromSelector(J){const Z=eZ(J);return Z?f.find(Z):[]}},G2=(J,Z="hide")=>{const q=`click.dismiss${J.EVENT_KEY}`,Q=J.NAME;I.on(document,q,`[data-bs-dismiss="${Q}"]`,function(W){if(["A","AREA"].includes(this.tagName))W.preventDefault();if(g9(this))return;const K=f.getElementFromSelector(this)||this.closest(`.${Q}`);J.getOrCreateInstance(K)[Z]()})},_b="alert",vb="bs.alert",qH=`.${vb}`,fb=`close${qH}`,ub=`closed${qH}`,xb="fade",gb="show";class $2 extends A6{static get NAME(){return _b}close(){if(I.trigger(this._element,fb).defaultPrevented)return;this._element.classList.remove(gb);const Z=this._element.classList.contains(xb);this._queueCallback(()=>this._destroyElement(),this._element,Z)}_destroyElement(){this._element.remove(),I.trigger(this._element,ub),this.dispose()}static jQueryInterface(J){return this.each(function(){const Z=$2.getOrCreateInstance(this);if(typeof J!=="string")return;if(Z[J]===void 0||J.startsWith("_")||J==="constructor")throw new TypeError(`No method named "${J}"`);Z[J](this)})}}G2($2,"close");D6($2);var mb="button",pb="bs.button",ab=`.${pb}`,cb=".data-api",ob="active",UF='[data-bs-toggle="button"]',db=`click${ab}${cb}`;class j2 extends A6{static get NAME(){return mb}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(ob))}static jQueryInterface(J){return this.each(function(){const Z=j2.getOrCreateInstance(this);if(J==="toggle")Z[J]()})}}I.on(document,db,UF,(J)=>{J.preventDefault();const Z=J.target.closest(UF);j2.getOrCreateInstance(Z).toggle()});D6(j2);var nb="swipe",A4=".bs.swipe",lb=`touchstart${A4}`,rb=`touchmove${A4}`,sb=`touchend${A4}`,ib=`pointerdown${A4}`,tb=`pointerup${A4}`,eb="touch",JD="pen",ZD="pointer-event",qD=40,QD={endCallback:null,leftCallback:null,rightCallback:null},WD={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class z2 extends D4{constructor(J,Z){super();if(this._element=J,!J||!z2.isSupported())return;this._config=this._getConfig(Z),this._deltaX=0,this._supportPointerEvents=Boolean(window.PointerEvent),this._initEvents()}static get Default(){return QD}static get DefaultType(){return WD}static get NAME(){return nb}dispose(){I.off(this._element,A4)}_start(J){if(!this._supportPointerEvents){this._deltaX=J.touches[0].clientX;return}if(this._eventIsPointerPenTouch(J))this._deltaX=J.clientX}_end(J){if(this._eventIsPointerPenTouch(J))this._deltaX=J.clientX-this._deltaX;this._handleSwipe(),X6(this._config.endCallback)}_move(J){this._deltaX=J.touches&&J.touches.length>1?0:J.touches[0].clientX-this._deltaX}_handleSwipe(){const J=Math.abs(this._deltaX);if(J<=qD)return;const Z=J/this._deltaX;if(this._deltaX=0,!Z)return;X6(Z>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){if(this._supportPointerEvents)I.on(this._element,ib,(J)=>this._start(J)),I.on(this._element,tb,(J)=>this._end(J)),this._element.classList.add(ZD);else I.on(this._element,lb,(J)=>this._start(J)),I.on(this._element,rb,(J)=>this._move(J)),I.on(this._element,sb,(J)=>this._end(J))}_eventIsPointerPenTouch(J){return this._supportPointerEvents&&(J.pointerType===JD||J.pointerType===eb)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}var KD="carousel",XD="bs.carousel",a9=`.${XD}`,QH=".data-api",YD="ArrowLeft",zD="ArrowRight",FD=500,S5="next",M4="prev",V4="left",K2="right",HD=`slide${a9}`,Jq=`slid${a9}`,GD=`keydown${a9}`,$D=`mouseenter${a9}`,jD=`mouseleave${a9}`,kD=`dragstart${a9}`,ND=`load${a9}${QH}`,LD=`click${a9}${QH}`,WH="carousel",e3="active",MD="slide",PD="carousel-item-end",VD="carousel-item-start",UD="carousel-item-next",hD="carousel-item-prev",KH=".active",XH=".carousel-item",RD=KH+XH,bD=".carousel-item img",DD=".carousel-indicators",AD="[data-bs-slide], [data-bs-slide-to]",wD='[data-bs-ride="carousel"]',BD={[YD]:K2,[zD]:V4},ID={interval:5000,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},CD={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class u5 extends A6{constructor(J,Z){super(J,Z);if(this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=f.findOne(DD,this._element),this._addEventListeners(),this._config.ride===WH)this.cycle()}static get Default(){return ID}static get DefaultType(){return CD}static get NAME(){return KD}next(){this._slide(S5)}nextWhenVisible(){if(!document.hidden&&b4(this._element))this.next()}prev(){this._slide(M4)}pause(){if(this._isSliding)dF(this._element);this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(!this._config.ride)return;if(this._isSliding){I.one(this._element,Jq,()=>this.cycle());return}this.cycle()}to(J){const Z=this._getItems();if(J>Z.length-1||J<0)return;if(this._isSliding){I.one(this._element,Jq,()=>this.to(J));return}const q=this._getItemIndex(this._getActive());if(q===J)return;const Q=J>q?S5:M4;this._slide(Q,Z[J])}dispose(){if(this._swipeHelper)this._swipeHelper.dispose();super.dispose()}_configAfterMerge(J){return J.defaultInterval=J.interval,J}_addEventListeners(){if(this._config.keyboard)I.on(this._element,GD,(J)=>this._keydown(J));if(this._config.pause==="hover")I.on(this._element,$D,()=>this.pause()),I.on(this._element,jD,()=>this._maybeEnableCycle());if(this._config.touch&&z2.isSupported())this._addTouchEventListeners()}_addTouchEventListeners(){for(let q of f.find(bD,this._element))I.on(q,kD,(Q)=>Q.preventDefault());const Z={leftCallback:()=>this._slide(this._directionToOrder(V4)),rightCallback:()=>this._slide(this._directionToOrder(K2)),endCallback:()=>{if(this._config.pause!=="hover")return;if(this.pause(),this.touchTimeout)clearTimeout(this.touchTimeout);this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),FD+this._config.interval)}};this._swipeHelper=new z2(this._element,Z)}_keydown(J){if(/input|textarea/i.test(J.target.tagName))return;const Z=BD[J.key];if(Z)J.preventDefault(),this._slide(this._directionToOrder(Z))}_getItemIndex(J){return this._getItems().indexOf(J)}_setActiveIndicatorElement(J){if(!this._indicatorsElement)return;const Z=f.findOne(KH,this._indicatorsElement);Z.classList.remove(e3),Z.removeAttribute("aria-current");const q=f.findOne(`[data-bs-slide-to="${J}"]`,this._indicatorsElement);if(q)q.classList.add(e3),q.setAttribute("aria-current","true")}_updateInterval(){const J=this._activeElement||this._getActive();if(!J)return;const Z=Number.parseInt(J.getAttribute("data-bs-interval"),10);this._config.interval=Z||this._config.defaultInterval}_slide(J,Z=null){if(this._isSliding)return;const q=this._getActive(),Q=J===S5,W=Z||jq(this._getItems(),q,Q,this._config.wrap);if(W===q)return;const K=this._getItemIndex(W),X=(N)=>{return I.trigger(this._element,N,{relatedTarget:W,direction:this._orderToDirection(J),from:this._getItemIndex(q),to:K})};if(X(HD).defaultPrevented)return;if(!q||!W)return;const z=Boolean(this._interval);this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(K),this._activeElement=W;const G=Q?VD:PD,H=Q?UD:hD;W.classList.add(H),f5(W),q.classList.add(G),W.classList.add(G);const j=()=>{W.classList.remove(G,H),W.classList.add(e3),q.classList.remove(e3,H,G),this._isSliding=!1,X(Jq)};if(this._queueCallback(j,q,this._isAnimated()),z)this.cycle()}_isAnimated(){return this._element.classList.contains(MD)}_getActive(){return f.findOne(RD,this._element)}_getItems(){return f.find(XH,this._element)}_clearInterval(){if(this._interval)clearInterval(this._interval),this._interval=null}_directionToOrder(J){if(R6())return J===V4?M4:S5;return J===V4?S5:M4}_orderToDirection(J){if(R6())return J===M4?V4:K2;return J===M4?K2:V4}static jQueryInterface(J){return this.each(function(){const Z=u5.getOrCreateInstance(this,J);if(typeof J==="number"){Z.to(J);return}if(typeof J==="string"){if(Z[J]===void 0||J.startsWith("_")||J==="constructor")throw new TypeError(`No method named "${J}"`);Z[J]()}})}}I.on(document,LD,AD,function(J){const Z=f.getElementFromSelector(this);if(!Z||!Z.classList.contains(WH))return;J.preventDefault();const q=u5.getOrCreateInstance(Z),Q=this.getAttribute("data-bs-slide-to");if(Q){q.to(Q),q._maybeEnableCycle();return}if(k9.getDataAttribute(this,"slide")==="next"){q.next(),q._maybeEnableCycle();return}q.prev(),q._maybeEnableCycle()});I.on(window,ND,()=>{const J=f.find(wD);for(let Z of J)u5.getOrCreateInstance(Z)});D6(u5);var OD="collapse",yD="bs.collapse",x5=`.${yD}`,ED=".data-api",TD=`show${x5}`,SD=`shown${x5}`,_D=`hide${x5}`,vD=`hidden${x5}`,fD=`click${x5}${ED}`,Zq="show",h4="collapse",J2="collapsing",uD="collapsed",xD=`:scope .${h4} .${h4}`,gD="collapse-horizontal",mD="width",pD="height",aD=".collapse.show, .collapse.collapsing",$q='[data-bs-toggle="collapse"]',cD={parent:null,toggle:!0},oD={parent:"(null|element)",toggle:"boolean"};class v5 extends A6{constructor(J,Z){super(J,Z);this._isTransitioning=!1,this._triggerArray=[];const q=f.find($q);for(let Q of q){const W=f.getSelectorFromElement(Q),K=f.find(W).filter((X)=>X===this._element);if(W!==null&&K.length)this._triggerArray.push(Q)}if(this._initializeChildren(),!this._config.parent)this._addAriaAndCollapsedClass(this._triggerArray,this._isShown());if(this._config.toggle)this.toggle()}static get Default(){return cD}static get DefaultType(){return oD}static get NAME(){return OD}toggle(){if(this._isShown())this.hide();else this.show()}show(){if(this._isTransitioning||this._isShown())return;let J=[];if(this._config.parent)J=this._getFirstLevelChildren(aD).filter((X)=>X!==this._element).map((X)=>v5.getOrCreateInstance(X,{toggle:!1}));if(J.length&&J[0]._isTransitioning)return;if(I.trigger(this._element,TD).defaultPrevented)return;for(let X of J)X.hide();const q=this._getDimension();this._element.classList.remove(h4),this._element.classList.add(J2),this._element.style[q]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const Q=()=>{this._isTransitioning=!1,this._element.classList.remove(J2),this._element.classList.add(h4,Zq),this._element.style[q]="",I.trigger(this._element,SD)},K=`scroll${q[0].toUpperCase()+q.slice(1)}`;this._queueCallback(Q,this._element,!0),this._element.style[q]=`${this._element[K]}px`}hide(){if(this._isTransitioning||!this._isShown())return;if(I.trigger(this._element,_D).defaultPrevented)return;const Z=this._getDimension();this._element.style[Z]=`${this._element.getBoundingClientRect()[Z]}px`,f5(this._element),this._element.classList.add(J2),this._element.classList.remove(h4,Zq);for(let Q of this._triggerArray){const W=f.getElementFromSelector(Q);if(W&&!this._isShown(W))this._addAriaAndCollapsedClass([Q],!1)}this._isTransitioning=!0;const q=()=>{this._isTransitioning=!1,this._element.classList.remove(J2),this._element.classList.add(h4),I.trigger(this._element,vD)};this._element.style[Z]="",this._queueCallback(q,this._element,!0)}_isShown(J=this._element){return J.classList.contains(Zq)}_configAfterMerge(J){return J.toggle=Boolean(J.toggle),J.parent=x9(J.parent),J}_getDimension(){return this._element.classList.contains(gD)?mD:pD}_initializeChildren(){if(!this._config.parent)return;const J=this._getFirstLevelChildren($q);for(let Z of J){const q=f.getElementFromSelector(Z);if(q)this._addAriaAndCollapsedClass([Z],this._isShown(q))}}_getFirstLevelChildren(J){const Z=f.find(xD,this._config.parent);return f.find(J,this._config.parent).filter((q)=>!Z.includes(q))}_addAriaAndCollapsedClass(J,Z){if(!J.length)return;for(let q of J)q.classList.toggle(uD,!Z),q.setAttribute("aria-expanded",Z)}static jQueryInterface(J){const Z={};if(typeof J==="string"&&/show|hide/.test(J))Z.toggle=!1;return this.each(function(){const q=v5.getOrCreateInstance(this,Z);if(typeof J==="string"){if(typeof q[J]==="undefined")throw new TypeError(`No method named "${J}"`);q[J]()}})}}I.on(document,fD,$q,function(J){if(J.target.tagName==="A"||J.delegateTarget&&J.delegateTarget.tagName==="A")J.preventDefault();for(let Z of f.getMultipleElementsFromSelector(this))v5.getOrCreateInstance(Z,{toggle:!1}).toggle()});D6(v5);var hF="dropdown",dD="bs.dropdown",h8=`.${dD}`,Nq=".data-api",nD="Escape",RF="Tab",lD="ArrowUp",bF="ArrowDown",rD=2,sD=`hide${h8}`,iD=`hidden${h8}`,tD=`show${h8}`,eD=`shown${h8}`,YH=`click${h8}${Nq}`,zH=`keydown${h8}${Nq}`,JA=`keyup${h8}${Nq}`,U4="show",ZA="dropup",qA="dropend",QA="dropstart",WA="dropup-center",KA="dropdown-center",V8='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',XA=`${V8}.${U4}`,X2=".dropdown-menu",YA=".navbar",zA=".navbar-nav",FA=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",HA=R6()?"top-end":"top-start",GA=R6()?"top-start":"top-end",$A=R6()?"bottom-end":"bottom-start",jA=R6()?"bottom-start":"bottom-end",kA=R6()?"left-start":"right-start",NA=R6()?"right-start":"left-start",LA="top",MA="bottom",PA={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},VA={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class s6 extends A6{constructor(J,Z){super(J,Z);this._popper=null,this._parent=this._element.parentNode,this._menu=f.next(this._element,X2)[0]||f.prev(this._element,X2)[0]||f.findOne(X2,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return PA}static get DefaultType(){return VA}static get NAME(){return hF}toggle(){return this._isShown()?this.hide():this.show()}show(){if(g9(this._element)||this._isShown())return;const J={relatedTarget:this._element};if(I.trigger(this._element,tD,J).defaultPrevented)return;if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(zA))for(let q of[].concat(...document.body.children))I.on(q,"mouseover",Y2);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(U4),this._element.classList.add(U4),I.trigger(this._element,eD,J)}hide(){if(g9(this._element)||!this._isShown())return;const J={relatedTarget:this._element};this._completeHide(J)}dispose(){if(this._popper)this._popper.destroy();super.dispose()}update(){if(this._inNavbar=this._detectNavbar(),this._popper)this._popper.update()}_completeHide(J){if(I.trigger(this._element,sD,J).defaultPrevented)return;if("ontouchstart"in document.documentElement)for(let q of[].concat(...document.body.children))I.off(q,"mouseover",Y2);if(this._popper)this._popper.destroy();this._menu.classList.remove(U4),this._element.classList.remove(U4),this._element.setAttribute("aria-expanded","false"),k9.removeDataAttribute(this._menu,"popper"),I.trigger(this._element,iD,J)}_getConfig(J){if(J=super._getConfig(J),typeof J.reference==="object"&&!j9(J.reference)&&typeof J.reference.getBoundingClientRect!=="function")throw new TypeError(`${hF.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return J}_createPopper(){if(typeof t3==="undefined")throw new TypeError("Bootstrap\'s dropdowns require Popper (https://popper.js.org)");let J=this._element;if(this._config.reference==="parent")J=this._parent;else if(j9(this._config.reference))J=x9(this._config.reference);else if(typeof this._config.reference==="object")J=this._config.reference;const Z=this._getPopperConfig();this._popper=T5(J,this._menu,Z)}_isShown(){return this._menu.classList.contains(U4)}_getPlacement(){const J=this._parent;if(J.classList.contains(qA))return kA;if(J.classList.contains(QA))return NA;if(J.classList.contains(WA))return LA;if(J.classList.contains(KA))return MA;const Z=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";if(J.classList.contains(ZA))return Z?GA:HA;return Z?jA:$A}_detectNavbar(){return this._element.closest(YA)!==null}_getOffset(){const{offset:J}=this._config;if(typeof J==="string")return J.split(",").map((Z)=>Number.parseInt(Z,10));if(typeof J==="function")return(Z)=>J(Z,this._element);return J}_getPopperConfig(){const J={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};if(this._inNavbar||this._config.display==="static")k9.setDataAttribute(this._menu,"popper","static"),J.modifiers=[{name:"applyStyles",enabled:!1}];return{...J,...X6(this._config.popperConfig,[J])}}_selectMenuItem({key:J,target:Z}){const q=f.find(FA,this._menu).filter((Q)=>b4(Q));if(!q.length)return;jq(q,Z,J===bF,!q.includes(Z)).focus()}static jQueryInterface(J){return this.each(function(){const Z=s6.getOrCreateInstance(this,J);if(typeof J!=="string")return;if(typeof Z[J]==="undefined")throw new TypeError(`No method named "${J}"`);Z[J]()})}static clearMenus(J){if(J.button===rD||J.type==="keyup"&&J.key!==RF)return;const Z=f.find(XA);for(let q of Z){const Q=s6.getInstance(q);if(!Q||Q._config.autoClose===!1)continue;const W=J.composedPath(),K=W.includes(Q._menu);if(W.includes(Q._element)||Q._config.autoClose==="inside"&&!K||Q._config.autoClose==="outside"&&K)continue;if(Q._menu.contains(J.target)&&(J.type==="keyup"&&J.key===RF||/input|select|option|textarea|form/i.test(J.target.tagName)))continue;const X={relatedTarget:Q._element};if(J.type==="click")X.clickEvent=J;Q._completeHide(X)}}static dataApiKeydownHandler(J){const Z=/input|textarea/i.test(J.target.tagName),q=J.key===nD,Q=[lD,bF].includes(J.key);if(!Q&&!q)return;if(Z&&!q)return;J.preventDefault();const W=this.matches(V8)?this:f.prev(this,V8)[0]||f.next(this,V8)[0]||f.findOne(V8,J.delegateTarget.parentNode),K=s6.getOrCreateInstance(W);if(Q){J.stopPropagation(),K.show(),K._selectMenuItem(J);return}if(K._isShown())J.stopPropagation(),K.hide(),W.focus()}}I.on(document,zH,V8,s6.dataApiKeydownHandler);I.on(document,zH,X2,s6.dataApiKeydownHandler);I.on(document,YH,s6.clearMenus);I.on(document,JA,s6.clearMenus);I.on(document,YH,V8,function(J){J.preventDefault(),s6.getOrCreateInstance(this).toggle()});D6(s6);var FH="backdrop",UA="fade",DF="show",AF=`mousedown.bs.${FH}`,hA={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},RA={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class Lq extends D4{constructor(J){super();this._config=this._getConfig(J),this._isAppended=!1,this._element=null}static get Default(){return hA}static get DefaultType(){return RA}static get NAME(){return FH}show(J){if(!this._config.isVisible){X6(J);return}this._append();const Z=this._getElement();if(this._config.isAnimated)f5(Z);Z.classList.add(DF),this._emulateAnimation(()=>{X6(J)})}hide(J){if(!this._config.isVisible){X6(J);return}this._getElement().classList.remove(DF),this._emulateAnimation(()=>{this.dispose(),X6(J)})}dispose(){if(!this._isAppended)return;I.off(this._element,AF),this._element.remove(),this._isAppended=!1}_getElement(){if(!this._element){const J=document.createElement("div");if(J.className=this._config.className,this._config.isAnimated)J.classList.add(UA);this._element=J}return this._element}_configAfterMerge(J){return J.rootElement=x9(J.rootElement),J}_append(){if(this._isAppended)return;const J=this._getElement();this._config.rootElement.append(J),I.on(J,AF,()=>{X6(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(J){rF(J,this._getElement(),this._config.isAnimated)}}var bA="focustrap",DA="bs.focustrap",F2=`.${DA}`,AA=`focusin${F2}`,wA=`keydown.tab${F2}`,BA="Tab",IA="forward",wF="backward",CA={autofocus:!0,trapElement:null},OA={autofocus:"boolean",trapElement:"element"};class Mq extends D4{constructor(J){super();this._config=this._getConfig(J),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return CA}static get DefaultType(){return OA}static get NAME(){return bA}activate(){if(this._isActive)return;if(this._config.autofocus)this._config.trapElement.focus();I.off(document,F2),I.on(document,AA,(J)=>this._handleFocusin(J)),I.on(document,wA,(J)=>this._handleKeydown(J)),this._isActive=!0}deactivate(){if(!this._isActive)return;this._isActive=!1,I.off(document,F2)}_handleFocusin(J){const{trapElement:Z}=this._config;if(J.target===document||J.target===Z||Z.contains(J.target))return;const q=f.focusableChildren(Z);if(q.length===0)Z.focus();else if(this._lastTabNavDirection===wF)q[q.length-1].focus();else q[0].focus()}_handleKeydown(J){if(J.key!==BA)return;this._lastTabNavDirection=J.shiftKey?wF:IA}}var BF=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",IF=".sticky-top",Z2="padding-right",CF="margin-right";class H2{constructor(){this._element=document.body}getWidth(){const J=document.documentElement.clientWidth;return Math.abs(window.innerWidth-J)}hide(){const J=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Z2,(Z)=>Z+J),this._setElementAttributes(BF,Z2,(Z)=>Z+J),this._setElementAttributes(IF,CF,(Z)=>Z-J)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Z2),this._resetElementAttributes(BF,Z2),this._resetElementAttributes(IF,CF)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(J,Z,q){const Q=this.getWidth(),W=(K)=>{if(K!==this._element&&window.innerWidth>K.clientWidth+Q)return;this._saveInitialAttribute(K,Z);const X=window.getComputedStyle(K).getPropertyValue(Z);K.style.setProperty(Z,`${q(Number.parseFloat(X))}px`)};this._applyManipulationCallback(J,W)}_saveInitialAttribute(J,Z){const q=J.style.getPropertyValue(Z);if(q)k9.setDataAttribute(J,Z,q)}_resetElementAttributes(J,Z){const q=(Q)=>{const W=k9.getDataAttribute(Q,Z);if(W===null){Q.style.removeProperty(Z);return}k9.removeDataAttribute(Q,Z),Q.style.setProperty(Z,W)};this._applyManipulationCallback(J,q)}_applyManipulationCallback(J,Z){if(j9(J)){Z(J);return}for(let q of f.find(J,this._element))Z(q)}}var yA="modal",EA="bs.modal",b6=`.${EA}`,TA=".data-api",SA="Escape",_A=`hide${b6}`,vA=`hidePrevented${b6}`,HH=`hidden${b6}`,GH=`show${b6}`,fA=`shown${b6}`,uA=`resize${b6}`,xA=`click.dismiss${b6}`,gA=`mousedown.dismiss${b6}`,mA=`keydown.dismiss${b6}`,pA=`click${b6}${TA}`,OF="modal-open",aA="fade",yF="show",qq="modal-static",cA=".modal.show",oA=".modal-dialog",dA=".modal-body",nA='[data-bs-toggle="modal"]',lA={backdrop:!0,focus:!0,keyboard:!0},rA={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class m9 extends A6{constructor(J,Z){super(J,Z);this._dialog=f.findOne(oA,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new H2,this._addEventListeners()}static get Default(){return lA}static get DefaultType(){return rA}static get NAME(){return yA}toggle(J){return this._isShown?this.hide():this.show(J)}show(J){if(this._isShown||this._isTransitioning)return;if(I.trigger(this._element,GH,{relatedTarget:J}).defaultPrevented)return;this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(OF),this._adjustDialog(),this._backdrop.show(()=>this._showElement(J))}hide(){if(!this._isShown||this._isTransitioning)return;if(I.trigger(this._element,_A).defaultPrevented)return;this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(yF),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())}dispose(){I.off(window,b6),I.off(this._dialog,b6),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Lq({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Mq({trapElement:this._element})}_showElement(J){if(!document.body.contains(this._element))document.body.append(this._element);this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const Z=f.findOne(dA,this._dialog);if(Z)Z.scrollTop=0;f5(this._element),this._element.classList.add(yF);const q=()=>{if(this._config.focus)this._focustrap.activate();this._isTransitioning=!1,I.trigger(this._element,fA,{relatedTarget:J})};this._queueCallback(q,this._dialog,this._isAnimated())}_addEventListeners(){I.on(this._element,mA,(J)=>{if(J.key!==SA)return;if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}),I.on(window,uA,()=>{if(this._isShown&&!this._isTransitioning)this._adjustDialog()}),I.on(this._element,gA,(J)=>{I.one(this._element,xA,(Z)=>{if(this._element!==J.target||this._element!==Z.target)return;if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}if(this._config.backdrop)this.hide()})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(OF),this._resetAdjustments(),this._scrollBar.reset(),I.trigger(this._element,HH)})}_isAnimated(){return this._element.classList.contains(aA)}_triggerBackdropTransition(){if(I.trigger(this._element,vA).defaultPrevented)return;const Z=this._element.scrollHeight>document.documentElement.clientHeight,q=this._element.style.overflowY;if(q==="hidden"||this._element.classList.contains(qq))return;if(!Z)this._element.style.overflowY="hidden";this._element.classList.add(qq),this._queueCallback(()=>{this._element.classList.remove(qq),this._queueCallback(()=>{this._element.style.overflowY=q},this._dialog)},this._dialog),this._element.focus()}_adjustDialog(){const J=this._element.scrollHeight>document.documentElement.clientHeight,Z=this._scrollBar.getWidth(),q=Z>0;if(q&&!J){const Q=R6()?"paddingLeft":"paddingRight";this._element.style[Q]=`${Z}px`}if(!q&&J){const Q=R6()?"paddingRight":"paddingLeft";this._element.style[Q]=`${Z}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(J,Z){return this.each(function(){const q=m9.getOrCreateInstance(this,J);if(typeof J!=="string")return;if(typeof q[J]==="undefined")throw new TypeError(`No method named "${J}"`);q[J](Z)})}}I.on(document,pA,nA,function(J){const Z=f.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName))J.preventDefault();I.one(Z,GH,(W)=>{if(W.defaultPrevented)return;I.one(Z,HH,()=>{if(b4(this))this.focus()})});const q=f.findOne(cA);if(q)m9.getInstance(q).hide();m9.getOrCreateInstance(Z).toggle(this)});G2(m9);D6(m9);var sA="offcanvas",iA="bs.offcanvas",N9=`.${iA}`,$H=".data-api",tA=`load${N9}${$H}`,eA="Escape",EF="show",TF="showing",SF="hiding",Jw="offcanvas-backdrop",jH=".offcanvas.show",Zw=`show${N9}`,qw=`shown${N9}`,Qw=`hide${N9}`,_F=`hidePrevented${N9}`,kH=`hidden${N9}`,Ww=`resize${N9}`,Kw=`click${N9}${$H}`,Xw=`keydown.dismiss${N9}`,Yw='[data-bs-toggle="offcanvas"]',zw={backdrop:!0,keyboard:!0,scroll:!1},Fw={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class p9 extends A6{constructor(J,Z){super(J,Z);this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return zw}static get DefaultType(){return Fw}static get NAME(){return sA}toggle(J){return this._isShown?this.hide():this.show(J)}show(J){if(this._isShown)return;if(I.trigger(this._element,Zw,{relatedTarget:J}).defaultPrevented)return;if(this._isShown=!0,this._backdrop.show(),!this._config.scroll)new H2().hide();this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(TF);const q=()=>{if(!this._config.scroll||this._config.backdrop)this._focustrap.activate();this._element.classList.add(EF),this._element.classList.remove(TF),I.trigger(this._element,qw,{relatedTarget:J})};this._queueCallback(q,this._element,!0)}hide(){if(!this._isShown)return;if(I.trigger(this._element,Qw).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(SF),this._backdrop.hide();const Z=()=>{if(this._element.classList.remove(EF,SF),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),!this._config.scroll)new H2().reset();I.trigger(this._element,kH)};this._queueCallback(Z,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const J=()=>{if(this._config.backdrop==="static"){I.trigger(this._element,_F);return}this.hide()},Z=Boolean(this._config.backdrop);return new Lq({className:Jw,isVisible:Z,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:Z?J:null})}_initializeFocusTrap(){return new Mq({trapElement:this._element})}_addEventListeners(){I.on(this._element,Xw,(J)=>{if(J.key!==eA)return;if(this._config.keyboard){this.hide();return}I.trigger(this._element,_F)})}static jQueryInterface(J){return this.each(function(){const Z=p9.getOrCreateInstance(this,J);if(typeof J!=="string")return;if(Z[J]===void 0||J.startsWith("_")||J==="constructor")throw new TypeError(`No method named "${J}"`);Z[J](this)})}}I.on(document,Kw,Yw,function(J){const Z=f.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName))J.preventDefault();if(g9(this))return;I.one(Z,kH,()=>{if(b4(this))this.focus()});const q=f.findOne(jH);if(q&&q!==Z)p9.getInstance(q).hide();p9.getOrCreateInstance(Z).toggle(this)});I.on(window,tA,()=>{for(let J of f.find(jH))p9.getOrCreateInstance(J).show()});I.on(window,Ww,()=>{for(let J of f.find("[aria-modal][class*=show][class*=offcanvas-]"))if(getComputedStyle(J).position!=="fixed")p9.getOrCreateInstance(J).hide()});G2(p9);D6(p9);var Hw=/^aria-[\w-]*$/i,NH={"*":["class","dir","id","lang","role",Hw],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Gw=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),$w=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,jw=(J,Z)=>{const q=J.nodeName.toLowerCase();if(Z.includes(q)){if(Gw.has(q))return Boolean($w.test(J.nodeValue));return!0}return Z.filter((Q)=>Q instanceof RegExp).some((Q)=>Q.test(q))},Nw="TemplateFactory",Lw={allowList:NH,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Mw={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},Pw={entry:"(string|element|function|null)",selector:"(string|element)"};class LH extends D4{constructor(J){super();this._config=this._getConfig(J)}static get Default(){return Lw}static get DefaultType(){return Mw}static get NAME(){return Nw}getContent(){return Object.values(this._config.content).map((J)=>this._resolvePossibleFunction(J)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(J){return this._checkContent(J),this._config.content={...this._config.content,...J},this}toHtml(){const J=document.createElement("div");J.innerHTML=this._maybeSanitize(this._config.template);for(let[Q,W]of Object.entries(this._config.content))this._setContent(J,W,Q);const Z=J.children[0],q=this._resolvePossibleFunction(this._config.extraClass);if(q)Z.classList.add(...q.split(" "));return Z}_typeCheckConfig(J){super._typeCheckConfig(J),this._checkContent(J.content)}_checkContent(J){for(let[Z,q]of Object.entries(J))super._typeCheckConfig({selector:Z,entry:q},Pw)}_setContent(J,Z,q){const Q=f.findOne(q,J);if(!Q)return;if(Z=this._resolvePossibleFunction(Z),!Z){Q.remove();return}if(j9(Z)){this._putElementInTemplate(x9(Z),Q);return}if(this._config.html){Q.innerHTML=this._maybeSanitize(Z);return}Q.textContent=Z}_maybeSanitize(J){return this._config.sanitize?kw(J,this._config.allowList,this._config.sanitizeFn):J}_resolvePossibleFunction(J){return X6(J,[this])}_putElementInTemplate(J,Z){if(this._config.html){Z.innerHTML="",Z.append(J);return}Z.textContent=J.textContent}}var Vw="tooltip",Uw=new Set(["sanitize","allowList","sanitizeFn"]),Qq="fade",hw="modal",q2="show",Rw=".tooltip-inner",vF=`.${hw}`,fF="hide.bs.modal",_5="hover",Wq="focus",bw="click",Dw="manual",Aw="hide",ww="hidden",Bw="show",Iw="shown",Cw="inserted",Ow="click",yw="focusin",Ew="focusout",Tw="mouseenter",Sw="mouseleave",_w={AUTO:"auto",TOP:"top",RIGHT:R6()?"left":"right",BOTTOM:"bottom",LEFT:R6()?"right":"left"},vw={allowList:NH,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},fw={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class w4 extends A6{constructor(J,Z){if(typeof t3==="undefined")throw new TypeError("Bootstrap\'s tooltips require Popper (https://popper.js.org)");super(J,Z);if(this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),!this._config.selector)this._fixTitle()}static get Default(){return vw}static get DefaultType(){return fw}static get NAME(){return Vw}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(!this._isEnabled)return;if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}dispose(){if(clearTimeout(this._timeout),I.off(this._element.closest(vF),fF,this._hideModalHandler),this._element.getAttribute("data-bs-original-title"))this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title"));this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const J=I.trigger(this._element,this.constructor.eventName(Bw)),q=(nF(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(J.defaultPrevented||!q)return;this._disposePopper();const Q=this._getTipElement();this._element.setAttribute("aria-describedby",Q.getAttribute("id"));const{container:W}=this._config;if(!this._element.ownerDocument.documentElement.contains(this.tip))W.append(Q),I.trigger(this._element,this.constructor.eventName(Cw));if(this._popper=this._createPopper(Q),Q.classList.add(q2),"ontouchstart"in document.documentElement)for(let X of[].concat(...document.body.children))I.on(X,"mouseover",Y2);const K=()=>{if(I.trigger(this._element,this.constructor.eventName(Iw)),this._isHovered===!1)this._leave();this._isHovered=!1};this._queueCallback(K,this.tip,this._isAnimated())}hide(){if(!this._isShown())return;if(I.trigger(this._element,this.constructor.eventName(Aw)).defaultPrevented)return;if(this._getTipElement().classList.remove(q2),"ontouchstart"in document.documentElement)for(let Q of[].concat(...document.body.children))I.off(Q,"mouseover",Y2);this._activeTrigger[bw]=!1,this._activeTrigger[Wq]=!1,this._activeTrigger[_5]=!1,this._isHovered=null;const q=()=>{if(this._isWithActiveTrigger())return;if(!this._isHovered)this._disposePopper();this._element.removeAttribute("aria-describedby"),I.trigger(this._element,this.constructor.eventName(ww))};this._queueCallback(q,this.tip,this._isAnimated())}update(){if(this._popper)this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){if(!this.tip)this.tip=this._createTipElement(this._newContent||this._getContentForTemplate());return this.tip}_createTipElement(J){const Z=this._getTemplateFactory(J).toHtml();if(!Z)return null;Z.classList.remove(Qq,q2),Z.classList.add(`bs-${this.constructor.NAME}-auto`);const q=Db(this.constructor.NAME).toString();if(Z.setAttribute("id",q),this._isAnimated())Z.classList.add(Qq);return Z}setContent(J){if(this._newContent=J,this._isShown())this._disposePopper(),this.show()}_getTemplateFactory(J){if(this._templateFactory)this._templateFactory.changeContent(J);else this._templateFactory=new LH({...this._config,content:J,extraClass:this._resolvePossibleFunction(this._config.customClass)});return this._templateFactory}_getContentForTemplate(){return{[Rw]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(J){return this.constructor.getOrCreateInstance(J.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Qq)}_isShown(){return this.tip&&this.tip.classList.contains(q2)}_createPopper(J){const Z=X6(this._config.placement,[this,J,this._element]),q=_w[Z.toUpperCase()];return T5(this._element,J,this._getPopperConfig(q))}_getOffset(){const{offset:J}=this._config;if(typeof J==="string")return J.split(",").map((Z)=>Number.parseInt(Z,10));if(typeof J==="function")return(Z)=>J(Z,this._element);return J}_resolvePossibleFunction(J){return X6(J,[this._element])}_getPopperConfig(J){const Z={placement:J,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:(q)=>{this._getTipElement().setAttribute("data-popper-placement",q.state.placement)}}]};return{...Z,...X6(this._config.popperConfig,[Z])}}_setListeners(){const J=this._config.trigger.split(" ");for(let Z of J)if(Z==="click")I.on(this._element,this.constructor.eventName(Ow),this._config.selector,(q)=>{this._initializeOnDelegatedTarget(q).toggle()});else if(Z!==Dw){const q=Z===_5?this.constructor.eventName(Tw):this.constructor.eventName(yw),Q=Z===_5?this.constructor.eventName(Sw):this.constructor.eventName(Ew);I.on(this._element,q,this._config.selector,(W)=>{const K=this._initializeOnDelegatedTarget(W);K._activeTrigger[W.type==="focusin"?Wq:_5]=!0,K._enter()}),I.on(this._element,Q,this._config.selector,(W)=>{const K=this._initializeOnDelegatedTarget(W);K._activeTrigger[W.type==="focusout"?Wq:_5]=K._element.contains(W.relatedTarget),K._leave()})}this._hideModalHandler=()=>{if(this._element)this.hide()},I.on(this._element.closest(vF),fF,this._hideModalHandler)}_fixTitle(){const J=this._element.getAttribute("title");if(!J)return;if(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim())this._element.setAttribute("aria-label",J);this._element.setAttribute("data-bs-original-title",J),this._element.removeAttribute("title")}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{if(this._isHovered)this.show()},this._config.delay.show)}_leave(){if(this._isWithActiveTrigger())return;this._isHovered=!1,this._setTimeout(()=>{if(!this._isHovered)this.hide()},this._config.delay.hide)}_setTimeout(J,Z){clearTimeout(this._timeout),this._timeout=setTimeout(J,Z)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(J){const Z=k9.getDataAttributes(this._element);for(let q of Object.keys(Z))if(Uw.has(q))delete Z[q];return J={...Z,...typeof J==="object"&&J?J:{}},J=this._mergeConfigObj(J),J=this._configAfterMerge(J),this._typeCheckConfig(J),J}_configAfterMerge(J){if(J.container=J.container===!1?document.body:x9(J.container),typeof J.delay==="number")J.delay={show:J.delay,hide:J.delay};if(typeof J.title==="number")J.title=J.title.toString();if(typeof J.content==="number")J.content=J.content.toString();return J}_getDelegateConfig(){const J={};for(let[Z,q]of Object.entries(this._config))if(this.constructor.Default[Z]!==q)J[Z]=q;return J.selector=!1,J.trigger="manual",J}_disposePopper(){if(this._popper)this._popper.destroy(),this._popper=null;if(this.tip)this.tip.remove(),this.tip=null}static jQueryInterface(J){return this.each(function(){const Z=w4.getOrCreateInstance(this,J);if(typeof J!=="string")return;if(typeof Z[J]==="undefined")throw new TypeError(`No method named "${J}"`);Z[J]()})}}D6(w4);var uw="popover",xw=".popover-header",gw=".popover-body",mw={...w4.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},pw={...w4.DefaultType,content:"(null|string|element|function)"};class Pq extends w4{static get Default(){return mw}static get DefaultType(){return pw}static get NAME(){return uw}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[xw]:this._getTitle(),[gw]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(J){return this.each(function(){const Z=Pq.getOrCreateInstance(this,J);if(typeof J!=="string")return;if(typeof Z[J]==="undefined")throw new TypeError(`No method named "${J}"`);Z[J]()})}}D6(Pq);var aw="scrollspy",cw="bs.scrollspy",Vq=`.${cw}`,ow=".data-api",dw=`activate${Vq}`,uF=`click${Vq}`,nw=`load${Vq}${ow}`,lw="dropdown-item",P4="active",rw='[data-bs-spy="scroll"]',Kq="[href]",sw=".nav, .list-group",xF=".nav-link",iw=".nav-item",tw=".list-group-item",ew=`${xF}, ${iw} > ${xF}, ${tw}`,JB=".dropdown",ZB=".dropdown-toggle",qB={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[0.1,0.5,1]},QB={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class k2 extends A6{constructor(J,Z){super(J,Z);this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return qB}static get DefaultType(){return QB}static get NAME(){return aw}refresh(){if(this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer)this._observer.disconnect();else this._observer=this._getNewObserver();for(let J of this._observableSections.values())this._observer.observe(J)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(J){if(J.target=x9(J.target)||document.body,J.rootMargin=J.offset?`${J.offset}px 0px -30%`:J.rootMargin,typeof J.threshold==="string")J.threshold=J.threshold.split(",").map((Z)=>Number.parseFloat(Z));return J}_maybeEnableSmoothScroll(){if(!this._config.smoothScroll)return;I.off(this._config.target,uF),I.on(this._config.target,uF,Kq,(J)=>{const Z=this._observableSections.get(J.target.hash);if(Z){J.preventDefault();const q=this._rootElement||window,Q=Z.offsetTop-this._element.offsetTop;if(q.scrollTo){q.scrollTo({top:Q,behavior:"smooth"});return}q.scrollTop=Q}})}_getNewObserver(){const J={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver((Z)=>this._observerCallback(Z),J)}_observerCallback(J){const Z=(K)=>this._targetLinks.get(`#${K.target.id}`),q=(K)=>{this._previousScrollData.visibleEntryTop=K.target.offsetTop,this._process(Z(K))},Q=(this._rootElement||document.documentElement).scrollTop,W=Q>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=Q;for(let K of J){if(!K.isIntersecting){this._activeTarget=null,this._clearActiveClass(Z(K));continue}const X=K.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(W&&X){if(q(K),!Q)return;continue}if(!W&&!X)q(K)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const J=f.find(Kq,this._config.target);for(let Z of J){if(!Z.hash||g9(Z))continue;const q=f.findOne(decodeURI(Z.hash),this._element);if(b4(q))this._targetLinks.set(decodeURI(Z.hash),Z),this._observableSections.set(Z.hash,q)}}_process(J){if(this._activeTarget===J)return;this._clearActiveClass(this._config.target),this._activeTarget=J,J.classList.add(P4),this._activateParents(J),I.trigger(this._element,dw,{relatedTarget:J})}_activateParents(J){if(J.classList.contains(lw)){f.findOne(ZB,J.closest(JB)).classList.add(P4);return}for(let Z of f.parents(J,sw))for(let q of f.prev(Z,ew))q.classList.add(P4)}_clearActiveClass(J){J.classList.remove(P4);const Z=f.find(`${Kq}.${P4}`,J);for(let q of Z)q.classList.remove(P4)}static jQueryInterface(J){return this.each(function(){const Z=k2.getOrCreateInstance(this,J);if(typeof J!=="string")return;if(Z[J]===void 0||J.startsWith("_")||J==="constructor")throw new TypeError(`No method named "${J}"`);Z[J]()})}}I.on(window,nw,()=>{for(let J of f.find(rw))k2.getOrCreateInstance(J)});D6(k2);var WB="tab",KB="bs.tab",R8=`.${KB}`,XB=`hide${R8}`,YB=`hidden${R8}`,zB=`show${R8}`,FB=`shown${R8}`,HB=`click${R8}`,GB=`keydown${R8}`,$B=`load${R8}`,jB="ArrowLeft",gF="ArrowRight",kB="ArrowUp",mF="ArrowDown",Xq="Home",pF="End",U8="active",aF="fade",Yq="show",NB="dropdown",MH=".dropdown-toggle",LB=".dropdown-menu",zq=`:not(${MH})`,MB='.list-group, .nav, [role="tablist"]',PB=".nav-item, .list-group-item",VB=`.nav-link${zq}, .list-group-item${zq}, [role="tab"]${zq}`,PH='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Fq=`${VB}, ${PH}`,UB=`.${U8}[data-bs-toggle="tab"], .${U8}[data-bs-toggle="pill"], .${U8}[data-bs-toggle="list"]`;class R4 extends A6{constructor(J){super(J);if(this._parent=this._element.closest(MB),!this._parent)return;this._setInitialAttributes(this._parent,this._getChildren()),I.on(this._element,GB,(Z)=>this._keydown(Z))}static get NAME(){return WB}show(){const J=this._element;if(this._elemIsActive(J))return;const Z=this._getActiveElem(),q=Z?I.trigger(Z,XB,{relatedTarget:J}):null;if(I.trigger(J,zB,{relatedTarget:Z}).defaultPrevented||q&&q.defaultPrevented)return;this._deactivate(Z,J),this._activate(J,Z)}_activate(J,Z){if(!J)return;J.classList.add(U8),this._activate(f.getElementFromSelector(J));const q=()=>{if(J.getAttribute("role")!=="tab"){J.classList.add(Yq);return}J.removeAttribute("tabindex"),J.setAttribute("aria-selected",!0),this._toggleDropDown(J,!0),I.trigger(J,FB,{relatedTarget:Z})};this._queueCallback(q,J,J.classList.contains(aF))}_deactivate(J,Z){if(!J)return;J.classList.remove(U8),J.blur(),this._deactivate(f.getElementFromSelector(J));const q=()=>{if(J.getAttribute("role")!=="tab"){J.classList.remove(Yq);return}J.setAttribute("aria-selected",!1),J.setAttribute("tabindex","-1"),this._toggleDropDown(J,!1),I.trigger(J,YB,{relatedTarget:Z})};this._queueCallback(q,J,J.classList.contains(aF))}_keydown(J){if(![jB,gF,kB,mF,Xq,pF].includes(J.key))return;J.stopPropagation(),J.preventDefault();const Z=this._getChildren().filter((Q)=>!g9(Q));let q;if([Xq,pF].includes(J.key))q=Z[J.key===Xq?0:Z.length-1];else{const Q=[gF,mF].includes(J.key);q=jq(Z,J.target,Q,!0)}if(q)q.focus({preventScroll:!0}),R4.getOrCreateInstance(q).show()}_getChildren(){return f.find(Fq,this._parent)}_getActiveElem(){return this._getChildren().find((J)=>this._elemIsActive(J))||null}_setInitialAttributes(J,Z){this._setAttributeIfNotExists(J,"role","tablist");for(let q of Z)this._setInitialAttributesOnChild(q)}_setInitialAttributesOnChild(J){J=this._getInnerElement(J);const Z=this._elemIsActive(J),q=this._getOuterElement(J);if(J.setAttribute("aria-selected",Z),q!==J)this._setAttributeIfNotExists(q,"role","presentation");if(!Z)J.setAttribute("tabindex","-1");this._setAttributeIfNotExists(J,"role","tab"),this._setInitialAttributesOnTargetPanel(J)}_setInitialAttributesOnTargetPanel(J){const Z=f.getElementFromSelector(J);if(!Z)return;if(this._setAttributeIfNotExists(Z,"role","tabpanel"),J.id)this._setAttributeIfNotExists(Z,"aria-labelledby",`${J.id}`)}_toggleDropDown(J,Z){const q=this._getOuterElement(J);if(!q.classList.contains(NB))return;const Q=(W,K)=>{const X=f.findOne(W,q);if(X)X.classList.toggle(K,Z)};Q(MH,U8),Q(LB,Yq),q.setAttribute("aria-expanded",Z)}_setAttributeIfNotExists(J,Z,q){if(!J.hasAttribute(Z))J.setAttribute(Z,q)}_elemIsActive(J){return J.classList.contains(U8)}_getInnerElement(J){return J.matches(Fq)?J:f.findOne(Fq,J)}_getOuterElement(J){return J.closest(PB)||J}static jQueryInterface(J){return this.each(function(){const Z=R4.getOrCreateInstance(this);if(typeof J!=="string")return;if(Z[J]===void 0||J.startsWith("_")||J==="constructor")throw new TypeError(`No method named "${J}"`);Z[J]()})}}I.on(document,HB,PH,function(J){if(["A","AREA"].includes(this.tagName))J.preventDefault();if(g9(this))return;R4.getOrCreateInstance(this).show()});I.on(window,$B,()=>{for(let J of f.find(UB))R4.getOrCreateInstance(J)});D6(R4);var hB="toast",RB="bs.toast",c9=`.${RB}`,bB=`mouseover${c9}`,DB=`mouseout${c9}`,AB=`focusin${c9}`,wB=`focusout${c9}`,BB=`hide${c9}`,IB=`hidden${c9}`,CB=`show${c9}`,OB=`shown${c9}`,yB="fade",cF="hide",Q2="show",W2="showing",EB={animation:"boolean",autohide:"boolean",delay:"number"},TB={animation:!0,autohide:!0,delay:5000};class N2 extends A6{constructor(J,Z){super(J,Z);this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return TB}static get DefaultType(){return EB}static get NAME(){return hB}show(){if(I.trigger(this._element,CB).defaultPrevented)return;if(this._clearTimeout(),this._config.animation)this._element.classList.add(yB);const Z=()=>{this._element.classList.remove(W2),I.trigger(this._element,OB),this._maybeScheduleHide()};this._element.classList.remove(cF),f5(this._element),this._element.classList.add(Q2,W2),this._queueCallback(Z,this._element,this._config.animation)}hide(){if(!this.isShown())return;if(I.trigger(this._element,BB).defaultPrevented)return;const Z=()=>{this._element.classList.add(cF),this._element.classList.remove(W2,Q2),I.trigger(this._element,IB)};this._element.classList.add(W2),this._queueCallback(Z,this._element,this._config.animation)}dispose(){if(this._clearTimeout(),this.isShown())this._element.classList.remove(Q2);super.dispose()}isShown(){return this._element.classList.contains(Q2)}_maybeScheduleHide(){if(!this._config.autohide)return;if(this._hasMouseInteraction||this._hasKeyboardInteraction)return;this._timeout=setTimeout(()=>{this.hide()},this._config.delay)}_onInteraction(J,Z){switch(J.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=Z;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=Z;break}}if(Z){this._clearTimeout();return}const q=J.relatedTarget;if(this._element===q||this._element.contains(q))return;this._maybeScheduleHide()}_setListeners(){I.on(this._element,bB,(J)=>this._onInteraction(J,!0)),I.on(this._element,DB,(J)=>this._onInteraction(J,!1)),I.on(this._element,AB,(J)=>this._onInteraction(J,!0)),I.on(this._element,wB,(J)=>this._onInteraction(J,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(J){return this.each(function(){const Z=N2.getOrCreateInstance(this,J);if(typeof J==="string"){if(typeof Z[J]==="undefined")throw new TypeError(`No method named "${J}"`);Z[J](this)}})}}G2(N2);D6(N2);class Uq{constructor(){this.modal=new m9("#controller",{}),this.initKeyInputs()}show(){this.modal.show()}initKeyInputs(){document.querySelectorAll(".control-input").forEach((Z)=>{Z.addEventListener("keydown",(q)=>{if(this.handleKeyDown(Z,q))return q.preventDefault(),!1}),Z.addEventListener("input",()=>{})})}handleKeyDown(J,Z){if(Z.key.length==1&&!Z.metaKey&&!Z.ctrlKey)return J.value=Z.key.toLowerCase(),!0}}class hq{constructor(){this.controllerConfig=null}domLoaded(){this.controllerConfig=new Uq;const J=n64js.debugger();$(".tabbable a").on("shown.bs.tab",()=>{J.redraw()}),J.redraw()}toggleControllerConfig(){this.controllerConfig.show()}triggerLoad(){const J=document.getElementById("fileInput");J.value="",J.click()}loadFile(){const J=document.getElementById("fileInput");if(J&&J.files.length>0){const Z=J.files[0],q=new FileReader;q.onerror=()=>{this.displayError("loading file")},q.onload=(Q)=>{n64js.loadRomAndStartRunning(Q.target.result)},q.readAsArrayBuffer(Z)}}displayWarning(J){this.displayAlert("Warning",J)}displayError(J){this.displayAlert("Error",J)}displayAlert(J,Z){const Q=document.getElementById("alert").content.cloneNode(!0),W=Q.querySelector(".alert-type"),K=Q.querySelector(".alert-message");W.textContent=J+"!",K.textContent=Z,$("#alerts").append(Q)}setRunning(J){const Z=J?'<i class="bi-pause"></i> Pause':'<i class="bi-play"></i> Run';$("#runbutton").html(Z)}}var Dq=function(J){B4=J,bq.setRunning(J)},fB=function(J){const Z=md5(J);U(`hash is ${Z}`)},uB=function(J){EY(J),fB(J);const Z=i6.createROM(J),q={header:Z.getU32(0),clock:Z.getU32(4),bootAddress:Z.getU32(8),release:Z.getU32(12),crclo:Z.getU32(16),crchi:Z.getU32(20),unk0:Z.getU32(24),unk1:Z.getU32(28),name:tz(Z.u8,32,20),unk2:Z.getU32(52),unk3:Z.getU16(56),unk4:Z.getU8(58),categoryCode:eq(Z.getU8(59)),cartId:Z.getU16(60),countryId:Z.getU8(62),romVersion:Z.getU8(63)};console.log(q);const Q=$('<table class="register-table"><tbody></tbody></table>'),W=Q.find("tbody");for(let X in q){const Y=typeof q[X]==="string"?q[X]:k(q[X]);W.append(`<tr><td>${X}</td><td>${Y}</td></tr>`)}RQ(Q),g0.cic=iz(Z.u8),g0.id=sz(q.crclo,q.crchi),g0.country=q.countryId,g0.tvType=tq(q.countryId);const K=ez[g0.id];if(K)U(`Loaded info for ${g0.id} from db`),g0.name=K.name,g0.save=K.save;else U(`No info for ${g0.id} in db`),g0.name=q.name,g0.save="Eeprom4k";U(`rominfo is ${IZ(g0)}`),$("#title").text(`n64js - ${g0.name}`)},xB=function(){const J=[],Z=new XMLHttpRequest;if(Z.open("GET","roms/n64-systemtest-all.z64",!0),Z.responseType="arraybuffer",Z.onload=()=>{const q=Z.response;if(q)n64js.loadRomAndStartRunning(q)},Z.send(null),Z.status!=200)return;for(let q=0;q<Z.responseText.length;++q)J.push(Z.responseText.charCodeAt(q)&255)},gB=function(){i6.timeline.startRecording()},Rq=function(){if(u6)u6.begin();if(B4){if(requestAnimationFrame(Rq),n64js.hardware().aiRegDevice.shouldSkipFrame())return;RH.updateInput();let J=_B;if(b8.active&&!OK())J=b8.debugCycles;if(DQ())J=AQ(J);if(J>0)n64js.cpu0.run(J),b8.redraw()}else if(CK())requestAnimationFrame(Rq),EK(),J3();if(u6)u6.end()},bH=function(J){return J+"-"+g0.id},mB=function(J){const Z=g0.name?`n64js - ${g0.name} - ${J}mspf`:`n64js - ${J}mspf`;$("#title").text(Z)},DH=function(J,Z){if(Dq(!1),Aq(),U('<span style="color:red">'+J+"</span>"),Z)n64js.ui().displayError(J)},Aq=function(){n64js.cpu0.breakExecution()};window.n64js=window.n64js||{};var _B=1e8,u6=null,B4=!1,VH=[],UH={runTest:xB,recordTimeline:gB};J6.add(UH,"runTest").name("Run n64-systemtest");J6.add(UH,"recordTimeline").name("Record Timeline");var g0={id:"",name:"",cic:"6101",country:iq,tvType:x4,save:"Eeprom4k"},i6=new BZ(g0),hH=new S2(i6),RH=new v2,vB=new u2(i6,RH.inputs),bq=new hq,b8=null;n64js.hardware=()=>i6;n64js.joybus=()=>vB;n64js.ui=()=>bq;n64js.debugger=()=>b8;n64js.loadRomAndStartRunning=(J)=>{uB(J),n64js.reset(),b8.hide(),Dq(!1),n64js.toggleRun()};n64js.toggleRun=()=>{if(Dq(!B4),B4)Rq()};n64js.toggleFullscreen=()=>{document.getElementById("display").requestFullscreen().catch((Z)=>{console.log(`Error attempting to enable fullscreen mode: ${Z.message} (${Z.name})`)})};n64js.breakEmulationForDisplayListDebug=()=>{if(B4)n64js.toggleRun(),Aq()};n64js.step=()=>{if(!B4)n64js.singleStep(),b8.redraw()};n64js.breakpoints=()=>{return hH};n64js.getLocalStorageItem=(J)=>{const Z=bH(J),q=localStorage.getItem(Z);return q?lz(q):void 0};n64js.setLocalStorageItem=(J,Z)=>{const q=bH(J),Q=IZ(Z);localStorage.setItem(q,Q)};var L2;n64js.onPresent=()=>{const J=new Date;if(L2){const Z=J.getTime()-L2.getTime();mB(Z)}L2=J};n64js.addResetCallback=(J)=>{VH.push(J)};n64js.reset=()=>{hH.reset(),bQ(),i6.reset(),kY(i6),eX(i6),IK(),i6.loadROM(),JQ(n64js.cpu0,i6,g0),L2=void 0;for(let J of VH)J()};n64js.check=(J,Z)=>{if(!J)U(Z)};n64js.warn=(J)=>{hQ(J)};n64js.stopForBreakpoint=()=>{DH("Breakpoint",!1)};n64js.halt=(J)=>{DH(J,!0)};n64js.returnControlToSystem=()=>{Aq()};n64js.init=()=>{n64js.reset(),b8=new y1,BK($("#display")),bq.domLoaded()};n64js.togglePerformance=()=>{const J=document.getElementById("performance");if(u6)J.removeChild(u6.dom),u6=null;else u6=new Stats,u6.showPanel(1),u6.dom.style.position="relative",J.appendChild(u6.dom)};
